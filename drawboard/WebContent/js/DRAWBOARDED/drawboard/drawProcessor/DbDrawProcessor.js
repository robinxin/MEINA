/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DbDrawProcessor");dojo.require("drawboard.graph.decorate.controller.MarkController");dojo.require("drawboard.graph.decorate.controller.MotionAnchorController");dojo.require("drawboard.graph.decorate.controller.RotatorController");dojo.require("drawboard.graph.decorate.controller.SkeletonController");dojo.require("drawboard.drawProcessor.DrawProcessor");dojo.require("drawboard.Constant");(function(){dojo.declare("drawboard.drawProcessor.DbDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_1){if(gp.isComposite()&&!gp.isFocus()){return;}gp.draw(_1);if(gp.isActive()){drawboard.skeletonController.draw(gp,_1);drawboard.motionAnchorController.draw(gp,_1);drawboard.rotatorController.draw(gp,_1);}((_1.getShowMark()||gp.showMark())||gp.isActive()||gp.isActived())&&drawboard.markController.draw(gp,_1);},setActive:function(gp,p,_2,_3,_4){var _5=drawboard.Constant.ActionStatus,_6,_7;if(gp&&gp.isActive()){var _8=[{controller:drawboard.skeletonController,status:_5.RESIZING},{controller:drawboard.rotatorController,status:[_5.POLEMOVING,_5.ROTATING]},{controller:drawboard.markController,status:_5.MARKING},{controller:drawboard.motionAnchorController,status:_5.MOTION}],_9,_a,_b;dojo.some(_8,function(_c){_9=_c.controller;if(_2&&_9!=_3){return;}if(!_2&&_9==_3){return;}_a=_9.active(gp,p,_4);if(_a){_6={};_b=_c.status;if(dojo.isArray(_b)){if(_9.isInPole(gp,p,_4)){_6.status=_b[0];}else{_6.status=_b[1];}}else{_6.status=_b;}_6.active=gp;_6.decorate=_a;return true;}},this);}if(!_6&&gp.isComposite()){return null;}if(!_6&&gp.active(p,_4)){_7=this.getActiveParent(gp);_6={};_6.status=_5.MOVING;if(_7&&!_7.isFocus()){gp=_7;}_6.active=gp;_6.decorate=null;}return _6;},getActiveParent:function(gp){var _d=(gp.getParent&&gp.getParent()),_e,_f;do{if(!_d||_d.isFocus()){_f=_e;break;}_e=_d;_d=(_e.getParent&&_e.getParent());}while(true);return _f;}});})();}