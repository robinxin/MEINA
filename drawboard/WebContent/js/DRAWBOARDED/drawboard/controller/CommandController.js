/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.controller.CommandController"]){dojo._hasResource["drawboard.controller.CommandController"]=true;dojo.provide("drawboard.controller.CommandController");dojo.require("common.container.ListContainer");dojo.require("common.container.MapContainer");dojo.require("common.exception.Exception");dojo.require("dojo.data.ItemFileReadStore");dojo.declare("drawboard.controller.CommandController",common.container.MapContainer,{resouce:drawboardRuntimeSetting.commands,_undoList:null,_redoList:null,maxSteps:20,store:null,constructor:function(){var _1=common.container.ListContainer;this._undoList=new _1();this._redoList=new _1();this.render();},getReadStore:function(){var _2=this.store;if(!_2){_2=new dojo.data.ItemFileReadStore({url:this.resouce});_2._forceLoad();this.store=_2;}return this.store;},render:function(){var _3=this.getReadStore(),_4,_5,_6,_7;dojo.forEach(_3._getItemsArray(),function(_8){_4=_3.getValue(_8,"type");_5=_3.getValue(_8,"command");_6=_3.getValue(_8,"desp0");_7=_3.getValue(_8,"desp1");this.registerCommand(_4,_5,_6,_7);},this);},registerCommand:function(_9,_a,_b,_c){this.addItem(_9,{command:_a,0:_b,1:_c});},instanceCommand:function(_d,_e,_f,_10,_11){var _12=this.getItem(_d),_13,_14;if(!_12){new common.exception.Exception({msg:"the command type doesn't exsit!"});return;}_14=eval(_12.command);_13=new _14(_e,_f,_10);_13.setDescription({0:_12.desp0,1:_12.desp1});_13.setRuntime(_11);return _13;},add:function(_15){var _16=this._undoList;_16.add(_15);if(_16.size()>this.maxSteps){_16.shift();}this._redoList.clearItems();},undo:function(){var _17=this._undoList.pop();if(!_17){return;}_17.unexecute();this._redoList.add(_17);},redo:function(){var _18=this._redoList.pop();if(!_18){return;}_18.execute();this._undoList.add(_18);}});}