/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.graph.CompositeProxy"]){dojo._hasResource["drawboard.graph.CompositeProxy"]=true;dojo.provide("drawboard.graph.CompositeProxy");dojo.require("drawboard.graph.GraphProxy");dojo.require("drawboard.Constant");dojo.require("common.container.ListContainer");(function(){var _1=common.calc.Geometry,_2=_1.add2Points,_3=_1.subtract2Points,_4=drawboard.Constant.Decorate;dojo.declare("drawboard.graph.CompositeProxy",[common.container.ListContainer,drawboard.graph.GraphProxy],{_focus:false,_isComposite:true,_operate:false,isFocus:function(_5){if(_5!==undefined){this._focus=_5;}return this._focus;},contains:function(gp){if(!gp){return false;}var _6=false;this.some(function(_7){if(_7.gp==gp){_6=true;return true;}},this);return _6;},remove:function(gp){var _8;this.some(function(_9,i){if(_9.gp==gp){_8=i;return true;}},this);drawboard.graph.CompositeProxy.superclass.remove.apply(this,[_8]);},equals:function(cp){if(cp.size()!=this.size()){return false;}var _a=true;this.some(function(_b){if(!cp.contains(_b.gp)){_a=false;return true;}},this);return _a;},resetRelations:function(){var _c=this,_d,gp;this.forInItems(function(_e){gp=_e.gp;_d=(gp.getParent&&gp.getParent());if(_d!=_c){_d&&_d.remove(gp);gp.getParent=function(){return _c;};}},this);},add:function(gp,_f){drawboard.graph.CompositeProxy.superclass.add.apply(this,[{gp:gp,oriPos:gp.getCoordinate(_f),oriRotator:dojo.clone(gp.getRotator(_f))}]);if(_1.graphContainsGraph(this.getSkeletonCoordinates(_f),gp.getSkeletonCoordinates(_f))){return;}var _10=_1.getMaxRect(gp.getSkeletonCoordinates(_f).concat(this.getSkeletonCoordinates(_f)));this.setCoordinate({x:_10.x,y:_10.y},_f);this.setWidth(_10.width,_f);this.setHeight(_10.height,_f);this.refresh(_f);},setRotator:function(_11,_12,_13){this._operate=true;var r=this.getRotator(_12),_14,_15=_1.rotation,_16=_11.angle-r.angle,_17=dojo.hitch(this,this.contains),_18=[];this.inherited(arguments);if(_13){return;}this.recursiveChild(_18);dojo.forEach(_18,function(gp){r=gp.getGraphRotator(_12);r.angle+=_16;_14=gp.getNWCoordinate(_12);_14=_15(_15(_14,_11.coordinate,_16),_15(r.coordinate,_11.coordinate,_16),-r.angle);gp.setCoordinate(_14,_12);gp.setRotator(r,_12,true);gp.refresh(_12,function(_19){if(_17(_19)){return false;}return true;});},this);this._operate=false;},recursiveChild:function(_1a){var gp;this.forInItems(function(_1b){gp=_1b.gp;_1a.push(gp);if(gp.recursiveChild){gp.recursiveChild(_1a);return;}},this);},deleteAll:function(db){this.forInItems(function(_1c){db.removeGraph(_1c.gp);},this);this.destroy();},destroy:function(){this.inherited(arguments);var gp;this.forInItems(function(_1d){gp=_1d.gp;gp.getParent&&(gp.getParent()==this)&&(delete gp.getParent);},this);},draw:function(_1e){this.inherited(arguments);},sizeChange:function(_1f,_20,end,_21){this._operate=true;var w=this.getWidth(_21),h=this.getHeight(_21),_22=1,_23=1,gp,nw,r,nnw,_24,_25,_26=_1.rotation,_27=this.getSkeletonCoordinates(_21)[0][0],_28=this.getRotator(_21),_29=dojo.hitch(this,this.contains);this.inherited(arguments);_22=this.getWidth(_21)/w;_23=this.getHeight(_21)/h;fixCoordinate=this.getSkeletonCoordinates(_21)[0][0];this.forInItems(function(_2a){gp=_2a.gp;_25=gp.getCoordinate(_21);nw=gp.getNWCoordinate(_21);nw=_26(nw,_27,-_28.angle);_24=_3(nw,_27);nw=_26(_2(_27,{x:_24.x*_22,y:_24.y*_23}),_27,_28.angle);nw=_2(nw,_3(fixCoordinate,_27));gp.setWidth(gp.getWidth(_21)*_22,_21);gp.setHeight(gp.getHeight(_21)*_23,_21);_21.clearCache(gp,_4.CENTER);r=gp.getGraphRotator(_21);_25=gp.getCoordinate(_21);nnw=_26(_25,r.coordinate,r.angle);gp.setCoordinate(_2(_25,_3(nw,nnw)),_21);gp.refresh(_21,function(_2b){if(_29(_2b)){return false;}return true;});},this);this._operate=false;},move:function(_2c,end,_2d){this._operate=true;this.inherited(arguments);this.forInItems(function(_2e){if(_2e){_2e.oriPos=_2(_2e.oriPos,_3(end,_2c));_2e.gp.move(_2c,end,_2d);}},this);this._operate=false;},zoom:function(_2f,_30){this._operate=true;this.inherited(arguments);this.forInItems(function(_31){if(_31){_31.gp.zoom(_2f,_30);}},this);this._operate=false;}});})();}