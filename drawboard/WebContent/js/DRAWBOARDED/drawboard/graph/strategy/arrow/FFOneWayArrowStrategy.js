/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy");dojo.require("drawboard.graph.strategy.GraphStrategy");(function(){var _1=common.calc.Geometry,_2=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_3,_4){return _1.isPointInPolyn(gp.getGraphCoordinates(_4),_3);},isAnchor:function(d){if(d.getIndex()==2){return true;}return false;},getActiveAnchors:function(gp,_5){var _6=gp.getSkeletonCoordinates(_5),_7=[_6[2]];return drawboard.skeletonController.create(_7);},getRotatorCoordinate:function(gp,_8){return this.getGraphCoordinates(gp,_8)[0];},draw:function(gp,gf,_9){var p=_2.Path,_a=gp.getGraphCoordinates(_9);gf.drawPath([{command:p.MOVE,points:_a[0]},{command:p.LINE,points:_a[1]},{command:p.LINE,points:_a[2]},{command:p.LINE,points:_a[3]},{command:p.LINE,points:_a[4]},{command:p.LINE,points:_a[5]},{command:p.LINE,points:_a[6]}],this.getStyle(gp,_9));},getGraphCoordinates:function(gp,_b){var _c=gp.getCoordinate(_b),w=gp.getWidth(_b),h=gp.getHeight(_b),x=_c.x,y=_c.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+w,y:y+h3},{x:x+w,y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_d){var _e=gp.getCoordinate(_d),w=gp.getWidth(_d),h=gp.getHeight(_d),x=_e.x,y=_e.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"}];},sizeChange:function(gp,_f,_10,_11){var d=_2.Direction,p=gp.getCoordinate(_11),w=gp.getWidth(_11),h=gp.getHeight(_11),_12=_10.x,_13=_10.y,_14=_f.getDirect();switch(_14){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_13)},_11);gp.setHeight(h-(_13<<1),_11);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_13)},_11);gp.setHeight(h+(_13<<1),_11);break;case d.WEST:var _15=gp.getMotionAnchorCoordinates(_11)[0][0],_16,wm,em,_17=gp.getRotator(_11);gp.setCoordinate({x:p.x+_12,y:p.y+_13},_11);_16=gp.getCoordinate(_11);wm={x:_16.x,y:_16.y+(h>>1)};em={x:_16.x+w,y:_16.y+(h>>1)};_17.angle=_1.angle(em,wm,_15);gp.setWidth(_1.getDistant(_15,wm),_11);gp.setRotator(_17,_11);break;case d.EAST:var _15=gp.getSkeletonCoordinates(_11)[3][0],_16=gp.getCoordinate(_11),wm,em,_18,_17=gp.getRotator(_11);wm={x:_16.x,y:_16.y+(h>>1)};em={x:_16.x+w,y:_16.y+(h>>1)};_18={x:_15.x+_12,y:_15.y+_13};_17.angle=_1.angle(em,wm,_18);gp.setWidth(_1.getDistant(_18,wm),_11);gp.setRotator(_17,_11);break;case d.END:break;default:break;}},calcMotionAnchor:function(gp,_19,_1a,_1b){var _1c=gp.getCoordinate(_1b),wm={x:_1c.x,y:_1c.y+(gp.getHeight(_1b)>>1)},em={x:_1c.x+gp.getWidth(_1b),y:_1c.y+(gp.getHeight(_1b)>>1)},_1d=_1.angle(em,wm,_1a),_1e;_1e=gp.getRotator(_1b);_1e.angle=_1d;gp.setWidth(_1.getDistant(wm,_1a),_1b);gp.setRotator(_1e,_1b);return _1a;},getMotionAnchorCoordinates:function(gp,_1f){var _20=gp.getCoordinate(_1f),w=gp.getWidth(_1f),h=gp.getHeight(_1f),x=_20.x,y=_20.y;return [{x:x+w,y:y+(h>>1)}];}});})();}