/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.MotionCircleStrategy");dojo.require("drawboard.controller.StyleController");dojo.require("drawboard.graph.strategy.SquareStrategy");(function(){var _1=common.calc.Geometry,_2=drawboard.Constant;dojo.declare("drawboard.graph.strategy.MotionCircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_3,_4){var w=gp.getWidth(_4),h=gp.getHeight(_4),r=w>h?h>>1:w>>1;return _1.isPointInCircle(_3,{coordinate:gp.getGraphCoordinates(_4)[0],r:r});},draw:function(gp,gf,_5){var p=_2.Path,w=gp.getWidth(_5),h=gp.getHeight(_5),_6=gp.getGraphCoordinates(_5),_7=gp.getMotionAnchorCoordinates(_5),_8;if(gf.getType()==_2.GraphicType.VML){var _9=gp.getCoordinate(_5),_a={x:w<0?_9.x+w:_9.x,y:h<0?_9.y+h:_9.y},_b={x:w<0?_9.x:_9.x+w,y:h<0?_9.y:_9.y+h};mstart=_7[0][0],mend=_7[1][0];_8=["wr",~~_a.x,~~_a.y,~~_b.x,~~_b.y,~~mstart.x,~~mstart.y,~~mend.x,~~mend.y];return gf.drawPath([{command:p.MOVE,points:_7[0][0]},_8.join(" ")],this.getStyle(gp,_5),true);}var r=w>h?h>>1:w>>1,a=_1.angle(_7[0][0],_6[0],_7[1][0]);_8=[p.ARC+r,r,0,(a<180?0:1)+",1",_7[1][0].x+" "+_7[1][0].y];return gf.drawPath([{command:p.MOVE,points:_7[0][0]},_8.join(" ")],this.getStyle(gp,_5),true);},getGraphCoordinates:function(gp,_c){var p=gp.getCoordinate(_c),w=gp.getWidth(_c),h=gp.getHeight(_c),r=w>h?h>>1:w>>1,_d=w>h?h:w,_e=[{x:p.x+r,y:p.y+r}];gp.setWidth(_d,_c);gp.setHeight(_d,_c);return _e;},getMotionAnchorCoordinates:function(gp,_f){var _10=gp.getRealMotionAnchors(_f),_11=[],gs,w=gp.getWidth(_f),_12=gp.getCoordinate(_f),_13=_1.rotation,_14=gp.getGraphCoordinates(_f)[0];_12.x+=(w>>1);if(!_10){_10=[10,100];gs=gp.getGraphStatus();gs.setMotionAnchors(_10,_f);}dojo.forEach(_10,function(_15){_11.push(_13(_12,_14,_15));},this);return _11;},calcMotionAnchor:function(gp,_16,_17,_18){var w=gp.getWidth(_18),h=gp.getHeight(_18),r=w>h?h>>1:w>>1,_19=gp.getCoordinate(_18),_1a=gp.getGraphCoordinates(_18),_1b=_1.intersectCircleLine(_1a[0],r,_1a[0],_17)[0];_19.x+=(w>>1);return _1.angle(_19,_1a[0],_1b);}});})();}