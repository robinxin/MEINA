/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.MotionCircleStrategy");dojo.require("drawboard.controller.StyleController");dojo.require("drawboard.graph.strategy.SquareStrategy");(function(){var _1=common.calc.Geometry,_2=drawboard.Constant;dojo.declare("drawboard.graph.strategy.MotionCircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_3,_4){var w=gp.getWidth(_4),h=gp.getHeight(_4),r=w>h?h>>1:w>>1;return _1.isPointInCircle(_3,{coordinate:gp.getGraphCoordinates(_4)[0],r:r});},draw:function(gp,gf,_5){var p=_2.Path,w=gp.getWidth(_5),h=gp.getHeight(_5),r=w>h?h>>1:w>>1,_6=gp.getGraphCoordinates(_5),_7=gp.getMotionAnchorCoordinates(_5),a=_1.angle(_7[0][0],_6[0],_7[1][0]),_8=[p.ARC+r,r,0,(a<180?0:1)+",1",_7[1][0].x+" "+_7[1][0].y];gf.drawPath([{command:p.MOVE,points:_7[0][0]},_8.join(" ")],this.getStyle(gp,_5),true);},getGraphCoordinates:function(gp,_9){var p=gp.getCoordinate(_9),w=gp.getWidth(_9),h=gp.getHeight(_9),r=w>h?h>>1:w>>1,_a=w>h?h:w,_b=[{x:p.x+r,y:p.y+r}];gp.setWidth(_a,_9);gp.setHeight(_a,_9);return _b;},getMotionAnchorCoordinates:function(gp,_c){var _d=gp.getRealMotionAnchors(_c),_e=[],gs,w=gp.getWidth(_c),_f=gp.getCoordinate(_c),_10=_1.rotation,_11=gp.getGraphCoordinates(_c)[0];_f.x+=(w>>1);if(!_d){_d=[10,100];gs=gp.getGraphStatus();gs.setMotionAnchors(_d,_c);}dojo.forEach(_d,function(_12){_e.push(_10(_f,_11,_12));},this);return _e;},calcMotionAnchor:function(gp,_13,_14,_15){var w=gp.getWidth(_15),h=gp.getHeight(_15),r=w>h?h>>1:w>>1,_16=gp.getCoordinate(_15),_17=gp.getGraphCoordinates(_15),_18=_1.intersectCircleLine(_17[0],r,_17[0],_14)[0];_16.x+=(w>>1);return _1.angle(_16,_17[0],_18);}});})();}