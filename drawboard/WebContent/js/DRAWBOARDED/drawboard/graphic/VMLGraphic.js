/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.graphic.VMLGraphic"]){dojo._hasResource["drawboard.graphic.VMLGraphic"]=true;dojo.provide("drawboard.graphic.VMLGraphic");dojo.require("drawboard.graphic.Graphic");dojo.require("common.utils.BrowerUtils");dojo.require("drawboard.Constant");(function(){var _1=dojo.attr,_2=window.location.pathname,_3=drawboard.Constant,_4=_3.Path,_5=_2.substring(0,_2.indexOf("/",1)+1),_1=function(_6,_7,_8){try{_6[_7]=_8;}catch(e){_6.setAttribute(_7,_8);}},_9=function(_a){return document.createElement(_a);},_b=common.utils.BrowerUtils,_c=new RegExp("(shape|image|rect|roundrect|oval|line|test)","ig");_c.compile();dojo.declare("drawboard.graphic.VMLGraphic",drawboard.graphic.Graphic,{anchor:null,type:_3.GraphicType.VML,createAnchor:function(w,h,_d){var _e=_9("div"),_f=["position:relative"];w&&_f.push("width:"+w);h&&_f.push("height:"+h);(_f.length>0)&&_1(_e,"style",_f.join(";"));this.anchor=_e;_d.appendChild(_e);return _e;},isGraphMark:function(_10){return _c.test(_10);},styleAdapte:function(_11,_12){_12=_12.split(";");var kv;for(var i=0;i<_12.length;i++){kv=_12[i].split(":");switch(kv[0]){case "fill":if(kv[1]!="none"){_1(_11,"filled","t");_1(_11,"fillcolor",kv[1]);}else{_1(_11,"filled","f");}break;case "stroke":_1(_11,"strokecolor",kv[1]);break;case "stroke-width":_1(_11,"strokeweight",kv[1]);break;}}},commandAdapte:function(_13){var c=_13;switch(_13){case _4.QUADRATIC:case _4.RQUADRATIC:c=_4.QUADRATICVML;break;}return c;},setSize:function(w,h){var _14=this.anchor,_15=[];w&&_15.push("width:"+w);h&&_15.push("height:"+h);(_15.length>0)&&_1(_14,"style",_15.join(";"));},drawPath:function(_16,_17,_18){var _19,d=[],ps;dojo.forEach(_16,function(_1a){if(!_1a){return;}if(typeof _1a=="string"){this.push(_1a);}else{this.push(_1a.command);ps=_1a.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((~~p.x||0)+" "+(~~p.y||0));},this);}},d);!_18&&d.push(" x");d.push(" e");_19=_9("<v:shape style='width:1;height:1;position:absolute;' CoordSize='1,1'></v:shape>");_1(_19,"path",d.join(""));this.styleAdapte(_19,_17);this.anchor.appendChild(_19);return _19;},drawCircle:function(_1b,r,_1c){var s=["position:absolute","left:"+(_1b.x-r),"top:"+(_1b.y-r),"width:"+(r<<1),"height:"+(r<<1)],_1d=_9("<v:oval style='"+s.join(";")+"'></v:oval>");this.anchor.appendChild(_1d);this.styleAdapte(_1d,_1c);return _1d;},drawEllipse:function(_1e,w,h,_1f,_20){var s=["position:absolute","left:"+_1e.x,"top:"+_1e.y,"width:"+w,"height:"+h],_21,_22=_1f.transform;if(_22){s.push(";rotation:"+_22[1].substr(7,_22[1].length-2));}_21=_9("<v:oval style='"+s.join(";")+"'></v:oval>");this.styleAdapte(_21,_20);this.anchor.appendChild(_21);return _21;},drawLine:function(p1,p2,_23){var _24=_9("<v:line style='position:absolute'><v:line>");_1(_24,"from",p1.x+","+p1.y);_1(_24,"to",p2.x+","+p2.y);this.anchor.appendChild(_24);return _24;},drawRect:function(_25,w,h,rx,_26,_27){var s=["position:absolute","left:"+_25.x,"top:"+_25.y,"width:"+w,"height:"+h],_28,_29=_26.transform;if(_29){s.push(";rotation:"+_29[1].substr(7,_29[1].length-2));}_28=(rx===undefined)?_9("<v:Rect style="+s.join(";")+"></v:Rect>"):_9("<v:RoundRect style="+s.join(";")+"></v:RoundRect>");this.styleAdapte(_28,_27);this.anchor.appendChild(_28);return _28;},drawImage:function(_2a,w,h,url,_2b){var s=["position:absolute","left:"+_2a.x,"top:"+_2a.y,"width:"+w,"height:"+h],_2c,_2d=_2b.transform;if(_2d){s.push(";rotation:"+_2d[1].substr(7,_2d[1].length-2));}_2c=_9("<v:image src='"+url+"' style='"+s.join(";")+"' ></v:image>");this.anchor.appendChild(_2c);return _2c;},drawText:function(_2e,w,h,_2f,_30,_31){var _32=_9("text"),s=_31,_33,_34=_2f&&_2f.split("\n");x=_2e&&_2e.x+(w>>1),y=_2e&&_2e.y+(h>>1),unitHeight=_2f&&_b.getFontHeight(_2f,_31);x&&_1(_32,"x",x);y&&_1(_32,"y",y);_1(_32,"width",w);_1(_32,"height",h);if(_30){for(var _35 in _30){_1(_32,_35,_30[_35] instanceof Array?_30[_35].join(" "):_30[_35]);}}s&&(s.indexOf("text-anchor")==-1)&&(s+=";text-anchor:middle;");!s&&(s="text-anchor:middle;");s&&_1(_32,"style",s);_34&&dojo.forEach(_34,function(t,_36){_33=_9("tspan");_1(_33,"x",x);_1(_33,"y",y+unitHeight*_36);_33.textContent=t;_32.appendChild(_33);},this);this.anchor.appendChild(_32);return _32;},clear:function(){var _37=this.anchor;while(_37.lastChild){_37.removeChild(_37.lastChild);}}});})();}