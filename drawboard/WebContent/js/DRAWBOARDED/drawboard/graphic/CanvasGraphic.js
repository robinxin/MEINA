/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.graphic.CanvasGraphic"]){dojo._hasResource["drawboard.graphic.CanvasGraphic"]=true;dojo.provide("drawboard.graphic.CanvasGraphic");dojo.require("drawboard.Constant");dojo.require("drawboard.cache.ResourceCache");(function(){var _1=drawboard.Constant.Path,_2=window.location.pathname,_3=_2.substring(0,_2.indexOf("/",1)+1);dojo.declare("drawboard.graphic.CanvasGraphic",null,{anchor:null,ctx:null,getContext:function(){if(!this.ctx){this.ctx=this.anchor.getContext("2d");}return this.ctx;},createAnchor:function(w,h,_4){var _5=dojo.create("canvas");w&&_5.setAttribute("width",w);h&&_5.setAttribute("height",h);_5.wkWidget=this;this.anchor=_5;_4.appendChild(_5);return _5;},setSize:function(w,h){var _6=this.anchor;dojo.attr(_6,"height",h);dojo.attr(_6,"width",w);},setStyle:function(ct,_7){if(!_7){return;}var _8=_7.split(";"),s,_9=[],_a;dojo.forEach(_8,function(_b){s=_b.split(":");switch(s[0]){case "fill":ct.fillStyle=s[1];_a="fill";break;case "stroke":ct.strokeStyle=s[1];_a="stroke";break;case "stroke-width":ct.lineWidth=s[1];_a=null;break;case "":break;default:break;}(s[1]!="none")&&_a&&_9.push(_a);},this);return function(){var _c=ct;dojo.forEach(_9,function(_d){_c[_d]();},this);};},setAttrs:function(ct,_e){if(_e){var _f,_10;for(_f in _e){if(_f=="transform"){dojo.forEach(_e[_f],function(opt){_10=opt.indexOf("rotate");if(_10!=-1){opt.substr(rindex,opt.length-2-_10);return;}eval("ct."+opt+";");},this);}}}},drawLine:function(p1,p2,_11){var ct=this.getContext(),_12=this.setStyle(ct,_11);ct.moveTo(p1.x,p1.y);ct.lineTo(p2.x,p2.y);_12();},drawRect:function(_13,w,h,rx,_14,_15){var ct=this.getContext(),_16;ct.save();_16=this.setStyle(ct,_15);this.setAttrs(_14);ct.moveTo(_13.x+(w>0?rx:-rx),_13.y);ct.arcTo(_13.x+w,_13.y,_13.x+w,_13.y+h-rx,rx);ct.arcTo(_13.x+w,_13.y+h,_13.x+rx,_13.y+h,rx);ct.arcTo(_13.x,_13.y+h,_13.x,_13.y+rx,rx);ct.arcTo(_13.x,_13.y,_13.x+(w>0?rx:-rx),_13.y,rx);_16();ct.restore();},drawCircle:function(_17,r,_18){var ct=this.getContext(),_19=this.setStyle(ct,_18);ct.beginPath();ct.arc(_17.x,_17.y,r,0,Math.PI*2,true);ct.closePath();_19();},drawPath:function(_1a,_1b,_1c){var ct=this.getContext(),p,_1d=this.setStyle(ct,_1b);ct.beginPath();dojo.forEach(_1a,function(_1e,_1f){p=_1e.points;switch(_1e.command){case _1.MOVE:case _1.RMOVE:ct.moveTo(p.x,p.y);break;case _1.LINE:case _1.RLINE:ct.lineTo(p.x,p.y);break;case _1.NONE:default:break;}},this);!_1c&&ct.closePath();_1d();},drawImage:function(_20,w,h,url,_21){var ct=this.getContext(),_22=drawboard.resourceCenter.getCache();ct.save();this.setAttrs(ct,_21);if(_22[url]){ct.drawImage(_22[url],_20.x,_20.y,w,h);}else{var img=new Image();img.onload=function(){ct.drawImage(img,_20.x,_20.y,w,h);_22[url]=img;};img.src=_3+url;}ct.restore();},clear:function(){var ct=this.getContext(),_23=ct.canvas;ct.clearRect(0,0,_23.width,_23.height);}});})();}