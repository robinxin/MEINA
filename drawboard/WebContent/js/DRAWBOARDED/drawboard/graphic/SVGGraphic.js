/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.graphic.SVGGraphic"]){dojo._hasResource["drawboard.graphic.SVGGraphic"]=true;dojo.provide("drawboard.graphic.SVGGraphic");dojo.require("drawboard.graphic.Graphic");dojo.require("common.utils.BrowerUtils");dojo.require("drawboard.Constant");(function(){var _1="http://www.w3.org/2000/svg",_2="http://www.w3.org/1999/xlink",_3=dojo.attr,_4=drawboard.Constant,_5=window.location.pathname,_6=_5.substring(0,_5.indexOf("/",1)+1),_7=function(_8,ns,_9,_a){_8.setAttributeNS?_8.setAttributeNS(ns,_9,_a):_8.setAttribute(_9,_a);},_b=function(_c){return document.createElementNS?document.createElementNS(_1,_c):document.createElement(_c);},_d=common.utils.BrowerUtils,_e=new RegExp("(path|image|rect|ellipse|line|test)","ig");_e.compile();dojo.declare("drawboard.graphic.SVGGraphic",drawboard.graphic.Graphic,{anchor:null,type:_4.GraphicType.SVG,createAnchor:function(w,h,_f){var _10=_b("svg");w&&_3(_10,"width",w);h&&_3(_10,"height",h);this.anchor=_10;_f&&(_f.appendChild(_10));return _10;},setSize:function(w,h){var _11=this.anchor;w&&_3(_11,"width",w);h&&_3(_11,"height",h);},isGraphMark:function(_12){return _e.test(_12);},drawPath:function(_13,_14,_15){var _16=_b("path"),d=[],ps;dojo.forEach(_13,function(_17){if(!_17){return;}if(typeof _17=="string"){this.push(_17);}else{this.push(_17.command);ps=_17.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((p.x?(p.y?p.x+","+p.y:p.x):p.y)+" ");},this);}},d);!_15&&d.push("Z");_3(_16,"d",d.join(""));_14&&_3(_16,"style",_14);this.anchor.appendChild(_16);return _16;},drawCircle:function(_18,r,_19){var _1a=_b("circle");_3(_1a,"cx",_18.x);_3(_1a,"cy",_18.y);_3(_1a,"r",r);_19&&_3(_1a,"style",_19);this.anchor.appendChild(_1a);return _1a;},drawEllipse:function(_1b,w,h,_1c,_1d){var _1e=_b("ellipse"),w=(w>>1),h=(h>>1);_3(_1e,"cx",_1b.x+w);_3(_1e,"cy",_1b.y+h);_3(_1e,"rx",w);_3(_1e,"ry",h);_1d&&_3(_1e,"style",_1d);if(_1c){for(var _1f in _1c){_3(_1e,_1f,((_1c[_1f] instanceof Array)?_1c[_1f].join(" "):_1c[_1f]));}}this.anchor.appendChild(_1e);return _1e;},drawLine:function(p1,p2,_20){var _21=_b("line");_3(_21,"x1",p1.x);_3(_21,"y1",p1.y);_3(_21,"x2",p2.x);_3(_21,"y2",p2.y);_20&&_3(_21,"style",_20);this.anchor.appendChild(_21);return _21;},drawRect:function(_22,w,h,rx,_23,_24){var _25=_b("rect");_3(_25,"x",_22.x);_3(_25,"y",_22.y);_3(_25,"width",w);_3(_25,"height",h);if(_23){for(var _26 in _23){_3(_25,_26,((_23[_26] instanceof Array)?_23[_26].join(" "):_23[_26]));}}(rx!==undefined&&rx!=null)&&(_3(_25,"rx",rx));_24&&_3(_25,"style",_24);this.anchor.appendChild(_25);return _25;},drawImage:function(_27,w,h,url,_28){var _29=_b("image");_27&&_3(_29,"x",_27.x);_27&&_3(_29,"y",_27.y);_3(_29,"width",w);_3(_29,"height",h);_7(_29,_2,"xlink:href",_6+url);if(_28){for(var _2a in _28){_3(_29,_2a,_28[_2a] instanceof Array?_28[_2a].join(" "):_28[_2a]);}}this.anchor.appendChild(_29);return _29;},drawText:function(_2b,w,h,_2c,_2d,_2e){var _2f=_b("text"),s=_2e,_30,_31=_2c&&_2c.split("\n");x=_2b&&_2b.x+(w>>1),y=_2b&&_2b.y+(h>>1),unitHeight=_2c&&_d.getFontHeight(_2c,_2e);x&&_3(_2f,"x",x);y&&_3(_2f,"y",y);_3(_2f,"width",w);_3(_2f,"height",h);if(_2d){for(var _32 in _2d){_3(_2f,_32,_2d[_32] instanceof Array?_2d[_32].join(" "):_2d[_32]);}}s&&(s.indexOf("text-anchor")==-1)&&(s+=";text-anchor:middle;");!s&&(s="text-anchor:middle;");s&&_3(_2f,"style",s);_31&&dojo.forEach(_31,function(t,_33){_30=_b("tspan");_3(_30,"x",x);_3(_30,"y",y+unitHeight*_33);_30.textContent=t;_2f.appendChild(_30);},this);this.anchor.appendChild(_2f);return _2f;},clear:function(){var _34=this.anchor;while(_34.lastChild){_34.removeChild(_34.lastChild);}}});})();}