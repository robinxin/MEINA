/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["drawboard.graphic.SVGIEGraphic"]){dojo._hasResource["drawboard.graphic.SVGIEGraphic"]=true;dojo.provide("drawboard.graphic.SVGIEGraphic");dojo.require("drawboard.graphic.Graphic");dojo.require("common.utils.BrowerUtils");(function(){var _1="http://www.w3.org/2000/svg",_2="http://www.w3.org/1999/xlink",_3=dojo.attr,_4=window.location.pathname,_5=_4.substring(0,_4.indexOf("/",1)+1),_6=function(_7,ns,_8,_9){_7.setAttributeNS(ns,_8,_9);},_a=common.utils.BrowerUtils;dojo.declare("drawboard.graphic.SVGIEGraphic",drawboard.graphic.Graphic,{anchor:null,embed:null,_w:null,_h:null,doc:null,createAnchor:function(w,h,_b){var _c=document.createElement("embed"),_d=document.createElement("div"),_e=_d.style;_c.type="image/svg+xml";_c.src="empty.svg";_c.wmode="Transparent";w&&(this._w=w)&&_3(_c,"width",w);h&&(this._h=h)&&_3(_c,"height",h);this.embed=_c;w&&(_e.width=w);h&&(_e.height=h);_e.position="absolute";_e.background="white";_e["z-index"]=100;_e.filter="alpha(opacity=0)";_b.appendChild(_d);_b.appendChild(_c);this.setSVGDoc();return _d;},ready:function(){if(this.doc){return true;}else{return false;}},setSVGDoc:function(){var _f=this.embed;if("getSVGDocument" in _f){var doc=_f.getSVGDocument(),svg=doc.documentElement;_3(svg,"width",this._w);_3(svg,"height",this._h);this.anchor=svg;this.doc=doc;return;}setTimeout(dojo.hitch(this,"setSVGDoc"),300);},createNS:function(ele){var doc=this.doc;return doc.createElementNS(_1,ele);},setSize:function(w,h){var _10=this.anchor;w&&_3(_10,"width",w);h&&_3(_10,"height",h);},drawPath:function(_11,_12,_13){var _14=this.createNS("path"),d=[],ps;dojo.forEach(_11,function(_15){if(!_15){return;}if(typeof _15=="string"){this.push(_15);}else{this.push(_15.command);ps=_15.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((p.x?(p.y?p.x+","+p.y:p.x):p.y)+" ");},this);}},d);!_13&&d.push("Z");_3(_14,"d",d.join(""));_12&&_3(_14,"style",_12);this.anchor.appendChild(_14);return _14;},drawCircle:function(_16,r,_17){var _18=this.createNS("circle");_3(_18,"cx",_16.x);_3(_18,"cy",_16.y);_3(_18,"r",r);_17&&_3(_18,"style",_17);this.anchor.appendChild(_18);return _18;},drawEllipse:function(_19,w,h,_1a,_1b){var _1c=this.createNS("ellipse"),w=(w>>1),h=(h>>1);_3(_1c,"cx",_19.x+w);_3(_1c,"cy",_19.y+h);_3(_1c,"rx",w);_3(_1c,"ry",h);_1b&&_3(_1c,"style",_1b);if(_1a){for(var _1d in _1a){_3(_1c,_1d,((_1a[_1d] instanceof Array)?_1a[_1d].join(" "):_1a[_1d]));}}this.anchor.appendChild(_1c);return _1c;},drawLine:function(p1,p2,_1e){var _1f=this.createNS("line");_3(_1f,"x1",p1.x);_3(_1f,"y1",p1.y);_3(_1f,"x2",p2.x);_3(_1f,"y2",p2.y);_1e&&_3(_1f,"style",_1e);this.anchor.appendChild(_1f);return _1f;},drawRect:function(_20,w,h,rx,_21,_22){var _23=this.createNS("rect");_3(_23,"x",_20.x);_3(_23,"y",_20.y);_3(_23,"width",w);_3(_23,"height",h);if(_21){for(var _24 in _21){_3(_23,_24,((_21[_24] instanceof Array)?_21[_24].join(" "):_21[_24]));}}(rx!==undefined&&rx!=null)&&(_3(_23,"rx",rx));_22&&_3(_23,"style",_22);this.anchor.appendChild(_23);return _23;},drawImage:function(_25,w,h,url,_26){var _27=this.createNS("image");_25&&_3(_27,"x",_25.x);_25&&_3(_27,"y",_25.y);_3(_27,"width",w);_3(_27,"height",h);_6(_27,_2,"xlink:href",_5+url);if(_26){for(var _28 in _26){_3(_27,_28,_26[_28] instanceof Array?_26[_28].join(" "):_26[_28]);}}this.anchor.appendChild(_27);return _27;},drawText:function(_29,w,h,_2a,_2b,_2c){var _2d=this.createNS("text"),s=_2c,_2e,_2f=_2a&&_2a.split("\n");x=_29&&_29.x+(w>>1),y=_29&&_29.y+(h>>1),unitHeight=_2a&&_a.getFontHeight(_2a,_2c);x&&_3(_2d,"x",x);y&&_3(_2d,"y",y);_3(_2d,"width",w);_3(_2d,"height",h);if(_2b){for(var _30 in _2b){_3(_2d,_30,_2b[_30] instanceof Array?_2b[_30].join(" "):_2b[_30]);}}s&&(s.indexOf("text-anchor")==-1)&&(s+=";text-anchor:middle;");!s&&(s="text-anchor:middle;");s&&_3(_2d,"style",s);_2f&&dojo.forEach(_2f,function(t,_31){_2e=this.createNS("tspan");_3(_2e,"x",x);_3(_2e,"y",y+unitHeight*_31);_2e.textContent=t;_2d.appendChild(_2e);},this);this.anchor.appendChild(_2d);return _2d;},clear:function(){var _32=this.anchor;while(_32.lastChild){_32.removeChild(_32.lastChild);}}});})();}