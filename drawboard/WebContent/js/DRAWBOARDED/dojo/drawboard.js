/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["drawboard.board.TextBoard"]){dojo._hasResource["drawboard.board.TextBoard"]=true;dojo.provide("drawboard.board.TextBoard");dojo.declare("drawboard.board.TextBoard",[dijit._Widget,dijit._Templated],{templateString:"<div style='position:absolute;display:none;'><textarea dojoAttachPoint='textContentNode'></textarea></div>",_db:null,postCreate:function(){this.inherited(arguments);},setText:function(_1){this.textContentNode.value=_1;},clearText:function(){this.textContentNode.value="";},show:function(gp){var _2=this.domNode.style,_3=this._db.getRuntime(),_4=gp.getCoordinate?gp.getCoordinate(_3):{x:gp.x,y:gp.y};_2.left=_4.x+"px";_2.top=_4.y+"px";this.textContentNode.style.width=_2.width=(gp.getWidth?gp.getWidth(_3):gp.width)+"px";this.textContentNode.style.height=_2.height=(gp.getHeight?gp.getHeight(_3):gp.height)+"px";_2.display="";},hide:function(){var _5=this.domNode.style;if(_5.display==""){var db=this._db,_6=this.textContentNode.value;db.setText(_6);this.clearText();}_5.display="none";}});}if(!dojo._hasResource["drawboard.graphic.Graphic"]){dojo._hasResource["drawboard.graphic.Graphic"]=true;dojo.provide("drawboard.graphic.Graphic");dojo.declare("drawboard.graphic.Graphic",null,{getType:function(){return this.type;},createAnchor:function(w,h,_7){},ready:function(){return true;},setStyle:function(_8){},drawLine:function(_9,w,h,_a){},drawRect:function(_b,w,h,_c){},drawCircle:function(_d,r,_e){},drawEllipse:function(_f,w,h,_10,_11){},drawPath:function(_12,_13){},drawImage:function(_14,w,h,url,_15,_16){},drawText:function(_17,w,h,_18,_19){},setSize:function(w,h){},clear:function(){}});}if(!dojo._hasResource["drawboard.Constant"]){dojo._hasResource["drawboard.Constant"]=true;dojo.provide("drawboard.Constant");drawboard.Constant={GraphicType:{SVG:0,VML:1},MouseAction:{NONE:0,MOUSEDOWN:1,MOUSEMOVE:2,MOUSEUP:3,MOUSEOVER:4,MOUSECLICK:5,MOUSEOUT:6},ActionStatus:{NONE:0,SELECTING:1,DRAWING:2,MOVING:3,MARKING:4,RESIZING:5,ROTATING:6,POLEMOVING:7,MOTION:8,TEXT:9},Decorate:{SKELETON:0,MARK:1,ROTATOR:2,MOTIONANCHOR:3,CHARACTER:4,Graph:5,CENTER:6,OUTLET:7},Direction:{EAST:0,EASTNORTH:1,NORTH:2,WESTNORTH:3,WEST:4,WESTSOUTH:5,SOUTH:6,EASTSOUTH:7,END:8},Path:{NONE:"",MOVE:"M",RMOVE:"m",LINE:"L",RLINE:"l",HORIZON:"H",RHORIZON:"h",VERTICAL:"V",RVERTICAL:"v",CUBIC:"C",RCUBIC:"c",CUBICSMOOTH:"S",CUBICRSMOOTH:"s",QUADRATIC:"Q",RQUADRATIC:"q",QUADRATICSMOOTH:"T",RQUADRATICSMOOTH:"t",ARC:"A",RARC:"a",CLOSE:"Z",RCLOSE:"z",ARCVML:"ar",CLOCKWISEARCVML:"wr",QUADRATICVML:"qb"},Command:{CREATEVSDELETECOMMAND:"createvsdelete",RESIZECOMMAND:"resize",MOVECOMMAND:"move",ROTATECOMMAND:"rotate",ZOOMCOMMAND:"zoom",STYLECOMMAND:"style",ADDVSDELTECONSTRAINCOMMAND:"addvsdeleteconstrain",COMBINEVSDEVIDEDCOMMAND:"combinevsdevided",COMPOSITECOMMAND:"composite",MOTIONCOMMAND:"motion"},Symbol:{concat:"&&"},Toolbar:{COLORPALETTE:0,DROPDOWNLIST:1,DIALOGUE:2}};}if(!dojo._hasResource["drawboard.graphic.SVGGraphic"]){dojo._hasResource["drawboard.graphic.SVGGraphic"]=true;dojo.provide("drawboard.graphic.SVGGraphic");(function(){var _1a="http://www.w3.org/2000/svg",_1b="http://www.w3.org/1999/xlink",_1c=dojo.attr,_1d=drawboard.Constant,_1e=window.location.pathname,_1f=_1e.substring(0,_1e.indexOf("/",1)+1),_20=function(_21,ns,_22,_23){_21.setAttributeNS?_21.setAttributeNS(ns,_22,_23):_21.setAttribute(_22,_23);},_24=function(ele){return document.createElementNS?document.createElementNS(_1a,ele):document.createElement(ele);},_25=common.utils.BrowerUtils,_26=new RegExp("(path|image|rect|ellipse|line|test)","ig");_26.compile();dojo.declare("drawboard.graphic.SVGGraphic",drawboard.graphic.Graphic,{anchor:null,type:_1d.GraphicType.SVG,createAnchor:function(w,h,_27){var _28=_24("svg");w&&_1c(_28,"width",w);h&&_1c(_28,"height",h);this.anchor=_28;_27&&(_27.appendChild(_28));return _28;},setSize:function(w,h){var _29=this.anchor;w&&_1c(_29,"width",w);h&&_1c(_29,"height",h);},isGraphMark:function(_2a){return _26.test(_2a);},drawPath:function(_2b,_2c,_2d){var _2e=_24("path"),d=[],ps;dojo.forEach(_2b,function(_2f){if(!_2f){return;}if(typeof _2f=="string"){this.push(_2f);}else{this.push(_2f.command);ps=_2f.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((p.x?(p.y?p.x+","+p.y:p.x):p.y)+" ");},this);}},d);!_2d&&d.push("Z");_1c(_2e,"d",d.join(""));_2c&&_1c(_2e,"style",_2c);this.anchor.appendChild(_2e);return _2e;},drawCircle:function(_30,r,_31){var _32=_24("circle");_1c(_32,"cx",_30.x);_1c(_32,"cy",_30.y);_1c(_32,"r",r);_31&&_1c(_32,"style",_31);this.anchor.appendChild(_32);return _32;},drawEllipse:function(_33,w,h,_34,_35){var _36=_24("ellipse"),w=(w>>1),h=(h>>1);_1c(_36,"cx",_33.x+w);_1c(_36,"cy",_33.y+h);_1c(_36,"rx",w);_1c(_36,"ry",h);_35&&_1c(_36,"style",_35);if(_34){for(var _37 in _34){_1c(_36,_37,((_34[_37] instanceof Array)?_34[_37].join(" "):_34[_37]));}}this.anchor.appendChild(_36);return _36;},drawLine:function(p1,p2,_38){var _39=_24("line");_1c(_39,"x1",p1.x);_1c(_39,"y1",p1.y);_1c(_39,"x2",p2.x);_1c(_39,"y2",p2.y);_38&&_1c(_39,"style",_38);this.anchor.appendChild(_39);return _39;},drawRect:function(_3a,w,h,rx,_3b,_3c){var _3d=_24("rect");_1c(_3d,"x",_3a.x);_1c(_3d,"y",_3a.y);_1c(_3d,"width",w);_1c(_3d,"height",h);if(_3b){for(var _3e in _3b){_1c(_3d,_3e,((_3b[_3e] instanceof Array)?_3b[_3e].join(" "):_3b[_3e]));}}(rx!==undefined&&rx!=null)&&(_1c(_3d,"rx",rx));_3c&&_1c(_3d,"style",_3c);this.anchor.appendChild(_3d);return _3d;},drawImage:function(_3f,w,h,url,_40){var _41=_24("image");_3f&&_1c(_41,"x",_3f.x);_3f&&_1c(_41,"y",_3f.y);_1c(_41,"width",w);_1c(_41,"height",h);_20(_41,_1b,"xlink:href",_1f+url);if(_40){for(var _42 in _40){_1c(_41,_42,_40[_42] instanceof Array?_40[_42].join(" "):_40[_42]);}}this.anchor.appendChild(_41);return _41;},drawText:function(_43,w,h,_44,_45,_46){var _47=_24("text"),s=_46,_48,_49=_44&&_44.split("\n");x=_43&&_43.x+(w>>1),y=_43&&_43.y+(h>>1),unitHeight=_44&&_25.getFontHeight(_44,_46);x&&_1c(_47,"x",x);y&&_1c(_47,"y",y);_1c(_47,"width",w);_1c(_47,"height",h);if(_45){for(var _4a in _45){_1c(_47,_4a,_45[_4a] instanceof Array?_45[_4a].join(" "):_45[_4a]);}}s&&(s.indexOf("text-anchor")==-1)&&(s+=";text-anchor:middle;");!s&&(s="text-anchor:middle;");s&&_1c(_47,"style",s);_49&&dojo.forEach(_49,function(t,_4b){_48=_24("tspan");_1c(_48,"x",x);_1c(_48,"y",y+unitHeight*_4b);_48.textContent=t;_47.appendChild(_48);},this);this.anchor.appendChild(_47);return _47;},clear:function(){var _4c=this.anchor;while(_4c.lastChild){_4c.removeChild(_4c.lastChild);}}});})();}if(!dojo._hasResource["drawboard.graphic.SVGIEGraphic"]){dojo._hasResource["drawboard.graphic.SVGIEGraphic"]=true;dojo.provide("drawboard.graphic.SVGIEGraphic");(function(){var _4d="http://www.w3.org/2000/svg",_4e="http://www.w3.org/1999/xlink",_4f=dojo.attr,_50=window.location.pathname,_51=_50.substring(0,_50.indexOf("/",1)+1),_52=function(_53,ns,_54,_55){_53.setAttributeNS(ns,_54,_55);},_56=common.utils.BrowerUtils;dojo.declare("drawboard.graphic.SVGIEGraphic",drawboard.graphic.Graphic,{anchor:null,embed:null,_w:null,_h:null,doc:null,createAnchor:function(w,h,_57){var _58=document.createElement("embed"),_59=document.createElement("div"),_5a=_59.style;_58.type="image/svg+xml";_58.src="empty.svg";_58.wmode="Transparent";w&&(this._w=w)&&_4f(_58,"width",w);h&&(this._h=h)&&_4f(_58,"height",h);this.embed=_58;w&&(_5a.width=w);h&&(_5a.height=h);_5a.position="absolute";_5a.background="white";_5a["z-index"]=100;_5a.filter="alpha(opacity=0)";_57.appendChild(_59);_57.appendChild(_58);this.setSVGDoc();return _59;},ready:function(){if(this.doc){return true;}else{return false;}},setSVGDoc:function(){var _5b=this.embed;if("getSVGDocument" in _5b){var doc=_5b.getSVGDocument(),svg=doc.documentElement;_4f(svg,"width",this._w);_4f(svg,"height",this._h);this.anchor=svg;this.doc=doc;return;}setTimeout(dojo.hitch(this,"setSVGDoc"),300);},createNS:function(ele){var doc=this.doc;return doc.createElementNS(_4d,ele);},setSize:function(w,h){var _5c=this.anchor;w&&_4f(_5c,"width",w);h&&_4f(_5c,"height",h);},drawPath:function(_5d,_5e,_5f){var _60=this.createNS("path"),d=[],ps;dojo.forEach(_5d,function(_61){if(!_61){return;}if(typeof _61=="string"){this.push(_61);}else{this.push(_61.command);ps=_61.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((p.x?(p.y?p.x+","+p.y:p.x):p.y)+" ");},this);}},d);!_5f&&d.push("Z");_4f(_60,"d",d.join(""));_5e&&_4f(_60,"style",_5e);this.anchor.appendChild(_60);return _60;},drawCircle:function(_62,r,_63){var _64=this.createNS("circle");_4f(_64,"cx",_62.x);_4f(_64,"cy",_62.y);_4f(_64,"r",r);_63&&_4f(_64,"style",_63);this.anchor.appendChild(_64);return _64;},drawEllipse:function(_65,w,h,_66,_67){var _68=this.createNS("ellipse"),w=(w>>1),h=(h>>1);_4f(_68,"cx",_65.x+w);_4f(_68,"cy",_65.y+h);_4f(_68,"rx",w);_4f(_68,"ry",h);_67&&_4f(_68,"style",_67);if(_66){for(var _69 in _66){_4f(_68,_69,((_66[_69] instanceof Array)?_66[_69].join(" "):_66[_69]));}}this.anchor.appendChild(_68);return _68;},drawLine:function(p1,p2,_6a){var _6b=this.createNS("line");_4f(_6b,"x1",p1.x);_4f(_6b,"y1",p1.y);_4f(_6b,"x2",p2.x);_4f(_6b,"y2",p2.y);_6a&&_4f(_6b,"style",_6a);this.anchor.appendChild(_6b);return _6b;},drawRect:function(_6c,w,h,rx,_6d,_6e){var _6f=this.createNS("rect");_4f(_6f,"x",_6c.x);_4f(_6f,"y",_6c.y);_4f(_6f,"width",w);_4f(_6f,"height",h);if(_6d){for(var _70 in _6d){_4f(_6f,_70,((_6d[_70] instanceof Array)?_6d[_70].join(" "):_6d[_70]));}}(rx!==undefined&&rx!=null)&&(_4f(_6f,"rx",rx));_6e&&_4f(_6f,"style",_6e);this.anchor.appendChild(_6f);return _6f;},drawImage:function(_71,w,h,url,_72){var _73=this.createNS("image");_71&&_4f(_73,"x",_71.x);_71&&_4f(_73,"y",_71.y);_4f(_73,"width",w);_4f(_73,"height",h);_52(_73,_4e,"xlink:href",_51+url);if(_72){for(var _74 in _72){_4f(_73,_74,_72[_74] instanceof Array?_72[_74].join(" "):_72[_74]);}}this.anchor.appendChild(_73);return _73;},drawText:function(_75,w,h,_76,_77,_78){var _79=this.createNS("text"),s=_78,_7a,_7b=_76&&_76.split("\n");x=_75&&_75.x+(w>>1),y=_75&&_75.y+(h>>1),unitHeight=_76&&_56.getFontHeight(_76,_78);x&&_4f(_79,"x",x);y&&_4f(_79,"y",y);_4f(_79,"width",w);_4f(_79,"height",h);if(_77){for(var _7c in _77){_4f(_79,_7c,_77[_7c] instanceof Array?_77[_7c].join(" "):_77[_7c]);}}s&&(s.indexOf("text-anchor")==-1)&&(s+=";text-anchor:middle;");!s&&(s="text-anchor:middle;");s&&_4f(_79,"style",s);_7b&&dojo.forEach(_7b,function(t,_7d){_7a=this.createNS("tspan");_4f(_7a,"x",x);_4f(_7a,"y",y+unitHeight*_7d);_7a.textContent=t;_79.appendChild(_7a);},this);this.anchor.appendChild(_79);return _79;},clear:function(){var _7e=this.anchor;while(_7e.lastChild){_7e.removeChild(_7e.lastChild);}}});})();}if(!dojo._hasResource["drawboard.graphic.VMLGraphic"]){dojo._hasResource["drawboard.graphic.VMLGraphic"]=true;dojo.provide("drawboard.graphic.VMLGraphic");(function(){var _7f=dojo.attr,_80=window.location.pathname,_81=drawboard.Constant,_82=_81.Path,_83=_80.substring(0,_80.indexOf("/",1)+1),_7f=function(_84,_85,_86){try{_84[_85]=_86;}catch(e){_84.setAttribute(_85,_86);}},_87=function(ele){return document.createElement(ele);},_88=common.utils.BrowerUtils,_89=new RegExp("(shape|image|rect|roundrect|oval|line|test)","ig");_89.compile();dojo.declare("drawboard.graphic.VMLGraphic",drawboard.graphic.Graphic,{anchor:null,type:_81.GraphicType.VML,createAnchor:function(w,h,_8a){var _8b=_87("div"),_8c=["position:relative"];w&&_8c.push("width:"+w);h&&_8c.push("height:"+h);(_8c.length>0)&&_7f(_8b,"style",_8c.join(";"));this.anchor=_8b;_8a.appendChild(_8b);return _8b;},isGraphMark:function(_8d){return _89.test(_8d);},styleAdapte:function(_8e,_8f){_8f=_8f.split(";");var kv;for(var i=0;i<_8f.length;i++){kv=_8f[i].split(":");switch(kv[0]){case "fill":if(kv[1]!="none"){_7f(_8e,"filled","t");_7f(_8e,"fillcolor",kv[1]);}else{_7f(_8e,"filled","f");}break;case "stroke":_7f(_8e,"strokecolor",kv[1]);break;case "stroke-width":_7f(_8e,"strokeweight",kv[1]);break;}}},commandAdapte:function(_90){var c=_90;switch(_90){case _82.QUADRATIC:case _82.RQUADRATIC:c=_82.QUADRATICVML;break;}return c;},setSize:function(w,h){var _91=this.anchor,_92=[];w&&_92.push("width:"+w);h&&_92.push("height:"+h);(_92.length>0)&&_7f(_91,"style",_92.join(";"));},drawPath:function(_93,_94,_95){var _96,d=[],ps;dojo.forEach(_93,function(_97){if(!_97){return;}if(typeof _97=="string"){this.push(_97);}else{this.push(_97.command);ps=_97.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((~~p.x||0)+" "+(~~p.y||0));},this);}},d);!_95&&d.push(" x");d.push(" e");_96=_87("<v:shape style='width:1;height:1;position:absolute;' CoordSize='1,1'></v:shape>");_7f(_96,"path",d.join(""));this.styleAdapte(_96,_94);this.anchor.appendChild(_96);return _96;},drawCircle:function(_98,r,_99){var s=["position:absolute","left:"+(_98.x-r),"top:"+(_98.y-r),"width:"+(r<<1),"height:"+(r<<1)],_9a=_87("<v:oval style='"+s.join(";")+"'></v:oval>");this.anchor.appendChild(_9a);this.styleAdapte(_9a,_99);return _9a;},drawEllipse:function(_9b,w,h,_9c,_9d){var s=["position:absolute","left:"+_9b.x,"top:"+_9b.y,"width:"+w,"height:"+h],_9e,_9f=_9c.transform;if(_9f){s.push(";rotation:"+_9f[1].substr(7,_9f[1].length-2));}_9e=_87("<v:oval style='"+s.join(";")+"'></v:oval>");this.styleAdapte(_9e,_9d);this.anchor.appendChild(_9e);return _9e;},drawLine:function(p1,p2,_a0){var _a1=_87("<v:line style='position:absolute'><v:line>");_7f(_a1,"from",p1.x+","+p1.y);_7f(_a1,"to",p2.x+","+p2.y);this.anchor.appendChild(_a1);return _a1;},drawRect:function(_a2,w,h,rx,_a3,_a4){var s=["position:absolute","left:"+_a2.x,"top:"+_a2.y,"width:"+w,"height:"+h],_a5,_a6=_a3.transform;if(_a6){s.push(";rotation:"+_a6[1].substr(7,_a6[1].length-2));}_a5=(rx===undefined)?_87("<v:Rect style="+s.join(";")+"></v:Rect>"):_87("<v:RoundRect style="+s.join(";")+"></v:RoundRect>");this.styleAdapte(_a5,_a4);this.anchor.appendChild(_a5);return _a5;},drawImage:function(_a7,w,h,url,_a8){var s=["position:absolute","left:"+_a7.x,"top:"+_a7.y,"width:"+w,"height:"+h],_a9,_aa=_a8.transform;if(_aa){s.push(";rotation:"+_aa[1].substr(7,_aa[1].length-2));}_a9=_87("<v:image src='"+url+"' style='"+s.join(";")+"' ></v:image>");this.anchor.appendChild(_a9);return _a9;},drawText:function(_ab,w,h,_ac,_ad,_ae){var _af=_87("text"),s=_ae,_b0,_b1=_ac&&_ac.split("\n");x=_ab&&_ab.x+(w>>1),y=_ab&&_ab.y+(h>>1),unitHeight=_ac&&_88.getFontHeight(_ac,_ae);x&&_7f(_af,"x",x);y&&_7f(_af,"y",y);_7f(_af,"width",w);_7f(_af,"height",h);if(_ad){for(var _b2 in _ad){_7f(_af,_b2,_ad[_b2] instanceof Array?_ad[_b2].join(" "):_ad[_b2]);}}s&&(s.indexOf("text-anchor")==-1)&&(s+=";text-anchor:middle;");!s&&(s="text-anchor:middle;");s&&_7f(_af,"style",s);_b1&&dojo.forEach(_b1,function(t,_b3){_b0=_87("tspan");_7f(_b0,"x",x);_7f(_b0,"y",y+unitHeight*_b3);_b0.textContent=t;_af.appendChild(_b0);},this);this.anchor.appendChild(_af);return _af;},clear:function(){var _b4=this.anchor;while(_b4.lastChild){_b4.removeChild(_b4.lastChild);}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.GraphStrategy"]){dojo._hasResource["drawboard.graph.strategy.GraphStrategy"]=true;dojo.provide("drawboard.graph.strategy.GraphStrategy");(function(){var _b5=drawboard.Constant;dojo.declare("drawboard.graph.strategy.GraphStrategy",null,{type:_b5.Decorate.Graph,_hasRotator:true,hasRotator:function(){return this._hasRotator;},getRotatorCoordinate:function(gp,_b6){return null;},getActiveAnchors:function(gp,_b7){return null;},isAnchor:function(d){return false;},isIn:function(gp,_b8,_b9){},draw:function(gp,gf,_ba){},normalize:function(gp,_bb,_bc){return false;},sizeChange:function(gp,_bd,_be,_bf){var d=_b5.Direction,p=gp.getCoordinate(_bf),w=gp.getWidth(_bf),h=gp.getHeight(_bf),_c0=_be.x,_c1=_be.y,_c2=_bd.getDirect();switch(_c2){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+_c1},_bf);gp.setHeight(h-_c1,_bf);break;case d.SOUTH:gp.setHeight(h+_c1,_bf);break;case d.WEST:gp.setCoordinate({x:p.x+_c0,y:p.y},_bf);gp.setWidth(w-_c0,_bf);break;case d.EAST:gp.setWidth(w+_c0,_bf);break;case d.WESTNORTH:gp.setCoordinate({x:p.x+_c0,y:p.y+_c1},_bf);gp.setWidth(w-_c0,_bf);gp.setHeight(h-_c1,_bf);break;case d.EASTNORTH:gp.setCoordinate({x:p.x,y:p.y+_c1},_bf);gp.setWidth(w+_c0,_bf);gp.setHeight(h-_c1,_bf);break;case d.EASTSOUTH:gp.setWidth(w+_c0,_bf);gp.setHeight(h+_c1,_bf);break;case d.WESTSOUTH:gp.setCoordinate({x:p.x+_c0,y:p.y},_bf);gp.setWidth(w-_c0,_bf);gp.setHeight(h+_c1,_bf);break;case d.END:break;default:break;}this._sizeChange(gp,_bd,_be,_bf);},_sizeChange:function(gp,_c3,_c4,_c5){},getGraphCoordinates:function(gp,_c6){},getSkeletonCoordinates:function(gp,_c7){var _c8=gp.getCoordinate(_c7),w=gp.getWidth(_c7),h=gp.getHeight(_c7),x=_c8.x,y=_c8.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y,css:"mover_ne"},{x:x,y:y+h,css:"mover_sw"},{x:x+w,y:y+h,css:"mover_se"},{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"},{x:x+w,y:y+(h>>1),css:"mover_e"}];},calcMotionAnchor:function(gp,_c9,_ca,_cb){},getMotionAnchorCoordinates:function(gp,_cc){},getMarkCoordinates:function(gp,_cd){var _ce=gp.getCoordinate(_cd),w=gp.getWidth(_cd),h=gp.getHeight(_cd),_cf=gp.getRealMarks(_cd),x=_ce.x,y=_ce.y;if(!_cf){return [{x:x+(w>>1),y:y},{x:x+(w>>1),y:y+h},{x:x,y:y+(h>>1)},{x:x+w,y:y+(h>>1)}];}var _d0=[_cf[0]||{x:x+(w>>1),y:y},_cf[1]||{x:x+(w>>1),y:y+h},_cf[2]||{x:x,y:y+(h>>1)},_cf[3]||{x:x+w,y:y+(h>>1)}];for(var i=4;i<_cf.length;i++){_d0.push(_cf[i]);}return _d0;},getStyleController:function(_d1){return _d1.getContext().getStyleCtrl();},getStyle:function(gp,_d2){return this.getStyleController(_d2).getStyle(this.type,gp);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RectangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RectangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RectangleStrategy");(function(){var _d3=common.calc.Geometry,_d4=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RectangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_d5,_d6){return _d3.isPointInPolyn(gp.getGraphCoordinates(_d6),_d5);},draw:function(gp,gf,_d7){var p=_d4.Path,_d8=gp.getGraphCoordinates(_d7);return gf.drawPath([{command:p.MOVE,points:_d8[0]},{command:p.LINE,points:_d8[1]},{command:p.LINE,points:_d8[2]},{command:p.LINE,points:_d8[3]},{command:p.LINE,points:_d8[0]}],this.getStyle(gp,_d7));},getGraphCoordinates:function(gp,_d9){var _da=gp.getCoordinate(_d9),w=gp.getWidth(_d9),h=gp.getHeight(_d9),x=_da.x,y=_da.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.TextStrategy"]){dojo._hasResource["drawboard.graph.strategy.TextStrategy"]=true;dojo.provide("drawboard.graph.strategy.TextStrategy");(function(){var _db=common.calc.Geometry,_dc=drawboard.Constant;dojo.declare("drawboard.graph.strategy.TextStrategy",drawboard.graph.strategy.RectangleStrategy,{draw:function(gp,gf,_dd){var p=_dc.Path,_de=gp.getGraphRotator(_dd),a=_de.angle,_df=_de.coordinate,_e0=["translate("+_df.x+","+_df.y+")","rotate("+a+")","translate("+-_df.x+","+-_df.y+")"];return gf.drawText(gp.getCoordinate(_dd),gp.getWidth(_dd),gp.getHeight(_dd),gp.getText(),(a!=0)&&{transform:_e0},this.getTextStyle(gp,_dd));},getTextStyle:function(gp,_e1){return this.getStyleController(_e1).getTextStyle(gp);}});})();}if(!dojo._hasResource["drawboard.controller.StyleController"]){dojo._hasResource["drawboard.controller.StyleController"]=true;dojo.provide("drawboard.controller.StyleController");(function(){dojo.declare("drawboard.controller.StyleController",common.container.MapContainer,{_style:"fill:none;stroke:black;stroke-width:1",_activeStyle:"fill:none;stroke:red;stroke-width:1",resultIdentity:"serializeStr",actives:null,activedGp:null,setActives:function(_e2,gp){this.actives=_e2;this.activedGp&&this.activedGp.isActived(false);gp&&gp.isActived(true)&&(this.activedGp=gp);},getActives:function(){return this.actives;},init:function(_e3){this._style=_e3;},getDefaultStyle:function(){return this._style;},getTextStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return "";}return gs[this.resultIdentity];},getGraphStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return this.getDefaultStyle(gp);}return gs[this.resultIdentity];},getGraphStyleValue:function(gp,_e4){var _e5=this.getItem(gp.getIdty());if(_e5){return _e5[_e4];}return null;},containGraphStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return false;}return true;},addGraphStyle:function(gp,_e6,_e7,_e8){if(gp.isComposite()){return;}var gs=this.getItem(gp.getIdty());if(!gs){gs={};this.addItem(gp.getIdty(),gs);}gs[_e6]=_e7;gs[this.resultIdentity]=this.serialize(gs,_e8);},removeGraphStyle:function(gp,_e9){if(gp.isComposite()){return;}var gs=this.getItem(gp.getIdty());if(!gs||!gs[_e9]){return;}delete gs[_e9];gs[this.resultIdentity]=this.serialize(gs);},removeGraph:function(gp){var _ea=gp.getIdty(),gs=this.getItem(_ea);if(!gs){return;}this.removeItem(_ea);},serialize:function(sj,_eb){var str=[];for(var _ec in sj){if(_ec!=this.resultIdentity){str.push([_ec,":",sj[_ec]].join(""));}}if(!_eb){if(!sj["stroke"]){str.push(["stroke",":","black"].join(""));}if(!sj["stroke-width"]){str.push(["stroke-width",":","1"].join(""));}if(!sj["fill"]){str.push(["fill",":","none"].join(""));}}return str.join(";");},getStyle:function(_ed,gp,d){var _ee=this.getActives(),_ef=false;if(d&&_ee){dojo.some(_ee,function(_f0){if(_f0.equal(d)){_ef=true;}},this);if(_ef){return this._activeStyle;}}return this.getGraphStyle(gp);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.BrokenLineStrategy"]){dojo._hasResource["drawboard.graph.strategy.BrokenLineStrategy"]=true;dojo.provide("drawboard.graph.strategy.BrokenLineStrategy");(function(){var _f1=common.calc.Geometry,_f2=drawboard.Constant,_f3=drawboard.relationController;dojo.declare("drawboard.graph.strategy.BrokenLineStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_f4,_f5){var p=gp.getCoordinate(_f5),w=gp.getWidth(_f5),h=gp.getHeight(_f5),_f6=gp.getRealMotionAnchors(_f5),_f7=dojo.hitch(_f1,"isPointInSegment"),max=_f6.length,_f8;if((max==0)&&_f7(p,{x:p.x+w,y:p.y+h},_f4)){return true;}for(var i=0;i<max;i++){_f8=((i+1==max)?{x:p.x+w,y:p.y+h}:_f6[i+1]);if(i==0){if(_f7(p,_f6[i],_f4)||_f7(_f6[i],_f8,_f4)){return true;}}else{if(i==max-1){if(_f7(_f6[i],{x:p.x+w,y:p.y+h},_f4)){return true;}}else{if(_f7(_f6[i],_f8,_f4)){return true;}}}}return false;},isAnchor:function(d){return true;},draw:function(gp,gf,_f9){var p=_f2.Path,_fa=gp.getGraphCoordinates(_f9),max=_fa.length-1,_fb=[];for(var i=0;i<max;i++){(i==0)?_fb.push({command:p.MOVE,points:_fa[i]},{command:p.LINE,points:_fa[i+1]}):_fb.push({command:p.LINE,points:_fa[i]},{command:p.LINE,points:_fa[i+1]});}return gf.drawPath(_fb,this.getStyle(gp,_f9),true);},sizeChange:function(gp,_fc,_fd,_fe){var d=_f2.Direction,p=gp.getCoordinate(_fe),w=gp.getWidth(_fe),h=gp.getHeight(_fe),_ff=_fd.x,_100=_fd.y,_101=_fc.getDirect(),_102=gp.getRealMotionAnchors(_fe),_103=true,_104,tmp,_105=dojo.hitch(gp.getGraphStatus(),"setMotionAnchors");switch(_101){case d.WESTNORTH:gp.setCoordinate({x:p.x+_ff,y:p.y+_100},_fe);gp.setWidth(w-_ff,_fe);gp.setHeight(h-_100,_fe);if(_102.length==0){tmp={x:p.x+w,y:p.y+h};_102.push({x:tmp.x,y:p.y+_100});break;}_104=_102[0];(_104.x==p.x)?(_103=true):(_103=false);if((_104.x==p.x)&&(_104.y==p.y)){tmp=_102[1];!tmp&&(tmp={x:p.x+w,y:y+h});(_104.x==tmp.x)?(_103=false):(_103=true);}(_103)&&((_104.x+=_ff)!=null)&&(_105(_102,_fe));(!_103)&&((_104.y+=_100)!=null)&&(_105(_102,_fe));break;case d.EASTSOUTH:gp.setWidth(w+_ff,_fe);gp.setHeight(h+_100,_fe);if(_102.length==0){tmp={x:p.x+w+_ff,y:p.y+h+_100};_102.push({x:p.x,y:p.y+h+_100});break;}_104=_102[_102.length-1];(_104.x==(p.x+w))?(_103=true):(_103=false);if((_104.x==(p.x+w))&&(_104.y==(p.y+h))){tmp=_102[_102.length-2]||{x:p.x,y:p.y};(_104.x==tmp.x)?(_103=false):(_103=true);}(_103)&&((_104.x+=_ff)!=null)&&(_105(_102,_fe));(!_103)&&((_104.y+=_100)!=null)&&(_105(_102,_fe));break;case d.END:break;default:break;}this._sizeChange(gp,_fc,_fd,_fe);},getActiveAnchors:function(gp,_106){return drawboard.skeletonController.create(gp.getSkeletonCoordinates(_106));},getSkeletonCoordinates:function(gp,_107){var _108=gp.getCoordinate(_107),w=gp.getWidth(_107),h=gp.getHeight(_107),x=_108.x,y=_108.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y+h,css:"mover_se"}];},getGraphCoordinates:function(gp,_109){var _10a=this.getMotionAnchorCoordinates(gp,_109);start=gp.getCoordinate(_109),w=gp.getWidth(_109),h=gp.getHeight(_109),x=start.x,y=start.y,graphs=[{x:x,y:y,css:"mover_nw",isAnchored:true}];dojo.forEach(_10a,function(item){graphs.push({x:item.x,y:item.y});},this);graphs.push({x:x+w,y:y+h,css:"mover_se",isAnchored:true});return graphs;},getMarkCoordinates:function(gp,_10b){return null;},getMotionAnchorCoordinates:function(gp,_10c){var _10d=gp.getRealMotionAnchors(_10c),_10e=[],_10f=gp.getCoordinate(_10c),w=gp.getWidth(_10c),h=gp.getHeight(_10c),x=_10f.x,y=_10f.y,_110=_10f,_111;(!_10d)&&((_10d=[{x:x+(w>>1),y:y},{x:x+(w>>1),y:y+h}])&&gp.getGraphStatus().setMotionAnchors(_10d,_10c));if(_10d.length==0){_10e.push({x:_10f.x+(w>>1),y:_10f.y+(h>>1)});return _10e;}dojo.forEach(_10d,function(_112,_113){((_110.x==_112.x)||(_10e.push({x:_110.x+((_112.x-_110.x)>>1),y:_110.y},{x:_112.x,y:_112.y})&&false))&&(_10e.push({x:_110.x,y:_110.y+((_112.y-_110.y)>>1)},{x:_112.x,y:_112.y}));_110=_112;},this);_111=_10d[_10d.length-1];(_111.x==(x+w))&&(_10e.push({x:_111.x,y:_111.y+((y+h-_111.y)>>1)}));(_111.y==(y+h))&&(_10e.push({x:_111.x+((x+w-_111.x)>>1),y:_111.y}));return _10e;},calcMotionAnchor:function(gp,_114,_115,_116){var _117=gp.getRealMotionAnchors(_116),_118=this.getActiveAnchors(gp,_116),_f3=drawboard.relationController,_119=gp.getCoordinate(_116),_11a=_114.getIndex(),_11b=Math.floor(_11a/2),len=_117.length,_11c=_f3.containRestrain(gp,_118[0],_116),_11d=_f3.containRestrain(gp,_118[1],_116),_11e=((_11b==0)?_119:_117[_11b-1]),_11f=((_11b==len-1)?{x:_119.x+w,y:_119.y+h}:_117[_11b+1]),_120=_117[_11b],tmp,_121;if(_11a%2==0){if(_11a==0){(!_120)&&(_120={x:_119.x+w,y:_119.y+h});if(_11c){if(!_11d){(_120.x==_119.x)&&(_117.splice(0,0,{x:_119.x,y:_119.y+((_120.y-_119.y)>>2)},{x:_115.x,y:_119.y+((_120.y-_119.y)>>2)}))&&(len>0?(_11f.y=_115.y):(gp.setHeight(_115.y-_119.y,_116)));(_120.y==_119.y)&&(_117.splice(0,0,{x:_119.x+((_120.x-_119.x)>>2),y:_119.y},{x:_119.x+((_120.x-_119.x)>>2),y:_115.y}))&&(len>0?(_11f.x=_115.x):(gp.setWidth(_115.x-_119.x,_116)));_114.setIndex(3);}else{(_120.x==_119.x)&&(_117.splice(0,0,{x:_119.x,y:_119.y+((_120.y-_119.y)>>2)},{x:_115.x,y:_119.y+((_120.y-_119.y)>>2)},{x:_115.x,y:_120.y-((_120.y-_119.y)>>2)},{x:_119.x,y:_120.y-((_120.y-_119.y)>>2)}));(_120.y==_119.y)&&(_117.splice(0,0,{x:_119.x+((_120.x-_119.x)>>2),y:_119.y},{x:_119.x+((_120.x-_119.x)>>2),y:_115.y},{x:_120.x-((_120.x-_119.x)>>2),y:_115.y},{x:_120.x-((_120.x-_119.x)>>2),y:_119.y}));_114.setIndex(4);}}else{if(_11d){if(!_11c){(_120.x==_119.x)&&(_117.splice(0,0,{x:_115.x,y:_119.y+((_120.y-_119.y)>>1)},{x:_120.x,y:_119.y+((_120.y-_119.y)>>1)}))&&(_119.x=_115.x);(_120.y==_119.y)&&(_117.splice(0,0,{x:_119.x+((_120.x-_119.x)>>1),y:_115.y},{x:_119.x+((_120.x-_119.x)>>1),y:_120.y}))&&(_119.y=_115.y);gp.setCoordinate(_119,_116);_114.setIndex(1);}else{(_120.x==_119.x)&&(_117.splice(0,0,{x:_119.x,y:_119.y+((_120.y-_119.y)>>2)},{x:_115.x,y:_119.y+((_120.y-_119.y)>>2)},{x:_115.x,y:_120.y-((_120.y-_119.y)>>2)},{x:_119.x,y:_120.y-((_120.y-_119.y)>>2)}));(_120.y==_119.y)&&(_117.splice(0,0,{x:_119.x+((_120.x-_119.x)>>2),y:_119.y},{x:_119.x+((_120.x-_119.x)>>2),y:_115.y},{x:_120.x-((_120.x-_119.x)>>2),y:_115.y},{x:_120.x-((_120.x-_119.x)>>2),y:_119.y}));_114.setIndex(4);}}else{(_119.x==_120.x)&&(gp.setWidth(gp.getWidth(_116)+(_119.x-_115.x),_116)||((_119.x=_120.x=_115.x)!=null)&&(gp.setCoordinate(_119,_116)));(_119.y==_120.y)&&(gp.setHeight(gp.getHeight(_116)+(_119.y-_115.y),_116)||((_119.y=_120.y=_115.y)!=null)&&(gp.setCoordinate(_119,_116)));}}}else{if(_11b==len){_120=(len==0)?{x:_119.x,y:_119.y}:_117[_11b-1];if(_11d){if(!_11c){((_119.x+w)==_120.x)&&(_117.push({x:_115.x,y:_119.y+h-((_119.y+h-_120.y)>>2)},{x:_120.x,y:_119.y+h-((_119.y+h-_120.y)>>2)}))&&(_11e.x=_115.x);((_119.y+h)==_120.y)&&(_117.push({x:_119.x+w-((_119.x+w-_120.x)>>2),y:_115.y},{x:_119.x+w-((_119.x+w-_120.x)>>2),y:_120.y}))&&(_11e.y=_115.y);(len==0)&&(gp.setCoordinate(_11e));_114.setIndex(_11a);}else{((_119.x+w)==_120.x)&&(_117.push({x:_120.x,y:_120.y+((_119.y+h-_120.y)>>2)},{x:_115.x,y:_120.y+((_119.y+h-_120.y)>>2)},{x:_115.x,y:_119.y+h-((_119.y+h-_120.y)>>2)},{x:_120.x,y:_119.y+h-((_119.y+h-_120.y)>>2)}));((_119.y+h)==_120.y)&&(_117.push({x:_120.x+((_119.x+w-_120.x)>>2),y:_120.y},{x:_120.x+((_119.x+w-_120.x)>>2),y:_115.y},{x:_119.x+w-((_119.x+w-_120.x)>>2),y:_115.y},{x:_119.x+w-((_119.x+w-_120.x)>>2),y:_120.y}));_114.setIndex(_11a+4);}}else{((_119.x+w)==_120.x)&&(((_120.x=_115.x)!=null)&&(gp.setWidth(_115.x-_119.x,_116)));((_119.y+h)==_120.y)&&(((_120.y=_115.y)!=null)&&(gp.setHeight(_115.y-_119.y,_116)));}}else{_11e=_117[_11b-1];(_11e.x==_120.x)&&(_120.x=_11e.x=_115.x);(_11e.y==_120.y)&&(_120.y=_11e.y=_115.y);}}}else{var end={x:_119.x+w,y:_119.y+h},_122,_123,_124=false,_125;if(((_11b==0)&&_11c)||((_11b==len-1)&&_11d)){(((_11e.x==_120.x)&&(_124=false)||(_115.x==_11e.x))||((_11e.y==_120.y)&&(_124=true)&&(_115.y==_11e.y))||(((_11b==0)&&(_124?(_11c?(_117.unshift({x:_11e.x+((_120.x-_11e.x)>>1),y:_11e.y},{x:_11e.x+((_120.x-_11e.x)>>1),y:_115.y})):((((_119.y=_115.y)!=null)&&(gp.setCoordinate(_119,_116))||true)&&_117.splice(1,0,{x:_115.x,y:_120.y+((_11f.y-_120.y)>>1)},{x:_11f.x,y:_120.y+((_11f.y-_120.y)>>1)}))):(_11c?_117.unshift({x:_11e.x,y:_11e.y+((_120.y-_11e.y)>>1)},{x:_115.x,y:_11e.y+((_120.y-_11e.y)>>1)}):((((_119.x=_115.x)!=null)&&(gp.setCoordinate(_119,_116))||true)&&_117.splice(1,0,{x:_120.x+((_11f.x-_120.x)>>1),y:_115.y},{x:_120.x+((_11f.x-_120.x)>>1),y:_11f.y})&&(_125=1))))&&(_11c?(_117[2]=_115):(_117[0]=_115))&&(_114.setIndex(_125||5)))||((_11b==len-1)&&(_11b!=0)&&(_124?_117.push({x:_115.x,y:_120.y+((end.y-_120.y)>>1)},{x:end.x,y:_120.y+((end.y-_120.y)>>1)}):_117.push({x:_120.x+((end.x-_120.x)>>1),y:_115.y},{x:_120.x+((end.x-_120.x)>>1),y:end.y}))&&(_117[_11b]=_115)||true)||true))&&(((_11b==len-1)?(_124?(_11e.y=_115.y):(_11e.x=_115.x)):(_124?(_11f.x=_115.x):(_11f.y=_115.y))));}else{(((_11e.x==_120.x)&&(_11e.y==_120.y))?(((((_11b<2)?((_11b==1)&&(tmp=_119)):(tmp=_117[_11b-2]))&&(tmp&&(_121=(tmp.x==_11e.x))||true))||(((_11b<len-2)?(tmp=_117[_11b+2]):((_11b==len-2)&&(tmp=end)))&&(tmp&&(_121=!(tmp.x==_11f.x))||true)))):((_11e.x==_120.x)?(_121=false):(_121=true)));if(!_121){(((_11e.x=_115.x)!=null)&&((_11f.y=_115.y)!=null)&&((_11b==0)&&(gp.setCoordinate(_119,_116)||gp.setWidth(end.x-_119.x,_116))))||((_11b==len-1)&&(gp.setHeight(_11f.y-_119.y,_116)));}else{(((_11e.y=_115.y)!=null)&&((_11f.x=_115.x)!=null)&&((_11b==0)&&(gp.setCoordinate(_119,_116)||gp.setHeight(end.y-_119.y,_116))))||((_11b==len-1)&&(gp.setWidth(_11f.x-_119.x,_116)));}((_120.x=_115.x)!=null)&&(_120.y=_115.y);}}return null;},normalize:function(gp,_126,_127){gp&&_126&&this.updateMotionAnchors(gp,_127,_126);return true;},updateMotionAnchors:function(gp,_128,_129){var _12a=gp.getRealMotionAnchors(_128),_12b=gp.getCoordinate(_128),_12c=[],_12d=[],_12e,_12f,_130=_129&&_129.getIndex(),_131=false,_132,_133;(_12e=-1)&&(_12f={x:_12b.x,y:_12b.y});dojo.forEach(_12a.concat({x:_12b.x+gp.getWidth(_128),y:_12b.y+gp.getHeight(_128)}),function(_134,_135){if((_12f.x==_134.x)&&(_12f.y==_134.y)){_12c.push(_135);return;}if(_12f.x==_134.x){_133=false;}else{_133=true;}(_132===undefined)&&_12c.push(_135);(_132!==undefined)&&(((_132==_133)&&_12c.push(_135))||((_12c.length>1)&&_12d.push(_12c)&&false)||(_12c=[_135]));_132=_133;_12f=_134;},this);(_12c.length>1)&&_12d.push(_12c);dojo.forEach(_12d.reverse(),function(item){dojo.forEach(item.reverse(),function(_136,pos){(pos!=0)&&(_12a.splice(_136,1))&&(_130!=null)&&((_130>_136)&&((_130=_130-2)!=null)&&_129.setIndex(_130));},this);},this);gp.getGraphStatus().setMotionAnchors(_12a,_128);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.ImageStrategy"]){dojo._hasResource["drawboard.graph.strategy.ImageStrategy"]=true;dojo.provide("drawboard.graph.strategy.ImageStrategy");(function(){var _137=common.calc.Geometry,_138=drawboard.Constant;dojo.declare("drawboard.graph.strategy.ImageStrategy",drawboard.graph.strategy.GraphStrategy,{getGraphCoordinates:function(gp,_139){var _13a=gp.getCoordinate(_139),w=gp.getWidth(_139),h=gp.getHeight(_139),x=_13a.x,y=_13a.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_13b,_13c){return _137.isPointInPolyn(gp.getGraphCoordinates(_13c),_13b);},draw:function(gp,gf,_13d){var p=_138.Path,_13e=gp.getGraphRotator(_13d),a=_13e.angle,pole=_13e.coordinate,_13f=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];return gf.drawImage(gp.getCoordinate(_13d),gp.getWidth(_13d),gp.getHeight(_13d),gp.getUrl(),(a!=0)&&{transform:_13f},this.getStyle(gp,_13d));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RatioStrategy"]){dojo._hasResource["drawboard.graph.strategy.RatioStrategy"]=true;dojo.provide("drawboard.graph.strategy.RatioStrategy");(function(){var _140=common.calc.Geometry,_141=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RatioStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_142,_143){},draw:function(gp,gf,_144){},getGraphCoordinates:function(gp,_145){var _146=gp.getRatio(),w=gp.getWidth(_145),h=gp.getHeight(_145),temp;if(!_146){return this._getGraphCoordinates(gp,_145,w,h);}temp=h*_146;if(temp>w){h=w/_146;}else{w=temp;}gp.setWidth(w,_145);gp.setHeight(h,_145);return this._getGraphCoordinates(gp,_145,w,h);},_getGraphCoordinates:function(gp,_147,w,h){},sizeChange:function(gp,_148,_149,_14a){var d=_141.Direction,_14b=gp.getRatio(),p=gp.getCoordinate(_14a),w=gp.getWidth(_14a),h=gp.getHeight(_14a),_14c=_148.getDirect(),temp;if(_14b){temp=h*_14b;if(temp>w){h=w/_14b;}else{w=temp;}}switch(_14c){case d.NORTH:_149=_149.y;gp.setCoordinate({x:p.x+(_149>>1),y:p.y+(_149)},_14a);gp.setWidth(w-(_149),_14a);gp.setHeight(h-(_149),_14a);break;case d.WESTNORTH:_149=Math.abs(_149.x)>Math.abs(_149.y)?_149.y:_149.x,gp.setCoordinate({x:p.x+_149,y:p.y+_149},_14a);gp.setWidth(w-_149,_14a);gp.setHeight(h-_149,_14a);break;case d.EASTNORTH:_149=_149.y;gp.setCoordinate({x:p.x,y:p.y+_149},_14a);gp.setWidth(w-_149,_14a);gp.setHeight(h-_149,_14a);break;case d.SOUTH:_149=_149.y;gp.setCoordinate({x:p.x-(_149>>1),y:p.y},_14a);gp.setWidth(w+(_149),_14a);gp.setHeight(h+(_149),_14a);break;case d.EASTSOUTH:_149=Math.abs(_149.x)>Math.abs(_149.y)?_149.y:_149.x,gp.setCoordinate({x:p.x,y:p.y},_14a);gp.setWidth(w+_149,_14a);gp.setHeight(h+_149,_14a);break;case d.WESTSOUTH:_149=_149.x;gp.setCoordinate({x:p.x+_149,y:p.y},_14a);gp.setWidth(w-_149,_14a);gp.setHeight(h-_149,_14a);break;case d.WEST:_149=_149.x;gp.setCoordinate({x:p.x+_149,y:p.y+(_149>>1)},_14a);gp.setWidth(w-(_149),_14a);gp.setHeight(h-(_149),_14a);break;case d.EAST:_149=_149.x;gp.setCoordinate({x:p.x,y:p.y-(_149>>1)},_14a);gp.setWidth(w+(_149),_14a);gp.setHeight(h+(_149),_14a);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RatioImageStrategy"]){dojo._hasResource["drawboard.graph.strategy.RatioImageStrategy"]=true;dojo.provide("drawboard.graph.strategy.RatioImageStrategy");(function(){var _14d=common.calc.Geometry,_14e=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RatioImageStrategy",drawboard.graph.strategy.RatioStrategy,{_getGraphCoordinates:function(gp,_14f,w,h){var _150=gp.getCoordinate(_14f),x=_150.x,y=_150.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_151,_152){return _14d.isPointInPolyn(gp.getGraphCoordinates(_152),_151);},draw:function(gp,gf,_153){var p=_14e.Path,_154=gp.getGraphRotator(_153),a=_154.angle,pole=_154.coordinate,_155=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];gp.getGraphCoordinates(_153);return gf.drawImage(gp.getCoordinate(_153),gp.getWidth(_153),gp.getHeight(_153),gp.getUrl(),(a!=0)&&{transform:_155},this.getStyle(gp,_153));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.SquareStrategy"]){dojo._hasResource["drawboard.graph.strategy.SquareStrategy"]=true;dojo.provide("drawboard.graph.strategy.SquareStrategy");(function(){var _156=common.calc.Geometry,_157=drawboard.Constant;dojo.declare("drawboard.graph.strategy.SquareStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_158,_159){return _156.isPointInPolyn(gp.getGraphCoordinates(_159),_158);},draw:function(gp,gf,_15a){var p=_157.Path,_15b=gp.getGraphCoordinates(_15a);return gf.drawPath([{command:p.MOVE,points:_15b[0]},{command:p.LINE,points:_15b[1]},{command:p.LINE,points:_15b[2]},{command:p.LINE,points:_15b[3]},{command:p.LINE,points:_15b[0]}],this.getStyle(gp,_15a));},getGraphCoordinates:function(gp,_15c){var _15d=gp.getCoordinate(_15c),w=gp.getWidth(_15c),h=gp.getHeight(_15c),min=w>h?h:w,x=_15d.x,y=_15d.y;gp.setWidth(min,_15c);gp.setHeight(min,_15c);return [{x:x,y:y},{x:x+min,y:y},{x:x+min,y:y+min},{x:x,y:y+min}];},sizeChange:function(gp,_15e,_15f,_160){var d=_157.Direction,p=gp.getCoordinate(_160),w=gp.getWidth(_160),h=gp.getHeight(_160),min=w>h?h:w,_161=_15e.getDirect();switch(_161){case d.NORTH:_15f=_15f.y;gp.setCoordinate({x:p.x+(_15f>>1),y:p.y+(_15f)},_160);gp.setWidth(min-(_15f),_160);gp.setHeight(min-(_15f),_160);break;case d.WESTNORTH:_15f=Math.abs(_15f.x)>Math.abs(_15f.y)?_15f.y:_15f.x,gp.setCoordinate({x:p.x+_15f,y:p.y+_15f},_160);gp.setWidth(min-_15f,_160);gp.setHeight(min-_15f,_160);break;case d.EASTNORTH:_15f=_15f.y;gp.setCoordinate({x:p.x,y:p.y+_15f},_160);gp.setWidth(min-_15f,_160);gp.setHeight(min-_15f,_160);break;case d.SOUTH:_15f=_15f.y;gp.setCoordinate({x:p.x-(_15f>>1),y:p.y},_160);gp.setWidth(min+(_15f),_160);gp.setHeight(min+(_15f),_160);break;case d.EASTSOUTH:_15f=Math.abs(_15f.x)>Math.abs(_15f.y)?_15f.y:_15f.x,gp.setCoordinate({x:p.x,y:p.y},_160);gp.setWidth(min+_15f,_160);gp.setHeight(min+_15f,_160);break;case d.WESTSOUTH:_15f=_15f.x;gp.setCoordinate({x:p.x+_15f,y:p.y},_160);gp.setWidth(min-_15f,_160);gp.setHeight(min-_15f,_160);break;case d.WEST:_15f=_15f.x;gp.setCoordinate({x:p.x+_15f,y:p.y+(_15f>>1)},_160);gp.setWidth(min-(_15f),_160);gp.setHeight(min-(_15f),_160);break;case d.EAST:_15f=_15f.x;gp.setCoordinate({x:p.x,y:p.y-(_15f>>1)},_160);gp.setWidth(min+(_15f),_160);gp.setHeight(min+(_15f),_160);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.OvalStrategy"]){dojo._hasResource["drawboard.graph.strategy.OvalStrategy"]=true;dojo.provide("drawboard.graph.strategy.OvalStrategy");(function(){var _162=common.calc.Geometry,_163=drawboard.Constant;dojo.declare("drawboard.graph.strategy.OvalStrategy",drawboard.graph.strategy.RectangleStrategy,{isIn:function(gp,_164,_165){return _162.isPointInPolyn(gp.getOutletCoordinates(_165),_164);},draw:function(gp,gf,_166){var _167=gp.getGraphCoordinates(_166),w=gp.getWidth(_166),h=gp.getHeight(_166),p=_163.Path,path=[],_168=gp.getGraphRotator(_166),a=_168.angle,pole=_168.coordinate,_169=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];return gf.drawEllipse(gp.getCoordinate(_166),w,h,(a!=0)&&{transform:_169},this.getStyle(gp,_166));},getGraphCoordinates:function(gp,_16a){var p=gp.getCoordinate(_16a),w=gp.getWidth(_16a),h=gp.getHeight(_16a),_16b=[{x:p.x+w,y:p.y+h}];return _16b;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.CircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.CircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.CircleStrategy");(function(){var _16c=common.calc.Geometry;dojo.declare("drawboard.graph.strategy.CircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_16d,_16e){var w=gp.getWidth(_16e),h=gp.getHeight(_16e),r=w>h?h>>1:w>>1;return _16c.isPointInCircle(_16d,{coordinate:gp.getGraphCoordinates(_16e)[0],r:r});},draw:function(gp,gf,_16f){var _170=gp.getGraphCoordinates(_16f),w=gp.getWidth(_16f),h=gp.getHeight(_16f),r=w>h?h>>1:w>>1;return gf.drawCircle(_170[0],r,this.getStyle(gp,_16f));},getGraphCoordinates:function(gp,_171){var p=gp.getCoordinate(_171),w=gp.getWidth(_171),h=gp.getHeight(_171),min=w>h?h:w,r=min>>1,_172=[{x:p.x+r,y:p.y+r}];gp.setWidth(min,_171);gp.setHeight(min,_171);return _172;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.MotionCircleStrategy");(function(){var _173=common.calc.Geometry,_174=drawboard.Constant;dojo.declare("drawboard.graph.strategy.MotionCircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_175,_176){var w=gp.getWidth(_176),h=gp.getHeight(_176),r=w>h?h>>1:w>>1;return _173.isPointInCircle(_175,{coordinate:gp.getGraphCoordinates(_176)[0],r:r});},draw:function(gp,gf,_177){var p=_174.Path,w=gp.getWidth(_177),h=gp.getHeight(_177),_178=gp.getGraphCoordinates(_177),_179=gp.getMotionAnchorCoordinates(_177),arc;if(gf.getType()==_174.GraphicType.VML){var _17a=gp.getCoordinate(_177),_17b={x:w<0?_17a.x+w:_17a.x,y:h<0?_17a.y+h:_17a.y},end={x:w<0?_17a.x:_17a.x+w,y:h<0?_17a.y:_17a.y+h};mstart=_179[0][0],mend=_179[1][0];arc=["wr",~~_17b.x,~~_17b.y,~~end.x,~~end.y,~~mstart.x,~~mstart.y,~~mend.x,~~mend.y];return gf.drawPath([{command:p.MOVE,points:_179[0][0]},arc.join(" ")],this.getStyle(gp,_177),true);}var r=w>h?h>>1:w>>1,a=_173.angle(_179[0][0],_178[0],_179[1][0]);arc=[p.ARC+r,r,0,(a<180?0:1)+",1",_179[1][0].x+" "+_179[1][0].y];return gf.drawPath([{command:p.MOVE,points:_179[0][0]},arc.join(" ")],this.getStyle(gp,_177),true);},getGraphCoordinates:function(gp,_17c){var p=gp.getCoordinate(_17c),w=gp.getWidth(_17c),h=gp.getHeight(_17c),r=w>h?h>>1:w>>1,min=w>h?h:w,_17d=[{x:p.x+r,y:p.y+r}];gp.setWidth(min,_17c);gp.setHeight(min,_17c);return _17d;},getMotionAnchorCoordinates:function(gp,_17e){var _17f=gp.getRealMotionAnchors(_17e),_180=[],gs,w=gp.getWidth(_17e),_181=gp.getCoordinate(_17e),_182=_173.rotation,_183=gp.getGraphCoordinates(_17e)[0];_181.x+=(w>>1);if(!_17f){_17f=[10,100];gs=gp.getGraphStatus();gs.setMotionAnchors(_17f,_17e);}dojo.forEach(_17f,function(_184){_180.push(_182(_181,_183,_184));},this);return _180;},calcMotionAnchor:function(gp,_185,_186,_187){var w=gp.getWidth(_187),h=gp.getHeight(_187),r=w>h?h>>1:w>>1,_188=gp.getCoordinate(_187),_189=gp.getGraphCoordinates(_187),newp=_173.intersectCircleLine(_189[0],r,_189[0],_186)[0];_188.x+=(w>>1);return _173.angle(_188,_189[0],newp);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RounderRectangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RounderRectangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RounderRectangleStrategy");(function(){var _18a=common.calc.Geometry,_18b=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RounderRectangleStrategy",drawboard.graph.strategy.GraphStrategy,{getGraphCoordinates:function(gp,_18c){var _18d=gp.getCoordinate(_18c),h=gp.getHeight(_18c),w=gp.getWidth(_18c),x=_18d.x,y=_18d.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_18e,_18f){return _18a.isPointInPolyn(gp.getGraphCoordinates(_18f),_18e);},draw:function(gp,gf,_190){var p=_18b.Path,_191=gp.getGraphRotator(_190),a=_191.angle,pole=_191.coordinate,r=_190.getRounder(),_192=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];return gf.drawRect(gp.getCoordinate(_190),gp.getWidth(_190),gp.getHeight(_190),r,(a!=0)&&{transform:_192},this.getStyle(gp,_190));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RounderSquareStrategy"]){dojo._hasResource["drawboard.graph.strategy.RounderSquareStrategy"]=true;dojo.provide("drawboard.graph.strategy.RounderSquareStrategy");(function(){var _193=common.calc.Geometry,_194=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RounderSquareStrategy",drawboard.graph.strategy.SquareStrategy,{draw:function(gp,gf,_195){var p=_194.Path,_196=gp.getGraphRotator(_195),a=_196.angle,pole=_196.coordinate,w=gp.getWidth(_195),h=gp.getHeight(_195),min=w>h?h:w,r=_195.getRounder(),_197=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];gp.getGraphCoordinates(_195);return gf.drawRect(gp.getCoordinate(_195),min,min,r,(a!=0)&&{transform:_197},this.getStyle(gp,_195));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.TriangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.TriangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.TriangleStrategy");(function(){var _198=common.calc.Geometry,_199=drawboard.Constant;dojo.declare("drawboard.graph.strategy.TriangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_19a,_19b){return _198.isPointInPolyn(gp.getGraphCoordinates(_19b),_19a);},draw:function(gp,gf,_19c){var p=_199.Path,_19d=gp.getGraphCoordinates(_19c);return gf.drawPath([{command:p.MOVE,points:_19d[0]},{command:p.LINE,points:_19d[1]},{command:p.LINE,points:_19d[2]}],this.getStyle(gp,_19c));},getGraphCoordinates:function(gp,_19e){var _19f=gp.getCoordinate(_19e),w=gp.getWidth(_19e),h=gp.getHeight(_19e),x=_19f.x,y=_19f.y;return [{x:x+(w>>1),y:y},{x:x,y:y+h},{x:x+w,y:y+h}];},getMarkCoordinates:function(gp,_1a0){var _1a1=gp.getCoordinate(_1a0),w=gp.getWidth(_1a0),h=gp.getHeight(_1a0),_1a2=gp.getRealMarks(_1a0),x=_1a1.x,y=_1a1.y;if(!_1a2){return [{x:x+(w>>1),y:y},{x:x,y:y+h},{x:x+w,y:y+h},{x:x+(w>>1),y:y+(h>>1)}];}var _1a3=[_1a2[0]||{x:x+(w>>1),y:y},_1a2[1]||{x:x,y:y+h},_1a2[2]||{x:x+w,y:y},_1a2[3]||{x:x+(w>>1),y:y+(h>>1)}];for(var i=4;i<_1a2.length;i++){_1a3.push(_1a2[i]);}return _1a3;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RightTriangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RightTriangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RightTriangleStrategy");(function(){var _1a4=common.calc.Geometry,_1a5=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RightTriangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_1a6,_1a7){return _1a4.isPointInPolyn(gp.getGraphCoordinates(_1a7),_1a6);},draw:function(gp,gf,_1a8){var p=_1a5.Path,_1a9=gp.getGraphCoordinates(_1a8);return gf.drawPath([{command:p.MOVE,points:_1a9[0]},{command:p.LINE,points:_1a9[1]},{command:p.LINE,points:_1a9[2]}],this.getStyle(gp,_1a8));},getGraphCoordinates:function(gp,_1aa){var _1ab=gp.getCoordinate(_1aa),w=gp.getWidth(_1aa),h=gp.getHeight(_1aa),x=_1ab.x,y=_1ab.y;return [{x:x,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},getMarkCoordinates:function(gp,_1ac){var _1ad=gp.getCoordinate(_1ac),w=gp.getWidth(_1ac),h=gp.getHeight(_1ac),_1ae=gp.getRealMarks(_1ac),x=_1ad.x,y=_1ad.y;if(!_1ae){return [{x:x,y:y},{x:x+w,y:y+h},{x:x,y:y+h},{x:x+(w>>1),y:y+(h>>1)}];}var _1af=[_1ae[0]||{x:x,y:y},_1ae[1]||{x:x+w,y:y+h},_1ae[2]||{x:x,y:y+h},_1ae[3]||{x:x+(w>>1),y:y+(h>>1)}];for(var i=4;i<_1ae.length;i++){_1af.push(_1ae[i]);}return _1af;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.LineStrategy"]){dojo._hasResource["drawboard.graph.strategy.LineStrategy"]=true;dojo.provide("drawboard.graph.strategy.LineStrategy");(function(){var _1b0=common.calc.Geometry,_1b1=drawboard.Constant;dojo.declare("drawboard.graph.strategy.LineStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_1b2,_1b3){var _1b4=gp.getGraphCoordinates(_1b3);return _1b0.isPointInSegment(_1b4[0],_1b4[1],_1b2);},isAnchor:function(d){return true;},draw:function(gp,gf,_1b5){var p=_1b1.Path,_1b6=gp.getGraphCoordinates(_1b5);return gf.drawLine(_1b6[0],_1b6[1],this.getStyle(gp,_1b5));},getActiveAnchors:function(gp,_1b7){return drawboard.skeletonController.create(gp.getSkeletonCoordinates(_1b7));},getSkeletonCoordinates:function(gp,_1b8){var _1b9=gp.getCoordinate(_1b8),w=gp.getWidth(_1b8),h=gp.getHeight(_1b8),x=_1b9.x,y=_1b9.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y+h,css:"mover_se"}];},getGraphCoordinates:function(gp,_1ba){var _1bb=gp.getCoordinate(_1ba),w=gp.getWidth(_1ba),h=gp.getHeight(_1ba),x=_1bb.x,y=_1bb.y;return [{x:x,y:y,css:"mover_nw",isAnchored:true},{x:x+w,y:y+h,css:"mover_se",isAnchored:true}];},getMotionAnchorCoordinates:function(gp,_1bc){return null;},getMarkCoordinates:function(gp,_1bd){return null;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.DiamondStrategy"]){dojo._hasResource["drawboard.graph.strategy.DiamondStrategy"]=true;dojo.provide("drawboard.graph.strategy.DiamondStrategy");(function(){var _1be=common.calc.Geometry,_1bf=drawboard.Constant;dojo.declare("drawboard.graph.strategy.DiamondStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_1c0,_1c1){return _1be.isPointInPolyn(gp.getGraphCoordinates(_1c1),_1c0);},draw:function(gp,gf,_1c2){var p=_1bf.Path,_1c3=gp.getGraphCoordinates(_1c2);return gf.drawPath([{command:p.MOVE,points:_1c3[0]},{command:p.LINE,points:_1c3[1]},{command:p.LINE,points:_1c3[2]},{command:p.LINE,points:_1c3[3]}],this.getStyle(gp,_1c2));},getGraphCoordinates:function(gp,_1c4){var _1c5=gp.getCoordinate(_1c4),w=gp.getWidth(_1c4),h=gp.getHeight(_1c4),x=_1c5.x,y=_1c5.y;return [{x:x+(w>>1),y:y},{x:x,y:y+(h>>1)},{x:x+(w>>1),y:y+h},{x:x+w,y:y+(h>>1)}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy");(function(){var _1c6=common.calc.Geometry,_1c7=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_1c8,_1c9){return _1c6.isPointInPolyn(gp.getGraphCoordinates(_1c9),_1c8);},isAnchor:function(d){if(d.getIndex()==2){return true;}return false;},getActiveAnchors:function(gp,_1ca){var _1cb=gp.getSkeletonCoordinates(_1ca),_1cc=[_1cb[2]];return drawboard.skeletonController.create(_1cc);},getRotatorCoordinate:function(gp,_1cd){return this.getGraphCoordinates(gp,_1cd)[0];},draw:function(gp,gf,_1ce){var p=_1c7.Path,_1cf=gp.getGraphCoordinates(_1ce);return gf.drawPath([{command:p.MOVE,points:_1cf[0]},{command:p.LINE,points:_1cf[1]},{command:p.LINE,points:_1cf[2]},{command:p.LINE,points:_1cf[3]},{command:p.LINE,points:_1cf[4]},{command:p.LINE,points:_1cf[5]},{command:p.LINE,points:_1cf[6]}],this.getStyle(gp,_1ce));},getGraphCoordinates:function(gp,_1d0){var _1d1=gp.getCoordinate(_1d0),w=gp.getWidth(_1d0),h=gp.getHeight(_1d0),x=_1d1.x,y=_1d1.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+w,y:y+h3},{x:x+w,y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_1d2){var _1d3=gp.getCoordinate(_1d2),w=gp.getWidth(_1d2),h=gp.getHeight(_1d2),x=_1d3.x,y=_1d3.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"}];},sizeChange:function(gp,_1d4,_1d5,_1d6){var d=_1c7.Direction,p=gp.getCoordinate(_1d6),w=gp.getWidth(_1d6),h=gp.getHeight(_1d6),_1d7=_1d5.x,_1d8=_1d5.y,_1d9=_1d4.getDirect();switch(_1d9){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_1d8)},_1d6);gp.setHeight(h-(_1d8<<1),_1d6);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_1d8)},_1d6);gp.setHeight(h+(_1d8<<1),_1d6);break;case d.WEST:var _1da=gp.getMotionAnchorCoordinates(_1d6)[0][0],_1db,wm,em,_1dc=gp.getRotator(_1d6);gp.setCoordinate({x:p.x+_1d7,y:p.y+_1d8},_1d6);_1db=gp.getCoordinate(_1d6);wm={x:_1db.x,y:_1db.y+(h>>1)};em={x:_1db.x+w,y:_1db.y+(h>>1)};_1dc.angle=_1c6.angle(em,wm,_1da);gp.setWidth(_1c6.getDistant(_1da,wm),_1d6);gp.setRotator(_1dc,_1d6);break;case d.EAST:var _1da=gp.getSkeletonCoordinates(_1d6)[3][0],_1db=gp.getCoordinate(_1d6),wm,em,_1dd,_1dc=gp.getRotator(_1d6);wm={x:_1db.x,y:_1db.y+(h>>1)};em={x:_1db.x+w,y:_1db.y+(h>>1)};_1dd={x:_1da.x+_1d7,y:_1da.y+_1d8};_1dc.angle=_1c6.angle(em,wm,_1dd);gp.setWidth(_1c6.getDistant(_1dd,wm),_1d6);gp.setRotator(_1dc,_1d6);break;case d.END:break;default:break;}},calcMotionAnchor:function(gp,_1de,_1df,_1e0){var _1e1=gp.getCoordinate(_1e0),wm={x:_1e1.x,y:_1e1.y+(gp.getHeight(_1e0)>>1)},em={x:_1e1.x+gp.getWidth(_1e0),y:_1e1.y+(gp.getHeight(_1e0)>>1)},_1e2=_1c6.angle(em,wm,_1df),_1e3;_1e3=gp.getRotator(_1e0);_1e3.angle=_1e2;gp.setWidth(_1c6.getDistant(wm,_1df),_1e0);gp.setRotator(_1e3,_1e0);return _1df;},getMotionAnchorCoordinates:function(gp,_1e4){var _1e5=gp.getCoordinate(_1e4),w=gp.getWidth(_1e4),h=gp.getHeight(_1e4),x=_1e5.x,y=_1e5.y;return [{x:x+w,y:y+(h>>1)}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy");(function(){var _1e6=common.calc.Geometry,_1e7=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_1e8,_1e9){return _1e6.isPointInPolyn(gp.getGraphCoordinates(_1e9),_1e8);},isAnchor:function(d){if(d.getIndex()==2||d.getIndex()==3){return true;}return false;},getActiveAnchors:function(gp,_1ea){var _1eb=gp.getSkeletonCoordinates(_1ea),_1ec=[_1eb[2],_1eb[3]];return drawboard.skeletonController.create(_1ec);},getRotatorCoordinate:function(gp,_1ed){return this.getGraphCoordinates(gp,_1ed)[0];},draw:function(gp,gf,_1ee){var p=_1e7.Path,_1ef=gp.getGraphCoordinates(_1ee);return gf.drawPath([{command:p.MOVE,points:_1ef[0]},{command:p.LINE,points:_1ef[1]},{command:p.LINE,points:_1ef[2]},{command:p.LINE,points:_1ef[3]},{command:p.LINE,points:_1ef[4]},{command:p.LINE,points:_1ef[5]},{command:p.LINE,points:_1ef[6]},{command:p.LINE,points:_1ef[7]},{command:p.LINE,points:_1ef[8]},{command:p.LINE,points:_1ef[9]}],this.getStyle(gp,_1ee));},getGraphCoordinates:function(gp,_1f0){var _1f1=gp.getCoordinate(_1f0),w=gp.getWidth(_1f0),h=gp.getHeight(_1f0),x=_1f1.x,y=_1f1.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+(w-(h>>1)),y:y+h3},{x:x+(w-(h>>1)),y:y},{x:x+w,y:y+(h>>1),isAnchored:true},{x:x+(w-(h>>1)),y:y+h},{x:x+(w-(h>>1)),y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_1f2){var _1f3=gp.getCoordinate(_1f2),w=gp.getWidth(_1f2),h=gp.getHeight(_1f2),x=_1f3.x,y=_1f3.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"},{x:x+w,y:y+(h>>1),css:"mover_e"}];},sizeChange:function(gp,_1f4,_1f5,_1f6){var d=_1e7.Direction,p=gp.getCoordinate(_1f6),w=gp.getWidth(_1f6),h=gp.getHeight(_1f6),_1f7=_1f5.x,_1f8=_1f5.y,_1f9=_1f4.getDirect();switch(_1f9){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_1f8)},_1f6);gp.setHeight(h-(_1f8<<1),_1f6);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_1f8)},_1f6);gp.setHeight(h+(_1f8<<1),_1f6);break;case d.WEST:var _1fa=gp.getSkeletonCoordinates(_1f6)[3][0],_1fb,wm,em,_1fc=gp.getRotator(_1f6);gp.setCoordinate({x:p.x+_1f7,y:p.y+_1f8},_1f6);_1fb=gp.getCoordinate(_1f6);wm={x:_1fb.x,y:_1fb.y+(h>>1)};em={x:_1fb.x+w,y:_1fb.y+(h>>1)};_1fc.angle=_1e6.angle(em,wm,_1fa);gp.setWidth(_1e6.getDistant(_1fa,wm),_1f6);gp.setRotator(_1fc,_1f6);break;case d.EAST:var _1fa=gp.getSkeletonCoordinates(_1f6)[3][0],_1fb=gp.getCoordinate(_1f6),wm,em,_1fd,_1fc=gp.getRotator(_1f6);wm={x:_1fb.x,y:_1fb.y+(h>>1)};em={x:_1fb.x+w,y:_1fb.y+(h>>1)};_1fd={x:_1fa.x+_1f7,y:_1fa.y+_1f8};_1fc.angle=_1e6.angle(em,wm,_1fd);gp.setWidth(_1e6.getDistant(_1fd,wm),_1f6);gp.setRotator(_1fc,_1f6);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.command.Command"]){dojo._hasResource["drawboard.command.Command"]=true;dojo.provide("drawboard.command.Command");(function(){var _1fe=drawboard.Constant.Command;dojo.declare("drawboard.command.Command",common.command.Command,{_memo:null,_executor:null,_runtime:null,_description:{},constructor:function(_1ff,memo,_200){if(!_1ff){new common.exception.Exception({msg:"the executor must be exist in the command!"});return;}this._executor=_1ff;this._memo=memo;if(!_200){this.execute=this.positive;this.unexecute=this.negative;}else{this.execute=this.negative;this.unexecute=this.positive;}},getType:function(){return "";},getConstant:function(){return _1fe;},setMemo:function(memo){this._memo=memo;},getMemo:function(){return this._memo;},setRuntime:function(_201){this._runtime=_201;},getRuntime:function(){var _202=this._runtime;if(!_202){new common.exception.Exception({msg:"the runtime must be exist in the command!"});}return _202;},getExecutor:function(){return this._executor;},setExecutor:function(_203){this._executor=_203;},execute:function(){},unexecute:function(){},positive:function(){},negative:function(){},setDescription:function(_204,_205){this._description={first:_204,second:_205};},isPositive:function(){if(this.execute==this.positive){return true;}return false;},isCancelOut:function(){return false;},getDesciption:function(){var desp=this._description;if(this.isPositive()){return desp.first;}return desp.second;},merge:function(_206){if(this.getType()!=_206.getType()||this.getExecutor()!=_206.getExecutor()){return false;}return this._merge(_206);},_merge:function(_207){}});})();}if(!dojo._hasResource["drawboard.command.AddVSDeleteConstrainCommand"]){dojo._hasResource["drawboard.command.AddVSDeleteConstrainCommand"]=true;dojo.provide("drawboard.command.AddVSDeleteConstrainCommand");dojo.declare("drawboard.command.AddVSDeleteConstrainCommand",drawboard.command.Command,{getType:function(){return this.getConstant().ADDVSDELTECONSTRAINCOMMAND;},positive:function(){var _208=this.getExecutor(),memo=this.getMemo(),_209=this.getRuntime();dojo.forEach(memo,function(mark){_208.addListener(mark.gp,mark.d,mark.restrainedGp,mark.restrainedD,_209);},this);},negative:function(){var _20a=this.getExecutor(),memo=this.getMemo(),_20b=this.getRuntime(),_20c;dojo.forEach(memo,function(mark){_20c=_20a.getRestrainedCache(mark.restrainedGp,mark.restrainedD,_20b);if(_20c&&_20c.length>0){memo=[];this.setMemo(memo);dojo.forEach(_20c,function(item){memo.push({gp:item.gp,d:item.decorate,restrainedGp:mark.restrainedGp,restrainedD:mark.restrainedD||item.restrainedD});},this);}_20a.removeListener(mark.restrainedGp,mark.restrainedD,_20b);},this);},_merge:function(_20d){return false;}});}if(!dojo._hasResource["drawboard.command.CombineVSDevidedCommand"]){dojo._hasResource["drawboard.command.CombineVSDevidedCommand"]=true;dojo.provide("drawboard.command.CombineVSDevidedCommand");dojo.declare("drawboard.command.CombineVSDevidedCommand",drawboard.command.Command,{getType:function(){return this.getConstant().COMBINEVSDEVIDEDCOMMAND;},positive:function(){var _20e=this.getExecutor(),memo=this.getMemo();_20e.combineGraph(memo);},negative:function(){var _20f=this.getExecutor(),memo=this.getMemo();_20f.divideGraph(memo);},_merge:function(_210){return false;}});}if(!dojo._hasResource["drawboard.command.CompositeCommand"]){dojo._hasResource["drawboard.command.CompositeCommand"]=true;dojo.provide("drawboard.command.CompositeCommand");dojo.declare("drawboard.command.CompositeCommand",[drawboard.command.Command,common.container.ListContainer],{constructor:function(){this.execute=this.positive;this.unexecute=this.negative;},getType:function(){return this.getConstant().COMPOSITECOMMAND;},add:function(_211){var last=this.last(),len=this.size();if(len==0||(last&&!last.merge(_211))){drawboard.command.CompositeCommand.superclass.add.call(this,_211);return;}},positive:function(){this.forInItems(function(_212){_212.execute();},this);},negative:function(){this.forInItems(function(_213){_213.unexecute();},this);}});}if(!dojo._hasResource["drawboard.command.CreateVSDeleteCommand"]){dojo._hasResource["drawboard.command.CreateVSDeleteCommand"]=true;dojo.provide("drawboard.command.CreateVSDeleteCommand");dojo.declare("drawboard.command.CreateVSDeleteCommand",drawboard.command.Command,{_info:null,index:null,getType:function(){return this.getConstant().CREATEVSDELETECOMMAND;},positive:function(){var _214=this.getExecutor(),memo=this.getMemo(),info=this._info,_215=this.getRuntime(),_216=_215.getContext().getStyleCtrl(),_217=this.index;_217===null?_214.add(memo):_214.insert(this.index,memo);if(info){dojo.forEach(info,function(item){_214.insert(item.index,item.gp);item.gs&&_216.addItem(item.gp.getIdty(),item.gs);memo.add(item.gp,_215);},this);memo.resetRelations();}},negative:function(){var _218=this.getExecutor(),memo=this.getMemo(),info,_219=this.getRuntime(),_21a=_219.getContext().getStyleCtrl();if(memo.isComposite()){if(!this._info){this._info=[];}info=this._info;var gp;memo.forInItems(function(item){gp=item.gp;info.push({gp:gp,gs:_21a.getItem(gp.getIdty()),index:_218.indexOf(gp)});},this);}this.index=_218.indexOf(memo);_218.removeGraph(memo);},_merge:function(_21b){return false;}});}if(!dojo._hasResource["drawboard.command.MoveCommand"]){dojo._hasResource["drawboard.command.MoveCommand"]=true;dojo.provide("drawboard.command.MoveCommand");dojo.declare("drawboard.command.MoveCommand",drawboard.command.Command,{getType:function(){return this.getConstant().MOVECOMMAND;},positive:function(){var _21c=this.getExecutor(),memo=this.getMemo(),_21d=this.getRuntime();_21c.move(memo.start,memo.end,_21d);},negative:function(){var _21e=this.getExecutor(),memo=this.getMemo(),_21f=this.getRuntime();_21e.move(memo.end,memo.start,_21f);},_merge:function(_220){var memo=this.getMemo(),_221=_220.getMemo();memo.end=_221.end;return true;}});}if(!dojo._hasResource["drawboard.command.ResizeCommand"]){dojo._hasResource["drawboard.command.ResizeCommand"]=true;dojo.provide("drawboard.command.ResizeCommand");dojo.declare("drawboard.command.ResizeCommand",drawboard.command.Command,{getType:function(){return this.getConstant().RESIZECOMMAND;},positive:function(){var _222=this.getExecutor(),memo=this.getMemo(),_223=this.getRuntime();_222.sizeChange(memo.decorate,memo.start,memo.end,_223);},negative:function(){var _224=this.getExecutor(),memo=this.getMemo(),_225=this.getRuntime();_224.sizeChange(memo.decorate,memo.end,memo.start,_225);},_merge:function(_226){var memo=this.getMemo(),_227=_226.getMemo();if(memo.decorate!=_227.decorate){return false;}memo.end=_227.end;return true;}});}if(!dojo._hasResource["drawboard.command.RotateCommand"]){dojo._hasResource["drawboard.command.RotateCommand"]=true;dojo.provide("drawboard.command.RotateCommand");dojo.declare("drawboard.command.RotateCommand",drawboard.command.Command,{_oriAngle:null,getType:function(){return this.getConstant().ROTATECOMMAND;},positive:function(){var _228=this.getExecutor(),memo=dojo.clone(this.getMemo()),_229=this.getRuntime();if(this._oriAngle===null){this._oriAngle=_228.getRotator(_229).angle;}_228.setRotator(memo,_229);},negative:function(){var _22a=this.getExecutor(),memo=dojo.clone(this.getMemo()),_22b=this.getRuntime();memo.angle=this._oriAngle;_22a.setRotator(memo,_22b);},_merge:function(_22c){var memo=this.getMemo(),_22d=_22c.getMemo();memo.angle=_22d.angle;return true;}});}if(!dojo._hasResource["drawboard.command.StyleCommand"]){dojo._hasResource["drawboard.command.StyleCommand"]=true;dojo.provide("drawboard.command.StyleCommand");dojo.declare("drawboard.command.StyleCommand",drawboard.command.Command,{_style:null,getType:function(){return this.getConstant().STYLECOMMAND;},getStyle:function(){var _22e=this._style;if(!_22e){this._style=_22e={};}return _22e;},positive:function(){var _22f=this.getExecutor(),memo=this.getMemo();if(!this._style&&_22f.containGraphStyle(memo.gp)){this._style=_22f.getGraphStyleValue(memo.gp,memo.attr);}_22f.addGraphStyle(memo.gp,memo.attr,memo.value,memo.isText);if(memo.gp.isComposite()){var _230=this.getStyle();memo.gp.forInItems(function(item){if(_22f.containGraphStyle(item.gp)){_230[item.gp.getIdty()]=_22f.getGraphStyleValue(item.gp,memo.attr);}_22f.addGraphStyle(item.gp,memo.attr,memo.value,memo.isText);},this);}},negative:function(){var _231=this.getExecutor(),memo=this.getMemo();if(memo.gp.isComposite()){var _232=this.getStyle(),_233;memo.gp.forInItems(function(item){_233=_232[item.gp.getIdty()];if(_233){_231.addGraphStyle(item.gp,memo.attr,_233,memo.isText);return;}_231.removeGraphStyle(item.gp,memo.attr);},this);return;}if(this._style){_231.addGraphStyle(memo.gp,memo.attr,this._style,memo.isText);return;}_231.removeGraphStyle(memo.gp,memo.attr);},_merge:function(_234){return false;}});}if(!dojo._hasResource["drawboard.command.ZoomCommand"]){dojo._hasResource["drawboard.command.ZoomCommand"]=true;dojo.provide("drawboard.command.ZoomCommand");dojo.declare("drawboard.command.ZoomCommand",drawboard.command.Command,{getType:function(){return this.getConstant().ZOOMCOMMAND;},positive:function(){var _235=this.getExecutor(),memo=this.getMemo(),_236=this.getRuntime();_235.zoom(memo,_236);},negative:function(){var _237=this.getExecutor(),memo=this.getMemo(),_238=this.getRuntime();_237.zoom({x:-memo.x,y:-memo.y},_238);},_merge:function(_239){var memo=this.getMemo(),_23a=_239.getMemo();this.setMemo(common.calc.Geometry.add2Points(memo,_23a));return true;}});}if(!dojo._hasResource["drawboard.command.MotionCommand"]){dojo._hasResource["drawboard.command.MotionCommand"]=true;dojo.provide("drawboard.command.MotionCommand");dojo.declare("drawboard.command.MotionCommand",drawboard.command.Command,{getType:function(){return this.getConstant().MOTIONCOMMAND;},positive:function(){var _23b=this.getExecutor(),memo=this.getMemo(),_23c=this.getRuntime(),ma=memo.decorator;(!memo.oldP)&&(memo.oldP=ma.getCenter());_23b.moveMotionAnchor(ma,memo.p,_23c);},negative:function(){var _23d=this.getExecutor(),memo=this.getMemo(),_23e=this.getRuntime();_23d.moveMotionAnchor(memo.decorator,memo.oldP,_23e);_23d.normalize(memo.decorator,_23e);},_merge:function(_23f){var memo=this.getMemo(),ma=memo.decorator,_240=_23f.getMemo(),cma=_240.decorator;if(ma.getIndex()==cma.getIndex()){memo.p=_240.p;return true;}return false;}});}if(!dojo._hasResource["drawboard.PreRequire"]){dojo._hasResource["drawboard.PreRequire"]=true;dojo.provide("drawboard.PreRequire");}if(!dojo._hasResource["drawboard._Event"]){dojo._hasResource["drawboard._Event"]=true;dojo.provide("drawboard._Event");(function(){var _241=common.calc.Geometry,_242=drawboard.Constant.ActionStatus,_243=drawboard.Constant;dojo.declare("drawboard._Event",null,{_start:null,_end:null,boxCache:null,_marks:null,getBoxCache:function(){if(!this.boxCache){var node=(this.fixNode||this.domNode),_244={left:node.offsetLeft,top:node.offsetTop};this.boxCache=_244;}return this.boxCache;},refreshBoxCache:function(){this.boxCache=null;},fetchCoordinate:function(e){var box=this.getBoxCache(),_245=this.domNode;return {x:e.pageX-box.left+_245.scrollLeft,y:e.pageY-box.top+_245.scrollTop};},showMarkActive:function(gp,d,_246){var _247=d||gp.getActiveAnchors(_246),_248,_249,mark;if((d&&!gp.isAnchor(d))||!_247){return;}(!dojo.isArray(_247))&&(_247=[_247]);_248=drawboard.markController;dojo.forEach(_247,function(s){mark=_248.cross(s,gp,this,_246);if(mark){!_249&&(_249=[])&&(this._marks=_249);_249.push(mark);}},this);_248=_246.getContext().getStyleCtrl();!_249&&(this._marks=null);if(_249){var _24a=[];dojo.forEach(_249,function(m){this.push(m.d);gp=m.gp;},_24a);_248.setActives(_24a,gp);return;}_248.setActives(null);},doClick:function(e){this.inherited(arguments);},doMouseMove:function(e){this.inherited(arguments);this._end&&(this._start=this._end);this._end=this.fetchCoordinate(e);var gp=this.getActive(),_24b=this._start,end=this._end,_24c=this.getActionStatus(),_24d=this.getDecorate(),_24e,pole,a,_24f=this.getRuntime(),_250=this.getSelectRect(),_251=_243.Command,_252=dojo.hitch(this,this.addCommand),_253=true;if(_24c!=_242.NONE&&gp){_24e=dojo.clone(gp.getRotator(_24f));pole=_24e.coordinate;}_250&&!gp&&(gp=_250);if(!gp&&_24c!=_242.DRAWING&&_24c!=_242.SELECTING&&_24c!=_242.TEXT){return;}switch(_24c){case _242.RESIZING:_252(_251.RESIZECOMMAND,gp,{decorate:_24d,start:_24b,end:end});this.showMarkActive(gp,drawboard.skeletonController.createItem(gp.getSkeletonCoordinates(_24f)[_24d.getIndex()],_24d.getIndex()),_24f);break;case _242.MOVING:_252(_251.MOVECOMMAND,gp,{start:_24b,end:end});this.showMarkActive(gp,null,_24f);break;case _242.DRAWING:case _242.SELECTING:case _242.TEXT:var _254=this.getDrawEntity(true);_254.width=end.x-_254.x;_254.height=end.y-_254.y;break;case _242.MOTION:_252(_251.MOTIONCOMMAND,gp,{decorator:_24d,p:end});break;case _242.ROTATING:case _242.POLEMOVING:if(_24c==_242.ROTATING){_24e.angle=_241.angle({x:pole.x,y:pole.y-_24f.getContext().getParamsCtrl().getRotateDistance()},pole,this._end);_252(_251.ROTATECOMMAND,gp,_24e);}else{_24d.pole=_24e.coordinate=end;gp.setRotator(_24e,_24f);}break;case _242.NONE:default:_253=false;break;}_253&&this.draw();},doMouseDown:function(e){this.inherited(arguments);var _255=this.fetchCoordinate(e),_256=this.getActionStatus(),_257;if(_256==_242.DRAWING||_256==_242.SELECTING||_256==_242.TEXT){_257=this.getDrawEntity(true);_257.x=_255.x;_257.y=_255.y;}this._start=_255;},doMouseOver:function(e){this.inherited(arguments);},doMouseUp:function(e){var _258=this._marks,_259=this.getRuntime(),_25a=this.getActionStatus(),_25b=(_25a==_242.DRAWING||_25a==_242.TEXT)?false:true,_25c=drawboard.relationController,gp=this.getActive(),_25d=this.getDecorate();gp&&(gp.normalize(_25d,_259));if(gp&&_25c.containRestrain(gp,_25d,_259)){this.addCommand(_243.Command.ADDVSDELTECONSTRAINCOMMAND,_25c,[{restrainedGp:gp,restrainedD:_25d}],true);}if(_258){var _25e=[];dojo.forEach(_258,function(mark){if(!_25c.containRestrain(mark.restrainedGp,mark.restrainedD,_259)){_25e.push(mark);}},this);(_25e.length>0)&&this.addCommand(_243.Command.ADDVSDELTECONSTRAINCOMMAND,_25c,_25e);}if(this._status==_242.TEXT){var _25f=this.getDrawEntity(),_260=this.getTextBoard();_260.clearText();_260.show(_25f);this.setDrawType("drawboard.graph.strategy.TextStrategy");}_259.getContext().getStyleCtrl().setActives(null);this._start=null;this._end=null;this._marks=null;this.clearDrawEntity(_25b);this.inherited(arguments);this.clearCommand();this.draw();dojo.publish("/drawboard/mouseup");}});})();}if(!dojo._hasResource["drawboard.container.LayoutContainer"]){dojo._hasResource["drawboard.container.LayoutContainer"]=true;dojo.provide("drawboard.container.LayoutContainer");dojo.declare("drawboard.container.LayoutContainer",[dijit._Widget,common.container.ListContainer],{up:function(gs){var _261=this.indexOf(gs);this.move(_261,_261+1);},down:function(gs){var _262=this.indexOf(gs);this.move(_262,_262-1);},top:function(gs){var _263=this.indexOf(gs);this.move(_263,this.size());},bottom:function(gs){var _264=this.indexOf(gs);this.move(_264,0);}});}if(!dojo._hasResource["drawboard.graph.strategy.GraphStrategyFactory"]){dojo._hasResource["drawboard.graph.strategy.GraphStrategyFactory"]=true;dojo.provide("drawboard.graph.strategy.GraphStrategyFactory");(function(){dojo.declare("drawboard.graph.strategy.GraphStrategyFactory",common.container.MapContainer,{getGraphStrategy:function(_265){if(!this.contains(_265)){var _266=eval("new "+_265+"()");this.addItem(_265,_266);}return this.getItem(_265);}});if(!drawboard.GraphStrategyFactory){drawboard.GraphStrategyFactory=new drawboard.graph.strategy.GraphStrategyFactory();}})();}if(!dojo._hasResource["drawboard.controller.RelationController"]){dojo._hasResource["drawboard.controller.RelationController"]=true;dojo.provide("drawboard.controller.RelationController");(function(){var _267=drawboard.Constant.Symbol,_268=common.utils.CollectionUtils.hasAttr;dojo.declare("drawboard.controller.RelationController",[common.container.MapContainer,common.Cache],{addListener:function(gp,d,_269,_26a,_26b){var idty=gp.getIdty(),_26c=this.getItem(idty),item,_26d=false,_26e=d.getType()+_267.concat+d.getIndex();if(!_26c){_26c={};this.addItem(idty,_26c);}item=_26c[_26e];if(!item){item=[];_26c[_26e]=item;}dojo.some(item,function(i){if(i.gp==_269){_26d=true;return true;}},this);if(!_26d){item.push({gp:_269,decorate:_26a});this.addRestrainedCache(gp,d,_269,_26a,_26b);}},removeListener:function(_26f,_270,_271){var _272=this.removeRestrainedCache(_26f,_270,_271),_273,item,_274,dels,id;dojo.forEach(_272,function(item){id=item.id;_273=this.getItem(id);if(!_273){return;}dels=[];_274=item.decorate.getType()+_267.concat+item.decorate.getIndex();item=_273[_274];dojo.forEach(item,function(_275,_276){if(_275.gp!=_26f){return;}if(!_270||(_270&&_275.decorate.equal(_270))){dels.push(_276);}},this);dojo.forEach(dels.reverse(),function(_277){item.splice(_277,1);},this);delete _273[_274];if(!_268(_273)){this.removeItem(id);}},this);},fireEvent:function(idty,d,_278,_279,_27a){var _27b=this.getItem(idty),item,temp;if(!_27b){return;}item=_27b[d.getType()+_267.concat+d.getIndex()];item&&dojo.forEach(item,function(i){if(_27a&&!_27a(i.gp)){return;}temp=_278.concat();temp.unshift(i.decorate);temp.push(null);temp.push(_279);i.gp.sizeChange.apply(i.gp,temp);},this);},addRestrainedCache:function(gp,d,_27c,_27d,_27e){var idty=gp.getIdty(),_27f=this.getCache(_27e),_280=_27f[_27c.getIdty()],_281=_27d.getType()+_267.concat+_27d.getIndex();if(!_280){_280={};_27f[_27c.getIdty()]=_280;}!_280[_281]&&(_280[_281]={id:idty,gp:gp,decorate:d,restrainedGp:_27c,restrainedD:_27d});},containRestrain:function(_282,_283,_284){var _285=this.getRestrainedCache(_282,_283,_284);if(_285&&_285.length>0){return true;}return false;},getRestrainedCache:function(_286,_287,_288){var _289=this.getCache(_288),_28a=_289[_286.getIdty()],_28b;if(!_28a){return _28b;}if(_287){var _28c=_287.getType()+_267.concat+_287.getIndex();_28a[_28c]&&(_28b=[_28a[_28c]]);return _28b;}_28b=[];for(var _28d in _28a){_28b.push(_28a[_28d]);}return _28b;},removeRestrainedCache:function(_28e,_28f,_290){var _291=this.getCache(_290),_292=_291[_28e.getIdty()],_293;if(!_292){return _293;}if(_28f){var _294=_28f.getType()+_267.concat+_28f.getIndex();_292[_294]&&(_293=[_292[_294]]);delete _292[_294];if(!_268(_292)){delete _291[_28e.getIdty()];}return _293;}_293=[];for(var _295 in _292){_293.push(_292[_295]);}delete _291[_28e.getIdty()];return _293;},createCache:function(){return {};}});if(drawboard.relationController==null){drawboard.relationController=new drawboard.controller.RelationController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Decorator"]){dojo._hasResource["drawboard.graph.decorate.Decorator"]=true;dojo.provide("drawboard.graph.decorate.Decorator");dojo.declare("drawboard.graph.decorate.Decorator",dijit._Widget,{_type:null,coordinate:null,center:null,index:0,getIndex:function(){return this.index;},setIndex:function(_296){this.index=_296;},getType:function(){return this._type;},getCoordinate:function(){return this.coordinate;},setCoordinate:function(_297){this.coordinate=_297;},getCenter:function(){return this.center;},setCenter:function(_298){this.center=_298;},draw:function(gp,_299,_29a){},getGraphStrategy:function(_29b){return drawboard.GraphStrategyFactory.getGraphStrategy(_29b);},equal:function(d){if(d.getIndex()!=this.getIndex()){return false;}var same=true,ps=this.getCoordinate();dojo.some(d.getCoordinate(),function(item,_29c){if(item!=ps[_29c]){same=false;return true;}},this);return same;}});}if(!dojo._hasResource["drawboard.graph.decorate.Mark"]){dojo._hasResource["drawboard.graph.decorate.Mark"]=true;dojo.provide("drawboard.graph.decorate.Mark");(function(){var _29d=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Mark",drawboard.graph.decorate.Decorator,{_type:_29d.Decorate.MARK,draw:function(gp,_29e,_29f){var p=this.getCoordinate(),path=_29d.Path,_2a0=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.MOVE,points:p[2]},{command:path.LINE,points:p[3]},];gp.drawPath(_2a0,_29e,true);}});})();}if(!dojo._hasResource["drawboard.graph.GraphProxy"]){dojo._hasResource["drawboard.graph.GraphProxy"]=true;dojo.provide("drawboard.graph.GraphProxy");(function(){var _2a1=drawboard.Constant,_2a2=_2a1.Decorate,_2a3=drawboard.GraphStrategyFactory,_2a4=common.calc.Geometry,_2a5=_2a4.dividePoint,add=_2a4.add2Points,_2a6=_2a4.subtract2Points,_2a7=_2a4.rotation;dojo.declare("drawboard.graph.GraphProxy",null,{_graphStatus:null,_graphStrategyClass:null,_isActive:false,_isActived:false,_isComposite:false,_showMark:false,constructor:function(_2a8,_2a9){_2a9=dojo.trim(_2a9);this._graphStrategyClass=_2a9;this._graphStatus=_2a8;},getGraphStrategy:function(){return _2a3.getGraphStrategy(this.getGraphStrategyClass());},getGraphStrategyClass:function(){if(!this._graphStrategyClass){new common.exception.Exception({msg:"graph proxy must have an graph strategy class!"});}return this._graphStrategyClass;},getGraphStatus:function(){if(!this._graphStatus){new common.exception.Exception({msg:"graph status proxy must have an graph status instance!"});}return this._graphStatus;},setRatio:function(_2aa){return this.getGraphStatus().setRatio(_2aa);},getRatio:function(){return this.getGraphStatus().getRatio();},setText:function(text){this.getGraphStatus().setText(text);},getText:function(){return this.getGraphStatus().getText();},isComposite:function(){return this._isComposite;},showMark:function(_2ab){if(_2ab!==undefined){this._showMark=_2ab;}return this._showMark;},getIdty:function(){return this.getGraphStatus().getIdty();},isActive:function(_2ac){if(_2ac!==null&&_2ac!==undefined){this._isActive=_2ac;}return this._isActive;},isActived:function(_2ad){if(_2ad!==null&&_2ad!==undefined){this._isActived=_2ad;}return this._isActived;},getCenter:function(_2ae){var _2af=this.getCache(_2ae),_2b0=_2af[_2a2.CENTER];if(!_2b0){var gs=this.getGraphStatus(),c=gs.getCoordinate(_2ae),w=gs.getWidth(_2ae),h=gs.getHeight(_2ae);_2af[_2a2.CENTER]=_2b0={x:c.x+(w>>1),y:c.y+(h>>1)};}return _2b0;},getCoordinate:function(_2b1){return this.getGraphStatus().getCoordinate(_2b1);},setCoordinate:function(_2b2,_2b3){this.getGraphStatus().setCoordinate(_2b2,_2b3);},reset:function(_2b4,_2b5){var gs=this.getGraphStatus(),_2b6=gs.getMarks(_2b5),_2b7=gs.getMotionAnchors(_2b5);if(_2b6){dojo.forEach(_2b6,function(item){if(item){item.x+=_2b4.x;item.y+=_2b4.y;}},this);gs.setMarks(_2b6,_2b5);}if(_2b7&&!gs.isAffectedByZoom()){dojo.forEach(_2b7,function(_2b8){if(_2b8){_2b8.x+=_2b4.x;_2b8.y+=_2b4.y;}},this);gs.setMotionAnchors(_2b7,_2b5);}},getWidth:function(_2b9){return this.getGraphStatus().getWidth(_2b9);},setWidth:function(w,_2ba){this.getGraphStatus().setWidth(w,_2ba);},getHeight:function(_2bb){return this.getGraphStatus().getHeight(_2bb);},setHeight:function(h,_2bc){this.getGraphStatus().setHeight(h,_2bc);},setRotator:function(_2bd,_2be,_2bf){var gs=this.getGraphStatus(),_2c0=gs.getRotator();(!_2c0)&&(_2c0={angle:0});if(_2bd.angle!=_2c0.angle){_2c0.angle=_2bd.angle;gs.setRotator(_2c0);}else{}!_2bf&&this.refresh(_2be);},getRotator:function(_2c1){var gs=this.getGraphStatus(),_2c2=gs.getRotator(),_2c3=gs.getCoordinate(_2c1),h=gs.getHeight(_2c1),w=gs.getWidth(_2c1);return {coordinate:{x:_2c3.x+(w>>1),y:_2c3.y+(h>>1)},angle:_2c2?_2c2.angle:0};},getGraphRotator:function(_2c4){var gs=this.getGraphStatus(),_2c5=this.getGraphStrategy(),_2c6=gs.getRotateAngle(),_2c7=this.getCenter(_2c4);if(!_2c5.hasRotator()){return {coordinate:_2c5.getRotatorCoordinate(this,_2c4)||_2c7,angle:_2c6};}return {coordinate:_2c7,angle:_2c6};},getRealMarks:function(_2c8){return this.getGraphStatus().getMarks(_2c8);},getRealMotionAnchors:function(_2c9){return this.getGraphStatus().getMotionAnchors(_2c9);},getUrl:function(){return this.getGraphStatus().getUrl();},getNWCoordinate:function(_2ca){var _2cb=this.getGraphRotator(_2ca),pole=_2cb.coordinate,a=_2cb.angle;return _2a7(this.getCoordinate(_2ca),pole,a);},getSECoordinate:function(_2cc){var _2cd=this.getGraphRotator(_2cc),pole=_2cd.coordinate,a=_2cd.angle,_2ce=this.getCoordinate(_2cc),w=this.getWidth(_2cc),h=this.getHeight(_2cc);return _2a7({x:_2ce.x+(w>>1),y:_2ce.y+(h>>1)},pole,a);},getCoordinatesByDeal:function(_2cf,_2d0){var _2d1=_2cf(this,_2d0);if(!_2d1||_2d1.length==0){return null;}var r=_2d0.getDistance(),_2d2=this.getGraphRotator(_2d0),pole=_2d2.coordinate,_2d3=common.utils.CollectionUtils.copy4Attrs,a=_2d2.angle,p=_2d1[0],_2d4,temp;temp=_2a7(p,pole,a);_2d3(p,temp,{x:1,y:1});_2d1[0]=[temp,_2a7({x:p.x-r,y:p.y-r},pole,a),_2a7({x:p.x+r,y:p.y-r},pole,a),_2a7({x:p.x+r,y:p.y+r},pole,a),_2a7({x:p.x-r,y:p.y+r},pole,a)];dojo.forEach(_2d1,function(_2d5,_2d6){if(_2d6!=0){temp=_2a7(_2d5,pole,a);_2d3(_2d5,temp,{x:1,y:1});_2d4=_2a6(temp,_2d1[0][0]);_2d1[_2d6]=[temp,add(_2d1[0][1],_2d4),add(_2d1[0][2],_2d4),add(_2d1[0][3],_2d4),add(_2d1[0][4],_2d4)];}},this);return _2d1;},getGraphCoordinates:function(_2d7){var _2d8=this.getCache(_2d7),_2d9=_2d8[_2a2.Graph];if(!_2d9){var _2da=this.getGraphStrategy(),_2db=this.getGraphRotator(_2d7),pole=_2db.coordinate,a=_2db.angle,_2dc=_2da.getGraphCoordinates(this,_2d7);dojo.forEach(_2dc,function(item,_2dd){_2dc[_2dd]=_2a7(item,pole,a);},this);_2d8[_2a2.Graph]=_2dc;return _2dc;}return _2d9;},getSkeletonCoordinates:function(_2de){var _2df=this.getCache(_2de),_2e0=_2df[_2a2.SKELETON];if(!_2e0){var _2e1=this.getGraphStrategy(),_2e2=this.getCoordinatesByDeal(_2e1.getSkeletonCoordinates,_2de);_2df[_2a2.SKELETON]=_2e2;return _2e2;}return _2e0;},getMarkCoordinates:function(_2e3){var _2e4=this.getCache(_2e3),_2e5=_2e4[_2a2.MARK];if(!_2e5){var _2e6=this.getGraphStrategy(),_2e7=this.getCoordinatesByDeal(_2e6.getMarkCoordinates,_2e3);_2e4[_2a2.MARK]=_2e7;return _2e7;}return _2e5;},getOutletCoordinates:function(_2e8){var _2e9=this.getCache(_2e8),_2ea=_2e9[_2a2.OUTLET];if(!_2ea){var _2eb=new drawboard.graph.strategy.RectangleStrategy(),_2ec=_2eb.getGraphCoordinates(this,_2e8),_2ed=this.getGraphRotator(_2e8),pole=_2ed.coordinate,a=_2ed.angle;dojo.forEach(_2ec,function(item,_2ee){_2ec[_2ee]=_2a7(item,pole,a);},this);_2e9[_2a2.OUTLET]=_2ec;return _2ec;}return _2ea;},hasRotator:function(){return this.getGraphStrategy().hasRotator();},getRotatorCoordinates:function(_2ef){if(!this.hasRotator()){return null;}var _2f0=this.getCache(_2ef),_2f1=_2f0[_2a2.ROTATOR];if(!_2f1){var r=_2ef.getDistance(),d=_2ef.getRotateDistance(),_2f2=this.getRotator(_2ef),pole=_2f2.coordinate,a=_2f2.angle,_2f3=this.getCoordinate(_2ef),_2f4={x:pole.x,y:_2f3.y},_2f5=this.getGraphRotator(_2ef).coordinate,_2f6=_2a4.getDistant(pole,_2a7(_2f4,_2f5,a)),_2f7;(_2f6>0)&&(d+=_2f6);_2f7=_2a7({x:pole.x,y:pole.y-d-r},pole,a);_2f1=[_2a4.intersectCircleLine(_2f7,r,_2f7,{x:_2f7.x,y:_2f7.y+10})[0],_2a7({x:pole.x,y:pole.y-d},pole,a),_2a7({x:pole.x,y:pole.y-r},pole,a),{x:pole.x,y:pole.y},_2a7({x:pole.x,y:pole.y-2*r},pole,a),_2f7];_2f0[_2a2.ROTATOR]=_2f1;return _2f1;}return _2f1;},getMotionAnchorCoordinates:function(_2f8){var _2f9=this.getCache(_2f8),_2fa=_2f9[_2a2.MOTIONANCHOR];if(!_2fa){var _2fb=this.getGraphStrategy(),_2fc=this.getCoordinatesByDeal(_2fb.getMotionAnchorCoordinates,_2f8);_2f9[_2a2.MOTIONANCHOR]=_2fc;return _2fc;}return _2fa;},refresh:function(_2fd,_2fe){var _2ff=this.getMarkCoordinates(_2fd),_300,_301;this.clearCache(_2fd);this.getSkeletonCoordinates(_2fd);this.getMotionAnchorCoordinates(_2fd);_300=this.getMarkCoordinates(_2fd);dojo.forEach(_2ff,function(item,_302){if(item[0]!=_300[_302][0]){_301=_2a6(_300[_302][0],item[0]);drawboard.relationController.fireEvent(this.getIdty(),new drawboard.graph.decorate.Mark({coordinate:[item[1],item[3],item[2],item[4]],index:_302}),[_301],_2fd,_2fe);}},this);},getCache:function(_303){return _303.getCache(this);},clearCache:function(_304,type){_304.clearCache(this,type);},draw:function(_305){var node=this.getGraphStrategy().draw(this,_305.getGraphic(),_305);node.setAttribute("id",this.getIdty());if(this.isActived()){var p=drawboard.Constant.Path,_306=this.getOutletCoordinates(_305);_305.getGraphic().drawPath([{command:p.MOVE,points:_306[0]},{command:p.LINE,points:_306[1]},{command:p.LINE,points:_306[2]},{command:p.LINE,points:_306[3]},{command:p.LINE,points:_306[0]}],"fill:none;stroke:red;stroke-width:2");}},sizeChange:function(_307,_308,end,_309){var _30a=this.getGraphStrategy(),_30b=this.getGraphRotator(_309),_30c=_30b.coordinate,a=_30b.angle,_30d=_308,gp=this,_30e=_30a.hasRotator(),_30f={};if(end!==null&&end!==undefined){_30d=_2a6(end,_308);if(_30e){var _310=_307.getDirect(),d=_2a1.Direction,_311=this.getCoordinate(_309),_312=this.getSkeletonCoordinates(_309),_313,_314;switch(_310){case d.NORTH:case d.WEST:case d.WESTNORTH:_313=_312[3][0];_314=function(pos,p,a){gp.setCoordinate(add(_311,_2a6(_2a7(pos,p,-a),{x:_311.x+gp.getWidth(_309),y:_311.y+gp.getHeight(_309)})),_309);};break;case d.EASTNORTH:_313=_312[2][0];_314=function(pos,p,a){gp.setCoordinate(add(_311,_2a6(_2a7(pos,p,-a),{x:_311.x,y:_311.y+gp.getHeight(_309)})),_309);};break;case d.WESTSOUTH:_313=_312[1][0];_314=function(pos,p,a){gp.setCoordinate(add(_311,_2a6(_2a7(pos,p,-a),{x:_311.x+gp.getWidth(_309),y:_311.y})),_309);};break;case d.SOUTH:case d.EAST:case d.EASTSOUTH:_313=_312[0][0];_314=function(pos,p,a){pos=_2a7(pos,p,-a);gp.setCoordinate(pos,_309);};break;case d.END:break;default:break;}_30f.oriFixPos=_313;_30f.oriFixFunct=_314;_308=_2a7(_308,_30c,-a);end=_2a7(end,_30c,-a);_30d=_2a6(end,_308);}}_30a.sizeChange(this,_307,_30d,_309);if(_30e&&a!=0&&_30f!==undefined){this.clearCache(_309,_2a2.CENTER);var _315=_2a7(this.getCenter(_309),_30c,a);_30f.oriFixFunct(_30f.oriFixPos,_315,a);}this.refresh(_309);},normalize:function(_316,_317){var _318=this.getGraphStrategy().normalize(this,_316,_317);_318&&this.refresh(_317);},move:function(_319,end,_31a){var _31b=this.getCoordinate(_31a),_31c=_2a6(end,_319);this.setCoordinate({x:_31b.x+_31c.x,y:_31b.y+_31c.y},_31a);this.reset(_31c,_31a);this.refresh(_31a);},zoom:function(rate,_31d){this.refresh(_31d,function(){return false;});},moveMotionAnchor:function(_31e,_31f,_320){var _321=this.getGraphStrategy().calcMotionAnchor(this,_31e,_31f,_320),_322=this.getRealMotionAnchors(_320);_322&&(_31e.getIndex()<_322.length)&&(_321!=null)&&(_322[_31e.getIndex()]=_321);this.refresh(_320);},active:function(p,_323){if(this.getGraphStrategy().isIn(this,p,_323)){return this;}return null;},getActiveAnchors:function(_324){return this.getGraphStrategy().getActiveAnchors(this,_324);},isAnchor:function(d){return this.getGraphStrategy().isAnchor(d);},deleteAll:function(db,_325){this.destroy(_325);},destroy:function(_326){drawboard.relationController.removeListener(this,null,_326);}});})();}if(!dojo._hasResource["drawboard.graph.CompositeProxy"]){dojo._hasResource["drawboard.graph.CompositeProxy"]=true;dojo.provide("drawboard.graph.CompositeProxy");(function(){var _327=common.calc.Geometry,add=_327.add2Points,_328=_327.subtract2Points,_329=drawboard.Constant.Decorate;dojo.declare("drawboard.graph.CompositeProxy",[common.container.ListContainer,drawboard.graph.GraphProxy],{_focus:false,_isComposite:true,_operate:false,isFocus:function(_32a){if(_32a!==undefined){this._focus=_32a;}return this._focus;},contains:function(gp){if(!gp){return false;}var _32b=false;this.some(function(item){if(item.gp==gp){_32b=true;return true;}},this);return _32b;},remove:function(gp){var _32c;this.some(function(item,i){if(item.gp==gp){_32c=i;return true;}},this);drawboard.graph.CompositeProxy.superclass.remove.apply(this,[_32c]);},equals:function(cp){if(cp.size()!=this.size()){return false;}var same=true;this.some(function(item){if(!cp.contains(item.gp)){same=false;return true;}},this);return same;},resetRelations:function(){var that=this,_32d,gp;this.forInItems(function(item){gp=item.gp;_32d=(gp.getParent&&gp.getParent());if(_32d!=that){_32d&&_32d.remove(gp);gp.getParent=function(){return that;};}},this);},add:function(gp,_32e){drawboard.graph.CompositeProxy.superclass.add.apply(this,[{gp:gp,oriPos:gp.getCoordinate(_32e),oriRotator:dojo.clone(gp.getRotator(_32e))}]);if(_327.graphContainsGraph(this.getSkeletonCoordinates(_32e),gp.getSkeletonCoordinates(_32e))){return;}var rect=_327.getMaxRect(gp.getSkeletonCoordinates(_32e).concat(this.getSkeletonCoordinates(_32e)));this.setCoordinate({x:rect.x,y:rect.y},_32e);this.setWidth(rect.width,_32e);this.setHeight(rect.height,_32e);this.refresh(_32e);},setRotator:function(_32f,_330,_331){this._operate=true;var r=this.getRotator(_330),_332,_333=_327.rotation,_334=_32f.angle-r.angle,_335=dojo.hitch(this,this.contains),_336=[];this.inherited(arguments);if(_331){return;}this.recursiveChild(_336);dojo.forEach(_336,function(gp){r=gp.getGraphRotator(_330);r.angle+=_334;_332=gp.getNWCoordinate(_330);_332=_333(_333(_332,_32f.coordinate,_334),_333(r.coordinate,_32f.coordinate,_334),-r.angle);gp.setCoordinate(_332,_330);gp.setRotator(r,_330,true);gp.refresh(_330,function(_337){if(_335(_337)){return false;}return true;});},this);this._operate=false;},recursiveChild:function(_338){var gp;this.forInItems(function(item){gp=item.gp;_338.push(gp);if(gp.recursiveChild){gp.recursiveChild(_338);return;}},this);},deleteAll:function(db){this.forInItems(function(item){db.removeGraph(item.gp);},this);this.destroy();},destroy:function(){this.inherited(arguments);var gp;this.forInItems(function(item){gp=item.gp;gp.getParent&&(gp.getParent()==this)&&(delete gp.getParent);},this);},draw:function(_339){this.inherited(arguments);},sizeChange:function(_33a,_33b,end,_33c){this._operate=true;var w=this.getWidth(_33c),h=this.getHeight(_33c),_33d=1,_33e=1,gp,nw,r,nnw,_33f,_340,_341=_327.rotation,_342=this.getSkeletonCoordinates(_33c)[0][0],_343=this.getRotator(_33c),_344=dojo.hitch(this,this.contains);this.inherited(arguments);_33d=this.getWidth(_33c)/w;_33e=this.getHeight(_33c)/h;fixCoordinate=this.getSkeletonCoordinates(_33c)[0][0];this.forInItems(function(item){gp=item.gp;_340=gp.getCoordinate(_33c);nw=gp.getNWCoordinate(_33c);nw=_341(nw,_342,-_343.angle);_33f=_328(nw,_342);nw=_341(add(_342,{x:_33f.x*_33d,y:_33f.y*_33e}),_342,_343.angle);nw=add(nw,_328(fixCoordinate,_342));gp.setWidth(gp.getWidth(_33c)*_33d,_33c);gp.setHeight(gp.getHeight(_33c)*_33e,_33c);_33c.clearCache(gp,_329.CENTER);r=gp.getGraphRotator(_33c);_340=gp.getCoordinate(_33c);nnw=_341(_340,r.coordinate,r.angle);gp.setCoordinate(add(_340,_328(nw,nnw)),_33c);gp.refresh(_33c,function(_345){if(_344(_345)){return false;}return true;});},this);this._operate=false;},move:function(_346,end,_347){this._operate=true;this.inherited(arguments);this.forInItems(function(item){if(item){item.oriPos=add(item.oriPos,_328(end,_346));item.gp.move(_346,end,_347);}},this);this._operate=false;},zoom:function(rate,_348){this._operate=true;this.inherited(arguments);this.forInItems(function(item){if(item){item.gp.zoom(rate,_348);}},this);this._operate=false;}});})();}if(!dojo._hasResource["drawboard.graph.GraphStatus"]){dojo._hasResource["drawboard.graph.GraphStatus"]=true;dojo.provide("drawboard.graph.GraphStatus");(function(){var _349=common.calc.Geometry,_34a=_349.multiPoint,_34b=_349.dividePoint;dojo.declare("drawboard.graph.GraphStatus",[dijit._Widget,common.Identity],{_coordinate:null,_w:null,_h:null,_rotator:null,_motionAnchors:null,affectedByZoom:false,_marks:null,_url:null,_ratio:null,_text:null,setRatio:function(_34c){return this._ratio=_34c;},getRatio:function(){return this._ratio;},isAffectedByZoom:function(_34d){(_34d!==undefined)&&(this.affectedByZoom=_34d);return this.affectedByZoom;},setCoordinate:function(_34e,_34f){this._coordinate=_34b(_34e,this.getZoom(_34f))[0];},getCoordinate:function(_350){return _34a(this._coordinate,this.getZoom(_350))[0];},getZoom:function(_351){return _351.getContext().getZoom();},setWidth:function(w,_352){this._w=w/this.getZoom(_352).x;},getWidth:function(_353){return this._w*this.getZoom(_353).x;},setHeight:function(h,_354){this._h=h/this.getZoom(_354).y;},getHeight:function(_355){return this._h*this.getZoom(_355).y;},hasRotator:function(){if(this._rotator){return true;}return false;},setRotator:function(_356){this._rotator=_356;},setText:function(text){this._text=text;},getText:function(){return this._text;},getRotator:function(){return this._rotator;},getRotateAngle:function(){var _357=this.getRotator();if(_357){return _357.angle;}return 0;},setMarks:function(_358,_359){this._marks=_34b(_358,this.getZoom(_359));},getMarks:function(_35a){return this._marks&&_34a(this._marks,this.getZoom(_35a));},setMotionAnchors:function(_35b,_35c){this.isAffectedByZoom()&&(_35b=_34b(_35b,this.getZoom(_35c)));this._motionAnchors=_35b;},getMotionAnchors:function(_35d){var _35e=this._motionAnchors;this.isAffectedByZoom()&&(_35e=_34a(_35e,this.getZoom(_35d)));return _35e;},getUrl:function(){return this._url;},setUrl:function(url){this._url=url;}});})();}if(!dojo._hasResource["drawboard.drawProcessor.DrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DrawProcessor");dojo.declare("drawboard.drawProcessor.DrawProcessor",null,{draw:function(gp,_35f){}});}if(!dojo._hasResource["drawboard._Selector"]){dojo._hasResource["drawboard._Selector"]=true;dojo.provide("drawboard._Selector");(function(){var _360=drawboard.Constant,_361=_360.ActionStatus,_362=_360.MouseAction,_363=common.calc.Geometry;dojo.declare("drawboard._Selector",drawboard.container.LayoutContainer,{_events:null,_status:_361.NONE,_mouseStatus:_362.NONE,_active:null,_decorate:null,_graphStrategy:null,_isMark:false,_isSelecting:false,lastScrollTop:0,lastScrollLeft:0,cache:null,postCreate:function(host){this._events=[dojo.connect(host,"onmousemove",dojo.hitch(this,"doMouseMove")),dojo.connect(host,"onmousedown",dojo.hitch(this,"doMouseDown")),dojo.connect(host,"onmouseup",dojo.hitch(this,"doMouseUp")),dojo.connect(host,"onmouseover",dojo.hitch(this,"doMouseOver")),dojo.connect(host,"onclick",dojo.hitch(this,"doClick")),dojo.connect(host,"ondblclick",dojo.hitch(this,"doDblClick")),dojo.connect(window,"onkeydown",dojo.hitch(this,"doKeyDown")),dojo.connect(window,"onkeyup",dojo.hitch(this,"doKeyUp")),dojo.connect(this.domNode,"onscroll",dojo.hitch(this,"doScroll"))];},getStatusCache:function(){if(!this.cache){this.cache={};}return this.cache;},setStatusCache:function(gp,_364,_365){var _366=this.getStatusCache();gp&&(_366.active=gp);_364&&(_366.decorate=_364);_366.status=_365;},setStatus:function(gp,_367,_368){var _369=this._active,_36a;if(_369&&_369!=gp){_36a=_369.getParent&&_369.getParent();if(_369.isComposite()&&!_369.contains(gp)){_369.isFocus(false);}_369.isActive(false);if(_36a&&!_36a.contains(gp)){_36a.isFocus(false);_36a.isActive(false);}}this._active=gp;this._decorate=_367;this._status=_368;this.updateActive();},updateActive:function(){var gp=this.getActive();gp&&gp.isActive(true)&&gp.isComposite()&&gp.isFocus(true);},getMouseStatus:function(){return this._mouseStatus;},setMouseStatus:function(_36b){this._mouseStatus=_36b;},getActionStatus:function(){return this._status;},setActionStatus:function(_36c){this._status=_36c;},getDecorate:function(){return this._decorate;},setDecorate:function(d){this._decorate=d;},getActive:function(){return this._active;},setActive:function(gp){this._active=gp;},setDrawType:function(_36d){this._graphStrategy=_36d;this._isSelecting=false;this._isMark=false;},getDrawType:function(){return this._graphStrategy;},isSelecting:function(_36e){this._isSelecting=_36e;if(_36e){this._isMark=false;this._graphStrategy=null;}},isMark:function(mark){this._isMark=mark;if(mark){this._isSelecting=false;this._graphStrategy=null;}},doClick:function(e){this.setMouseStatus(_362.MOUSECLICK);},doDblClick:function(e){var _36f=this.getActive(),text=_36f&&_36f.getText(),_370=this.getTextBoard();if(text){_370.setText(text);_370.show(_36f);}},doMouseMove:function(e){if(this.getMouseStatus()==_362.MOUSEDOWN){var _371=this.getActive(),_372=this.getStatusCache(),_373=_372.active,_374=_373&&_373.getParent&&_373.getParent(),_375=drawboard.relationController,_376=this.getDecorate(),_377=this.getRuntime();if(_373&&_373.isComposite()&&_371){!_371.isActive(false)&&_371.isComposite()&&_371.isFocus(false);_373.isActive(true);_373.isFocus(true);_374&&_374.isFocus(true);this._active=_373;}}this.setMouseStatus(_362.MOUSEMOVE);},doMouseDown:function(e){this.getTextBoard().hide();var d=drawboard,_378=d.markController,_379=this.fetchCoordinate(e),_37a,_37b=this.getRuntime(),_37c=dojo.hitch(_37b.getDrawProcessor(),"setActive"),_37d=this.getSelectRect(),_37e=this.getActive(),_37f=this.getg;status=this._status,_37f=_37b.getGraphic();target=e.target;this.setMouseStatus(_362.MOUSEDOWN);if(status&&status==_361.TEXT){return;}if(this._graphStrategy){this.setStatus(null,null,_361.DRAWING);return;}_37d&&(_37a=_37c(_37d,_379,this._isMark,_378,_37b));if(!_37a&&_37f.isGraphMark(target.tagName)){_37e&&(_37a=_37c(_37e,_379,this._isMark,_378,_37b));(!_37a)&&(idty=target.getAttribute("id"))&&this.some(function(gp){gp.getIdty()==idty&&(_37a={active:gp,decorate:null,status:_361.MOVING});if(_37a){return true;}},this,true);var idty;}if(!_37a){_37e&&(_37a=_37c(_37e,_379,this._isMark,_378,_37b));(!_37a)&&this.some(function(gp){_37a=_37c(gp,_379,this._isMark,_378,_37b);if(_37a){return true;}},this,true);}if(this.getActive()&&e.ctrlKey&&_37a&&_37a.active){_37a=_37a.active;if(_37d){if(_37d.contains(_37a)){return;}_37d.add(_37a,_37b);}else{var _37e=this.getActive();if(!_37e){return;}if(_37e.isComposite()&&_37e.contains(_37a)){return;}var rect=_363.getMaxRect([_37a.getGraphCoordinates(_37b).concat(_37e.getGraphCoordinates(_37b))]),_37d=new drawboard.graph.CompositeProxy(new drawboard.graph.GraphStatus({_coordinate:{x:rect.x,y:rect.y},_w:rect.width,_h:rect.height}),this.getSRGraphStrategyClass());_37e.isActive(false);_37d.add(_37e,_37b);_37d.add(_37a,_37b);this.setSelectRect(_37d);this.setStatus(_37d,null,_361.MOVING);}this.draw();return;}if(_37d){if(!_37a){this.setSelectRect(null);this.draw();return;}this.setStatus(_37a.active,_37a.decorate,_37a.status);return;}if(!_37a){this.setStatus(null,null,_361.SELECTING);}else{this.setStatus(_37a.active,_37a.decorate,_37a.status);}},doMouseOver:function(e){this.setMouseStatus(_362.MOUSEOVER);},doMouseUp:function(e){this.setMouseStatus(_362.MOUSEUP);this.setStatusCache(this._active,this._decorate,this._status);this._status=_361.NONE;this._decorate=null;},doKeyDown:function(e){var gp=this.getActive(),_380=this.getSelectRect(),keys=dojo.keys,_381=_360.Command,_382=dojo.hitch(this,"addCommand"),_383=false;if(gp&&e.keyCode==keys.DELETE&&!e.ctrlKey){_382(_381.CREATEVSDELETECOMMAND,this,gp,true);_380&&this.setSelectRect(null);_383=true;}if(e.keyCode==keys.UP_ARROW){_382(_381.ZOOMCOMMAND,this,{x:10,y:10});_383=true;}if(e.keyCode==keys.DOWN_ARROW){_382(_381.ZOOMCOMMAND,this,{x:-10,y:-10});_383=true;}if(e.keyCode==90&&e.ctrlKey){this.undo();_383=true;}if(e.keyCode==89&&e.ctrlKey){this.redo();_383=true;}_383&&this.draw();},doKeyUp:function(e){this.clearCommand();},doScroll:function(e){var _384=e.target||e.srcElement;if(_384!=this.domNode){return;}var top=_384.scrollTop,left=_384.scrollLeft,_385=this.lastScrollTop,_386=this.lastScrollLeft;if(top!=_385){this.fireListener(["doScroll",[false,top-_385]]);this.lastScrollTop=top;return;}if(left!=_386){this.fireListener(["doScroll",[true,left-_386]]);this.lastScrollLeft=left;}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);}});})();}if(!dojo._hasResource["drawboard.controller.ParamsController"]){dojo._hasResource["drawboard.controller.ParamsController"]=true;dojo.provide("drawboard.controller.ParamsController");(function(){dojo.declare("drawboard.controller.ParamsController",null,{_distance:5,rotate_distance:20,rounder:10,getDistance:function(){return this._distance;},setDistance:function(_387){this._distance=_387;},getRotateDistance:function(){return this.rotate_distance;},setRotateDistance:function(_388){this.rotate_distance=_388;},getRounder:function(){return this.rounder;}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.Controller"]){dojo._hasResource["drawboard.graph.decorate.controller.Controller"]=true;dojo.provide("drawboard.graph.decorate.controller.Controller");dojo.declare("drawboard.graph.decorate.controller.Controller",null,{draw:function(gp,_389){},active:function(gp,_38a,_38b){},create:function(ps){return null;},getStyle:function(gp,_38c,_38d){return _38d.getContext().getStyleCtrl().getStyle(this.type,gp,_38c);}});}if(!dojo._hasResource["drawboard.graph.decorate.controller.MarkController"]){dojo._hasResource["drawboard.graph.decorate.controller.MarkController"]=true;dojo.provide("drawboard.graph.decorate.controller.MarkController");(function(){var _38e=common.calc.Geometry;dojo.declare("drawboard.graph.decorate.controller.MarkController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.MARK,draw:function(gp,_38f){var _390,mark=new drawboard.graph.decorate.Mark(),gf=_38f.getGraphic();dojo.forEach(gp.getMarkCoordinates(_38f)||[],function(item,_391){_390=[item[1],item[3],item[2],item[4]];mark.setCoordinate(_390);mark.setIndex(_391);mark.draw(gf,this.getStyle(gp,mark,_38f),_38f);},this);},active:function(gp,_392,_393){var mark;dojo.some(gp.getMarkCoordinates(_393)||[],function(item,_394){item=[item[1],item[3],item[2],item[4]];if(_38e.isPointInPolyn(item,_392)){mark=new drawboard.graph.decorate.Mark({coordinate:item,index:_394,center:item[0]});return true;}},this);return mark;},create:function(ps){var mark,_395=[];dojo.forEach(ps||[],function(item,_396){mark=[item[1],item[3],item[2],item[4]];mark=new drawboard.graph.decorate.Mark({coordinate:skeleton,index:_396});_395.push(mark);},this);return _395;},cross:function(s,cgp,db,_397){var _398,_399=drawboard.skeletonController,mark,_39a={};db.some(function(gp){if(gp==cgp){return false;}_398=gp.getMarkCoordinates(_397);dojo.some(_398||[],function(item,_39b){item=[item[1],item[3],item[2],item[4]];dojo.some(item,function(p){if(_399.isIn(s.getCoordinate(),p,_397)){mark=true;return true;}},this);if(mark){_39a.d=new drawboard.graph.decorate.Mark({coordinate:item,index:_39b});return true;}},this);if(mark){_39a.gp=gp;return true;}},this,true);if(mark){_39a.restrainedGp=cgp;_39a.restrainedD=s;return _39a;}return null;}});if(!drawboard.markController){drawboard.markController=new drawboard.graph.decorate.controller.MarkController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.MotionAnchor"]){dojo._hasResource["drawboard.graph.decorate.MotionAnchor"]=true;dojo.provide("drawboard.graph.decorate.MotionAnchor");(function(){var _39c=drawboard.Constant;dojo.declare("drawboard.graph.decorate.MotionAnchor",drawboard.graph.decorate.Decorator,{_type:_39c.Decorate.MOTIONANCHOR,draw:function(gp,_39d,_39e){var p=this.getCoordinate(),path=_39c.Path,_39f=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.LINE,points:p[2]},{command:path.LINE,points:p[3]},{command:path.LINE,points:p[0]}];gp.drawPath(_39f,_39d);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.MotionAnchorController"]){dojo._hasResource["drawboard.graph.decorate.controller.MotionAnchorController"]=true;dojo.provide("drawboard.graph.decorate.controller.MotionAnchorController");(function(){var _3a0=common.calc.Geometry,_3a1=common.utils.CollectionUtils;dojo.declare("drawboard.graph.decorate.controller.MotionAnchorController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.MOTIONANCHOR,draw:function(gp,_3a2){var _3a3,_3a4=new drawboard.graph.decorate.MotionAnchor(),gf=_3a2.getGraphic(),_3a5=gp.getMotionAnchorCoordinates(_3a2);_3a5&&dojo.forEach(_3a5,function(item,_3a6){_3a3=_3a1.sliceRange(item,1,4);_3a4.setCoordinate(_3a3);_3a4.setIndex(_3a6),_3a4.draw(gf,this.getStyle(gp,_3a4,_3a2),_3a2);},this);},active:function(gp,_3a7,_3a8){var _3a9,_3aa=gp.getMotionAnchorCoordinates(_3a8),_3ab;_3aa&&dojo.some(_3aa,function(item,_3ac){_3ab=item[0];item=_3a1.sliceRange(item,1,4);if(_3a0.isPointInPolyn(item,_3a7)){_3a9=new drawboard.graph.decorate.MotionAnchor({coordinate:item,index:_3ac,center:_3ab});return true;}},this);return _3a9;}});if(!drawboard.motionAnchorController){drawboard.motionAnchorController=new drawboard.graph.decorate.controller.MotionAnchorController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Rotator"]){dojo._hasResource["drawboard.graph.decorate.Rotator"]=true;dojo.provide("drawboard.graph.decorate.Rotator");(function(){var _3ad=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Rotator",drawboard.graph.decorate.Decorator,{_type:_3ad.Decorate.ROTATOR,pole:null,angle:null,draw:function(gf,_3ae,_3af){var r=_3af.getDistance(),p=_3ad.Path,path=[],_3b0=this.getCoordinate();gf.drawCircle(_3b0[3],r,_3ae);gf.drawLine(_3b0[2],_3b0[1],_3ae);gf.drawCircle({x:_3b0[0].x,y:_3b0[0].y-r},r,_3ae);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.RotatorController"]){dojo._hasResource["drawboard.graph.decorate.controller.RotatorController"]=true;dojo.provide("drawboard.graph.decorate.controller.RotatorController");(function(){var _3b1=common.calc.Geometry;dojo.declare("drawboard.graph.decorate.controller.RotatorController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.ROTATOR,draw:function(gp,_3b2){if(!gp.hasRotator()){return;}var _3b3=gp.getRotatorCoordinates(_3b2),_3b4;_3b4=gp.getRotator(_3b2);_3b4=new drawboard.graph.decorate.Rotator({pole:_3b4.coordinate,angle:_3b4.angle,coordinate:_3b3});_3b4.draw(_3b2.getGraphic(),this.getStyle(gp,_3b4,_3b2),_3b2);},active:function(gp,_3b5,_3b6){if(!gp.hasRotator()){return null;}var _3b7;if(this.isIn(gp,_3b5,_3b6)){_3b7=gp.getRotator(_3b6);_3b7=new drawboard.graph.decorate.Rotator({coordinate:gp.getRotatorCoordinates(_3b6),pole:_3b7.pole,angle:_3b7.angle});}return _3b7;},isIn:function(gp,_3b8,_3b9){if(!gp.hasRotator()){return false;}var r=_3b9.getDistance(),_3ba=gp.getRotatorCoordinates(_3b9);if(_3b1.isPointInCircle(_3b8,{coordinate:_3ba[3],r:r})||_3b1.isPointInCircle(_3b8,{coordinate:_3ba[5],r:r})||_3b1.isPointInSegment(_3ba[1],_3ba[4],_3b8)){return true;}return false;},isInPole:function(gp,_3bb,_3bc){if(!gp.hasRotator()){return false;}var _3bd=gp.getRotatorCoordinates(_3bc);if(_3b1.isPointInCircle(_3bb,{coordinate:_3bd[3],r:_3bc.getDistance()})){return true;}return false;}});if(!drawboard.rotatorController){drawboard.rotatorController=new drawboard.graph.decorate.controller.RotatorController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Skeleton"]){dojo._hasResource["drawboard.graph.decorate.Skeleton"]=true;dojo.provide("drawboard.graph.decorate.Skeleton");(function(){var _3be=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Skeleton",drawboard.graph.decorate.Decorator,{_type:_3be.Decorate.SKELETON,_direct:null,_isAnchored:false,anchored:function(_3bf){this._isAnchored=_3bf;},isAnchored:function(){return this._isAnchored;},getDirect:function(){var _3c0=this._direct,t;if(typeof _3c0=="number"){return _3c0;}if(_3c0!==null&&_3c0!==undefined){var d=_3be.Direction;switch(_3c0){case "mover_n":t=d.NORTH;break;case "mover_s":t=d.SOUTH;break;case "mover_w":t=d.WEST;break;case "mover_e":t=d.EAST;break;case "mover_nw":t=d.WESTNORTH;break;case "mover_ne":t=d.EASTNORTH;break;case "mover_sw":t=d.WESTSOUTH;break;case "mover_se":t=d.EASTSOUTH;break;default:t=d.NORTH;break;}this._direct=t;}return t;},draw:function(gp,_3c1,_3c2){var p=this.getCoordinate(),path=_3be.Path;paths=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.LINE,points:p[2]},{command:path.LINE,points:p[3]},{command:path.LINE,points:p[0]}];gp.drawPath(paths,_3c1);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.SkeletonController"]){dojo._hasResource["drawboard.graph.decorate.controller.SkeletonController"]=true;dojo.provide("drawboard.graph.decorate.controller.SkeletonController");(function(){var _3c3=common.calc.Geometry,_3c4=common.utils.CollectionUtils;dojo.declare("drawboard.graph.decorate.controller.SkeletonContainer",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.SKELETON,draw:function(gp,_3c5){var _3c6,_3c7=new drawboard.graph.decorate.Skeleton(),gf=_3c5.getGraphic();dojo.forEach(gp.getSkeletonCoordinates(_3c5)||[],function(item,_3c8){_3c6=_3c4.sliceRange(item,1,4);_3c7.setCoordinate(_3c6);_3c7.setIndex(_3c8);item[0].isAnchored&&_3c7.anchored(item[0].isAnchored);_3c7.draw(gf,this.getStyle(gp,_3c7,_3c5),_3c5);},this);},isIn:function(ps,_3c9,_3ca){return _3c3.isPointInPolyn(ps,_3c9);},active:function(gp,_3cb,_3cc){var _3cd,gs=gp.getGraphStrategy(),temp,_3ce;dojo.some(gp.getSkeletonCoordinates(_3cc)||[],function(item,_3cf){_3ce=item[0];temp=_3c4.sliceRange(item,1,4);if(this.isIn(temp,_3cb,_3cc)){_3cd=new drawboard.graph.decorate.Skeleton({coordinate:temp,index:_3cf,_direct:item[0].css,center:_3ce});gs.isAnchor(_3cd)&&_3cd.anchored(true);return true;}},this);return _3cd;},create:function(ps){var _3d0=[];dojo.forEach(ps||[],function(item,_3d1){_3d0.push(this.createItem(item,_3d1));},this);return _3d0;},createItem:function(ps,_3d2){var _3d3=new drawboard.graph.decorate.Skeleton({coordinate:_3c4.sliceRange(ps,1,4),index:_3d2,_direct:ps[0].css});ps[0].isAnchored&&_3d3.anchored(true);return _3d3;}});if(!drawboard.skeletonController){drawboard.skeletonController=new drawboard.graph.decorate.controller.SkeletonContainer();}})();}if(!dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DbDrawProcessor");(function(){dojo.declare("drawboard.drawProcessor.DbDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_3d4){if(gp.isComposite()&&!gp.isFocus()){return;}gp.draw(_3d4);if(gp.isActive()){drawboard.skeletonController.draw(gp,_3d4);drawboard.motionAnchorController.draw(gp,_3d4);drawboard.rotatorController.draw(gp,_3d4);}((_3d4.getShowMark()||gp.showMark())||gp.isActive()||gp.isActived())&&drawboard.markController.draw(gp,_3d4);},setActive:function(gp,p,only,_3d5,_3d6){var _3d7=drawboard.Constant.ActionStatus,_3d8,_3d9;if(gp&&gp.isActive()){var _3da=[{controller:drawboard.skeletonController,status:_3d7.RESIZING},{controller:drawboard.rotatorController,status:[_3d7.POLEMOVING,_3d7.ROTATING]},{controller:drawboard.markController,status:_3d7.MARKING},{controller:drawboard.motionAnchorController,status:_3d7.MOTION}],_3db,_3dc,_3dd;dojo.some(_3da,function(item){_3db=item.controller;if(only&&_3db!=_3d5){return;}if(!only&&_3db==_3d5){return;}_3dc=_3db.active(gp,p,_3d6);if(_3dc){_3d8={};_3dd=item.status;if(dojo.isArray(_3dd)){if(_3db.isInPole(gp,p,_3d6)){_3d8.status=_3dd[0];}else{_3d8.status=_3dd[1];}}else{_3d8.status=_3dd;}_3d8.active=gp;_3d8.decorate=_3dc;return true;}},this);}if(!_3d8&&gp.isComposite()){return null;}if(!_3d8&&gp.active(p,_3d6)){_3d9=this.getActiveParent(gp);_3d8={};_3d8.status=_3d7.MOVING;if(_3d9&&!_3d9.isFocus()){gp=_3d9;}_3d8.active=gp;_3d8.decorate=null;}return _3d8;},getActiveParent:function(gp){var _3de=(gp.getParent&&gp.getParent()),_3df,_3e0;do{if(!_3de||_3de.isFocus()){_3e0=_3df;break;}_3df=_3de;_3de=(_3df.getParent&&_3df.getParent());}while(true);return _3e0;}});})();}if(!dojo._hasResource["drawboard.context.ExecuteContext"]){dojo._hasResource["drawboard.context.ExecuteContext"]=true;dojo.provide("drawboard.context.ExecuteContext");(function(){var _3e1=common.calc.Geometry;dojo.declare("drawboard.context.ExecuteContext",dijit._Widget,{zoom:{x:100,y:100},paramsCtrl:null,styleCtrl:null,commandCtrl:null,drawProcessor:null,getZoom:function(){return _3e1.dividePoint(this.zoom,{x:100,y:100})[0];},setZoom:function(rate){var zoom=_3e1.add2Points(this.zoom,rate);if(zoom.x<0||zoom.y<0||zoom.x>200||zoom.y>200){return false;}this.zoom=zoom;return true;},getParamsCtrl:function(){if(!this.paramsCtrl){new common.exception.Exception({msg:"the parameters controller in context doesnt' exist!"});}return this.paramsCtrl;},setParamsCtrl:function(_3e2){this.paramsCtrl=_3e2;},getCommandCtrl:function(){if(!this.commandCtrl){new common.exception.Exception({msg:"the command controller in context doesnt' exist!"});}return this.commandCtrl;},setCommandCtrl:function(_3e3){this.commandCtrl=_3e3;},setStyleCtrl:function(_3e4){if(!this.styleCtrl){new common.exception.Exception({msg:"the style controller in context doesnt' exist!"});}this.styleCtrl=_3e4;},getStyleCtrl:function(){return this.styleCtrl;},getDrawProcessor:function(){if(!this.drawProcessor){new common.exception.Exception({msg:"the draw processor in context doesnt' exist!"});}return this.drawProcessor;},setDrawProcessor:function(_3e5){this.drawProcessor=_3e5;}});})();}if(!dojo._hasResource["drawboard.runtime.ExecuteRuntime"]){dojo._hasResource["drawboard.runtime.ExecuteRuntime"]=true;dojo.provide("drawboard.runtime.ExecuteRuntime");dojo.declare("drawboard.runtime.ExecuteRuntime",[dijit._Widget,common.Cache,common.listener.Listener],{context:null,graphic:null,_showMark:false,setShowMark:function(_3e6){this._showMark=_3e6;},getShowMark:function(){return this._showMark;},apply:function(_3e7,_3e8){this[_3e7]&&this[_3e7].apply(this,_3e8);},createCache:function(){return {};},getCache:function(gp){var _3e9=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this),item=_3e9[gp.getIdty()];(!item)&&(_3e9[gp.getIdty()]=item={});return item;},addCache:function(gp,type,_3ea){var _3eb=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this),item=_3eb[gp.getIdty()];(!item)&&(_3eb[gp.getIdty()]=item={});item[type]=_3ea;},clearCache:function(gp,type){var _3ec=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this);if(type!==undefined&&type!==null){var item=_3ec[gp.getIdty()];if(item){item[type]=null;delete item[type];}this.fireListener(["clearCache",[gp,type]]);return;}_3ec[gp.getIdty()]=null;delete _3ec[gp.getIdty()];this.fireListener(["clearCache",[gp]]);},getContext:function(){if(!this.context){new common.exception.Exception({msg:"the context in runtime doesnt' exist!"});}return this.context;},setContext:function(_3ed){this.context=_3ed;},getGraphic:function(){if(!this.graphic){new common.exception.Exception({msg:"the graphic in runtime doesnt' exist!"});}return this.graphic;},setGraphic:function(gf){this.graphic=gf;},getDistance:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getDistance();},getRotateDistance:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getRotateDistance();},getRounder:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getRounder();},getDrawProcessor:function(){return this.getContext().getDrawProcessor();},draw:function(gp){this.getDrawProcessor().draw(gp,this);},zoom:function(gp,rate){gp.zoom(rate,this);}});}if(!dojo._hasResource["drawboard.controller.CommandController"]){dojo._hasResource["drawboard.controller.CommandController"]=true;dojo.provide("drawboard.controller.CommandController");dojo.declare("drawboard.controller.CommandController",common.container.MapContainer,{resouce:drawboardRuntimeSetting.commands,_undoList:null,_redoList:null,maxSteps:20,store:null,constructor:function(){var list=common.container.ListContainer;this._undoList=new list();this._redoList=new list();this.render();},getReadStore:function(){var _3ee=this.store;if(!_3ee){_3ee=new dojo.data.ItemFileReadStore({url:this.resouce});_3ee._forceLoad();this.store=_3ee;}return this.store;},render:function(){var _3ef=this.getReadStore(),type,_3f0,_3f1,_3f2;dojo.forEach(_3ef._getItemsArray(),function(item){type=_3ef.getValue(item,"type");_3f0=_3ef.getValue(item,"command");_3f1=_3ef.getValue(item,"desp0");_3f2=_3ef.getValue(item,"desp1");this.registerCommand(type,_3f0,_3f1,_3f2);},this);},registerCommand:function(type,_3f3,_3f4,_3f5){this.addItem(type,{command:_3f3,0:_3f4,1:_3f5});},instanceCommand:function(type,_3f6,memo,_3f7,_3f8){var item=this.getItem(type),_3f9,_3fa;if(!item){new common.exception.Exception({msg:"the command type doesn't exsit!"});return;}_3fa=eval(item.command);_3f9=new _3fa(_3f6,memo,_3f7);_3f9.setDescription({0:item.desp0,1:item.desp1});_3f9.setRuntime(_3f8);return _3f9;},add:function(_3fb){var _3fc=this._undoList;_3fc.add(_3fb);if(_3fc.size()>this.maxSteps){_3fc.shift();}this._redoList.clearItems();},undo:function(){var _3fd=this._undoList.pop();if(!_3fd){return;}_3fd.unexecute();this._redoList.add(_3fd);},redo:function(){var _3fe=this._redoList.pop();if(!_3fe){return;}_3fe.execute();this._undoList.add(_3fe);}});}if(!dojo._hasResource["drawboard.DrawBoard"]){dojo._hasResource["drawboard.DrawBoard"]=true;dojo.provide("drawboard.DrawBoard");dojo.declare("drawboard.DrawBoard",[dijit._Templated,drawboard._Selector,drawboard._Event,common.listener.Listener],{templateString:"<div></div>",dbCanvas:null,graphicClass:drawboard.graphic.SVGGraphic,textBoardClass:drawboard.board.TextBoard,_textBoard:null,_graphic:null,w:null,h:null,defaultWidth:300,defaultHeight:300,_selectRect:null,_runtime:null,fixNode:null,SRGraphStrategyClass:"drawboard.graph.strategy.RectangleStrategy",graphStrategyParam:null,drawEntity:null,_commands:null,postCreate:function(){var _3ff=this.createGraphic(),node,_400=drawboard.controller,ctx,_401,w=this.w,h=this.h,_402=this.domNode.style;_401=dojo.create("div",{},this.domNode);_402.overflow="auto";_402.width=w+"px";_402.height=h+"px";_402.position="relative";this.dbCanvas=_401;node=_3ff.createAnchor(w||this.defaultWidth,h||this.defaultHeight,_401);ctx=new drawboard.context.ExecuteContext({paramsCtrl:new _400.ParamsController(),styleCtrl:new _400.StyleController(),commandCtrl:new _400.CommandController(),drawProcessor:new drawboard.drawProcessor.DbDrawProcessor()});this._textBoard=new this.textBoardClass({"_db":this});this.domNode.appendChild(this._textBoard.domNode);this._runtime=new drawboard.runtime.ExecuteRuntime({context:ctx,graphic:_3ff});drawboard.DrawBoard.superclass.postCreate.call(this,this.domNode);},ready:function(){return this.getGraphic().ready();},getTextBoard:function(){return this._textBoard;},getGraphic:function(){return this.getRuntime().getGraphic();},getRuntime:function(){return this._runtime;},setRuntime:function(_403){this._runtime=_403;},setGraphStrategyParam:function(_404){this.graphStrategyParam=_404;},getGraphStrategyParam:function(){return this.graphStrategyParam;},createGraphic:function(){if(!this._graphic){this._graphic=new this.graphicClass();}return this._graphic;},getDrawEntity:function(_405){if(!this.drawEntity&&_405){this.drawEntity={};}return this.drawEntity;},getCanvasSize:function(){var zoom=this.getRuntime().getContext().getZoom();return {x:this.w*zoom.x,y:this.h*zoom.y};},getUserViewSize:function(){var _406=this.domNode;return {x:_406.clientWidth,y:_406.clientHeight};},clearDrawEntity:function(_407){var _408=this.drawEntity,_409=this.graphStrategyParam;if(_408&&!_407){var gs=new drawboard.graph.GraphStatus({_coordinate:{x:_408.x,y:_408.y},_w:_408.width,_h:_408.height,affectedByZoom:(_409&&_409.affectedByZoom)}),gp=new drawboard.graph.GraphProxy(gs,this.getDrawType());_409&&_409.url&&(gs.setUrl(_409.url));_409&&_409.ratio&&(gs.setRatio(_409.ratio));this.addCommand(drawboard.Constant.Command.CREATEVSDELETECOMMAND,this,gp);}this.drawEntity=null;this.graphStrategyParam=null;},getSRGraphStrategyClass:function(){return this.SRGraphStrategyClass;},setSRGraphStrategyClass:function(_40a){this.SRGraphStrategyClass=_40a;},getSelectRect:function(){return this._selectRect;},setSelectRect:function(_40b){var _40c=this._selectRect;if(_40b==_40c){return;}_40c&&_40c.destroy();this._selectRect=_40b;},containsSelectRect:function(_40d){var _40e=false;this.some(function(gp){if(gp.isComposite()&&gp.equals(_40d)){_40e=true;return true;}},this);return _40e;},combine:function(){var _40f=this.getSelectRect();_40f&&!this.containsSelectRect(_40f)&&!_40f.resetRelations()&&this.combineGraph(_40f);this._selectRect=null;},combineGraph:function(gp){this.add(gp);},divide:function(){var gp=this.getActive();this.divideGraph(gp);},divideGraph:function(gp){if(gp&&gp.isComposite()){gp.destroy();this.remove(gp);}},addGraph:function(gs,_410){var _411=new drawboard.graph.GraphProxy(gs,_410);this.add(_411);},removeGraph:function(gp){gp.deleteAll(this,this.getRuntime());this.getRuntime().getContext().getStyleCtrl().removeGraph(gp);this.remove(gp);},getGraph:function(idty){var gs;this.some(function(item){if(item.getIdty()==idty){gs=item;return true;}});return gs;},zoom:function(rate,_412){var _413=dojo.clone(_412.getContext().getZoom());if(!_412.getContext().setZoom(rate)){return;}var zoom=_412.getContext().getZoom(),_414=this.dbCanvas.style,gf=this.getGraphic(),w=this.w*zoom.x,h=this.h*zoom.y,_415=this.domNode,_416=common.calc.Geometry,_417=this.getSelectRect(),_418;_418={x:_415.scrollLeft+(this.w>>1),y:_415.scrollTop+(this.h>>1)};_418=_416.dividePoint(_418,_413)[0];_418=_416.multiPoint(_418,zoom)[0];_414.width=w+"px";_414.height=h+"px";_415.scrollLeft=_418.x-(this.w>>1);_415.scrollTop=_418.y-(this.h>>1);gf.setSize(w,h);this.forInItems(function(gp){gp&&_412.zoom(gp,zoom);},this,true);_417&&_412.zoom(_417,zoom);this.fireListener(["zoom",[rate]]);},draw:function(){this.clearGraphs();var _419=this.getSelectRect(),_41a=this.getDrawEntity(),_41b=this.getRuntime();if(_41a){var gs=new drawboard.graph.GraphStatus({_coordinate:{x:_41a.x,y:_41a.y},_w:_41a.width,_h:_41a.height}),_41c=new drawboard.graph.GraphProxy(gs,this.getDrawType()||this.getSRGraphStrategyClass()),_41d=this.graphStrategyParam;_41d&&_41d.url&&(gs.setUrl(_41d.url));_41d&&_41d.ratio&&(gs.setRatio(_41d.ratio));_41c.showMark(false);_41b.draw(_41c);}_419&&(_41b.draw(_419));this.drawGraphs(_41b);this.fireListener(["draw"]);},drawGraphs:function(_41e){this.forInItems(function(gp){gp&&_41e.draw(gp);},this);},clearGraphs:function(){this.getGraphic().clear();},setStyle:function(_41f,_420,_421){var gp=this.getActive();if(_421&&gp&&!gp.getText()){return;}gp&&this.addCommand(drawboard.Constant.Command.STYLECOMMAND,this.getRuntime().getContext().getStyleCtrl(),{gp:gp,attr:_41f,value:_420,isText:_421});this.clearCommand();this.draw();},setText:function(text){this.last().setText(text);},getCommandCtrl:function(){return this.getRuntime().getContext().getCommandCtrl();},getCommands:function(){var _422=this._commands;if(!_422){_422=this._commands=new drawboard.command.CompositeCommand();this.getCommandCtrl().add(_422);}return _422;},addCommand:function(type,_423,memo,_424){var _425=this.getCommandCtrl().instanceCommand(type,_423,memo,_424,this.getRuntime());_425.execute();this.getCommands().add(_425);},clearCommand:function(){this._commands=null;},undo:function(){this.getCommandCtrl().undo();this.draw();},redo:function(){this.getCommandCtrl().redo();this.draw();}});}if(!dojo._hasResource["drawboard.drawProcessor.ZoomDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.ZoomDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.ZoomDrawProcessor");(function(){dojo.declare("drawboard.drawProcessor.ZoomDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_426){gp.draw(_426);}});})();}if(!dojo._hasResource["drawboard.ZoomDrawBoard"]){dojo._hasResource["drawboard.ZoomDrawBoard"]=true;dojo.provide("drawboard.ZoomDrawBoard");(function(){var _427=common.calc.Geometry,_428=drawboard.Constant.MouseAction,_429=_427.subtract2Points;dojo.declare("drawboard.ZoomDrawBoard",[dijit._Widget,dijit._Templated],{templateString:"<div style='position:relative;overflow:hidden;'><div dojoAttachPoint='zoomDrawboard'></div><div dojoAttachPoint='zoomRect' style='position:absolute;border:2px solid red;left:0px;top:0px;'></div></div>",graphicClass:drawboard.graphic.SVGGraphic,_graphic:null,anchor:null,w:null,h:null,_zoom:{x:100,y:100},rectBorder:2,defaultWidth:300,defaultHeight:300,_runtime:null,drawboard:null,events:null,boxCache:null,scopeSelf:false,postCreate:function(){var _42a=this.createGraphic(),node,_42b=drawboard.controller,ctx,db=this.getDrawBoard(),_42c,_42d=this.zoomRect,_42e=this.domNode,_42f=this.rectBorder,w=this.w||this.defaultWidth,h=this.h||this.defaultHeight;node=_42a.createAnchor(w,h);this.anchor=node;ctx=new drawboard.context.ExecuteContext({paramsCtrl:new _42b.ParamsController(),styleCtrl:new _42b.StyleController(),drawProcessor:new drawboard.drawProcessor.ZoomDrawProcessor(),zoom:{x:50,y:50}});this._runtime=_42c=new drawboard.runtime.ExecuteRuntime({context:ctx,graphic:_42a});this.zoomDrawboard.appendChild(this.anchor);_42d.style.width=w+"px";_42d.style.height=h+"px";_42e.style.width=w+(_42f<<1)+"px";_42e.style.height=h+(_42f<<1)+"px";this.events=[dojo.connect(_42d,"onmousemove",dojo.hitch(this,"doMouseMove")),dojo.connect(_42d,"onmousedown",dojo.hitch(this,"doMouseDown")),dojo.connect(_42d,"onmouseup",dojo.hitch(this,"doMouseUp"))];db.addListener(this.apply,this);db.getRuntime().addListener(_42c.apply,_42c);},getDrawBoard:function(){if(!this.drawboard){new common.exception.Exception({msg:"the draw board can't find in the zoom window!"});}return this.drawboard;},setDrawBoard:function(_430){this.drawboard=_430;},setZoom:function(rate){var zoom=_429(this._zoom,{x:rate.x,y:rate.y});if(zoom.x<0||zoom.y<0||zoom.x>200||zoom.y>200){return false;}this._zoom=zoom;return true;},getZoom:function(){return _427.dividePoint(this._zoom,{x:100,y:100})[0];},getGraphic:function(){return this.getRuntime().getGraphic();},getRuntime:function(){return this._runtime;},setRuntime:function(_431){this._runtime=_431;},createGraphic:function(){return new this.graphicClass();},apply:function(_432,_433){this[_432]&&this[_432].apply(this,_433);},zoom:function(rate){this._unitCache=null;if(!this.setZoom(rate)){return;}this.scopeSelf=true;var _434=this.zoomRect,zoom=this.getDrawBoard().getRuntime().getContext().getZoom(),_435=_434.style,w=this.w,h=this.h,rw=w/(zoom.x),rh=h/(zoom.y);_435.left=parseFloat(_435.left)+(parseFloat(_435.width)>>1)-(rw>>1)+"px";_435.top=parseFloat(_435.top)+(parseFloat(_435.height)>>1)-(rh>>1)+"px";_435.width=rw+"px";_435.height=rh+"px";this.draw();},draw:function(){this.clearGraphs();var db=this.getDrawBoard();db.drawGraphs(this.getRuntime());},clearGraphs:function(){var _436=this.anchor;while(_436.lastChild){_436.removeChild(_436.lastChild);}},getBoxCache:function(){if(!this.boxCache){var node=this.domNode,_437={left:node.offsetLeft,top:node.offsetTop};this.boxCache=_437;}return this.boxCache;},fetchCoordinate:function(e){var box=this.getBoxCache(),_438=this.domNode;return {x:e.pageX-box.left+_438.scrollLeft,y:e.pageY-box.top+_438.scrollTop};},getUnitPx:function(){if(!this._unitCache){var db=this.getDrawBoard(),_439=db.getCanvasSize(),_43a=db.getUserViewSize(),_43b=this.zoomRect.style;this._unitCache={x:(_439.x-_43a.x)/(this.w-parseFloat(_43b.width)),y:(_439.y-_43a.y)/(this.h-parseFloat(_43b.height))};}return this._unitCache;},status:_428.NONE,_start:null,_end:null,_loseAccuracyLeft:0,_loseAccuracyTop:0,_accuracy:100000,doMouseMove:function(e){if(this.status!=_428.MOUSEDOWN&&this.status!=_428.MOUSEMOVE){return;}var end=this.fetchCoordinate(e),_43c=_429(end,this._start),_43d=this.zoomRect.style,db=this.getDrawBoard(),_43e=db.domNode,unit=this.getUnitPx(),temp,_43f=this._accuracy,top=parseFloat(_43d.top)+_43c.y,left=parseFloat(_43d.left)+_43c.x,_440=db.getCanvasSize(),_441=db.getUserViewSize(),_442=parseFloat(_43d.width),_443=parseFloat(_43d.height);this._start=end;(top<0)&&(top=0);(left<0)&&(left=0);this.scopeSelf=true;_43d.top=top+"px";_43d.left=left+"px";if(left==0){_43e.scrollLeft=0;this._loseAccuracyLeft=0;}else{if((left+_442)>this.w){_43e.scrollLeft=_440.x-_441.x;_43d.left=this.w-_442+"px";}else{_43e.scrollLeft=temp=_43e.scrollLeft+_43c.x*unit.x;temp=(temp*_43f-parseInt(temp)*_43f)/_43f;this._loseAccuracyLeft=temp=this._loseAccuracyLeft+temp;if(temp>=1){_43e.scrollLeft+=1;this._loseAccuracyLeft=temp-1;}}}if(top==0){_43e.scrollTop=0;this._loseAccuracyTop=0;}else{if((top+_443)>this.h){_43e.scrollTop=_440.y-_441.y;_43d.top=this.h-_443+"px";}else{_43e.scrollTop=temp=_43e.scrollTop+_43c.y*unit.y;temp=(temp*_43f-parseInt(temp)*_43f)/_43f;this._loseAccuracyTop=temp=this._loseAccuracyTop+temp;if(temp>=1){_43e.scrollTop+=1;this._loseAccuracyTop=temp-1;}}}this.status=_428.MOUSEMOVE;},doMouseDown:function(e){this._start=this.fetchCoordinate(e);this.status=_428.MOUSEDOWN;},doMouseUp:function(e){this.status=_428.MOUSEUP;},doScroll:function(_444,_445){if(this.scopeSelf){this.scopeSelf=false;return;}var _446=this.zoomRect.style,unit=this.getUnitPx();if(_444){_446.left=parseFloat(_446.left)+_445/unit.x+"px";}else{_446.top=parseFloat(_446.top)+_445/unit.y+"px";}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);}});})();}
