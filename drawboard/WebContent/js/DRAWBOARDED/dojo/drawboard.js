/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["drawboard.board.TextBoard"]){dojo._hasResource["drawboard.board.TextBoard"]=true;dojo.provide("drawboard.board.TextBoard");dojo.declare("drawboard.board.TextBoard",[dijit._Widget,dijit._Templated],{templateString:"<div style='position:absolute;display:none;'><textarea dojoAttachPoint='textContentNode'></textarea></div>",_db:null,postCreate:function(){this.inherited(arguments);},setText:function(_1){this.textContentNode.value=_1;},clearText:function(){this.textContentNode.value="";},show:function(gp){var _2=this.domNode.style,_3=this._db.getRuntime(),_4=gp.getCoordinate?gp.getCoordinate(_3):{x:gp.x,y:gp.y};_2.left=_4.x+"px";_2.top=_4.y+"px";this.textContentNode.style.width=_2.width=(gp.getWidth?gp.getWidth(_3):gp.width)+"px";this.textContentNode.style.height=_2.height=(gp.getHeight?gp.getHeight(_3):gp.height)+"px";_2.display="";},hide:function(){var _5=this.domNode.style;if(_5.display==""){var db=this._db,_6=this.textContentNode.value;db.setText(_6);this.clearText();}_5.display="none";}});}if(!dojo._hasResource["drawboard.graphic.Graphic"]){dojo._hasResource["drawboard.graphic.Graphic"]=true;dojo.provide("drawboard.graphic.Graphic");dojo.declare("drawboard.graphic.Graphic",null,{createAnchor:function(w,h,_7){},ready:function(){return true;},setStyle:function(_8){},drawLine:function(_9,w,h,_a){},drawRect:function(_b,w,h,_c){},drawCircle:function(_d,r,_e){},drawEllipse:function(_f,w,h,_10,_11){},drawPath:function(_12,_13){},drawImage:function(_14,w,h,url,_15,_16){},drawText:function(_17,w,h,_18,_19){},setSize:function(w,h){},clear:function(){}});}if(!dojo._hasResource["drawboard.graphic.SVGGraphic"]){dojo._hasResource["drawboard.graphic.SVGGraphic"]=true;dojo.provide("drawboard.graphic.SVGGraphic");(function(){var _1a="http://www.w3.org/2000/svg",_1b="http://www.w3.org/1999/xlink",_1c=dojo.attr,_1d=window.location.pathname,_1e=_1d.substring(0,_1d.indexOf("/",1)+1),_1f=function(_20,ns,_21,_22){_20.setAttributeNS?_20.setAttributeNS(ns,_21,_22):_20.setAttribute(_21,_22);},_23=function(ele){return document.createElementNS?document.createElementNS(_1a,ele):document.createElement(ele);},_24=common.utils.BrowerUtils;dojo.declare("drawboard.graphic.SVGGraphic",drawboard.graphic.Graphic,{anchor:null,createAnchor:function(w,h,_25){var _26=_23("svg");w&&_1c(_26,"width",w);h&&_1c(_26,"height",h);this.anchor=_26;_25&&(_25.appendChild(_26));return _26;},setSize:function(w,h){var _27=this.anchor;w&&_1c(_27,"width",w);h&&_1c(_27,"height",h);},drawPath:function(_28,_29,_2a){var _2b=_23("path"),d=[],ps;dojo.forEach(_28,function(_2c){if(!_2c){return;}if(typeof _2c=="string"){this.push(_2c);}else{this.push(_2c.command);ps=_2c.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((p.x?(p.y?p.x+","+p.y:p.x):p.y)+" ");},this);}},d);!_2a&&d.push("Z");_1c(_2b,"d",d.join(""));_29&&_1c(_2b,"style",_29);this.anchor.appendChild(_2b);return _2b;},drawCircle:function(_2d,r,_2e){var _2f=_23("circle");_1c(_2f,"cx",_2d.x);_1c(_2f,"cy",_2d.y);_1c(_2f,"r",r);_2e&&_1c(_2f,"style",_2e);this.anchor.appendChild(_2f);return _2f;},drawEllipse:function(_30,w,h,_31,_32){var _33=_23("ellipse"),w=(w>>1),h=(h>>1);_1c(_33,"cx",_30.x+w);_1c(_33,"cy",_30.y+h);_1c(_33,"rx",w);_1c(_33,"ry",h);_32&&_1c(_33,"style",_32);if(_31){for(var _34 in _31){_1c(_33,_34,((_31[_34] instanceof Array)?_31[_34].join(" "):_31[_34]));}}this.anchor.appendChild(_33);return _33;},drawLine:function(p1,p2,_35){var _36=_23("line");_1c(_36,"x1",p1.x);_1c(_36,"y1",p1.y);_1c(_36,"x2",p2.x);_1c(_36,"y2",p2.y);_35&&_1c(_36,"style",_35);this.anchor.appendChild(_36);return _36;},drawRect:function(_37,w,h,rx,_38,_39){var _3a=_23("rect");_1c(_3a,"x",_37.x);_1c(_3a,"y",_37.y);_1c(_3a,"width",w);_1c(_3a,"height",h);if(_38){for(var _3b in _38){_1c(_3a,_3b,((_38[_3b] instanceof Array)?_38[_3b].join(" "):_38[_3b]));}}(rx!==undefined&&rx!=null)&&(_1c(_3a,"rx",rx));_39&&_1c(_3a,"style",_39);this.anchor.appendChild(_3a);return _3a;},drawImage:function(_3c,w,h,url,_3d){var _3e=_23("image");_3c&&_1c(_3e,"x",_3c.x);_3c&&_1c(_3e,"y",_3c.y);_1c(_3e,"width",w);_1c(_3e,"height",h);_1f(_3e,_1b,"xlink:href",_1e+url);if(_3d){for(var _3f in _3d){_1c(_3e,_3f,_3d[_3f] instanceof Array?_3d[_3f].join(" "):_3d[_3f]);}}this.anchor.appendChild(_3e);return _3e;},drawText:function(_40,w,h,_41,_42,_43){var _44=_23("text"),s=_43,_45,_46=_41&&_41.split("\n");x=_40&&_40.x+(w>>1),y=_40&&_40.y+(h>>1),unitHeight=_41&&_24.getFontHeight(_41,_43);x&&_1c(_44,"x",x);y&&_1c(_44,"y",y);_1c(_44,"width",w);_1c(_44,"height",h);if(_42){for(var _47 in _42){_1c(_44,_47,_42[_47] instanceof Array?_42[_47].join(" "):_42[_47]);}}s&&(s.indexOf("text-anchor")==-1)&&(s+=";text-anchor:middle;");!s&&(s="text-anchor:middle;");s&&_1c(_44,"style",s);_46&&dojo.forEach(_46,function(t,_48){_45=_23("tspan");_1c(_45,"x",x);_1c(_45,"y",y+unitHeight*_48);_45.textContent=t;_44.appendChild(_45);},this);this.anchor.appendChild(_44);return _44;},clear:function(){var _49=this.anchor;while(_49.lastChild){_49.removeChild(_49.lastChild);}}});})();}if(!dojo._hasResource["drawboard.graphic.SVGIEGraphic"]){dojo._hasResource["drawboard.graphic.SVGIEGraphic"]=true;dojo.provide("drawboard.graphic.SVGIEGraphic");(function(){var _4a="http://www.w3.org/2000/svg",_4b="http://www.w3.org/1999/xlink",_4c=dojo.attr,_4d=window.location.pathname,_4e=_4d.substring(0,_4d.indexOf("/",1)+1),_4f=function(_50,ns,_51,_52){_50.setAttributeNS(ns,_51,_52);},_53=common.utils.BrowerUtils;dojo.declare("drawboard.graphic.SVGIEGraphic",drawboard.graphic.Graphic,{anchor:null,embed:null,_w:null,_h:null,doc:null,createAnchor:function(w,h,_54){var _55=document.createElement("embed"),_56=document.createElement("div"),_57=_56.style;_55.type="image/svg+xml";_55.src="empty.svg";_55.wmode="Transparent";w&&(this._w=w)&&_4c(_55,"width",w);h&&(this._h=h)&&_4c(_55,"height",h);this.embed=_55;w&&(_57.width=w);h&&(_57.height=h);_57.position="absolute";_57.background="white";_57["z-index"]=100;_57.filter="alpha(opacity=0)";_54.appendChild(_56);_54.appendChild(_55);this.setSVGDoc();return _56;},ready:function(){if(this.doc){return true;}else{return false;}},setSVGDoc:function(){var _58=this.embed;if("getSVGDocument" in _58){var doc=_58.getSVGDocument(),svg=doc.documentElement;_4c(svg,"width",this._w);_4c(svg,"height",this._h);this.anchor=svg;this.doc=doc;return;}setTimeout(dojo.hitch(this,"setSVGDoc"),300);},createNS:function(ele){var doc=this.doc;return doc.createElementNS(_4a,ele);},setSize:function(w,h){var _59=this.anchor;w&&_4c(_59,"width",w);h&&_4c(_59,"height",h);},drawPath:function(_5a,_5b,_5c){var _5d=this.createNS("path"),d=[],ps;dojo.forEach(_5a,function(_5e){if(!_5e){return;}if(typeof _5e=="string"){this.push(_5e);}else{this.push(_5e.command);ps=_5e.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((p.x?(p.y?p.x+","+p.y:p.x):p.y)+" ");},this);}},d);!_5c&&d.push("Z");_4c(_5d,"d",d.join(""));_5b&&_4c(_5d,"style",_5b);this.anchor.appendChild(_5d);return _5d;},drawCircle:function(_5f,r,_60){var _61=this.createNS("circle");_4c(_61,"cx",_5f.x);_4c(_61,"cy",_5f.y);_4c(_61,"r",r);_60&&_4c(_61,"style",_60);this.anchor.appendChild(_61);return _61;},drawEllipse:function(_62,w,h,_63,_64){var _65=this.createNS("ellipse"),w=(w>>1),h=(h>>1);_4c(_65,"cx",_62.x+w);_4c(_65,"cy",_62.y+h);_4c(_65,"rx",w);_4c(_65,"ry",h);_64&&_4c(_65,"style",_64);if(_63){for(var _66 in _63){_4c(_65,_66,((_63[_66] instanceof Array)?_63[_66].join(" "):_63[_66]));}}this.anchor.appendChild(_65);return _65;},drawLine:function(p1,p2,_67){var _68=this.createNS("line");_4c(_68,"x1",p1.x);_4c(_68,"y1",p1.y);_4c(_68,"x2",p2.x);_4c(_68,"y2",p2.y);_67&&_4c(_68,"style",_67);this.anchor.appendChild(_68);return _68;},drawRect:function(_69,w,h,rx,_6a,_6b){var _6c=this.createNS("rect");_4c(_6c,"x",_69.x);_4c(_6c,"y",_69.y);_4c(_6c,"width",w);_4c(_6c,"height",h);if(_6a){for(var _6d in _6a){_4c(_6c,_6d,((_6a[_6d] instanceof Array)?_6a[_6d].join(" "):_6a[_6d]));}}(rx!==undefined&&rx!=null)&&(_4c(_6c,"rx",rx));_6b&&_4c(_6c,"style",_6b);this.anchor.appendChild(_6c);return _6c;},drawImage:function(_6e,w,h,url,_6f){var _70=this.createNS("image");_6e&&_4c(_70,"x",_6e.x);_6e&&_4c(_70,"y",_6e.y);_4c(_70,"width",w);_4c(_70,"height",h);_4f(_70,_4b,"xlink:href",_4e+url);if(_6f){for(var _71 in _6f){_4c(_70,_71,_6f[_71] instanceof Array?_6f[_71].join(" "):_6f[_71]);}}this.anchor.appendChild(_70);return _70;},drawText:function(_72,w,h,_73,_74,_75){var _76=this.createNS("text"),s=_75,_77,_78=_73&&_73.split("\n");x=_72&&_72.x+(w>>1),y=_72&&_72.y+(h>>1),unitHeight=_73&&_53.getFontHeight(_73,_75);x&&_4c(_76,"x",x);y&&_4c(_76,"y",y);_4c(_76,"width",w);_4c(_76,"height",h);if(_74){for(var _79 in _74){_4c(_76,_79,_74[_79] instanceof Array?_74[_79].join(" "):_74[_79]);}}s&&(s.indexOf("text-anchor")==-1)&&(s+=";text-anchor:middle;");!s&&(s="text-anchor:middle;");s&&_4c(_76,"style",s);_78&&dojo.forEach(_78,function(t,_7a){_77=this.createNS("tspan");_4c(_77,"x",x);_4c(_77,"y",y+unitHeight*_7a);_77.textContent=t;_76.appendChild(_77);},this);this.anchor.appendChild(_76);return _76;},clear:function(){var _7b=this.anchor;while(_7b.lastChild){_7b.removeChild(_7b.lastChild);}}});})();}if(!dojo._hasResource["drawboard.Constant"]){dojo._hasResource["drawboard.Constant"]=true;dojo.provide("drawboard.Constant");drawboard.Constant={MouseAction:{NONE:0,MOUSEDOWN:1,MOUSEMOVE:2,MOUSEUP:3,MOUSEOVER:4,MOUSECLICK:5,MOUSEOUT:6},ActionStatus:{NONE:0,SELECTING:1,DRAWING:2,MOVING:3,MARKING:4,RESIZING:5,ROTATING:6,POLEMOVING:7,MOTION:8,TEXT:9},Decorate:{SKELETON:0,MARK:1,ROTATOR:2,MOTIONANCHOR:3,CHARACTER:4,Graph:5,CENTER:6,OUTLET:7},Direction:{EAST:0,EASTNORTH:1,NORTH:2,WESTNORTH:3,WEST:4,WESTSOUTH:5,SOUTH:6,EASTSOUTH:7,END:8},Path:{NONE:"",MOVE:"M",RMOVE:"m",LINE:"L",RLINE:"l",HORIZON:"H",RHORIZON:"h",VERTICAL:"V",RVERTICAL:"v",CUBIC:"C",RCUBIC:"c",CUBICSMOOTH:"S",CUBICRSMOOTH:"s",QUADRATIC:"Q",RQUADRATIC:"q",QUADRATICSMOOTH:"T",RQUADRATICSMOOTH:"t",ARC:"A",RARC:"a",CLOSE:"Z",RCLOSE:"z"},Command:{CREATEVSDELETECOMMAND:"createvsdelete",RESIZECOMMAND:"resize",MOVECOMMAND:"move",ROTATECOMMAND:"rotate",ZOOMCOMMAND:"zoom",STYLECOMMAND:"style",ADDVSDELTECONSTRAINCOMMAND:"addvsdeleteconstrain",COMBINEVSDEVIDEDCOMMAND:"combinevsdevided",COMPOSITECOMMAND:"composite",MOTIONCOMMAND:"motion"},Symbol:{concat:"&&"},Toolbar:{COLORPALETTE:0,DROPDOWNLIST:1,DIALOGUE:2}};}if(!dojo._hasResource["drawboard.graph.strategy.GraphStrategy"]){dojo._hasResource["drawboard.graph.strategy.GraphStrategy"]=true;dojo.provide("drawboard.graph.strategy.GraphStrategy");(function(){var _7c=drawboard.Constant;dojo.declare("drawboard.graph.strategy.GraphStrategy",null,{type:_7c.Decorate.Graph,_hasRotator:true,hasRotator:function(){return this._hasRotator;},getRotatorCoordinate:function(gp,_7d){return null;},getActiveAnchors:function(gp,_7e){return null;},isAnchor:function(d){return false;},isIn:function(gp,_7f,_80){},draw:function(gp,gf,_81){},normalize:function(gp,_82,_83){return false;},sizeChange:function(gp,_84,_85,_86){var d=_7c.Direction,p=gp.getCoordinate(_86),w=gp.getWidth(_86),h=gp.getHeight(_86),_87=_85.x,_88=_85.y,_89=_84.getDirect();switch(_89){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+_88},_86);gp.setHeight(h-_88,_86);break;case d.SOUTH:gp.setHeight(h+_88,_86);break;case d.WEST:gp.setCoordinate({x:p.x+_87,y:p.y},_86);gp.setWidth(w-_87,_86);break;case d.EAST:gp.setWidth(w+_87,_86);break;case d.WESTNORTH:gp.setCoordinate({x:p.x+_87,y:p.y+_88},_86);gp.setWidth(w-_87,_86);gp.setHeight(h-_88,_86);break;case d.EASTNORTH:gp.setCoordinate({x:p.x,y:p.y+_88},_86);gp.setWidth(w+_87,_86);gp.setHeight(h-_88,_86);break;case d.EASTSOUTH:gp.setWidth(w+_87,_86);gp.setHeight(h+_88,_86);break;case d.WESTSOUTH:gp.setCoordinate({x:p.x+_87,y:p.y},_86);gp.setWidth(w-_87,_86);gp.setHeight(h+_88,_86);break;case d.END:break;default:break;}this._sizeChange(gp,_84,_85,_86);},_sizeChange:function(gp,_8a,_8b,_8c){},getGraphCoordinates:function(gp,_8d){},getSkeletonCoordinates:function(gp,_8e){var _8f=gp.getCoordinate(_8e),w=gp.getWidth(_8e),h=gp.getHeight(_8e),x=_8f.x,y=_8f.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y,css:"mover_ne"},{x:x,y:y+h,css:"mover_sw"},{x:x+w,y:y+h,css:"mover_se"},{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"},{x:x+w,y:y+(h>>1),css:"mover_e"}];},calcMotionAnchor:function(gp,_90,_91,_92){},getMotionAnchorCoordinates:function(gp,_93){},getMarkCoordinates:function(gp,_94){var _95=gp.getCoordinate(_94),w=gp.getWidth(_94),h=gp.getHeight(_94),_96=gp.getRealMarks(_94),x=_95.x,y=_95.y;if(!_96){return [{x:x+(w>>1),y:y},{x:x+(w>>1),y:y+h},{x:x,y:y+(h>>1)},{x:x+w,y:y+(h>>1)}];}var _97=[_96[0]||{x:x+(w>>1),y:y},_96[1]||{x:x+(w>>1),y:y+h},_96[2]||{x:x,y:y+(h>>1)},_96[3]||{x:x+w,y:y+(h>>1)}];for(var i=4;i<_96.length;i++){_97.push(_96[i]);}return _97;},getStyleController:function(_98){return _98.getContext().getStyleCtrl();},getStyle:function(gp,_99){return this.getStyleController(_99).getStyle(this.type,gp);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RectangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RectangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RectangleStrategy");(function(){var _9a=common.calc.Geometry,_9b=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RectangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_9c,_9d){return _9a.isPointInPolyn(gp.getGraphCoordinates(_9d),_9c);},draw:function(gp,gf,_9e){var p=_9b.Path,_9f=gp.getGraphCoordinates(_9e);gf.drawPath([{command:p.MOVE,points:_9f[0]},{command:p.LINE,points:_9f[1]},{command:p.LINE,points:_9f[2]},{command:p.LINE,points:_9f[3]}],this.getStyle(gp,_9e));},getGraphCoordinates:function(gp,_a0){var _a1=gp.getCoordinate(_a0),w=gp.getWidth(_a0),h=gp.getHeight(_a0),x=_a1.x,y=_a1.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.TextStrategy"]){dojo._hasResource["drawboard.graph.strategy.TextStrategy"]=true;dojo.provide("drawboard.graph.strategy.TextStrategy");(function(){var _a2=common.calc.Geometry,_a3=drawboard.Constant;dojo.declare("drawboard.graph.strategy.TextStrategy",drawboard.graph.strategy.RectangleStrategy,{draw:function(gp,gf,_a4){var p=_a3.Path,_a5=gp.getGraphRotator(_a4),a=_a5.angle,_a6=_a5.coordinate,_a7=["translate("+_a6.x+","+_a6.y+")","rotate("+a+")","translate("+-_a6.x+","+-_a6.y+")"];gf.drawText(gp.getCoordinate(_a4),gp.getWidth(_a4),gp.getHeight(_a4),gp.getText(),(a!=0)&&{transform:_a7},this.getTextStyle(gp,_a4));},getTextStyle:function(gp,_a8){return this.getStyleController(_a8).getTextStyle(gp);}});})();}if(!dojo._hasResource["drawboard.controller.StyleController"]){dojo._hasResource["drawboard.controller.StyleController"]=true;dojo.provide("drawboard.controller.StyleController");(function(){dojo.declare("drawboard.controller.StyleController",common.container.MapContainer,{_style:"fill:none;stroke:black;stroke-width:1",_activeStyle:"fill:none;stroke:red;stroke-width:1",resultIdentity:"serializeStr",actives:null,activedGp:null,setActives:function(_a9,gp){this.actives=_a9;this.activedGp&&this.activedGp.isActived(false);gp&&gp.isActived(true)&&(this.activedGp=gp);},getActives:function(){return this.actives;},init:function(_aa){this._style=_aa;},getDefaultStyle:function(){return this._style;},getTextStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return "";}return gs[this.resultIdentity];},getGraphStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return this.getDefaultStyle(gp);}return gs[this.resultIdentity];},getGraphStyleValue:function(gp,_ab){var _ac=this.getItem(gp.getIdty());if(_ac){return _ac[_ab];}return null;},containGraphStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return false;}return true;},addGraphStyle:function(gp,_ad,_ae,_af){if(gp.isComposite()){return;}var gs=this.getItem(gp.getIdty());if(!gs){gs={};this.addItem(gp.getIdty(),gs);}gs[_ad]=_ae;gs[this.resultIdentity]=this.serialize(gs,_af);},removeGraphStyle:function(gp,_b0){if(gp.isComposite()){return;}var gs=this.getItem(gp.getIdty());if(!gs||!gs[_b0]){return;}delete gs[_b0];gs[this.resultIdentity]=this.serialize(gs);},removeGraph:function(gp){var _b1=gp.getIdty(),gs=this.getItem(_b1);if(!gs){return;}this.removeItem(_b1);},serialize:function(sj,_b2){var str=[];for(var _b3 in sj){if(_b3!=this.resultIdentity){str.push([_b3,":",sj[_b3]].join(""));}}if(!_b2){if(!sj["stroke"]){str.push(["stroke",":","black"].join(""));}if(!sj["stroke-width"]){str.push(["stroke-width",":","1"].join(""));}if(!sj["fill"]){str.push(["fill",":","none"].join(""));}}return str.join(";");},getStyle:function(_b4,gp,d){var _b5=this.getActives(),_b6=false;if(d&&_b5){dojo.some(_b5,function(_b7){if(_b7.equal(d)){_b6=true;}},this);if(_b6){return this._activeStyle;}}return this.getGraphStyle(gp);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.BrokenLineStrategy"]){dojo._hasResource["drawboard.graph.strategy.BrokenLineStrategy"]=true;dojo.provide("drawboard.graph.strategy.BrokenLineStrategy");(function(){var _b8=common.calc.Geometry,_b9=drawboard.Constant,_ba=drawboard.relationController;dojo.declare("drawboard.graph.strategy.BrokenLineStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_bb,_bc){var p=gp.getCoordinate(_bc),w=gp.getWidth(_bc),h=gp.getHeight(_bc),_bd=gp.getRealMotionAnchors(_bc),_be=dojo.hitch(_b8,"isPointInSegment"),max=_bd.length,_bf;if((max==0)&&_be(p,{x:p.x+w,y:p.y+h},_bb)){return true;}for(var i=0;i<max;i++){_bf=((i+1==max)?{x:p.x+w,y:p.y+h}:_bd[i+1]);if(i==0){if(_be(p,_bd[i],_bb)||_be(_bd[i],_bf,_bb)){return true;}}else{if(i==max-1){if(_be(_bd[i],{x:p.x+w,y:p.y+h},_bb)){return true;}}else{if(_be(_bd[i],_bf,_bb)){return true;}}}}return false;},isAnchor:function(d){return true;},draw:function(gp,gf,_c0){var p=_b9.Path,_c1=gp.getGraphCoordinates(_c0),max=_c1.length-1,_c2=[];for(var i=0;i<max;i++){(i==0)?_c2.push({command:p.MOVE,points:_c1[i]},{command:p.LINE,points:_c1[i+1]}):_c2.push({command:p.LINE,points:_c1[i]},{command:p.LINE,points:_c1[i+1]});}gf.drawPath(_c2,this.getStyle(gp,_c0),true);},sizeChange:function(gp,_c3,_c4,_c5){var d=_b9.Direction,p=gp.getCoordinate(_c5),w=gp.getWidth(_c5),h=gp.getHeight(_c5),_c6=_c4.x,_c7=_c4.y,_c8=_c3.getDirect(),_c9=gp.getRealMotionAnchors(_c5),_ca=true,_cb,tmp,_cc=dojo.hitch(gp.getGraphStatus(),"setMotionAnchors");switch(_c8){case d.WESTNORTH:gp.setCoordinate({x:p.x+_c6,y:p.y+_c7},_c5);gp.setWidth(w-_c6,_c5);gp.setHeight(h-_c7,_c5);if(_c9.length==0){tmp={x:p.x+w,y:p.y+h};_c9.push({x:tmp.x,y:p.y+_c7});break;}_cb=_c9[0];(_cb.x==p.x)?(_ca=true):(_ca=false);if((_cb.x==p.x)&&(_cb.y==p.y)){tmp=_c9[1];!tmp&&(tmp={x:p.x+w,y:y+h});(_cb.x==tmp.x)?(_ca=false):(_ca=true);}(_ca)&&((_cb.x+=_c6)!=null)&&(_cc(_c9,_c5));(!_ca)&&((_cb.y+=_c7)!=null)&&(_cc(_c9,_c5));break;case d.EASTSOUTH:gp.setWidth(w+_c6,_c5);gp.setHeight(h+_c7,_c5);if(_c9.length==0){tmp={x:p.x+w+_c6,y:p.y+h+_c7};_c9.push({x:p.x,y:p.y+h+_c7});break;}_cb=_c9[_c9.length-1];(_cb.x==(p.x+w))?(_ca=true):(_ca=false);if((_cb.x==(p.x+w))&&(_cb.y==(p.y+h))){tmp=_c9[_c9.length-2]||{x:p.x,y:p.y};(_cb.x==tmp.x)?(_ca=false):(_ca=true);}(_ca)&&((_cb.x+=_c6)!=null)&&(_cc(_c9,_c5));(!_ca)&&((_cb.y+=_c7)!=null)&&(_cc(_c9,_c5));break;case d.END:break;default:break;}this._sizeChange(gp,_c3,_c4,_c5);},getActiveAnchors:function(gp,_cd){return drawboard.skeletonController.create(gp.getSkeletonCoordinates(_cd));},getSkeletonCoordinates:function(gp,_ce){var _cf=gp.getCoordinate(_ce),w=gp.getWidth(_ce),h=gp.getHeight(_ce),x=_cf.x,y=_cf.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y+h,css:"mover_se"}];},getGraphCoordinates:function(gp,_d0){var _d1=this.getMotionAnchorCoordinates(gp,_d0);start=gp.getCoordinate(_d0),w=gp.getWidth(_d0),h=gp.getHeight(_d0),x=start.x,y=start.y,graphs=[{x:x,y:y,css:"mover_nw",isAnchored:true}];dojo.forEach(_d1,function(_d2){graphs.push({x:_d2.x,y:_d2.y});},this);graphs.push({x:x+w,y:y+h,css:"mover_se",isAnchored:true});return graphs;},getMarkCoordinates:function(gp,_d3){return null;},getMotionAnchorCoordinates:function(gp,_d4){var _d5=gp.getRealMotionAnchors(_d4),_d6=[],_d7=gp.getCoordinate(_d4),w=gp.getWidth(_d4),h=gp.getHeight(_d4),x=_d7.x,y=_d7.y,_d8=_d7,_d9;(!_d5)&&((_d5=[{x:x+(w>>1),y:y},{x:x+(w>>1),y:y+h}])&&gp.getGraphStatus().setMotionAnchors(_d5,_d4));if(_d5.length==0){_d6.push({x:_d7.x+(w>>1),y:_d7.y+(h>>1)});return _d6;}dojo.forEach(_d5,function(_da,_db){((_d8.x==_da.x)||(_d6.push({x:_d8.x+((_da.x-_d8.x)>>1),y:_d8.y},{x:_da.x,y:_da.y})&&false))&&(_d6.push({x:_d8.x,y:_d8.y+((_da.y-_d8.y)>>1)},{x:_da.x,y:_da.y}));_d8=_da;},this);_d9=_d5[_d5.length-1];(_d9.x==(x+w))&&(_d6.push({x:_d9.x,y:_d9.y+((y+h-_d9.y)>>1)}));(_d9.y==(y+h))&&(_d6.push({x:_d9.x+((x+w-_d9.x)>>1),y:_d9.y}));return _d6;},calcMotionAnchor:function(gp,_dc,_dd,_de){var _df=gp.getRealMotionAnchors(_de),_e0=this.getActiveAnchors(gp,_de),_ba=drawboard.relationController,_e1=gp.getCoordinate(_de),_e2=_dc.getIndex(),_e3=Math.floor(_e2/2),len=_df.length,_e4=_ba.containRestrain(gp,_e0[0],_de),_e5=_ba.containRestrain(gp,_e0[1],_de),_e6=((_e3==0)?_e1:_df[_e3-1]),_e7=((_e3==len-1)?{x:_e1.x+w,y:_e1.y+h}:_df[_e3+1]),_e8=_df[_e3],tmp,_e9;if(_e2%2==0){if(_e2==0){(!_e8)&&(_e8={x:_e1.x+w,y:_e1.y+h});if(_e4){if(!_e5){(_e8.x==_e1.x)&&(_df.splice(0,0,{x:_e1.x,y:_e1.y+((_e8.y-_e1.y)>>2)},{x:_dd.x,y:_e1.y+((_e8.y-_e1.y)>>2)}))&&(len>0?(_e7.y=_dd.y):(gp.setHeight(_dd.y-_e1.y,_de)));(_e8.y==_e1.y)&&(_df.splice(0,0,{x:_e1.x+((_e8.x-_e1.x)>>2),y:_e1.y},{x:_e1.x+((_e8.x-_e1.x)>>2),y:_dd.y}))&&(len>0?(_e7.x=_dd.x):(gp.setWidth(_dd.x-_e1.x,_de)));_dc.setIndex(3);}else{(_e8.x==_e1.x)&&(_df.splice(0,0,{x:_e1.x,y:_e1.y+((_e8.y-_e1.y)>>2)},{x:_dd.x,y:_e1.y+((_e8.y-_e1.y)>>2)},{x:_dd.x,y:_e8.y-((_e8.y-_e1.y)>>2)},{x:_e1.x,y:_e8.y-((_e8.y-_e1.y)>>2)}));(_e8.y==_e1.y)&&(_df.splice(0,0,{x:_e1.x+((_e8.x-_e1.x)>>2),y:_e1.y},{x:_e1.x+((_e8.x-_e1.x)>>2),y:_dd.y},{x:_e8.x-((_e8.x-_e1.x)>>2),y:_dd.y},{x:_e8.x-((_e8.x-_e1.x)>>2),y:_e1.y}));_dc.setIndex(4);}}else{if(_e5){if(!_e4){(_e8.x==_e1.x)&&(_df.splice(0,0,{x:_dd.x,y:_e1.y+((_e8.y-_e1.y)>>1)},{x:_e8.x,y:_e1.y+((_e8.y-_e1.y)>>1)}))&&(_e1.x=_dd.x);(_e8.y==_e1.y)&&(_df.splice(0,0,{x:_e1.x+((_e8.x-_e1.x)>>1),y:_dd.y},{x:_e1.x+((_e8.x-_e1.x)>>1),y:_e8.y}))&&(_e1.y=_dd.y);gp.setCoordinate(_e1,_de);_dc.setIndex(1);}else{(_e8.x==_e1.x)&&(_df.splice(0,0,{x:_e1.x,y:_e1.y+((_e8.y-_e1.y)>>2)},{x:_dd.x,y:_e1.y+((_e8.y-_e1.y)>>2)},{x:_dd.x,y:_e8.y-((_e8.y-_e1.y)>>2)},{x:_e1.x,y:_e8.y-((_e8.y-_e1.y)>>2)}));(_e8.y==_e1.y)&&(_df.splice(0,0,{x:_e1.x+((_e8.x-_e1.x)>>2),y:_e1.y},{x:_e1.x+((_e8.x-_e1.x)>>2),y:_dd.y},{x:_e8.x-((_e8.x-_e1.x)>>2),y:_dd.y},{x:_e8.x-((_e8.x-_e1.x)>>2),y:_e1.y}));_dc.setIndex(4);}}else{(_e1.x==_e8.x)&&(gp.setWidth(gp.getWidth(_de)+(_e1.x-_dd.x),_de)||((_e1.x=_e8.x=_dd.x)!=null)&&(gp.setCoordinate(_e1,_de)));(_e1.y==_e8.y)&&(gp.setHeight(gp.getHeight(_de)+(_e1.y-_dd.y),_de)||((_e1.y=_e8.y=_dd.y)!=null)&&(gp.setCoordinate(_e1,_de)));}}}else{if(_e3==len){_e8=(len==0)?{x:_e1.x,y:_e1.y}:_df[_e3-1];if(_e5){if(!_e4){((_e1.x+w)==_e8.x)&&(_df.push({x:_dd.x,y:_e1.y+h-((_e1.y+h-_e8.y)>>2)},{x:_e8.x,y:_e1.y+h-((_e1.y+h-_e8.y)>>2)}))&&(_e6.x=_dd.x);((_e1.y+h)==_e8.y)&&(_df.push({x:_e1.x+w-((_e1.x+w-_e8.x)>>2),y:_dd.y},{x:_e1.x+w-((_e1.x+w-_e8.x)>>2),y:_e8.y}))&&(_e6.y=_dd.y);(len==0)&&(gp.setCoordinate(_e6));_dc.setIndex(_e2);}else{((_e1.x+w)==_e8.x)&&(_df.push({x:_e8.x,y:_e8.y+((_e1.y+h-_e8.y)>>2)},{x:_dd.x,y:_e8.y+((_e1.y+h-_e8.y)>>2)},{x:_dd.x,y:_e1.y+h-((_e1.y+h-_e8.y)>>2)},{x:_e8.x,y:_e1.y+h-((_e1.y+h-_e8.y)>>2)}));((_e1.y+h)==_e8.y)&&(_df.push({x:_e8.x+((_e1.x+w-_e8.x)>>2),y:_e8.y},{x:_e8.x+((_e1.x+w-_e8.x)>>2),y:_dd.y},{x:_e1.x+w-((_e1.x+w-_e8.x)>>2),y:_dd.y},{x:_e1.x+w-((_e1.x+w-_e8.x)>>2),y:_e8.y}));_dc.setIndex(_e2+4);}}else{((_e1.x+w)==_e8.x)&&(((_e8.x=_dd.x)!=null)&&(gp.setWidth(_dd.x-_e1.x,_de)));((_e1.y+h)==_e8.y)&&(((_e8.y=_dd.y)!=null)&&(gp.setHeight(_dd.y-_e1.y,_de)));}}else{_e6=_df[_e3-1];(_e6.x==_e8.x)&&(_e8.x=_e6.x=_dd.x);(_e6.y==_e8.y)&&(_e8.y=_e6.y=_dd.y);}}}else{var end={x:_e1.x+w,y:_e1.y+h},_ea,_eb,_ec=false,_ed;if(((_e3==0)&&_e4)||((_e3==len-1)&&_e5)){(((_e6.x==_e8.x)&&(_ec=false)||(_dd.x==_e6.x))||((_e6.y==_e8.y)&&(_ec=true)&&(_dd.y==_e6.y))||(((_e3==0)&&(_ec?(_e4?(_df.unshift({x:_e6.x+((_e8.x-_e6.x)>>1),y:_e6.y},{x:_e6.x+((_e8.x-_e6.x)>>1),y:_dd.y})):((((_e1.y=_dd.y)!=null)&&(gp.setCoordinate(_e1,_de))||true)&&_df.splice(1,0,{x:_dd.x,y:_e8.y+((_e7.y-_e8.y)>>1)},{x:_e7.x,y:_e8.y+((_e7.y-_e8.y)>>1)}))):(_e4?_df.unshift({x:_e6.x,y:_e6.y+((_e8.y-_e6.y)>>1)},{x:_dd.x,y:_e6.y+((_e8.y-_e6.y)>>1)}):((((_e1.x=_dd.x)!=null)&&(gp.setCoordinate(_e1,_de))||true)&&_df.splice(1,0,{x:_e8.x+((_e7.x-_e8.x)>>1),y:_dd.y},{x:_e8.x+((_e7.x-_e8.x)>>1),y:_e7.y})&&(_ed=1))))&&(_e4?(_df[2]=_dd):(_df[0]=_dd))&&(_dc.setIndex(_ed||5)))||((_e3==len-1)&&(_e3!=0)&&(_ec?_df.push({x:_dd.x,y:_e8.y+((end.y-_e8.y)>>1)},{x:end.x,y:_e8.y+((end.y-_e8.y)>>1)}):_df.push({x:_e8.x+((end.x-_e8.x)>>1),y:_dd.y},{x:_e8.x+((end.x-_e8.x)>>1),y:end.y}))&&(_df[_e3]=_dd)||true)||true))&&(((_e3==len-1)?(_ec?(_e6.y=_dd.y):(_e6.x=_dd.x)):(_ec?(_e7.x=_dd.x):(_e7.y=_dd.y))));}else{(((_e6.x==_e8.x)&&(_e6.y==_e8.y))?(((((_e3<2)?((_e3==1)&&(tmp=_e1)):(tmp=_df[_e3-2]))&&(tmp&&(_e9=(tmp.x==_e6.x))||true))||(((_e3<len-2)?(tmp=_df[_e3+2]):((_e3==len-2)&&(tmp=end)))&&(tmp&&(_e9=!(tmp.x==_e7.x))||true)))):((_e6.x==_e8.x)?(_e9=false):(_e9=true)));if(!_e9){(((_e6.x=_dd.x)!=null)&&((_e7.y=_dd.y)!=null)&&((_e3==0)&&(gp.setCoordinate(_e1,_de)||gp.setWidth(end.x-_e1.x,_de))))||((_e3==len-1)&&(gp.setHeight(_e7.y-_e1.y,_de)));}else{(((_e6.y=_dd.y)!=null)&&((_e7.x=_dd.x)!=null)&&((_e3==0)&&(gp.setCoordinate(_e1,_de)||gp.setHeight(end.y-_e1.y,_de))))||((_e3==len-1)&&(gp.setWidth(_e7.x-_e1.x,_de)));}((_e8.x=_dd.x)!=null)&&(_e8.y=_dd.y);}}return null;},normalize:function(gp,_ee,_ef){gp&&_ee&&this.updateMotionAnchors(gp,_ef,_ee);return true;},updateMotionAnchors:function(gp,_f0,_f1){var _f2=gp.getRealMotionAnchors(_f0),_f3=gp.getCoordinate(_f0),_f4=[],_f5=[],_f6,_f7,_f8=_f1&&_f1.getIndex(),_f9=false,_fa,_fb;(_f6=-1)&&(_f7={x:_f3.x,y:_f3.y});dojo.forEach(_f2.concat({x:_f3.x+gp.getWidth(_f0),y:_f3.y+gp.getHeight(_f0)}),function(_fc,_fd){if((_f7.x==_fc.x)&&(_f7.y==_fc.y)){_f4.push(_fd);return;}if(_f7.x==_fc.x){_fb=false;}else{_fb=true;}(_fa===undefined)&&_f4.push(_fd);(_fa!==undefined)&&(((_fa==_fb)&&_f4.push(_fd))||((_f4.length>1)&&_f5.push(_f4)&&false)||(_f4=[_fd]));_fa=_fb;_f7=_fc;},this);(_f4.length>1)&&_f5.push(_f4);dojo.forEach(_f5.reverse(),function(_fe){dojo.forEach(_fe.reverse(),function(_ff,pos){(pos!=0)&&(_f2.splice(_ff,1))&&(_f8!=null)&&((_f8>_ff)&&((_f8=_f8-2)!=null)&&_f1.setIndex(_f8));},this);},this);gp.getGraphStatus().setMotionAnchors(_f2,_f0);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.ImageStrategy"]){dojo._hasResource["drawboard.graph.strategy.ImageStrategy"]=true;dojo.provide("drawboard.graph.strategy.ImageStrategy");(function(){var _100=common.calc.Geometry,_101=drawboard.Constant;dojo.declare("drawboard.graph.strategy.ImageStrategy",drawboard.graph.strategy.GraphStrategy,{getGraphCoordinates:function(gp,_102){var _103=gp.getCoordinate(_102),w=gp.getWidth(_102),h=gp.getHeight(_102),x=_103.x,y=_103.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_104,_105){return _100.isPointInPolyn(gp.getGraphCoordinates(_105),_104);},draw:function(gp,gf,_106){var p=_101.Path,_107=gp.getGraphRotator(_106),a=_107.angle,pole=_107.coordinate,_108=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];gf.drawImage(gp.getCoordinate(_106),gp.getWidth(_106),gp.getHeight(_106),gp.getUrl(),(a!=0)&&{transform:_108},this.getStyle(gp,_106));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RatioStrategy"]){dojo._hasResource["drawboard.graph.strategy.RatioStrategy"]=true;dojo.provide("drawboard.graph.strategy.RatioStrategy");(function(){var _109=common.calc.Geometry,_10a=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RatioStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_10b,_10c){},draw:function(gp,gf,_10d){},getGraphCoordinates:function(gp,_10e){var _10f=gp.getRatio(),w=gp.getWidth(_10e),h=gp.getHeight(_10e),temp;if(!_10f){return this._getGraphCoordinates(gp,_10e,w,h);}temp=h*_10f;if(temp>w){h=w/_10f;}else{w=temp;}gp.setWidth(w,_10e);gp.setHeight(h,_10e);return this._getGraphCoordinates(gp,_10e,w,h);},_getGraphCoordinates:function(gp,_110,w,h){},sizeChange:function(gp,_111,_112,_113){var d=_10a.Direction,_114=gp.getRatio(),p=gp.getCoordinate(_113),w=gp.getWidth(_113),h=gp.getHeight(_113),_115=_111.getDirect(),temp;if(_114){temp=h*_114;if(temp>w){h=w/_114;}else{w=temp;}}switch(_115){case d.NORTH:_112=_112.y;gp.setCoordinate({x:p.x+(_112>>1),y:p.y+(_112)},_113);gp.setWidth(w-(_112),_113);gp.setHeight(h-(_112),_113);break;case d.WESTNORTH:_112=Math.abs(_112.x)>Math.abs(_112.y)?_112.y:_112.x,gp.setCoordinate({x:p.x+_112,y:p.y+_112},_113);gp.setWidth(w-_112,_113);gp.setHeight(h-_112,_113);break;case d.EASTNORTH:_112=_112.y;gp.setCoordinate({x:p.x,y:p.y+_112},_113);gp.setWidth(w-_112,_113);gp.setHeight(h-_112,_113);break;case d.SOUTH:_112=_112.y;gp.setCoordinate({x:p.x-(_112>>1),y:p.y},_113);gp.setWidth(w+(_112),_113);gp.setHeight(h+(_112),_113);break;case d.EASTSOUTH:_112=Math.abs(_112.x)>Math.abs(_112.y)?_112.y:_112.x,gp.setCoordinate({x:p.x,y:p.y},_113);gp.setWidth(w+_112,_113);gp.setHeight(h+_112,_113);break;case d.WESTSOUTH:_112=_112.x;gp.setCoordinate({x:p.x+_112,y:p.y},_113);gp.setWidth(w-_112,_113);gp.setHeight(h-_112,_113);break;case d.WEST:_112=_112.x;gp.setCoordinate({x:p.x+_112,y:p.y+(_112>>1)},_113);gp.setWidth(w-(_112),_113);gp.setHeight(h-(_112),_113);break;case d.EAST:_112=_112.x;gp.setCoordinate({x:p.x,y:p.y-(_112>>1)},_113);gp.setWidth(w+(_112),_113);gp.setHeight(h+(_112),_113);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RatioImageStrategy"]){dojo._hasResource["drawboard.graph.strategy.RatioImageStrategy"]=true;dojo.provide("drawboard.graph.strategy.RatioImageStrategy");(function(){var _116=common.calc.Geometry,_117=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RatioImageStrategy",drawboard.graph.strategy.RatioStrategy,{_getGraphCoordinates:function(gp,_118,w,h){var _119=gp.getCoordinate(_118),x=_119.x,y=_119.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_11a,_11b){return _116.isPointInPolyn(gp.getGraphCoordinates(_11b),_11a);},draw:function(gp,gf,_11c){var p=_117.Path,_11d=gp.getGraphRotator(_11c),a=_11d.angle,pole=_11d.coordinate,_11e=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];gp.getGraphCoordinates(_11c);gf.drawImage(gp.getCoordinate(_11c),gp.getWidth(_11c),gp.getHeight(_11c),gp.getUrl(),(a!=0)&&{transform:_11e},this.getStyle(gp,_11c));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.SquareStrategy"]){dojo._hasResource["drawboard.graph.strategy.SquareStrategy"]=true;dojo.provide("drawboard.graph.strategy.SquareStrategy");(function(){var _11f=common.calc.Geometry,_120=drawboard.Constant;dojo.declare("drawboard.graph.strategy.SquareStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_121,_122){return _11f.isPointInPolyn(gp.getGraphCoordinates(_122),_121);},draw:function(gp,gf,_123){var p=_120.Path,_124=gp.getGraphCoordinates(_123);gf.drawPath([{command:p.MOVE,points:_124[0]},{command:p.LINE,points:_124[1]},{command:p.LINE,points:_124[2]},{command:p.LINE,points:_124[3]}],this.getStyle(gp,_123));},getGraphCoordinates:function(gp,_125){var _126=gp.getCoordinate(_125),w=gp.getWidth(_125),h=gp.getHeight(_125),min=w>h?h:w,x=_126.x,y=_126.y;gp.setWidth(min,_125);gp.setHeight(min,_125);return [{x:x,y:y},{x:x+min,y:y},{x:x+min,y:y+min},{x:x,y:y+min}];},sizeChange:function(gp,_127,_128,_129){var d=_120.Direction,p=gp.getCoordinate(_129),w=gp.getWidth(_129),h=gp.getHeight(_129),min=w>h?h:w,_12a=_127.getDirect();switch(_12a){case d.NORTH:_128=_128.y;gp.setCoordinate({x:p.x+(_128>>1),y:p.y+(_128)},_129);gp.setWidth(min-(_128),_129);gp.setHeight(min-(_128),_129);break;case d.WESTNORTH:_128=Math.abs(_128.x)>Math.abs(_128.y)?_128.y:_128.x,gp.setCoordinate({x:p.x+_128,y:p.y+_128},_129);gp.setWidth(min-_128,_129);gp.setHeight(min-_128,_129);break;case d.EASTNORTH:_128=_128.y;gp.setCoordinate({x:p.x,y:p.y+_128},_129);gp.setWidth(min-_128,_129);gp.setHeight(min-_128,_129);break;case d.SOUTH:_128=_128.y;gp.setCoordinate({x:p.x-(_128>>1),y:p.y},_129);gp.setWidth(min+(_128),_129);gp.setHeight(min+(_128),_129);break;case d.EASTSOUTH:_128=Math.abs(_128.x)>Math.abs(_128.y)?_128.y:_128.x,gp.setCoordinate({x:p.x,y:p.y},_129);gp.setWidth(min+_128,_129);gp.setHeight(min+_128,_129);break;case d.WESTSOUTH:_128=_128.x;gp.setCoordinate({x:p.x+_128,y:p.y},_129);gp.setWidth(min-_128,_129);gp.setHeight(min-_128,_129);break;case d.WEST:_128=_128.x;gp.setCoordinate({x:p.x+_128,y:p.y+(_128>>1)},_129);gp.setWidth(min-(_128),_129);gp.setHeight(min-(_128),_129);break;case d.EAST:_128=_128.x;gp.setCoordinate({x:p.x,y:p.y-(_128>>1)},_129);gp.setWidth(min+(_128),_129);gp.setHeight(min+(_128),_129);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.OvalStrategy"]){dojo._hasResource["drawboard.graph.strategy.OvalStrategy"]=true;dojo.provide("drawboard.graph.strategy.OvalStrategy");(function(){var _12b=common.calc.Geometry,_12c=drawboard.Constant;dojo.declare("drawboard.graph.strategy.OvalStrategy",drawboard.graph.strategy.RectangleStrategy,{isIn:function(gp,_12d,_12e){return _12b.isPointInPolyn(gp.getOutletCoordinates(_12e),_12d);},draw:function(gp,gf,_12f){var _130=gp.getGraphCoordinates(_12f),w=gp.getWidth(_12f),h=gp.getHeight(_12f),p=_12c.Path,path=[],_131=gp.getGraphRotator(_12f),a=_131.angle,pole=_131.coordinate,_132=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];gf.drawEllipse(gp.getCoordinate(_12f),w,h,(a!=0)&&{transform:_132},this.getStyle(gp,_12f));},getGraphCoordinates:function(gp,_133){var p=gp.getCoordinate(_133),w=gp.getWidth(_133),h=gp.getHeight(_133),_134=[{x:p.x+w,y:p.y+h}];return _134;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.CircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.CircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.CircleStrategy");(function(){var _135=common.calc.Geometry;dojo.declare("drawboard.graph.strategy.CircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_136,_137){var w=gp.getWidth(_137),h=gp.getHeight(_137),r=w>h?h>>1:w>>1;return _135.isPointInCircle(_136,{coordinate:gp.getGraphCoordinates(_137)[0],r:r});},draw:function(gp,gf,_138){var _139=gp.getGraphCoordinates(_138),w=gp.getWidth(_138),h=gp.getHeight(_138),r=w>h?h>>1:w>>1;gf.drawCircle(_139[0],r,this.getStyle(gp,_138));},getGraphCoordinates:function(gp,_13a){var p=gp.getCoordinate(_13a),w=gp.getWidth(_13a),h=gp.getHeight(_13a),min=w>h?h:w,r=min>>1,_13b=[{x:p.x+r,y:p.y+r}];gp.setWidth(min,_13a);gp.setHeight(min,_13a);return _13b;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.MotionCircleStrategy");(function(){var _13c=common.calc.Geometry,_13d=drawboard.Constant;dojo.declare("drawboard.graph.strategy.MotionCircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_13e,_13f){var w=gp.getWidth(_13f),h=gp.getHeight(_13f),r=w>h?h>>1:w>>1;return _13c.isPointInCircle(_13e,{coordinate:gp.getGraphCoordinates(_13f)[0],r:r});},draw:function(gp,gf,_140){var p=_13d.Path,w=gp.getWidth(_140),h=gp.getHeight(_140),r=w>h?h>>1:w>>1,_141=gp.getGraphCoordinates(_140),_142=gp.getMotionAnchorCoordinates(_140),a=_13c.angle(_142[0][0],_141[0],_142[1][0]),arc=[p.ARC+r,r,0,(a<180?0:1)+",1",_142[1][0].x+" "+_142[1][0].y];gf.drawPath([{command:p.MOVE,points:_142[0][0]},arc.join(" ")],this.getStyle(gp,_140),true);},getGraphCoordinates:function(gp,_143){var p=gp.getCoordinate(_143),w=gp.getWidth(_143),h=gp.getHeight(_143),r=w>h?h>>1:w>>1,min=w>h?h:w,_144=[{x:p.x+r,y:p.y+r}];gp.setWidth(min,_143);gp.setHeight(min,_143);return _144;},getMotionAnchorCoordinates:function(gp,_145){var _146=gp.getRealMotionAnchors(_145),_147=[],gs,w=gp.getWidth(_145),_148=gp.getCoordinate(_145),_149=_13c.rotation,_14a=gp.getGraphCoordinates(_145)[0];_148.x+=(w>>1);if(!_146){_146=[10,100];gs=gp.getGraphStatus();gs.setMotionAnchors(_146,_145);}dojo.forEach(_146,function(_14b){_147.push(_149(_148,_14a,_14b));},this);return _147;},calcMotionAnchor:function(gp,_14c,_14d,_14e){var w=gp.getWidth(_14e),h=gp.getHeight(_14e),r=w>h?h>>1:w>>1,_14f=gp.getCoordinate(_14e),_150=gp.getGraphCoordinates(_14e),newp=_13c.intersectCircleLine(_150[0],r,_150[0],_14d)[0];_14f.x+=(w>>1);return _13c.angle(_14f,_150[0],newp);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RounderRectangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RounderRectangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RounderRectangleStrategy");(function(){var _151=common.calc.Geometry,_152=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RounderRectangleStrategy",drawboard.graph.strategy.GraphStrategy,{getGraphCoordinates:function(gp,_153){var _154=gp.getCoordinate(_153),h=gp.getHeight(_153),w=gp.getWidth(_153),x=_154.x,y=_154.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_155,_156){return _151.isPointInPolyn(gp.getGraphCoordinates(_156),_155);},draw:function(gp,gf,_157){var p=_152.Path,_158=gp.getGraphRotator(_157),a=_158.angle,pole=_158.coordinate,r=_157.getRounder(),_159=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];gf.drawRect(gp.getCoordinate(_157),gp.getWidth(_157),gp.getHeight(_157),r,(a!=0)&&{transform:_159},this.getStyle(gp,_157));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RounderSquareStrategy"]){dojo._hasResource["drawboard.graph.strategy.RounderSquareStrategy"]=true;dojo.provide("drawboard.graph.strategy.RounderSquareStrategy");(function(){var _15a=common.calc.Geometry,_15b=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RounderSquareStrategy",drawboard.graph.strategy.SquareStrategy,{draw:function(gp,gf,_15c){var p=_15b.Path,_15d=gp.getGraphRotator(_15c),a=_15d.angle,pole=_15d.coordinate,w=gp.getWidth(_15c),h=gp.getHeight(_15c),min=w>h?h:w,r=_15c.getRounder(),_15e=["translate("+pole.x+","+pole.y+")","rotate("+a+")","translate("+-pole.x+","+-pole.y+")"];gp.getGraphCoordinates(_15c);gf.drawRect(gp.getCoordinate(_15c),min,min,r,(a!=0)&&{transform:_15e},this.getStyle(gp,_15c));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.TriangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.TriangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.TriangleStrategy");(function(){var _15f=common.calc.Geometry,_160=drawboard.Constant;dojo.declare("drawboard.graph.strategy.TriangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_161,_162){return _15f.isPointInPolyn(gp.getGraphCoordinates(_162),_161);},draw:function(gp,gf,_163){var p=_160.Path,_164=gp.getGraphCoordinates(_163);gf.drawPath([{command:p.MOVE,points:_164[0]},{command:p.LINE,points:_164[1]},{command:p.LINE,points:_164[2]}],this.getStyle(gp,_163));},getGraphCoordinates:function(gp,_165){var _166=gp.getCoordinate(_165),w=gp.getWidth(_165),h=gp.getHeight(_165),x=_166.x,y=_166.y;return [{x:x+(w>>1),y:y},{x:x,y:y+h},{x:x+w,y:y+h}];},getMarkCoordinates:function(gp,_167){var _168=gp.getCoordinate(_167),w=gp.getWidth(_167),h=gp.getHeight(_167),_169=gp.getRealMarks(_167),x=_168.x,y=_168.y;if(!_169){return [{x:x+(w>>1),y:y},{x:x,y:y+h},{x:x+w,y:y+h},{x:x+(w>>1),y:y+(h>>1)}];}var _16a=[_169[0]||{x:x+(w>>1),y:y},_169[1]||{x:x,y:y+h},_169[2]||{x:x+w,y:y},_169[3]||{x:x+(w>>1),y:y+(h>>1)}];for(var i=4;i<_169.length;i++){_16a.push(_169[i]);}return _16a;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RightTriangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RightTriangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RightTriangleStrategy");(function(){var _16b=common.calc.Geometry,_16c=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RightTriangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_16d,_16e){return _16b.isPointInPolyn(gp.getGraphCoordinates(_16e),_16d);},draw:function(gp,gf,_16f){var p=_16c.Path,_170=gp.getGraphCoordinates(_16f);gf.drawPath([{command:p.MOVE,points:_170[0]},{command:p.LINE,points:_170[1]},{command:p.LINE,points:_170[2]}],this.getStyle(gp,_16f));},getGraphCoordinates:function(gp,_171){var _172=gp.getCoordinate(_171),w=gp.getWidth(_171),h=gp.getHeight(_171),x=_172.x,y=_172.y;return [{x:x,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},getMarkCoordinates:function(gp,_173){var _174=gp.getCoordinate(_173),w=gp.getWidth(_173),h=gp.getHeight(_173),_175=gp.getRealMarks(_173),x=_174.x,y=_174.y;if(!_175){return [{x:x,y:y},{x:x+w,y:y+h},{x:x,y:y+h},{x:x+(w>>1),y:y+(h>>1)}];}var _176=[_175[0]||{x:x,y:y},_175[1]||{x:x+w,y:y+h},_175[2]||{x:x,y:y+h},_175[3]||{x:x+(w>>1),y:y+(h>>1)}];for(var i=4;i<_175.length;i++){_176.push(_175[i]);}return _176;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.LineStrategy"]){dojo._hasResource["drawboard.graph.strategy.LineStrategy"]=true;dojo.provide("drawboard.graph.strategy.LineStrategy");(function(){var _177=common.calc.Geometry,_178=drawboard.Constant;dojo.declare("drawboard.graph.strategy.LineStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_179,_17a){var _17b=gp.getGraphCoordinates(_17a);return _177.isPointInSegment(_17b[0],_17b[1],_179);},isAnchor:function(d){return true;},draw:function(gp,gf,_17c){var p=_178.Path,_17d=gp.getGraphCoordinates(_17c);gf.drawLine(_17d[0],_17d[1],this.getStyle(gp,_17c));},getActiveAnchors:function(gp,_17e){return drawboard.skeletonController.create(gp.getSkeletonCoordinates(_17e));},getSkeletonCoordinates:function(gp,_17f){var _180=gp.getCoordinate(_17f),w=gp.getWidth(_17f),h=gp.getHeight(_17f),x=_180.x,y=_180.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y+h,css:"mover_se"}];},getGraphCoordinates:function(gp,_181){var _182=gp.getCoordinate(_181),w=gp.getWidth(_181),h=gp.getHeight(_181),x=_182.x,y=_182.y;return [{x:x,y:y,css:"mover_nw",isAnchored:true},{x:x+w,y:y+h,css:"mover_se",isAnchored:true}];},getMotionAnchorCoordinates:function(gp,_183){return null;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.DiamondStrategy"]){dojo._hasResource["drawboard.graph.strategy.DiamondStrategy"]=true;dojo.provide("drawboard.graph.strategy.DiamondStrategy");(function(){var _184=common.calc.Geometry,_185=drawboard.Constant;dojo.declare("drawboard.graph.strategy.DiamondStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_186,_187){return _184.isPointInPolyn(gp.getGraphCoordinates(_187),_186);},draw:function(gp,gf,_188){var p=_185.Path,_189=gp.getGraphCoordinates(_188);gf.drawPath([{command:p.MOVE,points:_189[0]},{command:p.LINE,points:_189[1]},{command:p.LINE,points:_189[2]},{command:p.LINE,points:_189[3]}],this.getStyle(gp,_188));},getGraphCoordinates:function(gp,_18a){var _18b=gp.getCoordinate(_18a),w=gp.getWidth(_18a),h=gp.getHeight(_18a),x=_18b.x,y=_18b.y;return [{x:x+(w>>1),y:y},{x:x,y:y+(h>>1)},{x:x+(w>>1),y:y+h},{x:x+w,y:y+(h>>1)}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy");(function(){var _18c=common.calc.Geometry,_18d=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_18e,_18f){return _18c.isPointInPolyn(gp.getGraphCoordinates(_18f),_18e);},isAnchor:function(d){if(d.getIndex()==2){return true;}return false;},getActiveAnchors:function(gp,_190){var _191=gp.getSkeletonCoordinates(_190),_192=[_191[2]];return drawboard.skeletonController.create(_192);},getRotatorCoordinate:function(gp,_193){return this.getGraphCoordinates(gp,_193)[0];},draw:function(gp,gf,_194){var p=_18d.Path,_195=gp.getGraphCoordinates(_194);gf.drawPath([{command:p.MOVE,points:_195[0]},{command:p.LINE,points:_195[1]},{command:p.LINE,points:_195[2]},{command:p.LINE,points:_195[3]},{command:p.LINE,points:_195[4]},{command:p.LINE,points:_195[5]},{command:p.LINE,points:_195[6]}],this.getStyle(gp,_194));},getGraphCoordinates:function(gp,_196){var _197=gp.getCoordinate(_196),w=gp.getWidth(_196),h=gp.getHeight(_196),x=_197.x,y=_197.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+w,y:y+h3},{x:x+w,y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_198){var _199=gp.getCoordinate(_198),w=gp.getWidth(_198),h=gp.getHeight(_198),x=_199.x,y=_199.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"}];},sizeChange:function(gp,_19a,_19b,_19c){var d=_18d.Direction,p=gp.getCoordinate(_19c),w=gp.getWidth(_19c),h=gp.getHeight(_19c),_19d=_19b.x,_19e=_19b.y,_19f=_19a.getDirect();switch(_19f){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_19e)},_19c);gp.setHeight(h-(_19e<<1),_19c);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_19e)},_19c);gp.setHeight(h+(_19e<<1),_19c);break;case d.WEST:var _1a0=gp.getMotionAnchorCoordinates(_19c)[0][0],_1a1,wm,em,_1a2=gp.getRotator(_19c);gp.setCoordinate({x:p.x+_19d,y:p.y+_19e},_19c);_1a1=gp.getCoordinate(_19c);wm={x:_1a1.x,y:_1a1.y+(h>>1)};em={x:_1a1.x+w,y:_1a1.y+(h>>1)};_1a2.angle=_18c.angle(em,wm,_1a0);gp.setWidth(_18c.getDistant(_1a0,wm),_19c);gp.setRotator(_1a2,_19c);break;case d.EAST:var _1a0=gp.getSkeletonCoordinates(_19c)[3][0],_1a1=gp.getCoordinate(_19c),wm,em,_1a3,_1a2=gp.getRotator(_19c);wm={x:_1a1.x,y:_1a1.y+(h>>1)};em={x:_1a1.x+w,y:_1a1.y+(h>>1)};_1a3={x:_1a0.x+_19d,y:_1a0.y+_19e};_1a2.angle=_18c.angle(em,wm,_1a3);gp.setWidth(_18c.getDistant(_1a3,wm),_19c);gp.setRotator(_1a2,_19c);break;case d.END:break;default:break;}},calcMotionAnchor:function(gp,_1a4,_1a5,_1a6){var _1a7=gp.getCoordinate(_1a6),wm={x:_1a7.x,y:_1a7.y+(gp.getHeight(_1a6)>>1)},em={x:_1a7.x+gp.getWidth(_1a6),y:_1a7.y+(gp.getHeight(_1a6)>>1)},_1a8=_18c.angle(em,wm,_1a5),_1a9;_1a9=gp.getRotator(_1a6);_1a9.angle=_1a8;gp.setWidth(_18c.getDistant(wm,_1a5),_1a6);gp.setRotator(_1a9,_1a6);return _1a5;},getMotionAnchorCoordinates:function(gp,_1aa){var _1ab=gp.getCoordinate(_1aa),w=gp.getWidth(_1aa),h=gp.getHeight(_1aa),x=_1ab.x,y=_1ab.y;return [{x:x+w,y:y+(h>>1)}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy");(function(){var _1ac=common.calc.Geometry,_1ad=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_1ae,_1af){return _1ac.isPointInPolyn(gp.getGraphCoordinates(_1af),_1ae);},isAnchor:function(d){if(d.getIndex()==2||d.getIndex()==3){return true;}return false;},getActiveAnchors:function(gp,_1b0){var _1b1=gp.getSkeletonCoordinates(_1b0),_1b2=[_1b1[2],_1b1[3]];return drawboard.skeletonController.create(_1b2);},getRotatorCoordinate:function(gp,_1b3){return this.getGraphCoordinates(gp,_1b3)[0];},draw:function(gp,gf,_1b4){var p=_1ad.Path,_1b5=gp.getGraphCoordinates(_1b4);gf.drawPath([{command:p.MOVE,points:_1b5[0]},{command:p.LINE,points:_1b5[1]},{command:p.LINE,points:_1b5[2]},{command:p.LINE,points:_1b5[3]},{command:p.LINE,points:_1b5[4]},{command:p.LINE,points:_1b5[5]},{command:p.LINE,points:_1b5[6]},{command:p.LINE,points:_1b5[7]},{command:p.LINE,points:_1b5[8]},{command:p.LINE,points:_1b5[9]}],this.getStyle(gp,_1b4));},getGraphCoordinates:function(gp,_1b6){var _1b7=gp.getCoordinate(_1b6),w=gp.getWidth(_1b6),h=gp.getHeight(_1b6),x=_1b7.x,y=_1b7.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+(w-(h>>1)),y:y+h3},{x:x+(w-(h>>1)),y:y},{x:x+w,y:y+(h>>1),isAnchored:true},{x:x+(w-(h>>1)),y:y+h},{x:x+(w-(h>>1)),y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_1b8){var _1b9=gp.getCoordinate(_1b8),w=gp.getWidth(_1b8),h=gp.getHeight(_1b8),x=_1b9.x,y=_1b9.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"},{x:x+w,y:y+(h>>1),css:"mover_e"}];},sizeChange:function(gp,_1ba,_1bb,_1bc){var d=_1ad.Direction,p=gp.getCoordinate(_1bc),w=gp.getWidth(_1bc),h=gp.getHeight(_1bc),_1bd=_1bb.x,_1be=_1bb.y,_1bf=_1ba.getDirect();switch(_1bf){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_1be)},_1bc);gp.setHeight(h-(_1be<<1),_1bc);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_1be)},_1bc);gp.setHeight(h+(_1be<<1),_1bc);break;case d.WEST:var _1c0=gp.getSkeletonCoordinates(_1bc)[3][0],_1c1,wm,em,_1c2=gp.getRotator(_1bc);gp.setCoordinate({x:p.x+_1bd,y:p.y+_1be},_1bc);_1c1=gp.getCoordinate(_1bc);wm={x:_1c1.x,y:_1c1.y+(h>>1)};em={x:_1c1.x+w,y:_1c1.y+(h>>1)};_1c2.angle=_1ac.angle(em,wm,_1c0);gp.setWidth(_1ac.getDistant(_1c0,wm),_1bc);gp.setRotator(_1c2,_1bc);break;case d.EAST:var _1c0=gp.getSkeletonCoordinates(_1bc)[3][0],_1c1=gp.getCoordinate(_1bc),wm,em,_1c3,_1c2=gp.getRotator(_1bc);wm={x:_1c1.x,y:_1c1.y+(h>>1)};em={x:_1c1.x+w,y:_1c1.y+(h>>1)};_1c3={x:_1c0.x+_1bd,y:_1c0.y+_1be};_1c2.angle=_1ac.angle(em,wm,_1c3);gp.setWidth(_1ac.getDistant(_1c3,wm),_1bc);gp.setRotator(_1c2,_1bc);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.command.Command"]){dojo._hasResource["drawboard.command.Command"]=true;dojo.provide("drawboard.command.Command");(function(){var _1c4=drawboard.Constant.Command;dojo.declare("drawboard.command.Command",common.command.Command,{_memo:null,_executor:null,_runtime:null,_description:{},constructor:function(_1c5,memo,_1c6){if(!_1c5){new common.exception.Exception({msg:"the executor must be exist in the command!"});return;}this._executor=_1c5;this._memo=memo;if(!_1c6){this.execute=this.positive;this.unexecute=this.negative;}else{this.execute=this.negative;this.unexecute=this.positive;}},getType:function(){return "";},getConstant:function(){return _1c4;},setMemo:function(memo){this._memo=memo;},getMemo:function(){return this._memo;},setRuntime:function(_1c7){this._runtime=_1c7;},getRuntime:function(){var _1c8=this._runtime;if(!_1c8){new common.exception.Exception({msg:"the runtime must be exist in the command!"});}return _1c8;},getExecutor:function(){return this._executor;},setExecutor:function(_1c9){this._executor=_1c9;},execute:function(){},unexecute:function(){},positive:function(){},negative:function(){},setDescription:function(_1ca,_1cb){this._description={first:_1ca,second:_1cb};},isPositive:function(){if(this.execute==this.positive){return true;}return false;},isCancelOut:function(){return false;},getDesciption:function(){var desp=this._description;if(this.isPositive()){return desp.first;}return desp.second;},merge:function(_1cc){if(this.getType()!=_1cc.getType()||this.getExecutor()!=_1cc.getExecutor()){return false;}return this._merge(_1cc);},_merge:function(_1cd){}});})();}if(!dojo._hasResource["drawboard.command.AddVSDeleteConstrainCommand"]){dojo._hasResource["drawboard.command.AddVSDeleteConstrainCommand"]=true;dojo.provide("drawboard.command.AddVSDeleteConstrainCommand");dojo.declare("drawboard.command.AddVSDeleteConstrainCommand",drawboard.command.Command,{getType:function(){return this.getConstant().ADDVSDELTECONSTRAINCOMMAND;},positive:function(){var _1ce=this.getExecutor(),memo=this.getMemo(),_1cf=this.getRuntime();dojo.forEach(memo,function(mark){_1ce.addListener(mark.gp,mark.d,mark.restrainedGp,mark.restrainedD,_1cf);},this);},negative:function(){var _1d0=this.getExecutor(),memo=this.getMemo(),_1d1=this.getRuntime(),_1d2;dojo.forEach(memo,function(mark){_1d2=_1d0.getRestrainedCache(mark.restrainedGp,mark.restrainedD,_1d1);if(_1d2&&_1d2.length>0){memo=[];this.setMemo(memo);dojo.forEach(_1d2,function(item){memo.push({gp:item.gp,d:item.decorate,restrainedGp:mark.restrainedGp,restrainedD:mark.restrainedD||item.restrainedD});},this);}_1d0.removeListener(mark.restrainedGp,mark.restrainedD,_1d1);},this);},_merge:function(_1d3){return false;}});}if(!dojo._hasResource["drawboard.command.CombineVSDevidedCommand"]){dojo._hasResource["drawboard.command.CombineVSDevidedCommand"]=true;dojo.provide("drawboard.command.CombineVSDevidedCommand");dojo.declare("drawboard.command.CombineVSDevidedCommand",drawboard.command.Command,{getType:function(){return this.getConstant().COMBINEVSDEVIDEDCOMMAND;},positive:function(){var _1d4=this.getExecutor(),memo=this.getMemo();_1d4.combineGraph(memo);},negative:function(){var _1d5=this.getExecutor(),memo=this.getMemo();_1d5.divideGraph(memo);},_merge:function(_1d6){return false;}});}if(!dojo._hasResource["drawboard.command.CompositeCommand"]){dojo._hasResource["drawboard.command.CompositeCommand"]=true;dojo.provide("drawboard.command.CompositeCommand");dojo.declare("drawboard.command.CompositeCommand",[drawboard.command.Command,common.container.ListContainer],{constructor:function(){this.execute=this.positive;this.unexecute=this.negative;},getType:function(){return this.getConstant().COMPOSITECOMMAND;},add:function(_1d7){var last=this.last(),len=this.size();if(len==0||(last&&!last.merge(_1d7))){drawboard.command.CompositeCommand.superclass.add.call(this,_1d7);return;}},positive:function(){this.forInItems(function(_1d8){_1d8.execute();},this);},negative:function(){this.forInItems(function(_1d9){_1d9.unexecute();},this);}});}if(!dojo._hasResource["drawboard.command.CreateVSDeleteCommand"]){dojo._hasResource["drawboard.command.CreateVSDeleteCommand"]=true;dojo.provide("drawboard.command.CreateVSDeleteCommand");dojo.declare("drawboard.command.CreateVSDeleteCommand",drawboard.command.Command,{_info:null,index:null,getType:function(){return this.getConstant().CREATEVSDELETECOMMAND;},positive:function(){var _1da=this.getExecutor(),memo=this.getMemo(),info=this._info,_1db=this.getRuntime(),_1dc=_1db.getContext().getStyleCtrl(),_1dd=this.index;_1dd===null?_1da.add(memo):_1da.insert(this.index,memo);if(info){dojo.forEach(info,function(item){_1da.insert(item.index,item.gp);item.gs&&_1dc.addItem(item.gp.getIdty(),item.gs);memo.add(item.gp,_1db);},this);memo.resetRelations();}},negative:function(){var _1de=this.getExecutor(),memo=this.getMemo(),info,_1df=this.getRuntime(),_1e0=_1df.getContext().getStyleCtrl();if(memo.isComposite()){if(!this._info){this._info=[];}info=this._info;var gp;memo.forInItems(function(item){gp=item.gp;info.push({gp:gp,gs:_1e0.getItem(gp.getIdty()),index:_1de.indexOf(gp)});},this);}this.index=_1de.indexOf(memo);_1de.removeGraph(memo);},_merge:function(_1e1){return false;}});}if(!dojo._hasResource["drawboard.command.MoveCommand"]){dojo._hasResource["drawboard.command.MoveCommand"]=true;dojo.provide("drawboard.command.MoveCommand");dojo.declare("drawboard.command.MoveCommand",drawboard.command.Command,{getType:function(){return this.getConstant().MOVECOMMAND;},positive:function(){var _1e2=this.getExecutor(),memo=this.getMemo(),_1e3=this.getRuntime();_1e2.move(memo.start,memo.end,_1e3);},negative:function(){var _1e4=this.getExecutor(),memo=this.getMemo(),_1e5=this.getRuntime();_1e4.move(memo.end,memo.start,_1e5);},_merge:function(_1e6){var memo=this.getMemo(),_1e7=_1e6.getMemo();memo.end=_1e7.end;return true;}});}if(!dojo._hasResource["drawboard.command.ResizeCommand"]){dojo._hasResource["drawboard.command.ResizeCommand"]=true;dojo.provide("drawboard.command.ResizeCommand");dojo.declare("drawboard.command.ResizeCommand",drawboard.command.Command,{getType:function(){return this.getConstant().RESIZECOMMAND;},positive:function(){var _1e8=this.getExecutor(),memo=this.getMemo(),_1e9=this.getRuntime();_1e8.sizeChange(memo.decorate,memo.start,memo.end,_1e9);},negative:function(){var _1ea=this.getExecutor(),memo=this.getMemo(),_1eb=this.getRuntime();_1ea.sizeChange(memo.decorate,memo.end,memo.start,_1eb);},_merge:function(_1ec){var memo=this.getMemo(),_1ed=_1ec.getMemo();if(memo.decorate!=_1ed.decorate){return false;}memo.end=_1ed.end;return true;}});}if(!dojo._hasResource["drawboard.command.RotateCommand"]){dojo._hasResource["drawboard.command.RotateCommand"]=true;dojo.provide("drawboard.command.RotateCommand");dojo.declare("drawboard.command.RotateCommand",drawboard.command.Command,{_oriAngle:null,getType:function(){return this.getConstant().ROTATECOMMAND;},positive:function(){var _1ee=this.getExecutor(),memo=dojo.clone(this.getMemo()),_1ef=this.getRuntime();if(this._oriAngle===null){this._oriAngle=_1ee.getRotator(_1ef).angle;}_1ee.setRotator(memo,_1ef);},negative:function(){var _1f0=this.getExecutor(),memo=dojo.clone(this.getMemo()),_1f1=this.getRuntime();memo.angle=this._oriAngle;_1f0.setRotator(memo,_1f1);},_merge:function(_1f2){var memo=this.getMemo(),_1f3=_1f2.getMemo();memo.angle=_1f3.angle;return true;}});}if(!dojo._hasResource["drawboard.command.StyleCommand"]){dojo._hasResource["drawboard.command.StyleCommand"]=true;dojo.provide("drawboard.command.StyleCommand");dojo.declare("drawboard.command.StyleCommand",drawboard.command.Command,{_style:null,getType:function(){return this.getConstant().STYLECOMMAND;},getStyle:function(){var _1f4=this._style;if(!_1f4){this._style=_1f4={};}return _1f4;},positive:function(){var _1f5=this.getExecutor(),memo=this.getMemo();if(!this._style&&_1f5.containGraphStyle(memo.gp)){this._style=_1f5.getGraphStyleValue(memo.gp,memo.attr);}_1f5.addGraphStyle(memo.gp,memo.attr,memo.value,memo.isText);if(memo.gp.isComposite()){var _1f6=this.getStyle();memo.gp.forInItems(function(item){if(_1f5.containGraphStyle(item.gp)){_1f6[item.gp.getIdty()]=_1f5.getGraphStyleValue(item.gp,memo.attr);}_1f5.addGraphStyle(item.gp,memo.attr,memo.value,memo.isText);},this);}},negative:function(){var _1f7=this.getExecutor(),memo=this.getMemo();if(memo.gp.isComposite()){var _1f8=this.getStyle(),_1f9;memo.gp.forInItems(function(item){_1f9=_1f8[item.gp.getIdty()];if(_1f9){_1f7.addGraphStyle(item.gp,memo.attr,_1f9,memo.isText);return;}_1f7.removeGraphStyle(item.gp,memo.attr);},this);return;}if(this._style){_1f7.addGraphStyle(memo.gp,memo.attr,this._style,memo.isText);return;}_1f7.removeGraphStyle(memo.gp,memo.attr);},_merge:function(_1fa){return false;}});}if(!dojo._hasResource["drawboard.command.ZoomCommand"]){dojo._hasResource["drawboard.command.ZoomCommand"]=true;dojo.provide("drawboard.command.ZoomCommand");dojo.declare("drawboard.command.ZoomCommand",drawboard.command.Command,{getType:function(){return this.getConstant().ZOOMCOMMAND;},positive:function(){var _1fb=this.getExecutor(),memo=this.getMemo(),_1fc=this.getRuntime();_1fb.zoom(memo,_1fc);},negative:function(){var _1fd=this.getExecutor(),memo=this.getMemo(),_1fe=this.getRuntime();_1fd.zoom({x:-memo.x,y:-memo.y},_1fe);},_merge:function(_1ff){var memo=this.getMemo(),_200=_1ff.getMemo();this.setMemo(common.calc.Geometry.add2Points(memo,_200));return true;}});}if(!dojo._hasResource["drawboard.command.MotionCommand"]){dojo._hasResource["drawboard.command.MotionCommand"]=true;dojo.provide("drawboard.command.MotionCommand");dojo.declare("drawboard.command.MotionCommand",drawboard.command.Command,{getType:function(){return this.getConstant().MOTIONCOMMAND;},positive:function(){var _201=this.getExecutor(),memo=this.getMemo(),_202=this.getRuntime(),ma=memo.decorator;(!memo.oldP)&&(memo.oldP=ma.getCenter());_201.moveMotionAnchor(ma,memo.p,_202);},negative:function(){var _203=this.getExecutor(),memo=this.getMemo(),_204=this.getRuntime();_203.moveMotionAnchor(memo.decorator,memo.oldP,_204);_203.normalize(memo.decorator,_204);},_merge:function(_205){var memo=this.getMemo(),ma=memo.decorator,_206=_205.getMemo(),cma=_206.decorator;if(ma.getIndex()==cma.getIndex()){memo.p=_206.p;return true;}return false;}});}if(!dojo._hasResource["drawboard.PreRequire"]){dojo._hasResource["drawboard.PreRequire"]=true;dojo.provide("drawboard.PreRequire");}if(!dojo._hasResource["drawboard._Event"]){dojo._hasResource["drawboard._Event"]=true;dojo.provide("drawboard._Event");(function(){var _207=common.calc.Geometry,_208=drawboard.Constant.ActionStatus,_209=drawboard.Constant;dojo.declare("drawboard._Event",null,{_start:null,_end:null,boxCache:null,_marks:null,getBoxCache:function(){if(!this.boxCache){var node=(this.fixNode||this.domNode),_20a={left:node.offsetLeft,top:node.offsetTop};this.boxCache=_20a;}return this.boxCache;},refreshBoxCache:function(){this.boxCache=null;},fetchCoordinate:function(e){var box=this.getBoxCache(),_20b=this.domNode;return {x:e.pageX-box.left+_20b.scrollLeft,y:e.pageY-box.top+_20b.scrollTop};},showMarkActive:function(gp,d,_20c){var _20d=d||gp.getActiveAnchors(_20c),_20e,_20f,mark;if((d&&!gp.isAnchor(d))||!_20d){return;}(!dojo.isArray(_20d))&&(_20d=[_20d]);_20e=drawboard.markController;dojo.forEach(_20d,function(s){mark=_20e.cross(s,gp,this,_20c);if(mark){!_20f&&(_20f=[])&&(this._marks=_20f);_20f.push(mark);}},this);_20e=_20c.getContext().getStyleCtrl();!_20f&&(this._marks=null);if(_20f){var _210=[];dojo.forEach(_20f,function(m){this.push(m.d);gp=m.gp;},_210);_20e.setActives(_210,gp);return;}_20e.setActives(null);},doClick:function(e){this.inherited(arguments);},doMouseMove:function(e){this.inherited(arguments);this._end&&(this._start=this._end);this._end=this.fetchCoordinate(e);var gp=this.getActive(),_211=this._start,end=this._end,_212=this.getActionStatus(),_213=this.getDecorate(),_214,pole,a,_215=this.getRuntime(),_216=this.getSelectRect(),_217=_209.Command,_218=dojo.hitch(this,this.addCommand),_219=true;if(_212!=_208.NONE&&gp){_214=dojo.clone(gp.getRotator(_215));pole=_214.coordinate;}_216&&!gp&&(gp=_216);if(!gp&&_212!=_208.DRAWING&&_212!=_208.SELECTING&&_212!=_208.TEXT){return;}switch(_212){case _208.RESIZING:_218(_217.RESIZECOMMAND,gp,{decorate:_213,start:_211,end:end});this.showMarkActive(gp,drawboard.skeletonController.createItem(gp.getSkeletonCoordinates(_215)[_213.getIndex()],_213.getIndex()),_215);break;case _208.MOVING:_218(_217.MOVECOMMAND,gp,{start:_211,end:end});this.showMarkActive(gp,null,_215);break;case _208.DRAWING:case _208.SELECTING:case _208.TEXT:var _21a=this.getDrawEntity(true);_21a.width=end.x-_21a.x;_21a.height=end.y-_21a.y;break;case _208.MOTION:_218(_217.MOTIONCOMMAND,gp,{decorator:_213,p:end});break;case _208.ROTATING:case _208.POLEMOVING:if(_212==_208.ROTATING){_214.angle=_207.angle({x:pole.x,y:pole.y-_215.getContext().getParamsCtrl().getRotateDistance()},pole,this._end);_218(_217.ROTATECOMMAND,gp,_214);}else{_213.pole=_214.coordinate=end;gp.setRotator(_214,_215);}break;case _208.NONE:default:_219=false;break;}_219&&this.draw();},doMouseDown:function(e){this.inherited(arguments);var _21b=this.fetchCoordinate(e),_21c=this.getActionStatus(),_21d;if(_21c==_208.DRAWING||_21c==_208.SELECTING||_21c==_208.TEXT){_21d=this.getDrawEntity(true);_21d.x=_21b.x;_21d.y=_21b.y;}this._start=_21b;},doMouseOver:function(e){this.inherited(arguments);},doMouseUp:function(e){var _21e=this._marks,_21f=this.getRuntime(),_220=this.getActionStatus(),_221=(_220==_208.DRAWING||_220==_208.TEXT)?false:true,_222=drawboard.relationController,gp=this.getActive(),_223=this.getDecorate();gp&&(gp.normalize(_223,_21f));if(gp&&_222.containRestrain(gp,_223,_21f)){this.addCommand(_209.Command.ADDVSDELTECONSTRAINCOMMAND,_222,[{restrainedGp:gp,restrainedD:_223}],true);}if(_21e){var _224=[];dojo.forEach(_21e,function(mark){if(!_222.containRestrain(mark.restrainedGp,mark.restrainedD,_21f)){_224.push(mark);}},this);(_224.length>0)&&this.addCommand(_209.Command.ADDVSDELTECONSTRAINCOMMAND,_222,_224);}if(this._status==_208.TEXT){var _225=this.getDrawEntity(),_226=this.getTextBoard();_226.clearText();_226.show(_225);this.setDrawType("drawboard.graph.strategy.TextStrategy");}this.getRuntime().getContext().getStyleCtrl().setActives(null);this._start=null;this._end=null;this._marks=null;this.clearDrawEntity(_221);this.inherited(arguments);this.clearCommand();this.draw();dojo.publish("/drawboard/mouseup");}});})();}if(!dojo._hasResource["drawboard.container.LayoutContainer"]){dojo._hasResource["drawboard.container.LayoutContainer"]=true;dojo.provide("drawboard.container.LayoutContainer");dojo.declare("drawboard.container.LayoutContainer",[dijit._Widget,common.container.ListContainer],{up:function(gs){var _227=this.indexOf(gs);this.move(_227,_227+1);},down:function(gs){var _228=this.indexOf(gs);this.move(_228,_228-1);},top:function(gs){var _229=this.indexOf(gs);this.move(_229,this.size());},bottom:function(gs){var _22a=this.indexOf(gs);this.move(_22a,0);}});}if(!dojo._hasResource["drawboard.graph.strategy.GraphStrategyFactory"]){dojo._hasResource["drawboard.graph.strategy.GraphStrategyFactory"]=true;dojo.provide("drawboard.graph.strategy.GraphStrategyFactory");(function(){dojo.declare("drawboard.graph.strategy.GraphStrategyFactory",common.container.MapContainer,{getGraphStrategy:function(_22b){if(!this.contains(_22b)){var _22c=eval("new "+_22b+"()");this.addItem(_22b,_22c);}return this.getItem(_22b);}});if(!drawboard.GraphStrategyFactory){drawboard.GraphStrategyFactory=new drawboard.graph.strategy.GraphStrategyFactory();}})();}if(!dojo._hasResource["drawboard.controller.RelationController"]){dojo._hasResource["drawboard.controller.RelationController"]=true;dojo.provide("drawboard.controller.RelationController");(function(){var _22d=drawboard.Constant.Symbol,_22e=common.utils.CollectionUtils.hasAttr;dojo.declare("drawboard.controller.RelationController",[common.container.MapContainer,common.Cache],{addListener:function(gp,d,_22f,_230,_231){var idty=gp.getIdty(),_232=this.getItem(idty),item,_233=false,_234=d.getType()+_22d.concat+d.getIndex();if(!_232){_232={};this.addItem(idty,_232);}item=_232[_234];if(!item){item=[];_232[_234]=item;}dojo.some(item,function(i){if(i.gp==_22f){_233=true;return true;}},this);if(!_233){item.push({gp:_22f,decorate:_230});this.addRestrainedCache(gp,d,_22f,_230,_231);}},removeListener:function(_235,_236,_237){var _238=this.removeRestrainedCache(_235,_236,_237),_239,item,_23a,dels,id;dojo.forEach(_238,function(item){id=item.id;_239=this.getItem(id);if(!_239){return;}dels=[];_23a=item.decorate.getType()+_22d.concat+item.decorate.getIndex();item=_239[_23a];dojo.forEach(item,function(_23b,_23c){if(_23b.gp!=_235){return;}if(!_236||(_236&&_23b.decorate.equal(_236))){dels.push(_23c);}},this);dojo.forEach(dels.reverse(),function(_23d){item.splice(_23d,1);},this);delete _239[_23a];if(!_22e(_239)){this.removeItem(id);}},this);},fireEvent:function(idty,d,_23e,_23f,_240){var _241=this.getItem(idty),item,temp;if(!_241){return;}item=_241[d.getType()+_22d.concat+d.getIndex()];item&&dojo.forEach(item,function(i){if(_240&&!_240(i.gp)){return;}temp=_23e.concat();temp.unshift(i.decorate);temp.push(null);temp.push(_23f);i.gp.sizeChange.apply(i.gp,temp);},this);},addRestrainedCache:function(gp,d,_242,_243,_244){var idty=gp.getIdty(),_245=this.getCache(_244),_246=_245[_242.getIdty()],_247=_243.getType()+_22d.concat+_243.getIndex();if(!_246){_246={};_245[_242.getIdty()]=_246;}!_246[_247]&&(_246[_247]={id:idty,gp:gp,decorate:d,restrainedGp:_242,restrainedD:_243});},containRestrain:function(_248,_249,_24a){var _24b=this.getRestrainedCache(_248,_249,_24a);if(_24b&&_24b.length>0){return true;}return false;},getRestrainedCache:function(_24c,_24d,_24e){var _24f=this.getCache(_24e),_250=_24f[_24c.getIdty()],_251;if(!_250){return _251;}if(_24d){var _252=_24d.getType()+_22d.concat+_24d.getIndex();_250[_252]&&(_251=[_250[_252]]);return _251;}_251=[];for(var _253 in _250){_251.push(_250[_253]);}return _251;},removeRestrainedCache:function(_254,_255,_256){var _257=this.getCache(_256),_258=_257[_254.getIdty()],_259;if(!_258){return _259;}if(_255){var _25a=_255.getType()+_22d.concat+_255.getIndex();_258[_25a]&&(_259=[_258[_25a]]);delete _258[_25a];if(!_22e(_258)){delete _257[_254.getIdty()];}return _259;}_259=[];for(var _25b in _258){_259.push(_258[_25b]);}delete _257[_254.getIdty()];return _259;},createCache:function(){return {};}});if(drawboard.relationController==null){drawboard.relationController=new drawboard.controller.RelationController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Decorator"]){dojo._hasResource["drawboard.graph.decorate.Decorator"]=true;dojo.provide("drawboard.graph.decorate.Decorator");dojo.declare("drawboard.graph.decorate.Decorator",dijit._Widget,{_type:null,coordinate:null,center:null,index:0,getIndex:function(){return this.index;},setIndex:function(_25c){this.index=_25c;},getType:function(){return this._type;},getCoordinate:function(){return this.coordinate;},setCoordinate:function(_25d){this.coordinate=_25d;},getCenter:function(){return this.center;},setCenter:function(_25e){this.center=_25e;},draw:function(gp,_25f,_260){},equal:function(d){if(d.getIndex()!=this.getIndex()){return false;}var same=true,ps=this.getCoordinate();dojo.some(d.getCoordinate(),function(item,_261){if(item!=ps[_261]){same=false;return true;}},this);return same;}});}if(!dojo._hasResource["drawboard.graph.decorate.Mark"]){dojo._hasResource["drawboard.graph.decorate.Mark"]=true;dojo.provide("drawboard.graph.decorate.Mark");(function(){var _262=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Mark",drawboard.graph.decorate.Decorator,{_type:_262.Decorate.MARK,draw:function(gp,_263,_264){var p=this.getCoordinate(),path=_262.Path,_265=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.MOVE,points:p[2]},{command:path.LINE,points:p[3]},];gp.drawPath(_265,_263,true);}});})();}if(!dojo._hasResource["drawboard.graph.GraphProxy"]){dojo._hasResource["drawboard.graph.GraphProxy"]=true;dojo.provide("drawboard.graph.GraphProxy");(function(){var _266=drawboard.Constant,_267=_266.Decorate,_268=drawboard.GraphStrategyFactory,_269=common.calc.Geometry,_26a=_269.dividePoint,add=_269.add2Points,_26b=_269.subtract2Points,_26c=_269.rotation;dojo.declare("drawboard.graph.GraphProxy",null,{_graphStatus:null,_graphStrategyClass:null,_isActive:false,_isActived:false,_isComposite:false,_showMark:false,constructor:function(_26d,_26e){_26e=dojo.trim(_26e);this._graphStrategyClass=_26e;this._graphStatus=_26d;},getGraphStrategy:function(){return _268.getGraphStrategy(this.getGraphStrategyClass());},getGraphStrategyClass:function(){if(!this._graphStrategyClass){new common.exception.Exception({msg:"graph proxy must have an graph strategy class!"});}return this._graphStrategyClass;},getGraphStatus:function(){if(!this._graphStatus){new common.exception.Exception({msg:"graph status proxy must have an graph status instance!"});}return this._graphStatus;},setRatio:function(_26f){return this.getGraphStatus().setRatio(_26f);},getRatio:function(){return this.getGraphStatus().getRatio();},setText:function(text){this.getGraphStatus().setText(text);},getText:function(){return this.getGraphStatus().getText();},isComposite:function(){return this._isComposite;},showMark:function(_270){if(_270!==undefined){this._showMark=_270;}return this._showMark;},getIdty:function(){return this.getGraphStatus().getIdty();},isActive:function(_271){if(_271!==null&&_271!==undefined){this._isActive=_271;}return this._isActive;},isActived:function(_272){if(_272!==null&&_272!==undefined){this._isActived=_272;}return this._isActived;},getCenter:function(_273){var _274=this.getCache(_273),_275=_274[_267.CENTER];if(!_275){var gs=this.getGraphStatus(),c=gs.getCoordinate(_273),w=gs.getWidth(_273),h=gs.getHeight(_273);_274[_267.CENTER]=_275={x:c.x+(w>>1),y:c.y+(h>>1)};}return _275;},getCoordinate:function(_276){return this.getGraphStatus().getCoordinate(_276);},setCoordinate:function(_277,_278){this.getGraphStatus().setCoordinate(_277,_278);},reset:function(_279,_27a){var gs=this.getGraphStatus(),_27b=gs.getMarks(_27a),_27c=gs.getMotionAnchors(_27a);if(_27b){dojo.forEach(_27b,function(item){if(item){item.x+=_279.x;item.y+=_279.y;}},this);gs.setMarks(_27b,_27a);}if(_27c&&!gs.isAffectedByZoom()){dojo.forEach(_27c,function(_27d){if(_27d){_27d.x+=_279.x;_27d.y+=_279.y;}},this);gs.setMotionAnchors(_27c,_27a);}},getWidth:function(_27e){return this.getGraphStatus().getWidth(_27e);},setWidth:function(w,_27f){this.getGraphStatus().setWidth(w,_27f);},getHeight:function(_280){return this.getGraphStatus().getHeight(_280);},setHeight:function(h,_281){this.getGraphStatus().setHeight(h,_281);},setRotator:function(_282,_283,_284){var gs=this.getGraphStatus(),_285=gs.getRotator();(!_285)&&(_285={angle:0});if(_282.angle!=_285.angle){_285.angle=_282.angle;gs.setRotator(_285);}else{}!_284&&this.refresh(_283);},getRotator:function(_286){var gs=this.getGraphStatus(),_287=gs.getRotator(),_288=gs.getCoordinate(_286),h=gs.getHeight(_286),w=gs.getWidth(_286);return {coordinate:{x:_288.x+(w>>1),y:_288.y+(h>>1)},angle:_287?_287.angle:0};},getGraphRotator:function(_289){var gs=this.getGraphStatus(),_28a=this.getGraphStrategy(),_28b=gs.getRotateAngle(),_28c=this.getCenter(_289);if(!_28a.hasRotator()){return {coordinate:_28a.getRotatorCoordinate(this,_289)||_28c,angle:_28b};}return {coordinate:_28c,angle:_28b};},getRealMarks:function(_28d){return this.getGraphStatus().getMarks(_28d);},getRealMotionAnchors:function(_28e){return this.getGraphStatus().getMotionAnchors(_28e);},getUrl:function(){return this.getGraphStatus().getUrl();},getNWCoordinate:function(_28f){var _290=this.getGraphRotator(_28f),pole=_290.coordinate,a=_290.angle;return _26c(this.getCoordinate(_28f),pole,a);},getSECoordinate:function(_291){var _292=this.getGraphRotator(_291),pole=_292.coordinate,a=_292.angle,_293=this.getCoordinate(_291),w=this.getWidth(_291),h=this.getHeight(_291);return _26c({x:_293.x+(w>>1),y:_293.y+(h>>1)},pole,a);},getCoordinatesByDeal:function(_294,_295){var _296=_294(this,_295);if(!_296||_296.length==0){return null;}var r=_295.getDistance(),_297=this.getGraphRotator(_295),pole=_297.coordinate,_298=common.utils.CollectionUtils.copy4Attrs,a=_297.angle,p=_296[0],_299,temp;temp=_26c(p,pole,a);_298(p,temp,{x:1,y:1});_296[0]=[temp,_26c({x:p.x-r,y:p.y-r},pole,a),_26c({x:p.x+r,y:p.y-r},pole,a),_26c({x:p.x+r,y:p.y+r},pole,a),_26c({x:p.x-r,y:p.y+r},pole,a)];dojo.forEach(_296,function(_29a,_29b){if(_29b!=0){temp=_26c(_29a,pole,a);_298(_29a,temp,{x:1,y:1});_299=_26b(temp,_296[0][0]);_296[_29b]=[temp,add(_296[0][1],_299),add(_296[0][2],_299),add(_296[0][3],_299),add(_296[0][4],_299)];}},this);return _296;},getGraphCoordinates:function(_29c){var _29d=this.getCache(_29c),_29e=_29d[_267.Graph];if(!_29e){var _29f=this.getGraphStrategy(),_2a0=this.getGraphRotator(_29c),pole=_2a0.coordinate,a=_2a0.angle,_2a1=_29f.getGraphCoordinates(this,_29c);dojo.forEach(_2a1,function(item,_2a2){_2a1[_2a2]=_26c(item,pole,a);},this);_29d[_267.Graph]=_2a1;return _2a1;}return _29e;},getSkeletonCoordinates:function(_2a3){var _2a4=this.getCache(_2a3),_2a5=_2a4[_267.SKELETON];if(!_2a5){var _2a6=this.getGraphStrategy(),_2a7=this.getCoordinatesByDeal(_2a6.getSkeletonCoordinates,_2a3);_2a4[_267.SKELETON]=_2a7;return _2a7;}return _2a5;},getMarkCoordinates:function(_2a8){var _2a9=this.getCache(_2a8),_2aa=_2a9[_267.MARK];if(!_2aa){var _2ab=this.getGraphStrategy(),_2ac=this.getCoordinatesByDeal(_2ab.getMarkCoordinates,_2a8);_2a9[_267.MARK]=_2ac;return _2ac;}return _2aa;},getOutletCoordinates:function(_2ad){var _2ae=this.getCache(_2ad),_2af=_2ae[_267.OUTLET];if(!_2af){var _2b0=new drawboard.graph.strategy.RectangleStrategy(),_2b1=_2b0.getGraphCoordinates(this,_2ad),_2b2=this.getGraphRotator(_2ad),pole=_2b2.coordinate,a=_2b2.angle;dojo.forEach(_2b1,function(item,_2b3){_2b1[_2b3]=_26c(item,pole,a);},this);_2ae[_267.OUTLET]=_2b1;return _2b1;}return _2af;},hasRotator:function(){return this.getGraphStrategy().hasRotator();},getRotatorCoordinates:function(_2b4){if(!this.hasRotator()){return null;}var _2b5=this.getCache(_2b4),_2b6=_2b5[_267.ROTATOR];if(!_2b6){var r=_2b4.getDistance(),d=_2b4.getRotateDistance(),_2b7=this.getRotator(_2b4),pole=_2b7.coordinate,a=_2b7.angle,_2b8=this.getCoordinate(_2b4),_2b9={x:pole.x,y:_2b8.y},_2ba=this.getGraphRotator(_2b4).coordinate,_2bb=_269.getDistant(pole,_26c(_2b9,_2ba,a)),_2bc;(_2bb>0)&&(d+=_2bb);_2bc=_26c({x:pole.x,y:pole.y-d-r},pole,a);_2b6=[_269.intersectCircleLine(_2bc,r,_2bc,{x:_2bc.x,y:_2bc.y+10})[0],_26c({x:pole.x,y:pole.y-d},pole,a),_26c({x:pole.x,y:pole.y-r},pole,a),{x:pole.x,y:pole.y},_26c({x:pole.x,y:pole.y-2*r},pole,a),_2bc];_2b5[_267.ROTATOR]=_2b6;return _2b6;}return _2b6;},getMotionAnchorCoordinates:function(_2bd){var _2be=this.getCache(_2bd),_2bf=_2be[_267.MOTIONANCHOR];if(!_2bf){var _2c0=this.getGraphStrategy(),_2c1=this.getCoordinatesByDeal(_2c0.getMotionAnchorCoordinates,_2bd);_2be[_267.MOTIONANCHOR]=_2c1;return _2c1;}return _2bf;},refresh:function(_2c2,_2c3){var _2c4=this.getMarkCoordinates(_2c2),_2c5,_2c6;this.clearCache(_2c2);this.getSkeletonCoordinates(_2c2);this.getMotionAnchorCoordinates(_2c2);_2c5=this.getMarkCoordinates(_2c2);dojo.forEach(_2c4,function(item,_2c7){if(item[0]!=_2c5[_2c7][0]){_2c6=_26b(_2c5[_2c7][0],item[0]);drawboard.relationController.fireEvent(this.getIdty(),new drawboard.graph.decorate.Mark({coordinate:[item[1],item[3],item[2],item[4]],index:_2c7}),[_2c6],_2c2,_2c3);}},this);},getCache:function(_2c8){return _2c8.getCache(this);},clearCache:function(_2c9,type){_2c9.clearCache(this,type);},draw:function(_2ca){this.getGraphStrategy().draw(this,_2ca.getGraphic(),_2ca);if(this.isActived()){var p=drawboard.Constant.Path,_2cb=this.getOutletCoordinates(_2ca);_2ca.getGraphic().drawPath([{command:p.MOVE,points:_2cb[0]},{command:p.LINE,points:_2cb[1]},{command:p.LINE,points:_2cb[2]},{command:p.LINE,points:_2cb[3]}],"fill:none;stroke:red;stroke-width:2");}},sizeChange:function(_2cc,_2cd,end,_2ce){var _2cf=this.getGraphStrategy(),_2d0=this.getGraphRotator(_2ce),_2d1=_2d0.coordinate,a=_2d0.angle,_2d2=_2cd,gp=this,_2d3=_2cf.hasRotator(),_2d4={};if(end!==null&&end!==undefined){_2d2=_26b(end,_2cd);if(_2d3){var _2d5=_2cc.getDirect(),d=_266.Direction,_2d6=this.getCoordinate(_2ce),_2d7=this.getSkeletonCoordinates(_2ce),_2d8,_2d9;switch(_2d5){case d.NORTH:case d.WEST:case d.WESTNORTH:_2d8=_2d7[3][0];_2d9=function(pos,p,a){gp.setCoordinate(add(_2d6,_26b(_26c(pos,p,-a),{x:_2d6.x+gp.getWidth(_2ce),y:_2d6.y+gp.getHeight(_2ce)})),_2ce);};break;case d.EASTNORTH:_2d8=_2d7[2][0];_2d9=function(pos,p,a){gp.setCoordinate(add(_2d6,_26b(_26c(pos,p,-a),{x:_2d6.x,y:_2d6.y+gp.getHeight(_2ce)})),_2ce);};break;case d.WESTSOUTH:_2d8=_2d7[1][0];_2d9=function(pos,p,a){gp.setCoordinate(add(_2d6,_26b(_26c(pos,p,-a),{x:_2d6.x+gp.getWidth(_2ce),y:_2d6.y})),_2ce);};break;case d.SOUTH:case d.EAST:case d.EASTSOUTH:_2d8=_2d7[0][0];_2d9=function(pos,p,a){pos=_26c(pos,p,-a);gp.setCoordinate(pos,_2ce);};break;case d.END:break;default:break;}_2d4.oriFixPos=_2d8;_2d4.oriFixFunct=_2d9;_2cd=_26c(_2cd,_2d1,-a);end=_26c(end,_2d1,-a);_2d2=_26b(end,_2cd);}}_2cf.sizeChange(this,_2cc,_2d2,_2ce);if(_2d3&&a!=0&&_2d4!==undefined){this.clearCache(_2ce,_267.CENTER);var _2da=_26c(this.getCenter(_2ce),_2d1,a);_2d4.oriFixFunct(_2d4.oriFixPos,_2da,a);}this.refresh(_2ce);},normalize:function(_2db,_2dc){var _2dd=this.getGraphStrategy().normalize(this,_2db,_2dc);_2dd&&this.refresh(_2dc);},move:function(_2de,end,_2df){var _2e0=this.getCoordinate(_2df),_2e1=_26b(end,_2de);this.setCoordinate({x:_2e0.x+_2e1.x,y:_2e0.y+_2e1.y},_2df);this.reset(_2e1,_2df);this.refresh(_2df);},zoom:function(rate,_2e2){this.refresh(_2e2,function(){return false;});},moveMotionAnchor:function(_2e3,_2e4,_2e5){var _2e6=this.getGraphStrategy().calcMotionAnchor(this,_2e3,_2e4,_2e5),_2e7=this.getRealMotionAnchors(_2e5);(_2e3.getIndex()<_2e7.length)&&(_2e6!=null)&&(_2e7[_2e3.getIndex()]=_2e6);this.refresh(_2e5);},active:function(p,_2e8){if(this.getGraphStrategy().isIn(this,p,_2e8)){return this;}return null;},getActiveAnchors:function(_2e9){return this.getGraphStrategy().getActiveAnchors(this,_2e9);},isAnchor:function(d){return this.getGraphStrategy().isAnchor(d);},deleteAll:function(db,_2ea){this.destroy(_2ea);},destroy:function(_2eb){drawboard.relationController.removeListener(this,null,_2eb);}});})();}if(!dojo._hasResource["drawboard.graph.CompositeProxy"]){dojo._hasResource["drawboard.graph.CompositeProxy"]=true;dojo.provide("drawboard.graph.CompositeProxy");(function(){var _2ec=common.calc.Geometry,add=_2ec.add2Points,_2ed=_2ec.subtract2Points,_2ee=drawboard.Constant.Decorate;dojo.declare("drawboard.graph.CompositeProxy",[common.container.ListContainer,drawboard.graph.GraphProxy],{_focus:false,_isComposite:true,_operate:false,isFocus:function(_2ef){if(_2ef!==undefined){this._focus=_2ef;}return this._focus;},contains:function(gp){if(!gp){return false;}var _2f0=false;this.some(function(item){if(item.gp==gp){_2f0=true;return true;}},this);return _2f0;},remove:function(gp){var _2f1;this.some(function(item,i){if(item.gp==gp){_2f1=i;return true;}},this);drawboard.graph.CompositeProxy.superclass.remove.apply(this,[_2f1]);},equals:function(cp){if(cp.size()!=this.size()){return false;}var same=true;this.some(function(item){if(!cp.contains(item.gp)){same=false;return true;}},this);return same;},resetRelations:function(){var that=this,_2f2,gp;this.forInItems(function(item){gp=item.gp;_2f2=(gp.getParent&&gp.getParent());if(_2f2!=that){_2f2&&_2f2.remove(gp);gp.getParent=function(){return that;};}},this);},add:function(gp,_2f3){drawboard.graph.CompositeProxy.superclass.add.apply(this,[{gp:gp,oriPos:gp.getCoordinate(_2f3),oriRotator:dojo.clone(gp.getRotator(_2f3))}]);if(_2ec.graphContainsGraph(this.getSkeletonCoordinates(_2f3),gp.getSkeletonCoordinates(_2f3))){return;}var rect=_2ec.getMaxRect(gp.getSkeletonCoordinates(_2f3).concat(this.getSkeletonCoordinates(_2f3)));this.setCoordinate({x:rect.x,y:rect.y},_2f3);this.setWidth(rect.width,_2f3);this.setHeight(rect.height,_2f3);this.refresh(_2f3);},setRotator:function(_2f4,_2f5,_2f6){this._operate=true;var r=this.getRotator(_2f5),_2f7,_2f8=_2ec.rotation,_2f9=_2f4.angle-r.angle,_2fa=dojo.hitch(this,this.contains),_2fb=[];this.inherited(arguments);if(_2f6){return;}this.recursiveChild(_2fb);dojo.forEach(_2fb,function(gp){r=gp.getGraphRotator(_2f5);r.angle+=_2f9;_2f7=gp.getNWCoordinate(_2f5);_2f7=_2f8(_2f8(_2f7,_2f4.coordinate,_2f9),_2f8(r.coordinate,_2f4.coordinate,_2f9),-r.angle);gp.setCoordinate(_2f7,_2f5);gp.setRotator(r,_2f5,true);gp.refresh(_2f5,function(_2fc){if(_2fa(_2fc)){return false;}return true;});},this);this._operate=false;},recursiveChild:function(_2fd){var gp;this.forInItems(function(item){gp=item.gp;_2fd.push(gp);if(gp.recursiveChild){gp.recursiveChild(_2fd);return;}},this);},deleteAll:function(db){this.forInItems(function(item){db.removeGraph(item.gp);},this);this.destroy();},destroy:function(){this.inherited(arguments);var gp;this.forInItems(function(item){gp=item.gp;gp.getParent&&(gp.getParent()==this)&&(delete gp.getParent);},this);},draw:function(_2fe){this.inherited(arguments);},sizeChange:function(_2ff,_300,end,_301){this._operate=true;var w=this.getWidth(_301),h=this.getHeight(_301),_302=1,_303=1,gp,nw,r,nnw,_304,_305,_306=_2ec.rotation,_307=this.getSkeletonCoordinates(_301)[0][0],_308=this.getRotator(_301),_309=dojo.hitch(this,this.contains);this.inherited(arguments);_302=this.getWidth(_301)/w;_303=this.getHeight(_301)/h;fixCoordinate=this.getSkeletonCoordinates(_301)[0][0];this.forInItems(function(item){gp=item.gp;_305=gp.getCoordinate(_301);nw=gp.getNWCoordinate(_301);nw=_306(nw,_307,-_308.angle);_304=_2ed(nw,_307);nw=_306(add(_307,{x:_304.x*_302,y:_304.y*_303}),_307,_308.angle);nw=add(nw,_2ed(fixCoordinate,_307));gp.setWidth(gp.getWidth(_301)*_302,_301);gp.setHeight(gp.getHeight(_301)*_303,_301);_301.clearCache(gp,_2ee.CENTER);r=gp.getGraphRotator(_301);_305=gp.getCoordinate(_301);nnw=_306(_305,r.coordinate,r.angle);gp.setCoordinate(add(_305,_2ed(nw,nnw)),_301);gp.refresh(_301,function(_30a){if(_309(_30a)){return false;}return true;});},this);this._operate=false;},move:function(_30b,end,_30c){this._operate=true;this.inherited(arguments);this.forInItems(function(item){if(item){item.oriPos=add(item.oriPos,_2ed(end,_30b));item.gp.move(_30b,end,_30c);}},this);this._operate=false;},zoom:function(rate,_30d){this._operate=true;this.inherited(arguments);this.forInItems(function(item){if(item){item.gp.zoom(rate,_30d);}},this);this._operate=false;}});})();}if(!dojo._hasResource["drawboard.graph.GraphStatus"]){dojo._hasResource["drawboard.graph.GraphStatus"]=true;dojo.provide("drawboard.graph.GraphStatus");(function(){var _30e=common.calc.Geometry,_30f=_30e.multiPoint,_310=_30e.dividePoint;dojo.declare("drawboard.graph.GraphStatus",[dijit._Widget,common.Identity],{_coordinate:null,_w:null,_h:null,_rotator:null,_motionAnchors:null,affectedByZoom:false,_marks:null,_url:null,_ratio:null,_text:null,setRatio:function(_311){return this._ratio=_311;},getRatio:function(){return this._ratio;},isAffectedByZoom:function(_312){(_312!==undefined)&&(this.affectedByZoom=_312);return this.affectedByZoom;},setCoordinate:function(_313,_314){this._coordinate=_310(_313,this.getZoom(_314))[0];},getCoordinate:function(_315){return _30f(this._coordinate,this.getZoom(_315))[0];},getZoom:function(_316){return _316.getContext().getZoom();},setWidth:function(w,_317){this._w=w/this.getZoom(_317).x;},getWidth:function(_318){return this._w*this.getZoom(_318).x;},setHeight:function(h,_319){this._h=h/this.getZoom(_319).y;},getHeight:function(_31a){return this._h*this.getZoom(_31a).y;},hasRotator:function(){if(this._rotator){return true;}return false;},setRotator:function(_31b){this._rotator=_31b;},setText:function(text){this._text=text;},getText:function(){return this._text;},getRotator:function(){return this._rotator;},getRotateAngle:function(){var _31c=this.getRotator();if(_31c){return _31c.angle;}return 0;},setMarks:function(_31d,_31e){this._marks=_310(_31d,this.getZoom(_31e));},getMarks:function(_31f){return this._marks&&_30f(this._marks,this.getZoom(_31f));},setMotionAnchors:function(_320,_321){this.isAffectedByZoom()&&(_320=_310(_320,this.getZoom(_321)));this._motionAnchors=_320;},getMotionAnchors:function(_322){var _323=this._motionAnchors;this.isAffectedByZoom()&&(_323=_30f(_323,this.getZoom(_322)));return _323;},getUrl:function(){return this._url;},setUrl:function(url){this._url=url;}});})();}if(!dojo._hasResource["drawboard.drawProcessor.DrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DrawProcessor");dojo.declare("drawboard.drawProcessor.DrawProcessor",null,{draw:function(gp,_324){}});}if(!dojo._hasResource["drawboard._Selector"]){dojo._hasResource["drawboard._Selector"]=true;dojo.provide("drawboard._Selector");(function(){var _325=drawboard.Constant,_326=_325.ActionStatus,_327=_325.MouseAction,_328=common.calc.Geometry;dojo.declare("drawboard._Selector",drawboard.container.LayoutContainer,{_events:null,_status:_326.NONE,_mouseStatus:_327.NONE,_active:null,_decorate:null,_graphStrategy:null,_isMark:false,_isSelecting:false,lastScrollTop:0,lastScrollLeft:0,cache:null,postCreate:function(host){this._events=[dojo.connect(host,"onmousemove",dojo.hitch(this,"doMouseMove")),dojo.connect(host,"onmousedown",dojo.hitch(this,"doMouseDown")),dojo.connect(host,"onmouseup",dojo.hitch(this,"doMouseUp")),dojo.connect(host,"onmouseover",dojo.hitch(this,"doMouseOver")),dojo.connect(host,"onclick",dojo.hitch(this,"doClick")),dojo.connect(host,"ondblclick",dojo.hitch(this,"doDblClick")),dojo.connect(window,"onkeydown",dojo.hitch(this,"doKeyDown")),dojo.connect(window,"onkeyup",dojo.hitch(this,"doKeyUp")),dojo.connect(this.domNode,"onscroll",dojo.hitch(this,"doScroll"))];},getStatusCache:function(){if(!this.cache){this.cache={};}return this.cache;},setStatusCache:function(gp,_329,_32a){var _32b=this.getStatusCache();gp&&(_32b.active=gp);_329&&(_32b.decorate=_329);_32b.status=_32a;},setStatus:function(gp,_32c,_32d){var _32e=this._active,_32f;if(_32e&&_32e!=gp){_32f=_32e.getParent&&_32e.getParent();if(_32e.isComposite()&&!_32e.contains(gp)){_32e.isFocus(false);}_32e.isActive(false);if(_32f&&!_32f.contains(gp)){_32f.isFocus(false);_32f.isActive(false);}}this._active=gp;this._decorate=_32c;this._status=_32d;this.updateActive();},updateActive:function(){var gp=this.getActive();gp&&gp.isActive(true)&&gp.isComposite()&&gp.isFocus(true);},getMouseStatus:function(){return this._mouseStatus;},setMouseStatus:function(_330){this._mouseStatus=_330;},getActionStatus:function(){return this._status;},setActionStatus:function(_331){this._status=_331;},getDecorate:function(){return this._decorate;},setDecorate:function(d){this._decorate=d;},getActive:function(){return this._active;},setActive:function(gp){this._active=gp;},setDrawType:function(_332){this._graphStrategy=_332;this._isSelecting=false;this._isMark=false;},getDrawType:function(){return this._graphStrategy;},isSelecting:function(_333){this._isSelecting=_333;if(_333){this._isMark=false;this._graphStrategy=null;}},isMark:function(mark){this._isMark=mark;if(mark){this._isSelecting=false;this._graphStrategy=null;}},doClick:function(e){this.setMouseStatus(_327.MOUSECLICK);},doDblClick:function(e){var _334=this.getActive(),text=_334&&_334.getText(),_335=this.getTextBoard();if(text){_335.setText(text);_335.show(_334);}},doMouseMove:function(e){if(this.getMouseStatus()==_327.MOUSEDOWN){var _336=this.getActive(),_337=this.getStatusCache(),_338=_337.active,_339=_338&&_338.getParent&&_338.getParent(),_33a=drawboard.relationController,_33b=this.getDecorate(),_33c=this.getRuntime();if(_338&&_338.isComposite()&&_336){!_336.isActive(false)&&_336.isComposite()&&_336.isFocus(false);_338.isActive(true);_338.isFocus(true);_339&&_339.isFocus(true);this._active=_338;}}this.setMouseStatus(_327.MOUSEMOVE);},doMouseDown:function(e){this.getTextBoard().hide();var d=drawboard,_33d=d.markController,_33e=this.fetchCoordinate(e),_33f,_340=this.getRuntime(),_341=dojo.hitch(_340.getDrawProcessor(),"setActive"),_342=this.getSelectRect(),_343=this.getActive(),_344=this._status;this.setMouseStatus(_327.MOUSEDOWN);if(_344&&_344==_326.TEXT){return;}if(this._graphStrategy){this.setStatus(null,null,_326.DRAWING);return;}_342&&(_33f=_341(_342,_33e,this._isMark,_33d,_340));if(!_33f){_343&&(_33f=_341(_343,_33e,this._isMark,_33d,_340));(!_33f)&&this.some(function(gp){_33f=_341(gp,_33e,this._isMark,_33d,_340);if(_33f){return true;}},this,true);}if(this.getActive()&&e.ctrlKey&&_33f&&_33f.active){_33f=_33f.active;if(_342){if(_342.contains(_33f)){return;}_342.add(_33f,_340);}else{var _343=this.getActive();if(!_343){return;}if(_343.isComposite()&&_343.contains(_33f)){return;}var rect=_328.getMaxRect([_33f.getGraphCoordinates(_340).concat(_343.getGraphCoordinates(_340))]),_342=new drawboard.graph.CompositeProxy(new drawboard.graph.GraphStatus({_coordinate:{x:rect.x,y:rect.y},_w:rect.width,_h:rect.height}),this.getSRGraphStrategyClass());_343.isActive(false);_342.add(_343,_340);_342.add(_33f,_340);this.setSelectRect(_342);this.setStatus(_342,null,_326.MOVING);}this.draw();return;}if(_342){if(!_33f){this.setSelectRect(null);this.draw();return;}this.setStatus(_33f.active,_33f.decorate,_33f.status);return;}if(!_33f){this.setStatus(null,null,_326.SELECTING);}else{this.setStatus(_33f.active,_33f.decorate,_33f.status);}},doMouseOver:function(e){this.setMouseStatus(_327.MOUSEOVER);},doMouseUp:function(e){this.setMouseStatus(_327.MOUSEUP);this.setStatusCache(this._active,this._decorate,this._status);this._status=_326.NONE;this._decorate=null;},doKeyDown:function(e){var gp=this.getActive(),_345=this.getSelectRect(),keys=dojo.keys,_346=_325.Command,_347=dojo.hitch(this,"addCommand"),_348=false;if(gp&&e.keyCode==keys.DELETE&&!e.ctrlKey){_347(_346.CREATEVSDELETECOMMAND,this,gp,true);_345&&this.setSelectRect(null);_348=true;}if(e.keyCode==keys.UP_ARROW){_347(_346.ZOOMCOMMAND,this,{x:10,y:10});_348=true;}if(e.keyCode==keys.DOWN_ARROW){_347(_346.ZOOMCOMMAND,this,{x:-10,y:-10});_348=true;}if(e.keyCode==90&&e.ctrlKey){this.undo();_348=true;}if(e.keyCode==89&&e.ctrlKey){this.redo();_348=true;}_348&&this.draw();},doKeyUp:function(e){this.clearCommand();},doScroll:function(e){var _349=e.target||e.srcElement;if(_349!=this.domNode){return;}var top=_349.scrollTop,left=_349.scrollLeft,_34a=this.lastScrollTop,_34b=this.lastScrollLeft;if(top!=_34a){this.fireListener(["doScroll",[false,top-_34a]]);this.lastScrollTop=top;return;}if(left!=_34b){this.fireListener(["doScroll",[true,left-_34b]]);this.lastScrollLeft=left;}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);}});})();}if(!dojo._hasResource["drawboard.controller.ParamsController"]){dojo._hasResource["drawboard.controller.ParamsController"]=true;dojo.provide("drawboard.controller.ParamsController");(function(){dojo.declare("drawboard.controller.ParamsController",null,{_distance:5,rotate_distance:20,rounder:10,getDistance:function(){return this._distance;},setDistance:function(_34c){this._distance=_34c;},getRotateDistance:function(){return this.rotate_distance;},setRotateDistance:function(_34d){this.rotate_distance=_34d;},getRounder:function(){return this.rounder;}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.Controller"]){dojo._hasResource["drawboard.graph.decorate.controller.Controller"]=true;dojo.provide("drawboard.graph.decorate.controller.Controller");dojo.declare("drawboard.graph.decorate.controller.Controller",null,{draw:function(gp,_34e){},active:function(gp,_34f,_350){},create:function(ps){return null;},getStyle:function(gp,_351,_352){return _352.getContext().getStyleCtrl().getStyle(this.type,gp,_351);}});}if(!dojo._hasResource["drawboard.graph.decorate.controller.MarkController"]){dojo._hasResource["drawboard.graph.decorate.controller.MarkController"]=true;dojo.provide("drawboard.graph.decorate.controller.MarkController");(function(){var _353=common.calc.Geometry;dojo.declare("drawboard.graph.decorate.controller.MarkController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.MARK,draw:function(gp,_354){var _355,mark=new drawboard.graph.decorate.Mark(),gf=_354.getGraphic();dojo.forEach(gp.getMarkCoordinates(_354)||[],function(item,_356){_355=[item[1],item[3],item[2],item[4]];mark.setCoordinate(_355);mark.setIndex(_356);mark.draw(gf,this.getStyle(gp,mark,_354),_354);},this);},active:function(gp,_357,_358){var mark;dojo.some(gp.getMarkCoordinates(_358)||[],function(item,_359){item=[item[1],item[3],item[2],item[4]];if(_353.isPointInPolyn(item,_357)){mark=new drawboard.graph.decorate.Mark({coordinate:item,index:_359,center:item[0]});return true;}},this);return mark;},create:function(ps){var mark,_35a=[];dojo.forEach(ps||[],function(item,_35b){mark=[item[1],item[3],item[2],item[4]];mark=new drawboard.graph.decorate.Mark({coordinate:skeleton,index:_35b});_35a.push(mark);},this);return _35a;},cross:function(s,cgp,db,_35c){var _35d,_35e=drawboard.skeletonController,mark,_35f={};db.some(function(gp){if(gp==cgp){return false;}_35d=gp.getMarkCoordinates(_35c);dojo.some(_35d||[],function(item,_360){item=[item[1],item[3],item[2],item[4]];dojo.some(item,function(p){if(_35e.isIn(s.getCoordinate(),p,_35c)){mark=true;return true;}},this);if(mark){_35f.d=new drawboard.graph.decorate.Mark({coordinate:item,index:_360});return true;}},this);if(mark){_35f.gp=gp;return true;}},this,true);if(mark){_35f.restrainedGp=cgp;_35f.restrainedD=s;return _35f;}return null;}});if(!drawboard.markController){drawboard.markController=new drawboard.graph.decorate.controller.MarkController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.MotionAnchor"]){dojo._hasResource["drawboard.graph.decorate.MotionAnchor"]=true;dojo.provide("drawboard.graph.decorate.MotionAnchor");(function(){var _361=drawboard.Constant;dojo.declare("drawboard.graph.decorate.MotionAnchor",drawboard.graph.decorate.Decorator,{_type:_361.Decorate.MOTIONANCHOR,draw:function(gp,_362,_363){var p=this.getCoordinate(),path=_361.Path,_364=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.LINE,points:p[2]},{command:path.LINE,points:p[3]}];gp.drawPath(_364,_362);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.MotionAnchorController"]){dojo._hasResource["drawboard.graph.decorate.controller.MotionAnchorController"]=true;dojo.provide("drawboard.graph.decorate.controller.MotionAnchorController");(function(){var _365=common.calc.Geometry,_366=common.utils.CollectionUtils;dojo.declare("drawboard.graph.decorate.controller.MotionAnchorController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.MOTIONANCHOR,draw:function(gp,_367){var _368,_369=new drawboard.graph.decorate.MotionAnchor(),gf=_367.getGraphic(),_36a=gp.getMotionAnchorCoordinates(_367);_36a&&dojo.forEach(_36a,function(item,_36b){_368=_366.sliceRange(item,1,4);_369.setCoordinate(_368);_369.setIndex(_36b),_369.draw(gf,this.getStyle(gp,_369,_367),_367);},this);},active:function(gp,_36c,_36d){var _36e,_36f=gp.getMotionAnchorCoordinates(_36d),_370;_36f&&dojo.some(_36f,function(item,_371){_370=item[0];item=_366.sliceRange(item,1,4);if(_365.isPointInPolyn(item,_36c)){_36e=new drawboard.graph.decorate.MotionAnchor({coordinate:item,index:_371,center:_370});return true;}},this);return _36e;}});if(!drawboard.motionAnchorController){drawboard.motionAnchorController=new drawboard.graph.decorate.controller.MotionAnchorController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Rotator"]){dojo._hasResource["drawboard.graph.decorate.Rotator"]=true;dojo.provide("drawboard.graph.decorate.Rotator");(function(){var _372=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Rotator",drawboard.graph.decorate.Decorator,{_type:_372.Decorate.ROTATOR,pole:null,angle:null,draw:function(gf,_373,_374){var r=_374.getDistance(),p=_372.Path,path=[],_375=this.getCoordinate();gf.drawCircle(_375[3],r,_373);gf.drawLine(_375[2],_375[1],_373);gf.drawCircle({x:_375[0].x,y:_375[0].y-r},r,_373);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.RotatorController"]){dojo._hasResource["drawboard.graph.decorate.controller.RotatorController"]=true;dojo.provide("drawboard.graph.decorate.controller.RotatorController");(function(){var _376=common.calc.Geometry;dojo.declare("drawboard.graph.decorate.controller.RotatorController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.ROTATOR,draw:function(gp,_377){if(!gp.hasRotator()){return;}var _378=gp.getRotatorCoordinates(_377),_379;_379=gp.getRotator(_377);_379=new drawboard.graph.decorate.Rotator({pole:_379.coordinate,angle:_379.angle,coordinate:_378});_379.draw(_377.getGraphic(),this.getStyle(gp,_379,_377),_377);},active:function(gp,_37a,_37b){if(!gp.hasRotator()){return null;}var _37c;if(this.isIn(gp,_37a,_37b)){_37c=gp.getRotator(_37b);_37c=new drawboard.graph.decorate.Rotator({coordinate:gp.getRotatorCoordinates(_37b),pole:_37c.pole,angle:_37c.angle});}return _37c;},isIn:function(gp,_37d,_37e){if(!gp.hasRotator()){return false;}var r=_37e.getDistance(),_37f=gp.getRotatorCoordinates(_37e);if(_376.isPointInCircle(_37d,{coordinate:_37f[3],r:r})||_376.isPointInCircle(_37d,{coordinate:_37f[5],r:r})||_376.isPointInSegment(_37f[1],_37f[4],_37d)){return true;}return false;},isInPole:function(gp,_380,_381){if(!gp.hasRotator()){return false;}var _382=gp.getRotatorCoordinates(_381);if(_376.isPointInCircle(_380,{coordinate:_382[3],r:_381.getDistance()})){return true;}return false;}});if(!drawboard.rotatorController){drawboard.rotatorController=new drawboard.graph.decorate.controller.RotatorController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Skeleton"]){dojo._hasResource["drawboard.graph.decorate.Skeleton"]=true;dojo.provide("drawboard.graph.decorate.Skeleton");(function(){var _383=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Skeleton",drawboard.graph.decorate.Decorator,{_type:_383.Decorate.SKELETON,_direct:null,_isAnchored:false,anchored:function(_384){this._isAnchored=_384;},isAnchored:function(){return this._isAnchored;},getDirect:function(){var _385=this._direct,t;if(typeof _385=="number"){return _385;}if(_385!==null&&_385!==undefined){var d=_383.Direction;switch(_385){case "mover_n":t=d.NORTH;break;case "mover_s":t=d.SOUTH;break;case "mover_w":t=d.WEST;break;case "mover_e":t=d.EAST;break;case "mover_nw":t=d.WESTNORTH;break;case "mover_ne":t=d.EASTNORTH;break;case "mover_sw":t=d.WESTSOUTH;break;case "mover_se":t=d.EASTSOUTH;break;default:t=d.NORTH;break;}this._direct=t;}return t;},draw:function(gp,_386,_387){var p=this.getCoordinate(),path=_383.Path;paths=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.LINE,points:p[2]},{command:path.LINE,points:p[3]}];gp.drawPath(paths,_386);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.SkeletonController"]){dojo._hasResource["drawboard.graph.decorate.controller.SkeletonController"]=true;dojo.provide("drawboard.graph.decorate.controller.SkeletonController");(function(){var _388=common.calc.Geometry,_389=common.utils.CollectionUtils;dojo.declare("drawboard.graph.decorate.controller.SkeletonContainer",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.SKELETON,draw:function(gp,_38a){var _38b,_38c=new drawboard.graph.decorate.Skeleton(),gf=_38a.getGraphic();dojo.forEach(gp.getSkeletonCoordinates(_38a)||[],function(item,_38d){_38b=_389.sliceRange(item,1,4);_38c.setCoordinate(_38b);_38c.setIndex(_38d);item[0].isAnchored&&_38c.anchored(item[0].isAnchored);_38c.draw(gf,this.getStyle(gp,_38c,_38a),_38a);},this);},isIn:function(ps,_38e,_38f){return _388.isPointInPolyn(ps,_38e);},active:function(gp,_390,_391){var _392,gs=gp.getGraphStrategy(),temp,_393;dojo.some(gp.getSkeletonCoordinates(_391)||[],function(item,_394){_393=item[0];temp=_389.sliceRange(item,1,4);if(this.isIn(temp,_390,_391)){_392=new drawboard.graph.decorate.Skeleton({coordinate:temp,index:_394,_direct:item[0].css,center:_393});gs.isAnchor(_392)&&_392.anchored(true);return true;}},this);return _392;},create:function(ps){var _395=[];dojo.forEach(ps||[],function(item,_396){_395.push(this.createItem(item,_396));},this);return _395;},createItem:function(ps,_397){var _398=new drawboard.graph.decorate.Skeleton({coordinate:_389.sliceRange(ps,1,4),index:_397,_direct:ps[0].css});ps[0].isAnchored&&_398.anchored(true);return _398;}});if(!drawboard.skeletonController){drawboard.skeletonController=new drawboard.graph.decorate.controller.SkeletonContainer();}})();}if(!dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DbDrawProcessor");(function(){dojo.declare("drawboard.drawProcessor.DbDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_399){if(gp.isComposite()&&!gp.isFocus()){return;}gp.draw(_399);if(gp.isActive()){drawboard.skeletonController.draw(gp,_399);drawboard.motionAnchorController.draw(gp,_399);drawboard.rotatorController.draw(gp,_399);}((_399.getShowMark()||gp.showMark())||gp.isActive()||gp.isActived())&&drawboard.markController.draw(gp,_399);},setActive:function(gp,p,only,_39a,_39b){var _39c=drawboard.Constant.ActionStatus,_39d,_39e;if(gp&&gp.isActive()){var _39f=[{controller:drawboard.skeletonController,status:_39c.RESIZING},{controller:drawboard.rotatorController,status:[_39c.POLEMOVING,_39c.ROTATING]},{controller:drawboard.markController,status:_39c.MARKING},{controller:drawboard.motionAnchorController,status:_39c.MOTION}],_3a0,_3a1,_3a2;dojo.some(_39f,function(item){_3a0=item.controller;if(only&&_3a0!=_39a){return;}if(!only&&_3a0==_39a){return;}_3a1=_3a0.active(gp,p,_39b);if(_3a1){_39d={};_3a2=item.status;if(dojo.isArray(_3a2)){if(_3a0.isInPole(gp,p,_39b)){_39d.status=_3a2[0];}else{_39d.status=_3a2[1];}}else{_39d.status=_3a2;}_39d.active=gp;_39d.decorate=_3a1;return true;}},this);}if(!_39d&&gp.isComposite()){return null;}if(!_39d&&gp.active(p,_39b)){_39e=this.getActiveParent(gp);_39d={};_39d.status=_39c.MOVING;if(_39e&&!_39e.isFocus()){gp=_39e;}_39d.active=gp;_39d.decorate=null;}return _39d;},getActiveParent:function(gp){var _3a3=(gp.getParent&&gp.getParent()),_3a4,_3a5;do{if(!_3a3||_3a3.isFocus()){_3a5=_3a4;break;}_3a4=_3a3;_3a3=(_3a4.getParent&&_3a4.getParent());}while(true);return _3a5;}});})();}if(!dojo._hasResource["drawboard.context.ExecuteContext"]){dojo._hasResource["drawboard.context.ExecuteContext"]=true;dojo.provide("drawboard.context.ExecuteContext");(function(){var _3a6=common.calc.Geometry;dojo.declare("drawboard.context.ExecuteContext",dijit._Widget,{zoom:{x:100,y:100},paramsCtrl:null,styleCtrl:null,commandCtrl:null,drawProcessor:null,getZoom:function(){return _3a6.dividePoint(this.zoom,{x:100,y:100})[0];},setZoom:function(rate){var zoom=_3a6.add2Points(this.zoom,rate);if(zoom.x<0||zoom.y<0||zoom.x>200||zoom.y>200){return false;}this.zoom=zoom;return true;},getParamsCtrl:function(){if(!this.paramsCtrl){new common.exception.Exception({msg:"the parameters controller in context doesnt' exist!"});}return this.paramsCtrl;},setParamsCtrl:function(_3a7){this.paramsCtrl=_3a7;},getCommandCtrl:function(){if(!this.commandCtrl){new common.exception.Exception({msg:"the command controller in context doesnt' exist!"});}return this.commandCtrl;},setCommandCtrl:function(_3a8){this.commandCtrl=_3a8;},setStyleCtrl:function(_3a9){if(!this.styleCtrl){new common.exception.Exception({msg:"the style controller in context doesnt' exist!"});}this.styleCtrl=_3a9;},getStyleCtrl:function(){return this.styleCtrl;},getDrawProcessor:function(){if(!this.drawProcessor){new common.exception.Exception({msg:"the draw processor in context doesnt' exist!"});}return this.drawProcessor;},setDrawProcessor:function(_3aa){this.drawProcessor=_3aa;}});})();}if(!dojo._hasResource["drawboard.runtime.ExecuteRuntime"]){dojo._hasResource["drawboard.runtime.ExecuteRuntime"]=true;dojo.provide("drawboard.runtime.ExecuteRuntime");dojo.declare("drawboard.runtime.ExecuteRuntime",[dijit._Widget,common.Cache,common.listener.Listener],{context:null,graphic:null,_showMark:false,setShowMark:function(_3ab){this._showMark=_3ab;},getShowMark:function(){return this._showMark;},apply:function(_3ac,_3ad){this[_3ac]&&this[_3ac].apply(this,_3ad);},createCache:function(){return {};},getCache:function(gp){var _3ae=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this),item=_3ae[gp.getIdty()];(!item)&&(_3ae[gp.getIdty()]=item={});return item;},addCache:function(gp,type,_3af){var _3b0=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this),item=_3b0[gp.getIdty()];(!item)&&(_3b0[gp.getIdty()]=item={});item[type]=_3af;},clearCache:function(gp,type){var _3b1=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this);if(type!==undefined&&type!==null){var item=_3b1[gp.getIdty()];if(item){item[type]=null;delete item[type];}this.fireListener(["clearCache",[gp,type]]);return;}_3b1[gp.getIdty()]=null;delete _3b1[gp.getIdty()];this.fireListener(["clearCache",[gp]]);},getContext:function(){if(!this.context){new common.exception.Exception({msg:"the context in runtime doesnt' exist!"});}return this.context;},setContext:function(_3b2){this.context=_3b2;},getGraphic:function(){if(!this.graphic){new common.exception.Exception({msg:"the graphic in runtime doesnt' exist!"});}return this.graphic;},setGraphic:function(gf){this.graphic=gf;},getDistance:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getDistance();},getRotateDistance:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getRotateDistance();},getRounder:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getRounder();},getDrawProcessor:function(){return this.getContext().getDrawProcessor();},draw:function(gp){this.getDrawProcessor().draw(gp,this);},zoom:function(gp,rate){gp.zoom(rate,this);}});}if(!dojo._hasResource["drawboard.controller.CommandController"]){dojo._hasResource["drawboard.controller.CommandController"]=true;dojo.provide("drawboard.controller.CommandController");dojo.declare("drawboard.controller.CommandController",common.container.MapContainer,{resouce:drawboardRuntimeSetting.commands,_undoList:null,_redoList:null,maxSteps:20,store:null,constructor:function(){var list=common.container.ListContainer;this._undoList=new list();this._redoList=new list();this.render();},getReadStore:function(){var _3b3=this.store;if(!_3b3){_3b3=new dojo.data.ItemFileReadStore({url:this.resouce});_3b3._forceLoad();this.store=_3b3;}return this.store;},render:function(){var _3b4=this.getReadStore(),type,_3b5,_3b6,_3b7;dojo.forEach(_3b4._getItemsArray(),function(item){type=_3b4.getValue(item,"type");_3b5=_3b4.getValue(item,"command");_3b6=_3b4.getValue(item,"desp0");_3b7=_3b4.getValue(item,"desp1");this.registerCommand(type,_3b5,_3b6,_3b7);},this);},registerCommand:function(type,_3b8,_3b9,_3ba){this.addItem(type,{command:_3b8,0:_3b9,1:_3ba});},instanceCommand:function(type,_3bb,memo,_3bc,_3bd){var item=this.getItem(type),_3be,_3bf;if(!item){new common.exception.Exception({msg:"the command type doesn't exsit!"});return;}_3bf=eval(item.command);_3be=new _3bf(_3bb,memo,_3bc);_3be.setDescription({0:item.desp0,1:item.desp1});_3be.setRuntime(_3bd);return _3be;},add:function(_3c0){var _3c1=this._undoList;_3c1.add(_3c0);if(_3c1.size()>this.maxSteps){_3c1.shift();}this._redoList.clearItems();},undo:function(){var _3c2=this._undoList.pop();if(!_3c2){return;}_3c2.unexecute();this._redoList.add(_3c2);},redo:function(){var _3c3=this._redoList.pop();if(!_3c3){return;}_3c3.execute();this._undoList.add(_3c3);}});}if(!dojo._hasResource["drawboard.DrawBoard"]){dojo._hasResource["drawboard.DrawBoard"]=true;dojo.provide("drawboard.DrawBoard");dojo.declare("drawboard.DrawBoard",[dijit._Templated,drawboard._Selector,drawboard._Event,common.listener.Listener],{templateString:"<div></div>",dbCanvas:null,graphicClass:drawboard.graphic.SVGGraphic,textBoardClass:drawboard.board.TextBoard,_textBoard:null,_graphic:null,w:null,h:null,defaultWidth:300,defaultHeight:300,_selectRect:null,_runtime:null,fixNode:null,SRGraphStrategyClass:"drawboard.graph.strategy.RectangleStrategy",graphStrategyParam:null,drawEntity:null,_commands:null,postCreate:function(){var _3c4=this.createGraphic(),node,_3c5=drawboard.controller,ctx,_3c6,w=this.w,h=this.h,_3c7=this.domNode.style;_3c6=dojo.create("div",{},this.domNode);_3c7.overflow="auto";_3c7.width=w+"px";_3c7.height=h+"px";_3c7.position="relative";this.dbCanvas=_3c6;node=_3c4.createAnchor(w||this.defaultWidth,h||this.defaultHeight,_3c6);ctx=new drawboard.context.ExecuteContext({paramsCtrl:new _3c5.ParamsController(),styleCtrl:new _3c5.StyleController(),commandCtrl:new _3c5.CommandController(),drawProcessor:new drawboard.drawProcessor.DbDrawProcessor()});this._textBoard=new this.textBoardClass({"_db":this});this.domNode.appendChild(this._textBoard.domNode);this._runtime=new drawboard.runtime.ExecuteRuntime({context:ctx,graphic:_3c4});drawboard.DrawBoard.superclass.postCreate.call(this,node);},ready:function(){return this.getGraphic().ready();},getTextBoard:function(){return this._textBoard;},getGraphic:function(){return this.getRuntime().getGraphic();},getRuntime:function(){return this._runtime;},setRuntime:function(_3c8){this._runtime=_3c8;},setGraphStrategyParam:function(_3c9){this.graphStrategyParam=_3c9;},getGraphStrategyParam:function(){return this.graphStrategyParam;},createGraphic:function(){if(!this._graphic){this._graphic=new this.graphicClass();}return this._graphic;},getDrawEntity:function(_3ca){if(!this.drawEntity&&_3ca){this.drawEntity={};}return this.drawEntity;},getCanvasSize:function(){var zoom=this.getRuntime().getContext().getZoom();return {x:this.w*zoom.x,y:this.h*zoom.y};},getUserViewSize:function(){var _3cb=this.domNode;return {x:_3cb.clientWidth,y:_3cb.clientHeight};},clearDrawEntity:function(_3cc){var _3cd=this.drawEntity,_3ce=this.graphStrategyParam;if(_3cd&&!_3cc){var gs=new drawboard.graph.GraphStatus({_coordinate:{x:_3cd.x,y:_3cd.y},_w:_3cd.width,_h:_3cd.height,affectedByZoom:(_3ce&&_3ce.affectedByZoom)}),gp=new drawboard.graph.GraphProxy(gs,this.getDrawType());_3ce&&_3ce.url&&(gs.setUrl(_3ce.url));_3ce&&_3ce.ratio&&(gs.setRatio(_3ce.ratio));this.addCommand(drawboard.Constant.Command.CREATEVSDELETECOMMAND,this,gp);}this.drawEntity=null;this.graphStrategyParam=null;},getSRGraphStrategyClass:function(){return this.SRGraphStrategyClass;},setSRGraphStrategyClass:function(_3cf){this.SRGraphStrategyClass=_3cf;},getSelectRect:function(){return this._selectRect;},setSelectRect:function(_3d0){var _3d1=this._selectRect;if(_3d0==_3d1){return;}_3d1&&_3d1.destroy();this._selectRect=_3d0;},containsSelectRect:function(_3d2){var _3d3=false;this.some(function(gp){if(gp.isComposite()&&gp.equals(_3d2)){_3d3=true;return true;}},this);return _3d3;},combine:function(){var _3d4=this.getSelectRect();_3d4&&!this.containsSelectRect(_3d4)&&!_3d4.resetRelations()&&this.combineGraph(_3d4);this._selectRect=null;},combineGraph:function(gp){this.add(gp);},divide:function(){var gp=this.getActive();this.divideGraph(gp);},divideGraph:function(gp){if(gp&&gp.isComposite()){gp.destroy();this.remove(gp);}},addGraph:function(gs,_3d5){var _3d6=new drawboard.graph.GraphProxy(gs,_3d5);this.add(_3d6);},removeGraph:function(gp){gp.deleteAll(this,this.getRuntime());this.getRuntime().getContext().getStyleCtrl().removeGraph(gp);this.remove(gp);},getGraph:function(idty){var gs;this.some(function(item){if(item.getIdty()==idty){gs=item;return true;}});return gs;},zoom:function(rate,_3d7){var _3d8=dojo.clone(_3d7.getContext().getZoom());if(!_3d7.getContext().setZoom(rate)){return;}var zoom=_3d7.getContext().getZoom(),_3d9=this.dbCanvas.style,gf=this.getGraphic(),w=this.w*zoom.x,h=this.h*zoom.y,_3da=this.domNode,_3db=common.calc.Geometry,_3dc=this.getSelectRect(),_3dd;_3dd={x:_3da.scrollLeft+(this.w>>1),y:_3da.scrollTop+(this.h>>1)};_3dd=_3db.dividePoint(_3dd,_3d8)[0];_3dd=_3db.multiPoint(_3dd,zoom)[0];_3d9.width=w+"px";_3d9.height=h+"px";_3da.scrollLeft=_3dd.x-(this.w>>1);_3da.scrollTop=_3dd.y-(this.h>>1);gf.setSize(w,h);this.forInItems(function(gp){gp&&_3d7.zoom(gp,zoom);},this,true);_3dc&&_3d7.zoom(_3dc,zoom);this.fireListener(["zoom",[rate]]);},draw:function(){this.clearGraphs();var _3de=this.getSelectRect(),_3df=this.getDrawEntity(),_3e0=this.getRuntime();this.drawGraphs(_3e0);if(_3df){var gs=new drawboard.graph.GraphStatus({_coordinate:{x:_3df.x,y:_3df.y},_w:_3df.width,_h:_3df.height}),_3e1=new drawboard.graph.GraphProxy(gs,this.getDrawType()||this.getSRGraphStrategyClass()),_3e2=this.graphStrategyParam;_3e2&&_3e2.url&&(gs.setUrl(_3e2.url));_3e2&&_3e2.ratio&&(gs.setRatio(_3e2.ratio));_3e1.showMark(false);_3e0.draw(_3e1);}_3de&&(_3e0.draw(_3de));this.fireListener(["draw"]);},drawGraphs:function(_3e3){this.forInItems(function(gp){gp&&_3e3.draw(gp);},this);},clearGraphs:function(){this.getGraphic().clear();},setStyle:function(_3e4,_3e5,_3e6){var gp=this.getActive();if(_3e6&&gp&&!gp.getText()){return;}gp&&this.addCommand(drawboard.Constant.Command.STYLECOMMAND,this.getRuntime().getContext().getStyleCtrl(),{gp:gp,attr:_3e4,value:_3e5,isText:_3e6});this.clearCommand();this.draw();},setText:function(text){this.last().setText(text);},getCommandCtrl:function(){return this.getRuntime().getContext().getCommandCtrl();},getCommands:function(){var _3e7=this._commands;if(!_3e7){_3e7=this._commands=new drawboard.command.CompositeCommand();this.getCommandCtrl().add(_3e7);}return _3e7;},addCommand:function(type,_3e8,memo,_3e9){var _3ea=this.getCommandCtrl().instanceCommand(type,_3e8,memo,_3e9,this.getRuntime());_3ea.execute();this.getCommands().add(_3ea);},clearCommand:function(){this._commands=null;},undo:function(){this.getCommandCtrl().undo();this.draw();},redo:function(){this.getCommandCtrl().redo();this.draw();}});}if(!dojo._hasResource["drawboard.drawProcessor.ZoomDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.ZoomDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.ZoomDrawProcessor");(function(){dojo.declare("drawboard.drawProcessor.ZoomDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_3eb){gp.draw(_3eb);}});})();}if(!dojo._hasResource["drawboard.ZoomDrawBoard"]){dojo._hasResource["drawboard.ZoomDrawBoard"]=true;dojo.provide("drawboard.ZoomDrawBoard");(function(){var _3ec=common.calc.Geometry,_3ed=drawboard.Constant.MouseAction,_3ee=_3ec.subtract2Points;dojo.declare("drawboard.ZoomDrawBoard",[dijit._Widget,dijit._Templated],{templateString:"<div style='position:relative;overflow:hidden;'><div dojoAttachPoint='zoomDrawboard'></div><div dojoAttachPoint='zoomRect' style='position:absolute;border:2px solid red;left:0px;top:0px;'></div></div>",graphicClass:drawboard.graphic.SVGGraphic,_graphic:null,anchor:null,w:null,h:null,_zoom:{x:100,y:100},rectBorder:2,defaultWidth:300,defaultHeight:300,_runtime:null,drawboard:null,events:null,boxCache:null,scopeSelf:false,postCreate:function(){var _3ef=this.createGraphic(),node,_3f0=drawboard.controller,ctx,db=this.getDrawBoard(),_3f1,_3f2=this.zoomRect,_3f3=this.domNode,_3f4=this.rectBorder,w=this.w||this.defaultWidth,h=this.h||this.defaultHeight;node=_3ef.createAnchor(w,h);this.anchor=node;ctx=new drawboard.context.ExecuteContext({paramsCtrl:new _3f0.ParamsController(),styleCtrl:new _3f0.StyleController(),drawProcessor:new drawboard.drawProcessor.ZoomDrawProcessor(),zoom:{x:50,y:50}});this._runtime=_3f1=new drawboard.runtime.ExecuteRuntime({context:ctx,graphic:_3ef});this.zoomDrawboard.appendChild(this.anchor);_3f2.style.width=w+"px";_3f2.style.height=h+"px";_3f3.style.width=w+(_3f4<<1)+"px";_3f3.style.height=h+(_3f4<<1)+"px";this.events=[dojo.connect(_3f2,"onmousemove",dojo.hitch(this,"doMouseMove")),dojo.connect(_3f2,"onmousedown",dojo.hitch(this,"doMouseDown")),dojo.connect(_3f2,"onmouseup",dojo.hitch(this,"doMouseUp"))];db.addListener(this.apply,this);db.getRuntime().addListener(_3f1.apply,_3f1);},getDrawBoard:function(){if(!this.drawboard){new common.exception.Exception({msg:"the draw board can't find in the zoom window!"});}return this.drawboard;},setDrawBoard:function(_3f5){this.drawboard=_3f5;},setZoom:function(rate){var zoom=_3ee(this._zoom,{x:rate.x,y:rate.y});if(zoom.x<0||zoom.y<0||zoom.x>200||zoom.y>200){return false;}this._zoom=zoom;return true;},getZoom:function(){return _3ec.dividePoint(this._zoom,{x:100,y:100})[0];},getGraphic:function(){return this.getRuntime().getGraphic();},getRuntime:function(){return this._runtime;},setRuntime:function(_3f6){this._runtime=_3f6;},createGraphic:function(){return new this.graphicClass();},apply:function(_3f7,_3f8){this[_3f7]&&this[_3f7].apply(this,_3f8);},zoom:function(rate){this._unitCache=null;if(!this.setZoom(rate)){return;}this.scopeSelf=true;var _3f9=this.zoomRect,zoom=this.getDrawBoard().getRuntime().getContext().getZoom(),_3fa=_3f9.style,w=this.w,h=this.h,rw=w/(zoom.x),rh=h/(zoom.y);_3fa.left=parseFloat(_3fa.left)+(parseFloat(_3fa.width)>>1)-(rw>>1)+"px";_3fa.top=parseFloat(_3fa.top)+(parseFloat(_3fa.height)>>1)-(rh>>1)+"px";_3fa.width=rw+"px";_3fa.height=rh+"px";this.draw();},draw:function(){this.clearGraphs();var db=this.getDrawBoard();db.drawGraphs(this.getRuntime());},clearGraphs:function(){var _3fb=this.anchor;while(_3fb.lastChild){_3fb.removeChild(_3fb.lastChild);}},getBoxCache:function(){if(!this.boxCache){var node=this.domNode,_3fc={left:node.offsetLeft,top:node.offsetTop};this.boxCache=_3fc;}return this.boxCache;},fetchCoordinate:function(e){var box=this.getBoxCache(),_3fd=this.domNode;return {x:e.pageX-box.left+_3fd.scrollLeft,y:e.pageY-box.top+_3fd.scrollTop};},getUnitPx:function(){if(!this._unitCache){var db=this.getDrawBoard(),_3fe=db.getCanvasSize(),_3ff=db.getUserViewSize(),_400=this.zoomRect.style;this._unitCache={x:(_3fe.x-_3ff.x)/(this.w-parseFloat(_400.width)),y:(_3fe.y-_3ff.y)/(this.h-parseFloat(_400.height))};}return this._unitCache;},status:_3ed.NONE,_start:null,_end:null,_loseAccuracyLeft:0,_loseAccuracyTop:0,_accuracy:100000,doMouseMove:function(e){if(this.status!=_3ed.MOUSEDOWN&&this.status!=_3ed.MOUSEMOVE){return;}var end=this.fetchCoordinate(e),_401=_3ee(end,this._start),_402=this.zoomRect.style,db=this.getDrawBoard(),_403=db.domNode,unit=this.getUnitPx(),temp,_404=this._accuracy,top=parseFloat(_402.top)+_401.y,left=parseFloat(_402.left)+_401.x,_405=db.getCanvasSize(),_406=db.getUserViewSize(),_407=parseFloat(_402.width),_408=parseFloat(_402.height);this._start=end;(top<0)&&(top=0);(left<0)&&(left=0);this.scopeSelf=true;_402.top=top+"px";_402.left=left+"px";if(left==0){_403.scrollLeft=0;this._loseAccuracyLeft=0;}else{if((left+_407)>this.w){_403.scrollLeft=_405.x-_406.x;_402.left=this.w-_407+"px";}else{_403.scrollLeft=temp=_403.scrollLeft+_401.x*unit.x;temp=(temp*_404-parseInt(temp)*_404)/_404;this._loseAccuracyLeft=temp=this._loseAccuracyLeft+temp;if(temp>=1){_403.scrollLeft+=1;this._loseAccuracyLeft=temp-1;}}}if(top==0){_403.scrollTop=0;this._loseAccuracyTop=0;}else{if((top+_408)>this.h){_403.scrollTop=_405.y-_406.y;_402.top=this.h-_408+"px";}else{_403.scrollTop=temp=_403.scrollTop+_401.y*unit.y;temp=(temp*_404-parseInt(temp)*_404)/_404;this._loseAccuracyTop=temp=this._loseAccuracyTop+temp;if(temp>=1){_403.scrollTop+=1;this._loseAccuracyTop=temp-1;}}}this.status=_3ed.MOUSEMOVE;},doMouseDown:function(e){this._start=this.fetchCoordinate(e);this.status=_3ed.MOUSEDOWN;},doMouseUp:function(e){this.status=_3ed.MOUSEUP;},doScroll:function(_409,_40a){if(this.scopeSelf){this.scopeSelf=false;return;}var _40b=this.zoomRect.style,unit=this.getUnitPx();if(_409){_40b.left=parseFloat(_40b.left)+_40a/unit.x+"px";}else{_40b.top=parseFloat(_40b.top)+_40a/unit.y+"px";}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);}});})();}
