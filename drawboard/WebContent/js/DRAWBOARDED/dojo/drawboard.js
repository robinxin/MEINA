/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["drawboard.controller.StyleController"]){dojo._hasResource["drawboard.controller.StyleController"]=true;dojo.provide("drawboard.controller.StyleController");(function(){dojo.declare("drawboard.controller.StyleController",common.container.MapContainer,{_style:"fill:none;stroke:black;stroke-width:1",_activeStyle:"fill:none;stroke:red;stroke-width:1",resultIdentity:"serializeStr",actives:null,activedGp:null,setActives:function(_1,gp){this.actives=_1;this.activedGp&&this.activedGp.isActived(false);gp&&gp.isActived(true)&&(this.activedGp=gp);},getActives:function(){return this.actives;},init:function(_2){this._style=_2;},getDefaultStyle:function(){return this._style;},getGraphStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return this.getDefaultStyle();}return gs[this.resultIdentity];},getGraphStyleValue:function(gp,_3){var _4=this.getItem(gp.getIdty());if(_4){return _4[_3];}return null;},containGraphStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return false;}return true;},addGraphStyle:function(gp,_5,_6){if(gp.isComposite()){return;}var gs=this.getItem(gp.getIdty());if(!gs){gs={fill:"none"};this.addItem(gp.getIdty(),gs);}gs[_5]=_6;gs[this.resultIdentity]=this.serialize(gs);},removeGraphStyle:function(gp,_7){if(gp.isComposite()){return;}var gs=this.getItem(gp.getIdty());if(!gs||!gs[_7]){return;}delete gs[_7];gs[this.resultIdentity]=this.serialize(gs);},removeGraph:function(gp){var _8=gp.getIdty(),gs=this.getItem(_8);if(!gs){return;}this.removeItem(_8);},serialize:function(sj){var _9=[];for(var _a in sj){if(_a!=this.resultIdentity){_9.push([_a,":",sj[_a]].join(""));}}if(!sj["stroke"]){_9.push(["stroke",":","black"].join(""));}if(!sj["stroke-width"]){_9.push(["stroke-width",":","1"].join(""));}if(!sj["fill"]){_9.push(["fill",":","none"].join(""));}return _9.join(";");},getStyle:function(_b,gp,d){var _c=this.getActives(),_d=false;if(d&&_c){dojo.some(_c,function(_e){if(_e.equal(d)){_d=true;}},this);if(_d){return this._activeStyle;}}return this.getGraphStyle(gp);}});})();}if(!dojo._hasResource["drawboard.Constant"]){dojo._hasResource["drawboard.Constant"]=true;dojo.provide("drawboard.Constant");drawboard.Constant={MouseAction:{NONE:0,MOUSEDOWN:1,MOUSEMOVE:2,MOUSEUP:3,MOUSEOVER:4,MOUSECLICK:5,MOUSEOUT:6},ActionStatus:{NONE:0,SELECTING:1,DRAWING:2,MOVING:3,MARKING:4,RESIZING:5,ROTATING:6,POLEMOVING:7,MOTION:8},Decorate:{SKELETON:0,MARK:1,ROTATOR:2,MOTIONANCHOR:3,CHARACTER:4,Graph:5,CENTER:6},Direction:{EAST:0,EASTNORTH:1,NORTH:2,WESTNORTH:3,WEST:4,WESTSOUTH:5,SOUTH:6,EASTSOUTH:7,END:8},Path:{NONE:"",MOVE:"M",RMOVE:"m",LINE:"L",RLINE:"l",HORIZON:"H",RHORIZON:"h",VERTICAL:"V",RVERTICAL:"v",CUBIC:"C",RCUBIC:"c",CUBICSMOOTH:"S",CUBICRSMOOTH:"s",QUADRATIC:"Q",RQUADRATIC:"q",QUADRATICSMOOTH:"T",RQUADRATICSMOOTH:"t",ARC:"A",RARC:"a",CLOSE:"Z",RCLOSE:"z"},Command:{CREATEVSDELETECOMMAND:"createvsdelete",RESIZECOMMAND:"resize",MOVECOMMAND:"move",ROTATECOMMAND:"rotate",ZOOMCOMMAND:"zoom",STYLECOMMAND:"style",ADDVSDELTECONSTRAINCOMMAND:"addvsdeleteconstrain",COMBINEVSDEVIDEDCOMMAND:"combinevsdevided",COMPOSITECOMMAND:"composite"},Symbol:{concat:"&&"},Toolbar:{COLORPALETTE:0,DROPDOWNLIST:1}};}if(!dojo._hasResource["drawboard.graph.strategy.GraphStrategy"]){dojo._hasResource["drawboard.graph.strategy.GraphStrategy"]=true;dojo.provide("drawboard.graph.strategy.GraphStrategy");(function(){var _f=drawboard.Constant;dojo.declare("drawboard.graph.strategy.GraphStrategy",null,{type:_f.Decorate.Graph,_hasRotator:true,hasRotator:function(){return this._hasRotator;},getRotatorCoordinate:function(gp,_10){return null;},getActiveAnchors:function(gp,_11){return null;},isAnchor:function(d){return false;},isIn:function(gp,_12,_13){},draw:function(gp,gf,_14){},sizeChange:function(gp,_15,_16,_17){var d=_f.Direction,p=gp.getCoordinate(_17),w=gp.getWidth(_17),h=gp.getHeight(_17),_18=_16.x,_19=_16.y,_1a=_15.getDirect();switch(_1a){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+_19},_17);gp.setHeight(h-_19,_17);break;case d.SOUTH:gp.setHeight(h+_19,_17);break;case d.WEST:gp.setCoordinate({x:p.x+_18,y:p.y},_17);gp.setWidth(w-_18,_17);break;case d.EAST:gp.setWidth(w+_18,_17);break;case d.WESTNORTH:gp.setCoordinate({x:p.x+_18,y:p.y+_19},_17);gp.setWidth(w-_18,_17);gp.setHeight(h-_19,_17);break;case d.EASTNORTH:gp.setCoordinate({x:p.x,y:p.y+_19},_17);gp.setWidth(w+_18,_17);gp.setHeight(h-_19,_17);break;case d.EASTSOUTH:gp.setWidth(w+_18,_17);gp.setHeight(h+_19,_17);break;case d.WESTSOUTH:gp.setCoordinate({x:p.x+_18,y:p.y},_17);gp.setWidth(w-_18,_17);gp.setHeight(h+_19,_17);break;case d.END:break;default:break;}this._sizeChange(gp,_15,_16,_17);},_sizeChange:function(gp,_1b,_1c,_1d){},getGraphCoordinates:function(gp,_1e){},getSkeletonCoordinates:function(gp,_1f){var _20=gp.getCoordinate(_1f),w=gp.getWidth(_1f),h=gp.getHeight(_1f),x=_20.x,y=_20.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y,css:"mover_ne"},{x:x,y:y+h,css:"mover_sw"},{x:x+w,y:y+h,css:"mover_se"},{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"},{x:x+w,y:y+(h>>1),css:"mover_e"}];},calcMotionAnchor:function(gp,_21,_22,_23){},getMotionAnchorCoordinates:function(gp,_24){},getMarkCoordinates:function(gp,_25){var _26=gp.getCoordinate(_25),w=gp.getWidth(_25),h=gp.getHeight(_25),_27=gp.getRealMarks(_25),x=_26.x,y=_26.y;if(!_27){return [{x:x+(w>>1),y:y},{x:x+(w>>1),y:y+h},{x:x,y:y+(h>>1)},{x:x+w,y:y+(h>>1)}];}var _28=[_27[0]||{x:x+(w>>1),y:y},_27[1]||{x:x+(w>>1),y:y+h},_27[2]||{x:x,y:y+(h>>1)},_27[3]||{x:x+w,y:y+(h>>1)}];for(var i=4;i<_27.length;i++){_28.push(_27[i]);}return _28;},getStyle:function(gp,_29){return _29.getContext().getStyleCtrl().getStyle(this.type,gp);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.ImageStrategy"]){dojo._hasResource["drawboard.graph.strategy.ImageStrategy"]=true;dojo.provide("drawboard.graph.strategy.ImageStrategy");(function(){var _2a=common.calc.Geometry,_2b=drawboard.Constant;dojo.declare("drawboard.graph.strategy.ImageStrategy",drawboard.graph.strategy.GraphStrategy,{getGraphCoordinates:function(gp,_2c){var _2d=gp.getCoordinate(_2c),w=gp.getWidth(_2c),h=gp.getHeight(_2c),x=_2d.x,y=_2d.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_2e,_2f){return _2a.isPointInPolyn(gp.getGraphCoordinates(_2f),_2e);},draw:function(gp,gf,_30){var p=_2b.Path,_31=gp.getGraphRotator(_30),a=_31.angle,_32=_31.coordinate,_33=["translate("+_32.x+","+_32.y+")","rotate("+a+")","translate("+-_32.x+","+-_32.y+")"];gf.drawImage(gp.getCoordinate(_30),gp.getWidth(_30),gp.getHeight(_30),gp.getUrl(),(a!=0)&&{transform:_33},this.getStyle(gp,_30));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RatioStrategy"]){dojo._hasResource["drawboard.graph.strategy.RatioStrategy"]=true;dojo.provide("drawboard.graph.strategy.RatioStrategy");(function(){var _34=common.calc.Geometry,_35=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RatioStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_36,_37){},draw:function(gp,gf,_38){},getGraphCoordinates:function(gp,_39){var _3a=gp.getRatio(),w=gp.getWidth(_39),h=gp.getHeight(_39),_3b;if(!_3a){return this._getGraphCoordinates(gp,_39,w,h);}_3b=h*_3a;if(_3b>w){h=w/_3a;}else{w=_3b;}gp.setWidth(w,_39);gp.setHeight(h,_39);return this._getGraphCoordinates(gp,_39,w,h);},_getGraphCoordinates:function(gp,_3c,w,h){},sizeChange:function(gp,_3d,_3e,_3f){var d=_35.Direction,_40=gp.getRatio(),p=gp.getCoordinate(_3f),w=gp.getWidth(_3f),h=gp.getHeight(_3f),_41=_3d.getDirect(),_42;if(_40){_42=h*_40;if(_42>w){h=w/_40;}else{w=_42;}}switch(_41){case d.NORTH:_3e=_3e.y;gp.setCoordinate({x:p.x+(_3e>>1),y:p.y+(_3e)},_3f);gp.setWidth(w-(_3e),_3f);gp.setHeight(h-(_3e),_3f);break;case d.WESTNORTH:_3e=Math.abs(_3e.x)>Math.abs(_3e.y)?_3e.y:_3e.x,gp.setCoordinate({x:p.x+_3e,y:p.y+_3e},_3f);gp.setWidth(w-_3e,_3f);gp.setHeight(h-_3e,_3f);break;case d.EASTNORTH:_3e=_3e.y;gp.setCoordinate({x:p.x,y:p.y+_3e},_3f);gp.setWidth(w-_3e,_3f);gp.setHeight(h-_3e,_3f);break;case d.SOUTH:_3e=_3e.y;gp.setCoordinate({x:p.x-(_3e>>1),y:p.y},_3f);gp.setWidth(w+(_3e),_3f);gp.setHeight(h+(_3e),_3f);break;case d.EASTSOUTH:_3e=Math.abs(_3e.x)>Math.abs(_3e.y)?_3e.y:_3e.x,gp.setCoordinate({x:p.x,y:p.y},_3f);gp.setWidth(w+_3e,_3f);gp.setHeight(h+_3e,_3f);break;case d.WESTSOUTH:_3e=_3e.x;gp.setCoordinate({x:p.x+_3e,y:p.y},_3f);gp.setWidth(w-_3e,_3f);gp.setHeight(h-_3e,_3f);break;case d.WEST:_3e=_3e.x;gp.setCoordinate({x:p.x+_3e,y:p.y+(_3e>>1)},_3f);gp.setWidth(w-(_3e),_3f);gp.setHeight(h-(_3e),_3f);break;case d.EAST:_3e=_3e.x;gp.setCoordinate({x:p.x,y:p.y-(_3e>>1)},_3f);gp.setWidth(w+(_3e),_3f);gp.setHeight(h+(_3e),_3f);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RatioImageStrategy"]){dojo._hasResource["drawboard.graph.strategy.RatioImageStrategy"]=true;dojo.provide("drawboard.graph.strategy.RatioImageStrategy");(function(){var _43=common.calc.Geometry,_44=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RatioImageStrategy",drawboard.graph.strategy.RatioStrategy,{_getGraphCoordinates:function(gp,_45,w,h){var _46=gp.getCoordinate(_45),x=_46.x,y=_46.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_47,_48){return _43.isPointInPolyn(gp.getGraphCoordinates(_48),_47);},draw:function(gp,gf,_49){var p=_44.Path,_4a=gp.getGraphRotator(_49),a=_4a.angle,_4b=_4a.coordinate,_4c=["translate("+_4b.x+","+_4b.y+")","rotate("+a+")","translate("+-_4b.x+","+-_4b.y+")"];gp.getGraphCoordinates(_49);gf.drawImage(gp.getCoordinate(_49),gp.getWidth(_49),gp.getHeight(_49),gp.getUrl(),(a!=0)&&{transform:_4c},this.getStyle(gp,_49));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RectangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RectangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RectangleStrategy");(function(){var _4d=common.calc.Geometry,_4e=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RectangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_4f,_50){return _4d.isPointInPolyn(gp.getGraphCoordinates(_50),_4f);},draw:function(gp,gf,_51){var p=_4e.Path,_52=gp.getGraphCoordinates(_51);gf.drawPath([{command:p.MOVE,points:_52[0]},{command:p.LINE,points:_52[1]},{command:p.LINE,points:_52[2]},{command:p.LINE,points:_52[3]}],this.getStyle(gp,_51));},getGraphCoordinates:function(gp,_53){var _54=gp.getCoordinate(_53),w=gp.getWidth(_53),h=gp.getHeight(_53),x=_54.x,y=_54.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.SquareStrategy"]){dojo._hasResource["drawboard.graph.strategy.SquareStrategy"]=true;dojo.provide("drawboard.graph.strategy.SquareStrategy");(function(){var _55=common.calc.Geometry,_56=drawboard.Constant;dojo.declare("drawboard.graph.strategy.SquareStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_57,_58){return _55.isPointInPolyn(gp.getGraphCoordinates(_58),_57);},draw:function(gp,gf,_59){var p=_56.Path,_5a=gp.getGraphCoordinates(_59);gf.drawPath([{command:p.MOVE,points:_5a[0]},{command:p.LINE,points:_5a[1]},{command:p.LINE,points:_5a[2]},{command:p.LINE,points:_5a[3]}],this.getStyle(gp,_59));},getGraphCoordinates:function(gp,_5b){var _5c=gp.getCoordinate(_5b),w=gp.getWidth(_5b),h=gp.getHeight(_5b),min=w>h?h:w,x=_5c.x,y=_5c.y;gp.setWidth(min,_5b);gp.setHeight(min,_5b);return [{x:x,y:y},{x:x+min,y:y},{x:x+min,y:y+min},{x:x,y:y+min}];},sizeChange:function(gp,_5d,_5e,_5f){var d=_56.Direction,p=gp.getCoordinate(_5f),w=gp.getWidth(_5f),h=gp.getHeight(_5f),min=w>h?h:w,_60=_5d.getDirect();switch(_60){case d.NORTH:_5e=_5e.y;gp.setCoordinate({x:p.x+(_5e>>1),y:p.y+(_5e)},_5f);gp.setWidth(min-(_5e),_5f);gp.setHeight(min-(_5e),_5f);break;case d.WESTNORTH:_5e=Math.abs(_5e.x)>Math.abs(_5e.y)?_5e.y:_5e.x,gp.setCoordinate({x:p.x+_5e,y:p.y+_5e},_5f);gp.setWidth(min-_5e,_5f);gp.setHeight(min-_5e,_5f);break;case d.EASTNORTH:_5e=_5e.y;gp.setCoordinate({x:p.x,y:p.y+_5e},_5f);gp.setWidth(min-_5e,_5f);gp.setHeight(min-_5e,_5f);break;case d.SOUTH:_5e=_5e.y;gp.setCoordinate({x:p.x-(_5e>>1),y:p.y},_5f);gp.setWidth(min+(_5e),_5f);gp.setHeight(min+(_5e),_5f);break;case d.EASTSOUTH:_5e=Math.abs(_5e.x)>Math.abs(_5e.y)?_5e.y:_5e.x,gp.setCoordinate({x:p.x,y:p.y},_5f);gp.setWidth(min+_5e,_5f);gp.setHeight(min+_5e,_5f);break;case d.WESTSOUTH:_5e=_5e.x;gp.setCoordinate({x:p.x+_5e,y:p.y},_5f);gp.setWidth(min-_5e,_5f);gp.setHeight(min-_5e,_5f);break;case d.WEST:_5e=_5e.x;gp.setCoordinate({x:p.x+_5e,y:p.y+(_5e>>1)},_5f);gp.setWidth(min-(_5e),_5f);gp.setHeight(min-(_5e),_5f);break;case d.EAST:_5e=_5e.x;gp.setCoordinate({x:p.x,y:p.y-(_5e>>1)},_5f);gp.setWidth(min+(_5e),_5f);gp.setHeight(min+(_5e),_5f);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.OvalStrategy"]){dojo._hasResource["drawboard.graph.strategy.OvalStrategy"]=true;dojo.provide("drawboard.graph.strategy.OvalStrategy");(function(){var _61=common.calc.Geometry,_62=drawboard.Constant;dojo.declare("drawboard.graph.strategy.OvalStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_63,_64){var w=gp.getWidth(_64),h=gp.getHeight(_64),r=w>h?h>>1:w>>1;return _61.isPointInCircle(_63,{coordinate:gp.getGraphCoordinates(_64)[0],r:r});},draw:function(gp,gf,_65){var _66=gp.getGraphCoordinates(_65),w=gp.getWidth(_65),h=gp.getHeight(_65),p=_62.Path,_67=[];_67[0]=[p.MOVE,_66[0].x-(w>>1)," ",_66[0].y].join("");_67[1]=[p.RARC,(w>>1)," ",(h>>1)," 0 1,1 1 0"].join("");gf.drawPath(_67,this.getStyle(gp,_65));},getGraphCoordinates:function(gp,_68){var p=gp.getCoordinate(_68),w=gp.getWidth(_68),h=gp.getHeight(_68),_69=[{x:p.x+w,y:p.y+h}];return _69;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.CircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.CircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.CircleStrategy");(function(){var _6a=common.calc.Geometry;dojo.declare("drawboard.graph.strategy.CircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_6b,_6c){var w=gp.getWidth(_6c),h=gp.getHeight(_6c),r=w>h?h>>1:w>>1;return _6a.isPointInCircle(_6b,{coordinate:gp.getGraphCoordinates(_6c)[0],r:r});},draw:function(gp,gf,_6d){var _6e=gp.getGraphCoordinates(_6d),w=gp.getWidth(_6d),h=gp.getHeight(_6d),r=w>h?h>>1:w>>1;gf.drawCircle(_6e[0],r,this.getStyle(gp,_6d));},getGraphCoordinates:function(gp,_6f){var p=gp.getCoordinate(_6f),w=gp.getWidth(_6f),h=gp.getHeight(_6f),min=w>h?h:w,r=min>>1,_70=[{x:p.x+r,y:p.y+r}];gp.setWidth(min,_6f);gp.setHeight(min,_6f);return _70;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.MotionCircleStrategy");(function(){var _71=common.calc.Geometry,_72=drawboard.Constant;dojo.declare("drawboard.graph.strategy.MotionCircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_73,_74){var w=gp.getWidth(_74),h=gp.getHeight(_74),r=w>h?h>>1:w>>1;return _71.isPointInCircle(_73,{coordinate:gp.getGraphCoordinates(_74)[0],r:r});},draw:function(gp,gf,_75){var p=_72.Path,w=gp.getWidth(_75),h=gp.getHeight(_75),r=w>h?h>>1:w>>1,_76=gp.getGraphCoordinates(_75),_77=gp.getMotionAnchorCoordinates(_75),a=_71.angle(_77[0][0],_76[0],_77[1][0]),arc=[p.ARC+r,r,0,(a<180?0:1)+",1",_77[1][0].x+" "+_77[1][0].y];gf.drawPath([{command:p.MOVE,points:_77[0][0]},arc.join(" ")],this.getStyle(gp,_75),true);},getGraphCoordinates:function(gp,_78){var p=gp.getCoordinate(_78),w=gp.getWidth(_78),h=gp.getHeight(_78),r=w>h?h>>1:w>>1,min=w>h?h:w,_79=[{x:p.x+r,y:p.y+r}];gp.setWidth(min,_78);gp.setHeight(min,_78);return _79;},getMotionAnchorCoordinates:function(gp,_7a){var _7b=gp.getRealMotionAnchors(_7a),_7c=[],gs,w=gp.getWidth(_7a),_7d=gp.getCoordinate(_7a),_7e=_71.rotation,_7f=gp.getGraphCoordinates(_7a)[0];_7d.x+=(w>>1);if(!_7b){_7b=[10,100];gs=gp.getGraphStatus();gs.setMotionAnchors(_7b,_7a);}dojo.forEach(_7b,function(_80){_7c.push(_7e(_7d,_7f,_80));},this);return _7c;},calcMotionAnchor:function(gp,_81,_82,_83){var w=gp.getWidth(_83),h=gp.getHeight(_83),r=w>h?h>>1:w>>1,_84=gp.getCoordinate(_83),_85=gp.getGraphCoordinates(_83),_86=_71.intersectCircleLine(_85[0],r,_85[0],_82)[0];_84.x+=(w>>1);return _71.angle(_84,_85[0],_86);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RounderRectangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RounderRectangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RounderRectangleStrategy");(function(){var _87=common.calc.Geometry,_88=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RounderRectangleStrategy",drawboard.graph.strategy.GraphStrategy,{getGraphCoordinates:function(gp,_89){var _8a=gp.getCoordinate(_89),h=gp.getHeight(_89),w=gp.getWidth(_89),x=_8a.x,y=_8a.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_8b,_8c){return _87.isPointInPolyn(gp.getGraphCoordinates(_8c),_8b);},draw:function(gp,gf,_8d){var p=_88.Path,_8e=gp.getGraphRotator(_8d),a=_8e.angle,_8f=_8e.coordinate,r=_8d.getRounder(),_90=["translate("+_8f.x+","+_8f.y+")","rotate("+a+")","translate("+-_8f.x+","+-_8f.y+")"];gf.drawRect(gp.getCoordinate(_8d),gp.getWidth(_8d),gp.getHeight(_8d),r,(a!=0)&&{transform:_90},this.getStyle(gp,_8d));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RounderSquareStrategy"]){dojo._hasResource["drawboard.graph.strategy.RounderSquareStrategy"]=true;dojo.provide("drawboard.graph.strategy.RounderSquareStrategy");(function(){var _91=common.calc.Geometry,_92=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RounderSquareStrategy",drawboard.graph.strategy.SquareStrategy,{draw:function(gp,gf,_93){var p=_92.Path,_94=gp.getGraphRotator(_93),a=_94.angle,_95=_94.coordinate,w=gp.getWidth(_93),h=gp.getHeight(_93),min=w>h?h:w,r=_93.getRounder(),_96=["translate("+_95.x+","+_95.y+")","rotate("+a+")","translate("+-_95.x+","+-_95.y+")"];gp.getGraphCoordinates(_93);gf.drawRect(gp.getCoordinate(_93),min,min,r,(a!=0)&&{transform:_96},this.getStyle(gp,_93));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.TriangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.TriangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.TriangleStrategy");(function(){var _97=common.calc.Geometry,_98=drawboard.Constant;dojo.declare("drawboard.graph.strategy.TriangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_99,_9a){return _97.isPointInPolyn(gp.getGraphCoordinates(_9a),_99);},draw:function(gp,gf,_9b){var p=_98.Path,_9c=gp.getGraphCoordinates(_9b);gf.drawPath([{command:p.MOVE,points:_9c[0]},{command:p.LINE,points:_9c[1]},{command:p.LINE,points:_9c[2]}],this.getStyle(gp,_9b));},getGraphCoordinates:function(gp,_9d){var _9e=gp.getCoordinate(_9d),w=gp.getWidth(_9d),h=gp.getHeight(_9d),x=_9e.x,y=_9e.y;return [{x:x+(w>>1),y:y},{x:x,y:y+h},{x:x+w,y:y+h}];},getMarkCoordinates:function(gp,_9f){var _a0=gp.getCoordinate(_9f),w=gp.getWidth(_9f),h=gp.getHeight(_9f),_a1=gp.getRealMarks(_9f),x=_a0.x,y=_a0.y;if(!_a1){return [{x:x+(w>>1),y:y},{x:x,y:y+h},{x:x+w,y:y+h},{x:x+(w>>1),y:y+(h>>1)}];}var _a2=[_a1[0]||{x:x+(w>>1),y:y},_a1[1]||{x:x,y:y+h},_a1[2]||{x:x+w,y:y},_a1[3]||{x:x+(w>>1),y:y+(h>>1)}];for(var i=4;i<_a1.length;i++){_a2.push(_a1[i]);}return _a2;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RightTriangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RightTriangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RightTriangleStrategy");(function(){var _a3=common.calc.Geometry,_a4=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RightTriangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_a5,_a6){return _a3.isPointInPolyn(gp.getGraphCoordinates(_a6),_a5);},draw:function(gp,gf,_a7){var p=_a4.Path,_a8=gp.getGraphCoordinates(_a7);gf.drawPath([{command:p.MOVE,points:_a8[0]},{command:p.LINE,points:_a8[1]},{command:p.LINE,points:_a8[2]}],this.getStyle(gp,_a7));},getGraphCoordinates:function(gp,_a9){var _aa=gp.getCoordinate(_a9),w=gp.getWidth(_a9),h=gp.getHeight(_a9),x=_aa.x,y=_aa.y;return [{x:x,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},getMarkCoordinates:function(gp,_ab){var _ac=gp.getCoordinate(_ab),w=gp.getWidth(_ab),h=gp.getHeight(_ab),_ad=gp.getRealMarks(_ab),x=_ac.x,y=_ac.y;if(!_ad){return [{x:x,y:y},{x:x+w,y:y+h},{x:x,y:y+h},{x:x+(w>>1),y:y+(h>>1)}];}var _ae=[_ad[0]||{x:x,y:y},_ad[1]||{x:x+w,y:y+h},_ad[2]||{x:x,y:y+h},_ad[3]||{x:x+(w>>1),y:y+(h>>1)}];for(var i=4;i<_ad.length;i++){_ae.push(_ad[i]);}return _ae;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.LineStrategy"]){dojo._hasResource["drawboard.graph.strategy.LineStrategy"]=true;dojo.provide("drawboard.graph.strategy.LineStrategy");(function(){var _af=common.calc.Geometry,_b0=drawboard.Constant;dojo.declare("drawboard.graph.strategy.LineStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_b1,_b2){var _b3=gp.getGraphCoordinates(_b2);return _af.isPointInRect(_b3[0],_b3[1],_b1);},isAnchor:function(d){return true;},draw:function(gp,gf,_b4){var p=_b0.Path,_b5=gp.getGraphCoordinates(_b4);gf.drawLine(_b5[0],_b5[1],this.getStyle(gp,_b4));},getActiveAnchors:function(gp,_b6){return drawboard.skeletonController.create(gp.getSkeletonCoordinates(_b6));},getSkeletonCoordinates:function(gp,_b7){var _b8=gp.getCoordinate(_b7),w=gp.getWidth(_b7),h=gp.getHeight(_b7),x=_b8.x,y=_b8.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y+h,css:"mover_se"}];},getGraphCoordinates:function(gp,_b9){var _ba=gp.getCoordinate(_b9),w=gp.getWidth(_b9),h=gp.getHeight(_b9),x=_ba.x,y=_ba.y;return [{x:x,y:y,css:"mover_nw",isAnchored:true},{x:x+w,y:y+h,css:"mover_se",isAnchored:true}];},getMotionAnchorCoordinates:function(gp,_bb){return null;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.DiamondStrategy"]){dojo._hasResource["drawboard.graph.strategy.DiamondStrategy"]=true;dojo.provide("drawboard.graph.strategy.DiamondStrategy");(function(){var _bc=common.calc.Geometry,_bd=drawboard.Constant;dojo.declare("drawboard.graph.strategy.DiamondStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_be,_bf){return _bc.isPointInPolyn(gp.getGraphCoordinates(_bf),_be);},draw:function(gp,gf,_c0){var p=_bd.Path,_c1=gp.getGraphCoordinates(_c0);gf.drawPath([{command:p.MOVE,points:_c1[0]},{command:p.LINE,points:_c1[1]},{command:p.LINE,points:_c1[2]},{command:p.LINE,points:_c1[3]}],this.getStyle(gp,_c0));},getGraphCoordinates:function(gp,_c2){var _c3=gp.getCoordinate(_c2),w=gp.getWidth(_c2),h=gp.getHeight(_c2),x=_c3.x,y=_c3.y;return [{x:x+(w>>1),y:y},{x:x,y:y+(h>>1)},{x:x+(w>>1),y:y+h},{x:x+w,y:y+(h>>1)}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy");(function(){var _c4=common.calc.Geometry,_c5=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_c6,_c7){return _c4.isPointInPolyn(gp.getGraphCoordinates(_c7),_c6);},isAnchor:function(d){if(d.getIndex()==2){return true;}return false;},getActiveAnchors:function(gp,_c8){var _c9=gp.getSkeletonCoordinates(_c8),_ca=[_c9[2]];return drawboard.skeletonController.create(_ca);},getRotatorCoordinate:function(gp,_cb){return this.getGraphCoordinates(gp,_cb)[0];},draw:function(gp,gf,_cc){var p=_c5.Path,_cd=gp.getGraphCoordinates(_cc);gf.drawPath([{command:p.MOVE,points:_cd[0]},{command:p.LINE,points:_cd[1]},{command:p.LINE,points:_cd[2]},{command:p.LINE,points:_cd[3]},{command:p.LINE,points:_cd[4]},{command:p.LINE,points:_cd[5]},{command:p.LINE,points:_cd[6]}],this.getStyle(gp,_cc));},getGraphCoordinates:function(gp,_ce){var _cf=gp.getCoordinate(_ce),w=gp.getWidth(_ce),h=gp.getHeight(_ce),x=_cf.x,y=_cf.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+w,y:y+h3},{x:x+w,y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_d0){var _d1=gp.getCoordinate(_d0),w=gp.getWidth(_d0),h=gp.getHeight(_d0),x=_d1.x,y=_d1.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"}];},sizeChange:function(gp,_d2,_d3,_d4){var d=_c5.Direction,p=gp.getCoordinate(_d4),w=gp.getWidth(_d4),h=gp.getHeight(_d4),_d5=_d3.x,_d6=_d3.y,_d7=_d2.getDirect();switch(_d7){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_d6)},_d4);gp.setHeight(h-(_d6<<1),_d4);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_d6)},_d4);gp.setHeight(h+(_d6<<1),_d4);break;case d.WEST:var _d8=gp.getMotionAnchorCoordinates(_d4)[0][0],_d9,wm,em,_da=gp.getRotator(_d4);gp.setCoordinate({x:p.x+_d5,y:p.y+_d6},_d4);_d9=gp.getCoordinate(_d4);wm={x:_d9.x,y:_d9.y+(h>>1)};em={x:_d9.x+w,y:_d9.y+(h>>1)};_da.angle=_c4.angle(em,wm,_d8);gp.setWidth(_c4.getDistant(_d8,wm),_d4);gp.setRotator(_da,_d4);break;case d.EAST:var _d8=gp.getSkeletonCoordinates(_d4)[3][0],_d9=gp.getCoordinate(_d4),wm,em,_db,_da=gp.getRotator(_d4);wm={x:_d9.x,y:_d9.y+(h>>1)};em={x:_d9.x+w,y:_d9.y+(h>>1)};_db={x:_d8.x+_d5,y:_d8.y+_d6};_da.angle=_c4.angle(em,wm,_db);gp.setWidth(_c4.getDistant(_db,wm),_d4);gp.setRotator(_da,_d4);break;case d.END:break;default:break;}},calcMotionAnchor:function(gp,_dc,_dd,_de){var _df=gp.getCoordinate(_de),wm={x:_df.x,y:_df.y+(gp.getHeight(_de)>>1)},em={x:_df.x+gp.getWidth(_de),y:_df.y+(gp.getHeight(_de)>>1)},_e0=_c4.angle(em,wm,_dd),_e1;_e1=gp.getRotator(_de);_e1.angle=_e0;gp.setWidth(_c4.getDistant(wm,_dd),_de);gp.setRotator(_e1,_de);return _dd;},getMotionAnchorCoordinates:function(gp,_e2){var _e3=gp.getCoordinate(_e2),w=gp.getWidth(_e2),h=gp.getHeight(_e2),x=_e3.x,y=_e3.y;return [{x:x+w,y:y+(h>>1)}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy");(function(){var _e4=common.calc.Geometry,_e5=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_e6,_e7){return _e4.isPointInPolyn(gp.getGraphCoordinates(_e7),_e6);},isAnchor:function(d){if(d.getIndex()==2||d.getIndex()==3){return true;}return false;},getActiveAnchors:function(gp,_e8){var _e9=gp.getSkeletonCoordinates(_e8),_ea=[_e9[2],_e9[3]];return drawboard.skeletonController.create(_ea);},getRotatorCoordinate:function(gp,_eb){return this.getGraphCoordinates(gp,_eb)[0];},draw:function(gp,gf,_ec){var p=_e5.Path,_ed=gp.getGraphCoordinates(_ec);gf.drawPath([{command:p.MOVE,points:_ed[0]},{command:p.LINE,points:_ed[1]},{command:p.LINE,points:_ed[2]},{command:p.LINE,points:_ed[3]},{command:p.LINE,points:_ed[4]},{command:p.LINE,points:_ed[5]},{command:p.LINE,points:_ed[6]},{command:p.LINE,points:_ed[7]},{command:p.LINE,points:_ed[8]},{command:p.LINE,points:_ed[9]}],this.getStyle(gp,_ec));},getGraphCoordinates:function(gp,_ee){var _ef=gp.getCoordinate(_ee),w=gp.getWidth(_ee),h=gp.getHeight(_ee),x=_ef.x,y=_ef.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+(w-(h>>1)),y:y+h3},{x:x+(w-(h>>1)),y:y},{x:x+w,y:y+(h>>1),isAnchored:true},{x:x+(w-(h>>1)),y:y+h},{x:x+(w-(h>>1)),y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_f0){var _f1=gp.getCoordinate(_f0),w=gp.getWidth(_f0),h=gp.getHeight(_f0),x=_f1.x,y=_f1.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"},{x:x+w,y:y+(h>>1),css:"mover_e"}];},sizeChange:function(gp,_f2,_f3,_f4){var d=_e5.Direction,p=gp.getCoordinate(_f4),w=gp.getWidth(_f4),h=gp.getHeight(_f4),_f5=_f3.x,_f6=_f3.y,_f7=_f2.getDirect();switch(_f7){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_f6)},_f4);gp.setHeight(h-(_f6<<1),_f4);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_f6)},_f4);gp.setHeight(h+(_f6<<1),_f4);break;case d.WEST:var _f8=gp.getSkeletonCoordinates(_f4)[3][0],_f9,wm,em,_fa=gp.getRotator(_f4);gp.setCoordinate({x:p.x+_f5,y:p.y+_f6},_f4);_f9=gp.getCoordinate(_f4);wm={x:_f9.x,y:_f9.y+(h>>1)};em={x:_f9.x+w,y:_f9.y+(h>>1)};_fa.angle=_e4.angle(em,wm,_f8);gp.setWidth(_e4.getDistant(_f8,wm),_f4);gp.setRotator(_fa,_f4);break;case d.EAST:var _f8=gp.getSkeletonCoordinates(_f4)[3][0],_f9=gp.getCoordinate(_f4),wm,em,_fb,_fa=gp.getRotator(_f4);wm={x:_f9.x,y:_f9.y+(h>>1)};em={x:_f9.x+w,y:_f9.y+(h>>1)};_fb={x:_f8.x+_f5,y:_f8.y+_f6};_fa.angle=_e4.angle(em,wm,_fb);gp.setWidth(_e4.getDistant(_fb,wm),_f4);gp.setRotator(_fa,_f4);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.command.Command"]){dojo._hasResource["drawboard.command.Command"]=true;dojo.provide("drawboard.command.Command");(function(){var _fc=drawboard.Constant.Command;dojo.declare("drawboard.command.Command",common.command.Command,{_memo:null,_executor:null,_runtime:null,_description:{},constructor:function(_fd,_fe,_ff){if(!_fd){new common.exception.Exception({msg:"the executor must be exist in the command!"});return;}this._executor=_fd;this._memo=_fe;if(!_ff){this.execute=this.positive;this.unexecute=this.negative;}else{this.execute=this.negative;this.unexecute=this.positive;}},getType:function(){return "";},getConstant:function(){return _fc;},setMemo:function(memo){this._memo=memo;},getMemo:function(){return this._memo;},setRuntime:function(_100){this._runtime=_100;},getRuntime:function(){var _101=this._runtime;if(!_101){new common.exception.Exception({msg:"the runtime must be exist in the command!"});}return _101;},getExecutor:function(){return this._executor;},setExecutor:function(_102){this._executor=_102;},execute:function(){},unexecute:function(){},positive:function(){},negative:function(){},setDescription:function(_103,_104){this._description={first:_103,second:_104};},isPositive:function(){if(this.execute==this.positive){return true;}return false;},isCancelOut:function(){return false;},getDesciption:function(){var desp=this._description;if(this.isPositive()){return desp.first;}return desp.second;},merge:function(_105){if(this.getType()!=_105.getType()||this.getExecutor()!=_105.getExecutor()){return false;}return this._merge(_105);},_merge:function(_106){}});})();}if(!dojo._hasResource["drawboard.command.AddVSDeleteConstrainCommand"]){dojo._hasResource["drawboard.command.AddVSDeleteConstrainCommand"]=true;dojo.provide("drawboard.command.AddVSDeleteConstrainCommand");dojo.declare("drawboard.command.AddVSDeleteConstrainCommand",drawboard.command.Command,{getType:function(){return this.getConstant().ADDVSDELTECONSTRAINCOMMAND;},positive:function(){var _107=this.getExecutor(),memo=this.getMemo(),_108=this.getRuntime();dojo.forEach(memo,function(mark){_107.addListener(mark.gp,mark.d,mark.restrainedGp,mark.restrainedD,_108);},this);},negative:function(){var _109=this.getExecutor(),memo=this.getMemo(),_10a=this.getRuntime(),_10b,_10c=this.isPositive();dojo.forEach(memo,function(mark){if(!_10c){_10b=_109.getRestrainedCache(mark.restrainedGp,mark.restrainedD,_10a);if(_10b&&_10b.length>0){memo=[];this.setMemo(memo);dojo.forEach(_10b,function(item){memo.push({gp:item.gp,d:item.decorate,restrainedGp:mark.restrainedGp,restrainedD:mark.restrainedD});},this);}_109.removeListener(mark.restrainedGp,mark.restrainedD,_10a);}},this);},_merge:function(_10d){return false;}});}if(!dojo._hasResource["drawboard.command.CombineVSDevidedCommand"]){dojo._hasResource["drawboard.command.CombineVSDevidedCommand"]=true;dojo.provide("drawboard.command.CombineVSDevidedCommand");dojo.declare("drawboard.command.CombineVSDevidedCommand",drawboard.command.Command,{getType:function(){return this.getConstant().COMBINEVSDEVIDEDCOMMAND;},positive:function(){var _10e=this.getExecutor(),memo=this.getMemo();_10e.combineGraph(memo);},negative:function(){var _10f=this.getExecutor(),memo=this.getMemo();_10f.divideGraph(memo);},_merge:function(_110){return false;}});}if(!dojo._hasResource["drawboard.command.CompositeCommand"]){dojo._hasResource["drawboard.command.CompositeCommand"]=true;dojo.provide("drawboard.command.CompositeCommand");dojo.declare("drawboard.command.CompositeCommand",[drawboard.command.Command,common.container.ListContainer],{constructor:function(){this.execute=this.positive;this.unexecute=this.negative;},getType:function(){return this.getConstant().COMPOSITECOMMAND;},add:function(_111){var last=this.last(),len=this.size();if(len==0||(last&&!last.merge(_111))){drawboard.command.CompositeCommand.superclass.add.call(this,_111);return;}},positive:function(){this.forInItems(function(_112){_112.execute();},this);},negative:function(){this.forInItems(function(_113){_113.unexecute();},this);}});}if(!dojo._hasResource["drawboard.command.CreateVSDeleteCommand"]){dojo._hasResource["drawboard.command.CreateVSDeleteCommand"]=true;dojo.provide("drawboard.command.CreateVSDeleteCommand");dojo.declare("drawboard.command.CreateVSDeleteCommand",drawboard.command.Command,{_info:null,index:null,getType:function(){return this.getConstant().CREATEVSDELETECOMMAND;},positive:function(){var _114=this.getExecutor(),memo=this.getMemo(),info=this._info,_115=this.getRuntime(),_116=_115.getContext().getStyleCtrl(),_117=this.index;_117===null?_114.add(memo):_114.insert(this.index,memo);if(info){dojo.forEach(info,function(item){_114.insert(item.index,item.gp);item.gs&&_116.addItem(item.gp.getIdty(),item.gs);memo.add(item.gp,_115);},this);memo.resetRelations();}},negative:function(){var _118=this.getExecutor(),memo=this.getMemo(),info,_119=this.getRuntime(),_11a=_119.getContext().getStyleCtrl();if(memo.isComposite()){if(!this._info){this._info=[];}info=this._info;var gp;memo.forInItems(function(item){gp=item.gp;info.push({gp:gp,gs:_11a.getItem(gp.getIdty()),index:_118.indexOf(gp)});},this);}this.index=_118.indexOf(memo);_118.removeGraph(memo);},_merge:function(_11b){return false;}});}if(!dojo._hasResource["drawboard.command.MoveCommand"]){dojo._hasResource["drawboard.command.MoveCommand"]=true;dojo.provide("drawboard.command.MoveCommand");dojo.declare("drawboard.command.MoveCommand",drawboard.command.Command,{getType:function(){return this.getConstant().MOVECOMMAND;},positive:function(){var _11c=this.getExecutor(),memo=this.getMemo(),_11d=this.getRuntime();_11c.move(memo.start,memo.end,_11d);},negative:function(){var _11e=this.getExecutor(),memo=this.getMemo(),_11f=this.getRuntime();_11e.move(memo.end,memo.start,_11f);},_merge:function(_120){var memo=this.getMemo(),_121=_120.getMemo();memo.end=_121.end;return true;}});}if(!dojo._hasResource["drawboard.command.ResizeCommand"]){dojo._hasResource["drawboard.command.ResizeCommand"]=true;dojo.provide("drawboard.command.ResizeCommand");dojo.declare("drawboard.command.ResizeCommand",drawboard.command.Command,{getType:function(){return this.getConstant().RESIZECOMMAND;},positive:function(){var _122=this.getExecutor(),memo=this.getMemo(),_123=this.getRuntime();_122.sizeChange(memo.decorate,memo.start,memo.end,_123);},negative:function(){var _124=this.getExecutor(),memo=this.getMemo(),_125=this.getRuntime();_124.sizeChange(memo.decorate,memo.end,memo.start,_125);},_merge:function(_126){var memo=this.getMemo(),_127=_126.getMemo();if(memo.decorate!=_127.decorate){return false;}memo.end=_127.end;return true;}});}if(!dojo._hasResource["drawboard.command.RotateCommand"]){dojo._hasResource["drawboard.command.RotateCommand"]=true;dojo.provide("drawboard.command.RotateCommand");dojo.declare("drawboard.command.RotateCommand",drawboard.command.Command,{_oriAngle:null,getType:function(){return this.getConstant().ROTATECOMMAND;},positive:function(){var _128=this.getExecutor(),memo=dojo.clone(this.getMemo()),_129=this.getRuntime();if(this._oriAngle===null){this._oriAngle=_128.getRotator(_129).angle;}_128.setRotator(memo,_129);},negative:function(){var _12a=this.getExecutor(),memo=dojo.clone(this.getMemo()),_12b=this.getRuntime();memo.angle=this._oriAngle;_12a.setRotator(memo,_12b);},_merge:function(_12c){var memo=this.getMemo(),_12d=_12c.getMemo();memo.angle=_12d.angle;return true;}});}if(!dojo._hasResource["drawboard.command.StyleCommand"]){dojo._hasResource["drawboard.command.StyleCommand"]=true;dojo.provide("drawboard.command.StyleCommand");dojo.declare("drawboard.command.StyleCommand",drawboard.command.Command,{_style:null,getType:function(){return this.getConstant().STYLECOMMAND;},getStyle:function(){var _12e=this._style;if(!_12e){this._style=_12e={};}return _12e;},positive:function(){var _12f=this.getExecutor(),memo=this.getMemo();if(!this._style&&_12f.containGraphStyle(memo.gp)){this._style=_12f.getGraphStyleValue(memo.gp,memo.attr);}_12f.addGraphStyle(memo.gp,memo.attr,memo.value,memo.isSelect);if(memo.gp.isComposite()){var _130=this.getStyle();memo.gp.forInItems(function(item){if(_12f.containGraphStyle(item.gp)){_130[item.gp.getIdty()]=_12f.getGraphStyleValue(item.gp,memo.attr);}_12f.addGraphStyle(item.gp,memo.attr,memo.value);},this);}},negative:function(){var _131=this.getExecutor(),memo=this.getMemo();if(memo.gp.isComposite()){var _132=this.getStyle(),_133;memo.gp.forInItems(function(item){_133=_132[item.gp.getIdty()];if(_133){_131.addGraphStyle(item.gp,memo.attr,_133);return;}_131.removeGraphStyle(item.gp,memo.attr);},this);return;}if(this._style){_131.addGraphStyle(memo.gp,memo.attr,this._style);return;}_131.removeGraphStyle(memo.gp,memo.attr);},_merge:function(_134){return false;}});}if(!dojo._hasResource["drawboard.command.ZoomCommand"]){dojo._hasResource["drawboard.command.ZoomCommand"]=true;dojo.provide("drawboard.command.ZoomCommand");dojo.declare("drawboard.command.ZoomCommand",drawboard.command.Command,{getType:function(){return this.getConstant().ZOOMCOMMAND;},positive:function(){var _135=this.getExecutor(),memo=this.getMemo(),_136=this.getRuntime();_135.zoom(memo,_136);},negative:function(){var _137=this.getExecutor(),memo=this.getMemo(),_138=this.getRuntime();_137.zoom({x:-memo.x,y:-memo.y},_138);},_merge:function(_139){var memo=this.getMemo(),_13a=_139.getMemo();this.setMemo(common.calc.Geometry.add2Points(memo,_13a));return true;}});}if(!dojo._hasResource["drawboard.PreRequire"]){dojo._hasResource["drawboard.PreRequire"]=true;dojo.provide("drawboard.PreRequire");}if(!dojo._hasResource["drawboard._Event"]){dojo._hasResource["drawboard._Event"]=true;dojo.provide("drawboard._Event");(function(){var _13b=common.calc.Geometry,_13c=drawboard.Constant.ActionStatus,_13d=drawboard.Constant;dojo.declare("drawboard._Event",null,{_start:null,_end:null,boxCache:null,_marks:null,getBoxCache:function(){if(!this.boxCache){var node=this.dbCanvas,_13e={left:node.offsetLeft,top:node.offsetTop};this.boxCache=_13e;}return this.boxCache;},refreshBoxCache:function(){this.boxCache=null;},fetchCoordinate:function(e){var box=this.getBoxCache(),_13f=this.domNode;return {x:e.pageX-box.left+_13f.scrollLeft,y:e.pageY-box.top+_13f.scrollTop};},showMarkActive:function(gp,d,_140){var _141=d||gp.getActiveAnchors(_140),_142,_143,mark;if(!_141||(d&&!gp.isAnchor(d))){return;}(!dojo.isArray(_141))&&(_141=[_141]);_142=drawboard.markController;dojo.forEach(_141,function(s){mark=_142.cross(s,gp,this,_140);if(mark){!_143&&(_143=[])&&(this._marks=_143);_143.push(mark);}},this);_142=_140.getContext().getStyleCtrl();!_143&&(this._marks=null);if(_143){var _144=[];dojo.forEach(_143,function(m){this.push(m.d);gp=m.gp;},_144);_142.setActives(_144,gp);return;}_142.setActives(null);},doClick:function(e){this.inherited(arguments);},doMouseMove:function(e){this.inherited(arguments);this._end&&(this._start=this._end);this._end=this.fetchCoordinate(e);var gp=this.getActive(),_145=this._start,end=this._end,_146=this.getActionStatus(),_147=this.getDecorate(),_148,pole,a,_149=this.getRuntime(),_14a=this.getSelectRect(),_14b=_13d.Command,_14c=dojo.hitch(this,this.addCommand),_14d=true;if(_146!=_13c.NONE&&gp){_148=dojo.clone(gp.getRotator(_149));pole=_148.coordinate;}_14a&&!gp&&(gp=_14a);if(!gp&&_146!=_13c.DRAWING&&_146!=_13c.SELECTING){return;}switch(_146){case _13c.RESIZING:_14c(_14b.RESIZECOMMAND,gp,{decorate:_147,start:_145,end:end});this.showMarkActive(gp,drawboard.skeletonController.createItem(gp.getSkeletonCoordinates(_149)[_147.getIndex()],_147.getIndex()),_149);break;case _13c.MOVING:_14c(_14b.MOVECOMMAND,gp,{start:_145,end:end});this.showMarkActive(gp,null,_149);break;case _13c.DRAWING:case _13c.SELECTING:var _14e=this.getDrawEntity(true);_14e.width=end.x-_14e.x;_14e.height=end.y-_14e.y;break;case _13c.MOTION:gp.moveMotionAnchor(_147,end,_149);break;case _13c.ROTATING:case _13c.POLEMOVING:if(_146==_13c.ROTATING){_148.angle=_13b.angle({x:pole.x,y:pole.y-_149.getContext().getParamsCtrl().getRotateDistance()},pole,this._end);_14c(_14b.ROTATECOMMAND,gp,_148);}else{_147.pole=_148.coordinate=end;gp.setRotator(_148,_149);}break;case _13c.NONE:default:_14d=false;break;}_14d&&this.draw();},doMouseDown:function(e){this.inherited(arguments);var _14f=this.fetchCoordinate(e),_150=this.getActionStatus(),_151;if(_150==_13c.DRAWING||_150==_13c.SELECTING){_151=this.getDrawEntity(true);_151.x=_14f.x;_151.y=_14f.y;}this._start=_14f;},doMouseOver:function(e){this.inherited(arguments);},doMouseUp:function(e){var _152=this._marks,_153=this.getRuntime(),_154=(this.getActionStatus()==_13c.DRAWING)?false:true,_155=drawboard.relationController,gp=this.getActive(),_156=this.getDecorate();if(gp&&_155.containRestrain(gp,_156,_153)){this.addCommand(_13d.Command.ADDVSDELTECONSTRAINCOMMAND,_155,[{restrainedGp:gp,restrainedD:_156}],true);}if(_152){var _157=[];dojo.forEach(_152,function(mark){if(!_155.containRestrain(mark.restrainedGp,mark.restrainedD,_153)){_157.push(mark);}},this);(_157.length>0)&&this.addCommand(_13d.Command.ADDVSDELTECONSTRAINCOMMAND,_155,_157);}this.getRuntime().getContext().getStyleCtrl().setActives(null);this._start=null;this._end=null;this.clearDrawEntity(_154);this.inherited(arguments);this.clearCommand();this.draw();dojo.publish("/drawboard/mouseup");}});})();}if(!dojo._hasResource["drawboard.container.LayoutContainer"]){dojo._hasResource["drawboard.container.LayoutContainer"]=true;dojo.provide("drawboard.container.LayoutContainer");dojo.declare("drawboard.container.LayoutContainer",[dijit._Widget,common.container.ListContainer],{up:function(gs){var _158=this.indexOf(gs);this.move(_158,_158+1);},down:function(gs){var _159=this.indexOf(gs);this.move(_159,_159-1);},top:function(gs){var _15a=this.indexOf(gs);this.move(_15a,this.size());},bottom:function(gs){var _15b=this.indexOf(gs);this.move(_15b,0);}});}if(!dojo._hasResource["drawboard.graph.strategy.GraphStrategyFactory"]){dojo._hasResource["drawboard.graph.strategy.GraphStrategyFactory"]=true;dojo.provide("drawboard.graph.strategy.GraphStrategyFactory");(function(){dojo.declare("drawboard.graph.strategy.GraphStrategyFactory",common.container.MapContainer,{getGraphStrategy:function(_15c){if(!this.contains(_15c)){var _15d=eval("new "+_15c+"()");this.addItem(_15c,_15d);}return this.getItem(_15c);}});if(!drawboard.GraphStrategyFactory){drawboard.GraphStrategyFactory=new drawboard.graph.strategy.GraphStrategyFactory();}})();}if(!dojo._hasResource["drawboard.controller.RelationController"]){dojo._hasResource["drawboard.controller.RelationController"]=true;dojo.provide("drawboard.controller.RelationController");(function(){var _15e=drawboard.Constant.Symbol,_15f=common.utils.CollectionUtils.hasAttr;dojo.declare("drawboard.controller.RelationController",[common.container.MapContainer,common.Cache],{addListener:function(gp,d,_160,_161,_162){var idty=gp.getIdty(),_163=this.getItem(idty),item,_164=false,_165=d.getType()+_15e.concat+d.getIndex();if(!_163){_163={};this.addItem(idty,_163);}item=_163[_165];if(!item){item=[];_163[_165]=item;}dojo.some(item,function(i){if(i.gp==_160){_164=true;return true;}},this);if(!_164){item.push({gp:_160,decorate:_161});this.addRestrainedCache(gp,d,_160,_161,_162);}},removeListener:function(_166,_167,_168){var _169=this.removeRestrainedCache(_166,_167,_168),_16a,item,_16b,dels,id;dojo.forEach(_169,function(item){id=item.id;_16a=this.getItem(id);if(!_16a){return;}dels=[];_16b=item.decorate.getType()+_15e.concat+item.decorate.getIndex();item=_16a[_16b];dojo.forEach(item,function(_16c,_16d){if(_16c.gp!=_166){return;}if(!_167||(_167&&_16c.decorate.equal(_167))){dels.push(_16d);}},this);dojo.forEach(dels.reverse(),function(_16e){item.splice(_16e,1);},this);delete _16a[_16b];if(!_15f(_16a)){this.removeItem(id);}},this);},fireEvent:function(idty,d,_16f,_170,_171){var _172=this.getItem(idty),item,temp;if(!_172){return;}item=_172[d.getType()+_15e.concat+d.getIndex()];item&&dojo.forEach(item,function(i){if(_171&&!_171(i.gp)){return;}temp=_16f.concat();temp.unshift(i.decorate);temp.push(null);temp.push(_170);i.gp.sizeChange.apply(i.gp,temp);},this);},addRestrainedCache:function(gp,d,_173,_174,_175){var idty=gp.getIdty(),_176=this.getCache(_175),_177=_176[_173.getIdty()],_178=_174.getType()+_15e.concat+_174.getIndex();if(!_177){_177={};_176[_173.getIdty()]=_177;}!_177[_178]&&(_177[_178]={id:idty,gp:gp,decorate:d});},containRestrain:function(_179,_17a,_17b){var _17c=this.getRestrainedCache(_179,_17a,_17b);if(_17c&&_17c.length>0){return true;}return false;},getRestrainedCache:function(_17d,_17e,_17f){var _180=this.getCache(_17f),_181=_180[_17d.getIdty()],_182;if(!_181){return _182;}if(_17e){var _183=_17e.getType()+_15e.concat+_17e.getIndex();_181[_183]&&(_182=[_181[_183]]);return _182;}_182=[];for(var _184 in _181){_182.push(_181[_184]);}return _182;},removeRestrainedCache:function(_185,_186,_187){var _188=this.getCache(_187),_189=_188[_185.getIdty()],_18a;if(!_189){return _18a;}if(_186){var _18b=_186.getType()+_15e.concat+_186.getIndex();_189[_18b]&&(_18a=[_189[_18b]]);delete _189[_18b];if(!_15f(_189)){delete _188[_185.getIdty()];}return _18a;}_18a=[];for(var _18c in _189){_18a.push(_189[_18c]);}delete _188[_185.getIdty()];return _18a;},createCache:function(){return {};}});if(drawboard.relationController==null){drawboard.relationController=new drawboard.controller.RelationController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Decorator"]){dojo._hasResource["drawboard.graph.decorate.Decorator"]=true;dojo.provide("drawboard.graph.decorate.Decorator");dojo.declare("drawboard.graph.decorate.Decorator",dijit._Widget,{_type:null,coordinate:null,index:0,getIndex:function(){return this.index;},setIndex:function(_18d){this.index=_18d;},getType:function(){return this._type;},getCoordinate:function(){return this.coordinate;},setCoordinate:function(_18e){this.coordinate=_18e;},draw:function(gp,_18f,_190){},equal:function(d){if(d.getIndex()!=this.getIndex()){return false;}var same=true,ps=this.getCoordinate();dojo.some(d.getCoordinate(),function(item,_191){if(item!=ps[_191]){same=false;return true;}},this);return same;}});}if(!dojo._hasResource["drawboard.graph.decorate.Mark"]){dojo._hasResource["drawboard.graph.decorate.Mark"]=true;dojo.provide("drawboard.graph.decorate.Mark");(function(){var _192=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Mark",drawboard.graph.decorate.Decorator,{_type:_192.Decorate.MARK,draw:function(gp,_193,_194){var p=this.getCoordinate(),path=_192.Path,_195=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.MOVE,points:p[2]},{command:path.LINE,points:p[3]},];gp.drawPath(_195,_193,true);}});})();}if(!dojo._hasResource["drawboard.graph.GraphProxy"]){dojo._hasResource["drawboard.graph.GraphProxy"]=true;dojo.provide("drawboard.graph.GraphProxy");(function(){var _196=drawboard.Constant,_197=_196.Decorate,_198=drawboard.GraphStrategyFactory,_199=common.calc.Geometry,_19a=_199.dividePoint,add=_199.add2Points,_19b=_199.subtract2Points,_19c=_199.rotation;dojo.declare("drawboard.graph.GraphProxy",null,{_graphStatus:null,_graphStrategyClass:null,_isActive:false,_isActived:false,_isComposite:false,_showMark:false,constructor:function(_19d,_19e){_19e=dojo.trim(_19e);this._graphStrategyClass=_19e;this._graphStatus=_19d;},getGraphStrategy:function(){return _198.getGraphStrategy(this.getGraphStrategyClass());},getGraphStrategyClass:function(){if(!this._graphStrategyClass){new common.exception.Exception({msg:"graph proxy must have an graph strategy class!"});}return this._graphStrategyClass;},getGraphStatus:function(){if(!this._graphStatus){new common.exception.Exception({msg:"graph status proxy must have an graph status instance!"});}return this._graphStatus;},setRatio:function(_19f){return this.getGraphStatus().setRatio(_19f);},getRatio:function(){return this.getGraphStatus().getRatio();},isComposite:function(){return this._isComposite;},showMark:function(_1a0){if(_1a0!==undefined){this._showMark=_1a0;}return this._showMark;},getIdty:function(){return this.getGraphStatus().getIdty();},isActive:function(_1a1){if(_1a1!==null&&_1a1!==undefined){this._isActive=_1a1;}return this._isActive;},isActived:function(_1a2){if(_1a2!==null&&_1a2!==undefined){this._isActived=_1a2;}return this._isActived;},getCenter:function(_1a3){var _1a4=this.getCache(_1a3),_1a5=_1a4[_197.CENTER];if(!_1a5){var gs=this.getGraphStatus(),c=gs.getCoordinate(_1a3),w=gs.getWidth(_1a3),h=gs.getHeight(_1a3);_1a4[_197.CENTER]=_1a5={x:c.x+(w>>1),y:c.y+(h>>1)};}return _1a5;},getCoordinate:function(_1a6){return this.getGraphStatus().getCoordinate(_1a6);},setCoordinate:function(_1a7,_1a8){var gs=this.getGraphStatus();gs.setCoordinate(_1a7,_1a8);},reset:function(_1a9,_1aa){var gs=this.getGraphStatus(),_1ab=gs.getMarks(_1aa);_1a9=_19a([_1a9],_1aa.getContext().getZoom())[0];if(_1ab){dojo.forEach(_1ab,function(item){if(item){item.x+=_1a9.x;item.y+=_1a9.y;}},this);gs.setMarks(_1ab,_1aa);}},getWidth:function(_1ac){return this.getGraphStatus().getWidth(_1ac);},setWidth:function(w,_1ad){this.getGraphStatus().setWidth(w,_1ad);},getHeight:function(_1ae){return this.getGraphStatus().getHeight(_1ae);},setHeight:function(h,_1af){this.getGraphStatus().setHeight(h,_1af);},setRotator:function(_1b0,_1b1,_1b2){var gs=this.getGraphStatus(),_1b3=gs.getRotator();(!_1b3)&&(_1b3={angle:0});if(_1b0.angle!=_1b3.angle){_1b3.angle=_1b0.angle;gs.setRotator(_1b3);}else{}!_1b2&&this.refresh(_1b1);},getRotator:function(_1b4){var gs=this.getGraphStatus(),_1b5=gs.getRotator(),_1b6=gs.getCoordinate(_1b4),h=gs.getHeight(_1b4),w=gs.getWidth(_1b4);return {coordinate:{x:_1b6.x+(w>>1),y:_1b6.y+(h>>1)},angle:_1b5?_1b5.angle:0};},getGraphRotator:function(_1b7){var gs=this.getGraphStatus(),_1b8=this.getGraphStrategy(),_1b9=gs.getRotateAngle(),_1ba=this.getCenter(_1b7);if(!_1b8.hasRotator()){return {coordinate:_1b8.getRotatorCoordinate(this,_1b7)||_1ba,angle:_1b9};}return {coordinate:_1ba,angle:_1b9};},getRealMarks:function(_1bb){return this.getGraphStatus().getMarks(_1bb);},getRealMotionAnchors:function(_1bc){return this.getGraphStatus().getMotionAnchors(_1bc);},getUrl:function(){return this.getGraphStatus().getUrl();},getNWCoordinate:function(_1bd){var _1be=this.getGraphRotator(_1bd),pole=_1be.coordinate,a=_1be.angle;return _19c(this.getCoordinate(_1bd),pole,a);},getSECoordinate:function(_1bf){var _1c0=this.getGraphRotator(_1bf),pole=_1c0.coordinate,a=_1c0.angle,_1c1=this.getCoordinate(_1bf),w=this.getWidth(_1bf),h=this.getHeight(_1bf);return _19c({x:_1c1.x+(w>>1),y:_1c1.y+(h>>1)},pole,a);},getCoordinatesByDeal:function(_1c2,_1c3){var _1c4=_1c2(this,_1c3);if(!_1c4){return null;}var r=_1c3.getDistance(),_1c5=this.getGraphRotator(_1c3),pole=_1c5.coordinate,_1c6=common.utils.CollectionUtils.copy4Attrs,a=_1c5.angle,p=_1c4[0],_1c7,temp;temp=_19c(p,pole,a);_1c6(p,temp,{x:1,y:1});_1c4[0]=[temp,_19c({x:p.x-r,y:p.y-r},pole,a),_19c({x:p.x+r,y:p.y-r},pole,a),_19c({x:p.x+r,y:p.y+r},pole,a),_19c({x:p.x-r,y:p.y+r},pole,a)];dojo.forEach(_1c4,function(_1c8,_1c9){if(_1c9!=0){temp=_19c(_1c8,pole,a);_1c6(_1c8,temp,{x:1,y:1});_1c7=_19b(temp,_1c4[0][0]);_1c4[_1c9]=[temp,add(_1c4[0][1],_1c7),add(_1c4[0][2],_1c7),add(_1c4[0][3],_1c7),add(_1c4[0][4],_1c7)];}},this);return _1c4;},getGraphCoordinates:function(_1ca){var _1cb=this.getCache(_1ca),_1cc=_1cb[_197.Graph];if(!_1cc){var _1cd=this.getGraphStrategy(),_1ce=this.getGraphRotator(_1ca),pole=_1ce.coordinate,a=_1ce.angle,_1cf=_1cd.getGraphCoordinates(this,_1ca);dojo.forEach(_1cf,function(item,_1d0){_1cf[_1d0]=_19c(item,pole,a);},this);_1cb[_197.Graph]=_1cf;return _1cf;}return _1cc;},getSkeletonCoordinates:function(_1d1){var _1d2=this.getCache(_1d1),_1d3=_1d2[_197.SKELETON];if(!_1d3){var _1d4=this.getGraphStrategy(),_1d5=this.getCoordinatesByDeal(_1d4.getSkeletonCoordinates,_1d1);_1d2[_197.SKELETON]=_1d5;return _1d5;}return _1d3;},getMarkCoordinates:function(_1d6){var _1d7=this.getCache(_1d6),_1d8=_1d7[_197.MARK];if(!_1d8){var _1d9=this.getGraphStrategy(),_1da=this.getCoordinatesByDeal(_1d9.getMarkCoordinates,_1d6);_1d7[_197.MARK]=_1da;return _1da;}return _1d8;},hasRotator:function(){return this.getGraphStrategy().hasRotator();},getRotatorCoordinates:function(_1db){if(!this.hasRotator()){return null;}var _1dc=this.getCache(_1db),_1dd=_1dc[_197.ROTATOR];if(!_1dd){var r=_1db.getDistance(),d=_1db.getRotateDistance(),_1de=this.getRotator(_1db),pole=_1de.coordinate,a=_1de.angle,_1df=this.getCoordinate(_1db),_1e0={x:pole.x,y:_1df.y},_1e1=this.getGraphRotator(_1db).coordinate,_1e2=_199.getDistant(pole,_19c(_1e0,_1e1,a)),_1e3;(_1e2>0)&&(d+=_1e2);_1e3=_19c({x:pole.x,y:pole.y-d-r},pole,a);_1dd=[_199.intersectCircleLine(_1e3,r,_1e3,{x:_1e3.x,y:_1e3.y+10})[0],_19c({x:pole.x,y:pole.y-d},pole,a),_19c({x:pole.x,y:pole.y-r},pole,a),{x:pole.x,y:pole.y},_19c({x:pole.x,y:pole.y-2*r},pole,a),_1e3];_1dc[_197.ROTATOR]=_1dd;return _1dd;}return _1dd;},getMotionAnchorCoordinates:function(_1e4){var _1e5=this.getCache(_1e4),_1e6=_1e5[_197.MOTIONANCHOR];if(!_1e6){var _1e7=this.getGraphStrategy(),_1e8=this.getCoordinatesByDeal(_1e7.getMotionAnchorCoordinates,_1e4);_1e5[_197.MOTIONANCHOR]=_1e8;return _1e8;}return _1e6;},refresh:function(_1e9,_1ea){var _1eb=this.getMarkCoordinates(_1e9),_1ec,_1ed;this.clearCache(_1e9);this.getSkeletonCoordinates(_1e9);this.getMotionAnchorCoordinates(_1e9);_1ec=this.getMarkCoordinates(_1e9);dojo.forEach(_1eb,function(item,_1ee){if(item[0]!=_1ec[_1ee][0]){_1ed=_19b(_1ec[_1ee][0],item[0]);drawboard.relationController.fireEvent(this.getIdty(),new drawboard.graph.decorate.Mark({coordinate:[item[1],item[3],item[2],item[4]],index:_1ee}),[_1ed],_1e9,_1ea);}},this);},getCache:function(_1ef){return _1ef.getCache(this);},clearCache:function(_1f0,type){_1f0.clearCache(this,type);},draw:function(_1f1){this.getGraphStrategy().draw(this,_1f1.getGraphic(),_1f1);if(this.isActived()){var _1f2=this.getCoordinate(_1f1),w=this.getWidth(_1f1),h=this.getHeight(_1f1),x=_1f2.x,y=_1f2.y,p=drawboard.Constant.Path;_1f1.getGraphic().drawPath([{command:p.MOVE,points:{x:x,y:y}},{command:p.LINE,points:{x:x+w,y:y}},{command:p.LINE,points:{x:x+w,y:y+h}},{command:p.LINE,points:{x:x,y:y+h}}],"fill:none;stroke:red;stroke-width:2");}},sizeChange:function(_1f3,_1f4,end,_1f5){var _1f6=this.getGraphStrategy(),_1f7=this.getGraphRotator(_1f5),_1f8=_1f7.coordinate,a=_1f7.angle,_1f9=_1f4,gp=this,_1fa=_1f6.hasRotator(),_1fb={};if(end!==null&&end!==undefined){_1f9=_19b(end,_1f4);if(_1fa){var _1fc=_1f3.getDirect(),d=_196.Direction,_1fd=this.getCoordinate(_1f5),_1fe=this.getSkeletonCoordinates(_1f5),_1ff,_200;switch(_1fc){case d.NORTH:case d.WEST:case d.WESTNORTH:_1ff=_1fe[3][0];_200=function(pos,p,a){gp.setCoordinate(add(_1fd,_19b(_19c(pos,p,-a),{x:_1fd.x+gp.getWidth(_1f5),y:_1fd.y+gp.getHeight(_1f5)})),_1f5);};break;case d.EASTNORTH:_1ff=_1fe[2][0];_200=function(pos,p,a){gp.setCoordinate(add(_1fd,_19b(_19c(pos,p,-a),{x:_1fd.x,y:_1fd.y+gp.getHeight(_1f5)})),_1f5);};break;case d.WESTSOUTH:_1ff=_1fe[1][0];_200=function(pos,p,a){gp.setCoordinate(add(_1fd,_19b(_19c(pos,p,-a),{x:_1fd.x+gp.getWidth(_1f5),y:_1fd.y})),_1f5);};break;case d.SOUTH:case d.EAST:case d.EASTSOUTH:_1ff=_1fe[0][0];_200=function(pos,p,a){pos=_19c(pos,p,-a);gp.setCoordinate(pos,_1f5);};break;case d.END:break;default:break;}_1fb.oriFixPos=_1ff;_1fb.oriFixFunct=_200;_1f4=_19c(_1f4,_1f8,-a);end=_19c(end,_1f8,-a);_1f9=_19b(end,_1f4);}}_1f6.sizeChange(this,_1f3,_1f9,_1f5);if(_1fa&&a!=0&&_1fb!==undefined){this.clearCache(_1f5,_197.CENTER);var _201=_19c(this.getCenter(_1f5),_1f8,a);_1fb.oriFixFunct(_1fb.oriFixPos,_201,a);}this.refresh(_1f5);},move:function(_202,end,_203){var _204=this.getCoordinate(_203),_205=_19b(end,_202);this.setCoordinate({x:_204.x+_205.x,y:_204.y+_205.y},_203);this.reset(_205,_203);this.refresh(_203);},zoom:function(rate,_206){this.refresh(_206,function(){return false;});},moveMotionAnchor:function(_207,_208,_209){var _20a=this.getRealMotionAnchors(_209);_20a[_207.index]=this.getGraphStrategy().calcMotionAnchor(this,_207,_208,_209);this.refresh(_209);},active:function(p,_20b){if(this.getGraphStrategy().isIn(this,p,_20b)){return this;}return null;},getActiveAnchors:function(_20c){return this.getGraphStrategy().getActiveAnchors(this,_20c);},isAnchor:function(d){return this.getGraphStrategy().isAnchor(d);},deleteAll:function(db,_20d){this.destroy(_20d);},destroy:function(_20e){drawboard.relationController.removeListener(this,_20e);}});})();}if(!dojo._hasResource["drawboard.graph.CompositeProxy"]){dojo._hasResource["drawboard.graph.CompositeProxy"]=true;dojo.provide("drawboard.graph.CompositeProxy");(function(){var _20f=common.calc.Geometry,add=_20f.add2Points,_210=_20f.subtract2Points,_211=drawboard.Constant.Decorate;dojo.declare("drawboard.graph.CompositeProxy",[common.container.ListContainer,drawboard.graph.GraphProxy],{_focus:false,_isComposite:true,_operate:false,isFocus:function(_212){if(_212!==undefined){this._focus=_212;}return this._focus;},contains:function(gp){if(!gp){return false;}var _213=false;this.some(function(item){if(item.gp==gp){_213=true;return true;}},this);return _213;},remove:function(gp){var _214;this.some(function(item,i){if(item.gp==gp){_214=i;return true;}},this);drawboard.graph.CompositeProxy.superclass.remove.apply(this,[_214]);},equals:function(cp){if(cp.size()!=this.size()){return false;}var same=true;this.some(function(item){if(!cp.contains(item.gp)){same=false;return true;}},this);return same;},resetRelations:function(){var that=this,_215,gp;this.forInItems(function(item){gp=item.gp;_215=(gp.getParent&&gp.getParent());if(_215!=that){_215&&_215.remove(gp);gp.getParent=function(){return that;};}},this);},add:function(gp,_216){drawboard.graph.CompositeProxy.superclass.add.apply(this,[{gp:gp,oriPos:gp.getCoordinate(_216),oriRotator:dojo.clone(gp.getRotator(_216))}]);if(_20f.graphContainsGraph(this.getSkeletonCoordinates(_216),gp.getSkeletonCoordinates(_216))){return;}var rect=_20f.getMaxRect(gp.getSkeletonCoordinates(_216).concat(this.getSkeletonCoordinates(_216)));this.setCoordinate({x:rect.x,y:rect.y},_216);this.setWidth(rect.width,_216);this.setHeight(rect.height,_216);this.refresh(_216);},setRotator:function(_217,_218,_219){this._operate=true;var r=this.getRotator(_218),_21a,_21b=_20f.rotation,_21c=_217.angle-r.angle,_21d=dojo.hitch(this,this.contains),_21e=[];this.inherited(arguments);if(_219){return;}this.recursiveChild(_21e);dojo.forEach(_21e,function(gp){r=gp.getGraphRotator(_218);r.angle+=_21c;_21a=gp.getNWCoordinate(_218);_21a=_21b(_21b(_21a,_217.coordinate,_21c),_21b(r.coordinate,_217.coordinate,_21c),-r.angle);gp.setCoordinate(_21a,_218);gp.setRotator(r,_218,true);gp.refresh(_218,function(_21f){if(_21d(_21f)){return false;}return true;});},this);this._operate=false;},recursiveChild:function(_220){var gp;this.forInItems(function(item){gp=item.gp;_220.push(gp);if(gp.recursiveChild){gp.recursiveChild(_220);return;}},this);},deleteAll:function(db){this.forInItems(function(item){db.removeGraph(item.gp);},this);this.destroy();},destroy:function(){this.inherited(arguments);var gp;this.forInItems(function(item){gp=item.gp;gp.getParent&&(gp.getParent()==this)&&(delete gp.getParent);},this);},draw:function(_221){this.inherited(arguments);},sizeChange:function(_222,_223,end,_224){this._operate=true;var w=this.getWidth(_224),h=this.getHeight(_224),_225=1,_226=1,gp,nw,r,nnw,_227,_228,_229=_20f.rotation,_22a=this.getSkeletonCoordinates(_224)[0][0],_22b=this.getRotator(_224),_22c=dojo.hitch(this,this.contains);this.inherited(arguments);_225=this.getWidth(_224)/w;_226=this.getHeight(_224)/h;fixCoordinate=this.getSkeletonCoordinates(_224)[0][0];this.forInItems(function(item){gp=item.gp;_228=gp.getCoordinate(_224);nw=gp.getNWCoordinate(_224);nw=_229(nw,_22a,-_22b.angle);_227=_210(nw,_22a);nw=_229(add(_22a,{x:_227.x*_225,y:_227.y*_226}),_22a,_22b.angle);nw=add(nw,_210(fixCoordinate,_22a));gp.setWidth(gp.getWidth(_224)*_225,_224);gp.setHeight(gp.getHeight(_224)*_226,_224);_224.clearCache(gp,_211.CENTER);r=gp.getGraphRotator(_224);_228=gp.getCoordinate(_224);nnw=_229(_228,r.coordinate,r.angle);gp.setCoordinate(add(_228,_210(nw,nnw)),_224);gp.refresh(_224,function(_22d){if(_22c(_22d)){return false;}return true;});},this);this._operate=false;},move:function(_22e,end,_22f){this._operate=true;this.inherited(arguments);this.forInItems(function(item){if(item){item.oriPos=add(item.oriPos,_210(end,_22e));item.gp.move(_22e,end,_22f);}},this);this._operate=false;},zoom:function(rate,_230){this._operate=true;this.inherited(arguments);this.forInItems(function(item){if(item){item.gp.zoom(rate,_230);}},this);this._operate=false;}});})();}if(!dojo._hasResource["drawboard.graph.GraphStatus"]){dojo._hasResource["drawboard.graph.GraphStatus"]=true;dojo.provide("drawboard.graph.GraphStatus");(function(){var _231=common.calc.Geometry,_232=_231.multiPoint,_233=_231.dividePoint;dojo.declare("drawboard.graph.GraphStatus",[dijit._Widget,common.Identity],{_coordinate:null,_w:null,_h:null,_rotator:null,_motionAnchors:null,_marks:null,_url:null,_ratio:null,setRatio:function(_234){return this._ratio=_234;},getRatio:function(){return this._ratio;},setCoordinate:function(_235,_236){this._coordinate=_233(_235,this.getZoom(_236))[0];},getCoordinate:function(_237){return _232(this._coordinate,this.getZoom(_237))[0];},getZoom:function(_238){return _238.getContext().getZoom();},setWidth:function(w,_239){this._w=w/this.getZoom(_239).x;},getWidth:function(_23a){return this._w*this.getZoom(_23a).x;},setHeight:function(h,_23b){this._h=h/this.getZoom(_23b).y;},getHeight:function(_23c){return this._h*this.getZoom(_23c).y;},hasRotator:function(){if(this._rotator){return true;}return false;},setRotator:function(_23d){this._rotator=_23d;},getRotator:function(){return this._rotator;},getRotateAngle:function(){var _23e=this.getRotator();if(_23e){return _23e.angle;}return 0;},setMarks:function(_23f,_240){this._marks=_233(_23f,this.getZoom(_240));},getMarks:function(_241){return this._marks&&_232(this._marks,this.getZoom(_241));},setMotionAnchors:function(_242,_243){this._motionAnchors=_242;},getMotionAnchors:function(_244){return this._motionAnchors;},getUrl:function(){return this._url;},setUrl:function(url){this._url=url;}});})();}if(!dojo._hasResource["drawboard.drawProcessor.DrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DrawProcessor");dojo.declare("drawboard.drawProcessor.DrawProcessor",null,{draw:function(gp,_245){}});}if(!dojo._hasResource["drawboard._Selector"]){dojo._hasResource["drawboard._Selector"]=true;dojo.provide("drawboard._Selector");(function(){var _246=drawboard.Constant,_247=_246.ActionStatus,_248=_246.MouseAction,_249=common.calc.Geometry;dojo.declare("drawboard._Selector",drawboard.container.LayoutContainer,{_events:null,_status:_247.NONE,_mouseStatus:_248.NONE,_active:null,_decorate:null,_graphStrategy:null,_isMark:false,_isSelecting:false,lastScrollTop:0,lastScrollLeft:0,cache:null,postCreate:function(host){this._events=[dojo.connect(host,"onmousemove",dojo.hitch(this,"doMouseMove")),dojo.connect(host,"onmousedown",dojo.hitch(this,"doMouseDown")),dojo.connect(host,"onmouseup",dojo.hitch(this,"doMouseUp")),dojo.connect(host,"onmouseover",dojo.hitch(this,"doMouseOver")),dojo.connect(host,"onclick",dojo.hitch(this,"doClick")),dojo.connect(window,"onkeydown",dojo.hitch(this,"doKeyDown")),dojo.connect(window,"onkeyup",dojo.hitch(this,"doKeyUp")),dojo.connect(this.domNode,"onscroll",dojo.hitch(this,"doScroll"))];},getStatusCache:function(){if(!this.cache){this.cache={};}return this.cache;},setStatusCache:function(gp,_24a,_24b){var _24c=this.getStatusCache();gp&&(_24c.active=gp);_24a&&(_24c.decorate=_24a);_24c.status=_24b;},setStatus:function(gp,_24d,_24e){var _24f=this._active,_250;if(_24f&&_24f!=gp){_250=_24f.getParent&&_24f.getParent();if(_24f.isComposite()&&!_24f.contains(gp)){_24f.isFocus(false);}_24f.isActive(false);if(_250&&!_250.contains(gp)){_250.isFocus(false);_250.isActive(false);}}this._active=gp;this._decorate=_24d;this._status=_24e;this.updateActive();},updateActive:function(){var gp=this.getActive();gp&&gp.isActive(true)&&gp.isComposite()&&gp.isFocus(true);},getMouseStatus:function(){return this._mouseStatus;},setMouseStatus:function(_251){this._mouseStatus=_251;},getActionStatus:function(){return this._status;},setActionStatus:function(_252){this._status=_252;},getDecorate:function(){return this._decorate;},setDecorate:function(d){this._decorate=d;},getActive:function(){return this._active;},setActive:function(gp){this._active=gp;},setDrawType:function(_253){this._graphStrategy=_253;this._isSelecting=false;this._isMark=false;},getDrawType:function(){return this._graphStrategy;},isSelecting:function(_254){this._isSelecting=_254;if(_254){this._isMark=false;this._graphStrategy=null;}},isMark:function(mark){this._isMark=mark;if(mark){this._isSelecting=false;this._graphStrategy=null;}},doClick:function(e){this.setMouseStatus(_248.MOUSECLICK);},doMouseMove:function(e){if(this.getMouseStatus()==_248.MOUSEDOWN){var _255=this.getActive(),_256=this.getStatusCache(),_257=_256.active,_258=_257&&_257.getParent&&_257.getParent(),_259=drawboard.relationController,_25a=this.getDecorate(),_25b=this.getRuntime();_255&&_259.containRestrain(_255,_25a,_25b)&&this.addCommand(_246.Command.ADDVSDELTECONSTRAINCOMMAND,_259,{restrainedGp:_255,restrainedD:_25a},false);if(_257&&_257.isComposite()&&_255){!_255.isActive(false)&&_255.isComposite()&&_255.isFocus(false);_257.isActive(true);_257.isFocus(true);_258&&_258.isFocus(true);this._active=_257;}}this.setMouseStatus(_248.MOUSEMOVE);},doMouseDown:function(e){var d=drawboard,_25c=d.markController,_25d=this.fetchCoordinate(e),_25e,_25f=this.getRuntime(),_260=dojo.hitch(_25f.getDrawProcessor(),"setActive"),_261=this.getSelectRect();this.setMouseStatus(_248.MOUSEDOWN);if(this._graphStrategy){this.setStatus(null,null,_247.DRAWING);return;}_261&&(_25e=_260(_261,_25d,this._isMark,_25c,_25f));if(!_25e){this.some(function(gp){_25e=_260(gp,_25d,this._isMark,_25c,_25f);if(_25e){return true;}},this,true);}if(this.getActive()&&e.ctrlKey&&_25e&&_25e.active){_25e=_25e.active;if(_261){if(_261.contains(_25e)){return;}_261.add(_25e,_25f);}else{var _262=this.getActive();if(!_262){return;}if(_262.isComposite()&&_262.contains(_25e)){return;}var rect=_249.getMaxRect([_25e.getGraphCoordinates(_25f).concat(_262.getGraphCoordinates(_25f))]),_261=new drawboard.graph.CompositeProxy(new drawboard.graph.GraphStatus({_coordinate:{x:rect.x,y:rect.y},_w:rect.width,_h:rect.height}),this.getSRGraphStrategyClass());_262.isActive(false);_261.add(_262,_25f);_261.add(_25e,_25f);this.setSelectRect(_261);this.setStatus(_261,null,_247.MOVING);}this.draw();return;}if(_261){if(!_25e){this.setSelectRect(null);this.draw();return;}this.setStatus(_25e.active,_25e.decorate,_25e.status);return;}if(!_25e){this.setStatus(null,null,_247.SELECTING);}else{this.setStatus(_25e.active,_25e.decorate,_25e.status);}},doMouseOver:function(e){this.setMouseStatus(_248.MOUSEOVER);},doMouseUp:function(e){this.setMouseStatus(_248.MOUSEUP);this.setStatusCache(this._active,this._decorate,this._status);this._status=_247.NONE;this._decorate=null;},doKeyDown:function(e){var gp=this.getActive(),_263=this.getSelectRect(),keys=dojo.keys,_264=_246.Command,_265=dojo.hitch(this,"addCommand");if(gp&&e.keyCode==keys.DELETE&&!e.ctrlKey){_265(_264.CREATEVSDELETECOMMAND,this,gp,true);_263&&this.setSelectRect(null);}if(e.keyCode==keys.UP_ARROW){_265(_264.ZOOMCOMMAND,this,{x:10,y:10});}if(e.keyCode==keys.DOWN_ARROW){_265(_264.ZOOMCOMMAND,this,{x:-10,y:-10});}if(e.keyCode==90&&e.ctrlKey){this.undo();}if(e.keyCode==89&&e.ctrlKey){this.redo();}this.draw();},doKeyUp:function(e){this.clearCommand();},doScroll:function(e){var _266=e.target||e.srcElement;if(_266!=this.domNode){return;}var top=_266.scrollTop,left=_266.scrollLeft,_267=this.lastScrollTop,_268=this.lastScrollLeft;if(top!=_267){this.fireListener(["doScroll",[false,top-_267]]);this.lastScrollTop=top;return;}if(left!=_268){this.fireListener(["doScroll",[true,left-_268]]);this.lastScrollLeft=left;}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);}});})();}if(!dojo._hasResource["drawboard.graphic.Graphic"]){dojo._hasResource["drawboard.graphic.Graphic"]=true;dojo.provide("drawboard.graphic.Graphic");dojo.declare("drawboard.graphic.Graphic",null,{createAnchor:function(w,h){},setStyle:function(_269){},drawLine:function(_26a,w,h){},drawRect:function(_26b,w,h){},drawCircle:function(_26c,r){},drawPath:function(_26d){},drawImage:function(_26e,w,h,url,_26f){},setSize:function(w,h){},clear:function(){}});}if(!dojo._hasResource["drawboard.graphic.SVGGraphic"]){dojo._hasResource["drawboard.graphic.SVGGraphic"]=true;dojo.provide("drawboard.graphic.SVGGraphic");(function(){var _270="http://www.w3.org/2000/svg",_271="http://www.w3.org/1999/xlink",attr=dojo.attr,_272=window.location.pathname,_273=_272.substring(0,_272.indexOf("/",1)+1),_274=function(node,ns,_275,_276){node.setAttributeNS(ns,_275,_276);},_277=function(ele){return document.createElementNS(_270,ele);};dojo.declare("drawboard.graphic.SVGGraphic",drawboard.graphic.Graphic,{anchor:null,createAnchor:function(w,h){var node=_277("svg");w&&attr(node,"width",w);h&&attr(node,"height",h);this.anchor=node;return node;},setSize:function(w,h){var node=this.anchor;w&&attr(node,"width",w);h&&attr(node,"height",h);},drawPath:function(_278,_279,open){var path=_277("path"),d=[],ps;dojo.forEach(_278,function(item){if(typeof item=="string"){this.push(item);}else{this.push(item.command);ps=item.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((p.x?(p.y?p.x+","+p.y:p.x):p.y)+" ");},this);}},d);!open&&d.push("Z");attr(path,"d",d.join(""));_279&&attr(path,"style",_279);this.anchor.appendChild(path);return path;},drawCircle:function(_27a,r,_27b){var _27c=_277("circle");attr(_27c,"cx",_27a.x);attr(_27c,"cy",_27a.y);attr(_27c,"r",r);_27b&&attr(_27c,"style",_27b);this.anchor.appendChild(_27c);return _27c;},drawLine:function(p1,p2,_27d){var line=_277("line");attr(line,"x1",p1.x);attr(line,"y1",p1.y);attr(line,"x2",p2.x);attr(line,"y2",p2.y);_27d&&attr(line,"style",_27d);this.anchor.appendChild(line);return line;},drawRect:function(_27e,w,h,rx,_27f,_280){var rect=_277("rect");attr(rect,"x",_27e.x);attr(rect,"y",_27e.y);attr(rect,"width",w);attr(rect,"height",h);if(_27f){for(var item in _27f){attr(rect,item,((_27f[item] instanceof Array)?_27f[item].join(" "):_27f[item]));}}(rx!==undefined&&rx!=null)&&(attr(rect,"rx",rx));_280&&attr(rect,"style",_280);this.anchor.appendChild(rect);return rect;},drawImage:function(_281,w,h,url,_282){var _283=_277("image");_281&&attr(_283,"x",_281.x);_281&&attr(_283,"y",_281.y);attr(_283,"width",w);attr(_283,"height",h);_274(_283,_271,"xlink:href",_273+url);if(_282){for(var item in _282){attr(_283,item,_282[item] instanceof Array?_282[item].join(" "):_282[item]);}}this.anchor.appendChild(_283);return _283;},clear:function(){var _284=this.anchor;while(_284.lastChild){_284.removeChild(_284.lastChild);}}});})();}if(!dojo._hasResource["drawboard.controller.ParamsController"]){dojo._hasResource["drawboard.controller.ParamsController"]=true;dojo.provide("drawboard.controller.ParamsController");(function(){dojo.declare("drawboard.controller.ParamsController",null,{_distance:5,rotate_distance:20,rounder:10,getDistance:function(){return this._distance;},setDistance:function(_285){this._distance=_285;},getRotateDistance:function(){return this.rotate_distance;},setRotateDistance:function(_286){this.rotate_distance=_286;},getRounder:function(){return this.rounder;}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.Controller"]){dojo._hasResource["drawboard.graph.decorate.controller.Controller"]=true;dojo.provide("drawboard.graph.decorate.controller.Controller");dojo.declare("drawboard.graph.decorate.controller.Controller",null,{draw:function(gp,_287){},active:function(gp,_288,_289){},create:function(ps){return null;},getStyle:function(gp,_28a,_28b){return _28b.getContext().getStyleCtrl().getStyle(this.type,gp,_28a);}});}if(!dojo._hasResource["drawboard.graph.decorate.controller.MarkController"]){dojo._hasResource["drawboard.graph.decorate.controller.MarkController"]=true;dojo.provide("drawboard.graph.decorate.controller.MarkController");(function(){var _28c=common.calc.Geometry;dojo.declare("drawboard.graph.decorate.controller.MarkController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.MARK,draw:function(gp,_28d){var _28e,mark=new drawboard.graph.decorate.Mark(),gf=_28d.getGraphic();dojo.forEach(gp.getMarkCoordinates(_28d),function(item,_28f){_28e=[item[1],item[3],item[2],item[4]];mark.setCoordinate(_28e);mark.setIndex(_28f);mark.draw(gf,this.getStyle(gp,mark,_28d),_28d);},this);},active:function(gp,_290,_291){var mark;dojo.some(gp.getMarkCoordinates(_291),function(item,_292){item=[item[1],item[3],item[2],item[4]];if(_28c.isPointInPolyn(item,_290)){mark=new drawboard.graph.decorate.Mark({coordinate:item,index:_292});return true;}},this);return mark;},create:function(ps){var mark,_293=[];dojo.forEach(ps,function(item,_294){mark=[item[1],item[3],item[2],item[4]];mark=new drawboard.graph.decorate.Mark({coordinate:skeleton,index:_294});_293.push(mark);},this);return _293;},cross:function(s,cgp,db,_295){var _296,_297=drawboard.skeletonController,mark,_298={};db.some(function(gp){if(gp==cgp){return false;}_296=gp.getMarkCoordinates(_295);dojo.some(_296,function(item,_299){item=[item[1],item[3],item[2],item[4]];dojo.some(item,function(p){if(_297.isIn(s.getCoordinate(),p,_295)){mark=true;return true;}},this);if(mark){_298.d=new drawboard.graph.decorate.Mark({coordinate:item,index:_299});return true;}},this);if(mark){_298.gp=gp;return true;}},this,true);if(mark){_298.restrainedGp=cgp;_298.restrainedD=s;return _298;}return null;}});if(!drawboard.markController){drawboard.markController=new drawboard.graph.decorate.controller.MarkController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.MotionAnchor"]){dojo._hasResource["drawboard.graph.decorate.MotionAnchor"]=true;dojo.provide("drawboard.graph.decorate.MotionAnchor");(function(){var _29a=drawboard.Constant;dojo.declare("drawboard.graph.decorate.MotionAnchor",drawboard.graph.decorate.Decorator,{_type:_29a.Decorate.MOTIONANCHOR,draw:function(gp,_29b,_29c){var p=this.getCoordinate(),path=_29a.Path,_29d=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.LINE,points:p[2]},{command:path.LINE,points:p[3]}];gp.drawPath(_29d,_29b);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.MotionAnchorController"]){dojo._hasResource["drawboard.graph.decorate.controller.MotionAnchorController"]=true;dojo.provide("drawboard.graph.decorate.controller.MotionAnchorController");(function(){var _29e=common.calc.Geometry,_29f=common.utils.CollectionUtils;dojo.declare("drawboard.graph.decorate.controller.MotionAnchorController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.MOTIONANCHOR,draw:function(gp,_2a0){var _2a1,_2a2=new drawboard.graph.decorate.MotionAnchor(),gf=_2a0.getGraphic(),_2a3=gp.getMotionAnchorCoordinates(_2a0);_2a3&&dojo.forEach(_2a3,function(item,_2a4){_2a1=_29f.sliceRange(item,1,4);_2a2.setCoordinate(_2a1);_2a2.setIndex(_2a4),_2a2.draw(gf,this.getStyle(gp,_2a2,_2a0),_2a0);},this);},active:function(gp,_2a5,_2a6){var _2a7,_2a8=gp.getMotionAnchorCoordinates(_2a6);_2a8&&dojo.some(_2a8,function(item,_2a9){item=_29f.sliceRange(item,1,4);if(_29e.isPointInPolyn(item,_2a5)){_2a7=new drawboard.graph.decorate.MotionAnchor({coordinate:item,index:_2a9});return true;}},this);return _2a7;}});if(!drawboard.motionAnchorController){drawboard.motionAnchorController=new drawboard.graph.decorate.controller.MotionAnchorController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Rotator"]){dojo._hasResource["drawboard.graph.decorate.Rotator"]=true;dojo.provide("drawboard.graph.decorate.Rotator");(function(){var _2aa=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Rotator",drawboard.graph.decorate.Decorator,{_type:_2aa.Decorate.ROTATOR,pole:null,angle:null,draw:function(gf,_2ab,_2ac){var r=_2ac.getDistance(),p=_2aa.Path,path=[],_2ad=this.getCoordinate();gf.drawCircle(_2ad[3],r,_2ab);gf.drawLine(_2ad[2],_2ad[1],_2ab);gf.drawCircle({x:_2ad[0].x,y:_2ad[0].y-r},r,_2ab);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.RotatorController"]){dojo._hasResource["drawboard.graph.decorate.controller.RotatorController"]=true;dojo.provide("drawboard.graph.decorate.controller.RotatorController");(function(){var _2ae=common.calc.Geometry;dojo.declare("drawboard.graph.decorate.controller.RotatorController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.ROTATOR,draw:function(gp,_2af){if(!gp.hasRotator()){return;}var _2b0=gp.getRotatorCoordinates(_2af),_2b1;_2b1=gp.getRotator(_2af);_2b1=new drawboard.graph.decorate.Rotator({pole:_2b1.coordinate,angle:_2b1.angle,coordinate:_2b0});_2b1.draw(_2af.getGraphic(),this.getStyle(gp,_2b1,_2af),_2af);},active:function(gp,_2b2,_2b3){if(!gp.hasRotator()){return null;}var _2b4;if(this.isIn(gp,_2b2,_2b3)){_2b4=gp.getRotator(_2b3);_2b4=new drawboard.graph.decorate.Rotator({coordinate:gp.getRotatorCoordinates(_2b3),pole:_2b4.pole,angle:_2b4.angle});}return _2b4;},isIn:function(gp,_2b5,_2b6){if(!gp.hasRotator()){return false;}var r=_2b6.getDistance(),_2b7=gp.getRotatorCoordinates(_2b6);if(_2ae.isPointInCircle(_2b5,{coordinate:_2b7[3],r:r})||_2ae.isPointInCircle(_2b5,{coordinate:_2b7[5],r:r})||_2ae.isPointInSegment(_2b7[1],_2b7[4],_2b5)){return true;}return false;},isInPole:function(gp,_2b8,_2b9){if(!gp.hasRotator()){return false;}var _2ba=gp.getRotatorCoordinates(_2b9);if(_2ae.isPointInCircle(_2b8,{coordinate:_2ba[3],r:_2b9.getDistance()})){return true;}return false;}});if(!drawboard.rotatorController){drawboard.rotatorController=new drawboard.graph.decorate.controller.RotatorController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Skeleton"]){dojo._hasResource["drawboard.graph.decorate.Skeleton"]=true;dojo.provide("drawboard.graph.decorate.Skeleton");(function(){var _2bb=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Skeleton",drawboard.graph.decorate.Decorator,{_type:_2bb.Decorate.SKELETON,_direct:null,_isAnchored:false,anchored:function(_2bc){this._isAnchored=_2bc;},isAnchored:function(){return this._isAnchored;},getDirect:function(){var _2bd=this._direct,t;if(typeof _2bd=="number"){return _2bd;}if(_2bd!==null&&_2bd!==undefined){var d=_2bb.Direction;switch(_2bd){case "mover_n":t=d.NORTH;break;case "mover_s":t=d.SOUTH;break;case "mover_w":t=d.WEST;break;case "mover_e":t=d.EAST;break;case "mover_nw":t=d.WESTNORTH;break;case "mover_ne":t=d.EASTNORTH;break;case "mover_sw":t=d.WESTSOUTH;break;case "mover_se":t=d.EASTSOUTH;break;default:t=d.NORTH;break;}this._direct=t;}return t;},draw:function(gp,_2be,_2bf){var p=this.getCoordinate(),path=_2bb.Path;paths=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.LINE,points:p[2]},{command:path.LINE,points:p[3]}];gp.drawPath(paths,_2be);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.SkeletonController"]){dojo._hasResource["drawboard.graph.decorate.controller.SkeletonController"]=true;dojo.provide("drawboard.graph.decorate.controller.SkeletonController");(function(){var _2c0=common.calc.Geometry,_2c1=common.utils.CollectionUtils;dojo.declare("drawboard.graph.decorate.controller.SkeletonContainer",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.SKELETON,draw:function(gp,_2c2){var _2c3,_2c4=new drawboard.graph.decorate.Skeleton(),gf=_2c2.getGraphic();dojo.forEach(gp.getSkeletonCoordinates(_2c2),function(item,_2c5){_2c3=_2c1.sliceRange(item,1,4);_2c4.setCoordinate(_2c3);_2c4.setIndex(_2c5);item[0].isAnchored&&_2c4.anchored(item[0].isAnchored);_2c4.draw(gf,this.getStyle(gp,_2c4,_2c2),_2c2);},this);},isIn:function(ps,_2c6,_2c7){return _2c0.isPointInPolyn(ps,_2c6);},active:function(gp,_2c8,_2c9){var _2ca,gs=gp.getGraphStrategy(),temp;dojo.some(gp.getSkeletonCoordinates(_2c9),function(item,_2cb){temp=_2c1.sliceRange(item,1,4);if(this.isIn(temp,_2c8,_2c9)){_2ca=new drawboard.graph.decorate.Skeleton({coordinate:temp,index:_2cb,_direct:item[0].css});gs.isAnchor(_2ca)&&_2ca.anchored(true);return true;}},this);return _2ca;},create:function(ps){var _2cc=[];dojo.forEach(ps,function(item,_2cd){_2cc.push(this.createItem(item,_2cd));},this);return _2cc;},createItem:function(ps,_2ce){var _2cf=new drawboard.graph.decorate.Skeleton({coordinate:_2c1.sliceRange(ps,1,4),index:_2ce,_direct:ps[0].css});ps[0].isAnchored&&_2cf.anchored(true);return _2cf;}});if(!drawboard.skeletonController){drawboard.skeletonController=new drawboard.graph.decorate.controller.SkeletonContainer();}})();}if(!dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DbDrawProcessor");(function(){dojo.declare("drawboard.drawProcessor.DbDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_2d0){if(gp.isComposite()&&!gp.isFocus()){return;}gp.draw(_2d0);if(gp.isActive()){drawboard.skeletonController.draw(gp,_2d0);drawboard.motionAnchorController.draw(gp,_2d0);drawboard.rotatorController.draw(gp,_2d0);}((_2d0.getShowMark()||gp.showMark())||gp.isActive()||gp.isActived())&&drawboard.markController.draw(gp,_2d0);},setActive:function(gp,p,only,_2d1,_2d2){var _2d3=drawboard.Constant.ActionStatus,_2d4,_2d5;if(gp&&gp.isActive()){var _2d6=[{controller:drawboard.skeletonController,status:_2d3.RESIZING},{controller:drawboard.rotatorController,status:[_2d3.POLEMOVING,_2d3.ROTATING]},{controller:drawboard.markController,status:_2d3.MARKING},{controller:drawboard.motionAnchorController,status:_2d3.MOTION}],_2d7,_2d8,_2d9;dojo.some(_2d6,function(item){_2d7=item.controller;if(only&&_2d7!=_2d1){return;}if(!only&&_2d7==_2d1){return;}_2d8=_2d7.active(gp,p,_2d2);if(_2d8){_2d4={};_2d9=item.status;if(dojo.isArray(_2d9)){if(_2d7.isInPole(gp,p,_2d2)){_2d4.status=_2d9[0];}else{_2d4.status=_2d9[1];}}else{_2d4.status=_2d9;}_2d4.active=gp;_2d4.decorate=_2d8;return true;}},this);}if(!_2d4&&gp.isComposite()){return null;}if(!_2d4&&gp.active(p,_2d2)){_2d5=this.getActiveParent(gp);_2d4={};_2d4.status=_2d3.MOVING;if(_2d5&&!_2d5.isFocus()){gp=_2d5;}_2d4.active=gp;_2d4.decorate=null;}return _2d4;},getActiveParent:function(gp){var _2da=(gp.getParent&&gp.getParent()),_2db,_2dc;do{if(!_2da||_2da.isFocus()){_2dc=_2db;break;}_2db=_2da;_2da=(_2db.getParent&&_2db.getParent());}while(true);return _2dc;}});})();}if(!dojo._hasResource["drawboard.context.ExecuteContext"]){dojo._hasResource["drawboard.context.ExecuteContext"]=true;dojo.provide("drawboard.context.ExecuteContext");(function(){var _2dd=common.calc.Geometry;dojo.declare("drawboard.context.ExecuteContext",dijit._Widget,{zoom:{x:100,y:100},paramsCtrl:null,styleCtrl:null,commandCtrl:null,drawProcessor:null,getZoom:function(){return _2dd.dividePoint(this.zoom,{x:100,y:100})[0];},setZoom:function(rate){var zoom=_2dd.add2Points(this.zoom,rate);if(zoom.x<0||zoom.y<0||zoom.x>200||zoom.y>200){return false;}this.zoom=zoom;return true;},getParamsCtrl:function(){if(!this.paramsCtrl){new common.exception.Exception({msg:"the parameters controller in context doesnt' exist!"});}return this.paramsCtrl;},setParamsCtrl:function(_2de){this.paramsCtrl=_2de;},getCommandCtrl:function(){if(!this.commandCtrl){new common.exception.Exception({msg:"the command controller in context doesnt' exist!"});}return this.commandCtrl;},setCommandCtrl:function(_2df){this.commandCtrl=_2df;},setStyleCtrl:function(_2e0){if(!this.styleCtrl){new common.exception.Exception({msg:"the style controller in context doesnt' exist!"});}this.styleCtrl=_2e0;},getStyleCtrl:function(){return this.styleCtrl;},getDrawProcessor:function(){if(!this.drawProcessor){new common.exception.Exception({msg:"the draw processor in context doesnt' exist!"});}return this.drawProcessor;},setDrawProcessor:function(_2e1){this.drawProcessor=_2e1;}});})();}if(!dojo._hasResource["drawboard.runtime.ExecuteRuntime"]){dojo._hasResource["drawboard.runtime.ExecuteRuntime"]=true;dojo.provide("drawboard.runtime.ExecuteRuntime");dojo.declare("drawboard.runtime.ExecuteRuntime",[dijit._Widget,common.Cache,common.listener.Listener],{context:null,graphic:null,_showMark:false,setShowMark:function(_2e2){this._showMark=_2e2;},getShowMark:function(){return this._showMark;},apply:function(_2e3,_2e4){this[_2e3]&&this[_2e3].apply(this,_2e4);},createCache:function(){return {};},getCache:function(gp){var _2e5=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this),item=_2e5[gp.getIdty()];(!item)&&(_2e5[gp.getIdty()]=item={});return item;},addCache:function(gp,type,_2e6){var _2e7=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this),item=_2e7[gp.getIdty()];(!item)&&(_2e7[gp.getIdty()]=item={});item[type]=_2e6;},clearCache:function(gp,type){var _2e8=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this);if(type!==undefined&&type!==null){var item=_2e8[gp.getIdty()];if(item){item[type]=null;delete item[type];}this.fireListener(["clearCache",[gp,type]]);return;}_2e8[gp.getIdty()]=null;delete _2e8[gp.getIdty()];this.fireListener(["clearCache",[gp]]);},getContext:function(){if(!this.context){new common.exception.Exception({msg:"the context in runtime doesnt' exist!"});}return this.context;},setContext:function(_2e9){this.context=_2e9;},getGraphic:function(){if(!this.graphic){new common.exception.Exception({msg:"the graphic in runtime doesnt' exist!"});}return this.graphic;},setGraphic:function(gf){this.graphic=gf;},getDistance:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getDistance();},getRotateDistance:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getRotateDistance();},getRounder:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getRounder();},getDrawProcessor:function(){return this.getContext().getDrawProcessor();},draw:function(gp){this.getDrawProcessor().draw(gp,this);},zoom:function(gp,rate){gp.zoom(rate,this);}});}if(!dojo._hasResource["drawboard.controller.CommandController"]){dojo._hasResource["drawboard.controller.CommandController"]=true;dojo.provide("drawboard.controller.CommandController");dojo.declare("drawboard.controller.CommandController",common.container.MapContainer,{resouce:drawboardRuntimeSetting.commands,_undoList:null,_redoList:null,maxSteps:20,store:null,constructor:function(){var list=common.container.ListContainer;this._undoList=new list();this._redoList=new list();this.render();},getReadStore:function(){var _2ea=this.store;if(!_2ea){_2ea=new dojo.data.ItemFileReadStore({url:this.resouce});_2ea._forceLoad();this.store=_2ea;}return this.store;},render:function(){var _2eb=this.getReadStore(),type,_2ec,_2ed,_2ee;dojo.forEach(_2eb._getItemsArray(),function(item){type=_2eb.getValue(item,"type");_2ec=_2eb.getValue(item,"command");_2ed=_2eb.getValue(item,"desp0");_2ee=_2eb.getValue(item,"desp1");this.registerCommand(type,_2ec,_2ed,_2ee);},this);},registerCommand:function(type,_2ef,_2f0,_2f1){this.addItem(type,{command:_2ef,0:_2f0,1:_2f1});},instanceCommand:function(type,_2f2,memo,_2f3,_2f4){var item=this.getItem(type),_2f5,_2f6;if(!item){new common.exception.Exception({msg:"the command type doesn't exsit!"});return;}_2f6=eval(item.command);_2f5=new _2f6(_2f2,memo,_2f3);_2f5.setDescription({0:item.desp0,1:item.desp1});_2f5.setRuntime(_2f4);return _2f5;},add:function(_2f7){var _2f8=this._undoList;_2f8.add(_2f7);if(_2f8.size()>this.maxSteps){_2f8.shift();}this._redoList.clearItems();},undo:function(){var _2f9=this._undoList.pop();if(!_2f9){return;}_2f9.unexecute();this._redoList.add(_2f9);},redo:function(){var _2fa=this._redoList.pop();if(!_2fa){return;}_2fa.execute();this._undoList.add(_2fa);}});}if(!dojo._hasResource["drawboard.DrawBoard"]){dojo._hasResource["drawboard.DrawBoard"]=true;dojo.provide("drawboard.DrawBoard");dojo.declare("drawboard.DrawBoard",[dijit._Templated,drawboard._Selector,drawboard._Event,common.listener.Listener],{templateString:"<div></div>",dbCanvas:null,graphicClass:drawboard.graphic.SVGGraphic,_graphic:null,anchor:null,w:null,h:null,defaultWidth:300,defaultHeight:300,_selectRect:null,_runtime:null,SRGraphStrategyClass:"drawboard.graph.strategy.RectangleStrategy",graphStrategyParam:null,drawEntity:null,_commands:null,postCreate:function(){var _2fb=this.createGraphic(),node,_2fc=drawboard.controller,ctx,_2fd,w=this.w,h=this.h,_2fe=this.domNode.style;_2fd=dojo.create("div",{},this.domNode);_2fe.overflow="auto";_2fe.width=w+"px";_2fe.height=h+"px";this.dbCanvas=_2fd;node=_2fb.createAnchor(w||this.defaultWidth,h||this.defaultHeight);this.anchor=node;ctx=new drawboard.context.ExecuteContext({paramsCtrl:new _2fc.ParamsController(),styleCtrl:new _2fc.StyleController(),commandCtrl:new _2fc.CommandController(),drawProcessor:new drawboard.drawProcessor.DbDrawProcessor()});this._runtime=new drawboard.runtime.ExecuteRuntime({context:ctx,graphic:_2fb});drawboard.DrawBoard.superclass.postCreate.call(this,node);_2fd.appendChild(this.anchor);},getGraphic:function(){return this.getRuntime().getGraphic();},getRuntime:function(){return this._runtime;},setRuntime:function(_2ff){this._runtime=_2ff;},setGraphStrategyParam:function(_300){this.graphStrategyParam=_300;},getGraphStrategyParam:function(){return this.graphStrategyParam;},createGraphic:function(){return new this.graphicClass();},getDrawEntity:function(_301){if(!this.drawEntity&&_301){this.drawEntity={};}return this.drawEntity;},getCanvasSize:function(){var zoom=this.getRuntime().getContext().getZoom();return {x:this.w*zoom.x,y:this.h*zoom.y};},getUserViewSize:function(){var _302=this.domNode;return {x:_302.clientWidth,y:_302.clientHeight};},clearDrawEntity:function(_303){var _304=this.drawEntity,_305=this.graphStrategyParam;if(_304&&!_303){var gs=new drawboard.graph.GraphStatus({_coordinate:{x:_304.x,y:_304.y},_w:_304.width,_h:_304.height}),gp=new drawboard.graph.GraphProxy(gs,this.getDrawType());_305&&_305.url&&(gs.setUrl(_305.url));_305&&_305.ratio&&(gs.setRatio(_305.ratio));this.addCommand(drawboard.Constant.Command.CREATEVSDELETECOMMAND,this,gp);}this.drawEntity=null;this.graphStrategyParam=null;},getSRGraphStrategyClass:function(){return this.SRGraphStrategyClass;},setSRGraphStrategyClass:function(_306){this.SRGraphStrategyClass=_306;},getSelectRect:function(){return this._selectRect;},setSelectRect:function(_307){var _308=this._selectRect;if(_307==_308){return;}_308&&_308.destroy();this._selectRect=_307;},containsSelectRect:function(_309){var _30a=false;this.some(function(gp){if(gp.isComposite()&&gp.equals(_309)){_30a=true;return true;}},this);return _30a;},combine:function(){var _30b=this.getSelectRect();_30b&&!this.containsSelectRect(_30b)&&!_30b.resetRelations()&&this.combineGraph(_30b);this._selectRect=null;},combineGraph:function(gp){this.add(gp);},divide:function(){var gp=this.getActive();this.divideGraph(gp);},divideGraph:function(gp){if(gp&&gp.isComposite()){gp.destroy();this.remove(gp);}},addGraph:function(gs,_30c){var _30d=new drawboard.graph.GraphProxy(gs,_30c);this.add(_30d);},removeGraph:function(gp){gp.deleteAll(this,this.getRuntime());this.getRuntime().getContext().getStyleCtrl().removeGraph(gp);this.remove(gp);},getGraph:function(idty){var gs;this.some(function(item){if(item.getIdty()==idty){gs=item;return true;}});return gs;},zoom:function(rate,_30e){var _30f=dojo.clone(_30e.getContext().getZoom());if(!_30e.getContext().setZoom(rate)){return;}var zoom=_30e.getContext().getZoom(),_310=this.dbCanvas.style,gf=this.getGraphic(),w=this.w*zoom.x,h=this.h*zoom.y,_311=this.domNode,_312=common.calc.Geometry,_313=this.getSelectRect(),_314;_314={x:_311.scrollLeft+(this.w>>1),y:_311.scrollTop+(this.h>>1)};_314=_312.dividePoint(_314,_30f)[0];_314=_312.multiPoint(_314,zoom)[0];_310.width=w+"px";_310.height=h+"px";_311.scrollLeft=_314.x-(this.w>>1);_311.scrollTop=_314.y-(this.h>>1);gf.setSize(w,h);this.forInItems(function(gp){gp&&_30e.zoom(gp,zoom);},this,true);_313&&_30e.zoom(_313,zoom);this.fireListener(["zoom",[rate]]);},draw:function(){this.clearGraphs();var _315=this.getSelectRect(),_316=this.getDrawEntity(),_317=this.getRuntime();this.drawGraphs(_317);if(_316){var gs=new drawboard.graph.GraphStatus({_coordinate:{x:_316.x,y:_316.y},_w:_316.width,_h:_316.height}),_318=new drawboard.graph.GraphProxy(gs,this.getDrawType()||this.getSRGraphStrategyClass()),_319=this.graphStrategyParam;_319&&_319.url&&(gs.setUrl(_319.url));_319&&_319.ratio&&(gs.setRatio(_319.ratio));_318.showMark(false);_317.draw(_318);}_315&&(_317.draw(_315));this.fireListener(["draw"]);},drawGraphs:function(_31a){this.forInItems(function(gp){gp&&_31a.draw(gp);},this);},clearGraphs:function(){this.getGraphic().clear();},setStyle:function(_31b,_31c){var gp=this.getActive();gp&&this.addCommand(drawboard.Constant.Command.STYLECOMMAND,this.getRuntime().getContext().getStyleCtrl(),{gp:gp,attr:_31b,value:_31c});this.clearCommand();this.draw();},getCommandCtrl:function(){return this.getRuntime().getContext().getCommandCtrl();},getCommands:function(){var _31d=this._commands;if(!_31d){_31d=this._commands=new drawboard.command.CompositeCommand();this.getCommandCtrl().add(_31d);}return _31d;},addCommand:function(type,_31e,memo,_31f){var _320=this.getCommandCtrl().instanceCommand(type,_31e,memo,_31f,this.getRuntime());_320.execute();this.getCommands().add(_320);},clearCommand:function(){this._commands=null;},undo:function(){this.getCommandCtrl().undo();this.draw();},redo:function(){this.getCommandCtrl().redo();this.draw();}});}if(!dojo._hasResource["drawboard.drawProcessor.ZoomDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.ZoomDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.ZoomDrawProcessor");(function(){dojo.declare("drawboard.drawProcessor.ZoomDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_321){gp.draw(_321);}});})();}if(!dojo._hasResource["drawboard.ZoomDrawBoard"]){dojo._hasResource["drawboard.ZoomDrawBoard"]=true;dojo.provide("drawboard.ZoomDrawBoard");(function(){var _322=common.calc.Geometry,_323=drawboard.Constant.MouseAction,_324=_322.subtract2Points;dojo.declare("drawboard.ZoomDrawBoard",[dijit._Widget,dijit._Templated],{templateString:"<div style='position:relative;overflow:hidden;'><div dojoAttachPoint='zoomDrawboard'></div><div dojoAttachPoint='zoomRect' style='position:absolute;border:2px solid red;left:0px;top:0px;'></div></div>",graphicClass:drawboard.graphic.SVGGraphic,_graphic:null,anchor:null,w:null,h:null,_zoom:{x:100,y:100},rectBorder:2,defaultWidth:300,defaultHeight:300,_runtime:null,drawboard:null,events:null,boxCache:null,scopeSelf:false,postCreate:function(){var _325=this.createGraphic(),node,_326=drawboard.controller,ctx,db=this.getDrawBoard(),_327,_328=this.zoomRect,_329=this.domNode,_32a=this.rectBorder,w=this.w||this.defaultWidth,h=this.h||this.defaultHeight;node=_325.createAnchor(w,h);this.anchor=node;ctx=new drawboard.context.ExecuteContext({paramsCtrl:new _326.ParamsController(),styleCtrl:new _326.StyleController(),drawProcessor:new drawboard.drawProcessor.ZoomDrawProcessor(),zoom:{x:50,y:50}});this._runtime=_327=new drawboard.runtime.ExecuteRuntime({context:ctx,graphic:_325});this.zoomDrawboard.appendChild(this.anchor);_328.style.width=w+"px";_328.style.height=h+"px";_329.style.width=w+(_32a<<1)+"px";_329.style.height=h+(_32a<<1)+"px";this.events=[dojo.connect(_328,"onmousemove",dojo.hitch(this,"doMouseMove")),dojo.connect(_328,"onmousedown",dojo.hitch(this,"doMouseDown")),dojo.connect(_328,"onmouseup",dojo.hitch(this,"doMouseUp"))];db.addListener(this.apply,this);db.getRuntime().addListener(_327.apply,_327);},getDrawBoard:function(){if(!this.drawboard){new common.exception.Exception({msg:"the draw board can't find in the zoom window!"});}return this.drawboard;},setDrawBoard:function(_32b){this.drawboard=_32b;},setZoom:function(rate){var zoom=_324(this._zoom,{x:rate.x,y:rate.y});if(zoom.x<0||zoom.y<0||zoom.x>200||zoom.y>200){return false;}this._zoom=zoom;return true;},getZoom:function(){return _322.dividePoint(this._zoom,{x:100,y:100})[0];},getGraphic:function(){return this.getRuntime().getGraphic();},getRuntime:function(){return this._runtime;},setRuntime:function(_32c){this._runtime=_32c;},createGraphic:function(){return new this.graphicClass();},apply:function(_32d,_32e){this[_32d]&&this[_32d].apply(this,_32e);},zoom:function(rate){this._unitCache=null;if(!this.setZoom(rate)){return;}this.scopeSelf=true;var _32f=this.zoomRect,zoom=this.getDrawBoard().getRuntime().getContext().getZoom(),_330=_32f.style,w=this.w,h=this.h,rw=w/(zoom.x),rh=h/(zoom.y);_330.left=parseFloat(_330.left)+(parseFloat(_330.width)>>1)-(rw>>1)+"px";_330.top=parseFloat(_330.top)+(parseFloat(_330.height)>>1)-(rh>>1)+"px";_330.width=rw+"px";_330.height=rh+"px";this.draw();},draw:function(){this.clearGraphs();var db=this.getDrawBoard();db.drawGraphs(this.getRuntime());},clearGraphs:function(){var _331=this.anchor;while(_331.lastChild){_331.removeChild(_331.lastChild);}},getBoxCache:function(){if(!this.boxCache){var node=this.domNode,_332={left:node.offsetLeft,top:node.offsetTop};this.boxCache=_332;}return this.boxCache;},fetchCoordinate:function(e){var box=this.getBoxCache(),_333=this.domNode;return {x:e.pageX-box.left+_333.scrollLeft,y:e.pageY-box.top+_333.scrollTop};},getUnitPx:function(){if(!this._unitCache){var db=this.getDrawBoard(),_334=db.getCanvasSize(),_335=db.getUserViewSize(),_336=this.zoomRect.style;this._unitCache={x:(_334.x-_335.x)/(this.w-parseFloat(_336.width)),y:(_334.y-_335.y)/(this.h-parseFloat(_336.height))};}return this._unitCache;},status:_323.NONE,_start:null,_end:null,_loseAccuracyLeft:0,_loseAccuracyTop:0,_accuracy:100000,doMouseMove:function(e){if(this.status!=_323.MOUSEDOWN&&this.status!=_323.MOUSEMOVE){return;}var end=this.fetchCoordinate(e),_337=_324(end,this._start),_338=this.zoomRect.style,db=this.getDrawBoard(),_339=db.domNode,unit=this.getUnitPx(),temp,_33a=this._accuracy,top=parseFloat(_338.top)+_337.y,left=parseFloat(_338.left)+_337.x,_33b=db.getCanvasSize(),_33c=db.getUserViewSize(),_33d=parseFloat(_338.width),_33e=parseFloat(_338.height);this._start=end;(top<0)&&(top=0);(left<0)&&(left=0);this.scopeSelf=true;_338.top=top+"px";_338.left=left+"px";if(left==0){_339.scrollLeft=0;this._loseAccuracyLeft=0;}else{if((left+_33d)>this.w){_339.scrollLeft=_33b.x-_33c.x;_338.left=this.w-_33d+"px";}else{_339.scrollLeft=temp=_339.scrollLeft+_337.x*unit.x;temp=(temp*_33a-parseInt(temp)*_33a)/_33a;this._loseAccuracyLeft=temp=this._loseAccuracyLeft+temp;if(temp>=1){_339.scrollLeft+=1;this._loseAccuracyLeft=temp-1;}}}if(top==0){_339.scrollTop=0;this._loseAccuracyTop=0;}else{if((top+_33e)>this.h){_339.scrollTop=_33b.y-_33c.y;_338.top=this.h-_33e+"px";}else{_339.scrollTop=temp=_339.scrollTop+_337.y*unit.y;temp=(temp*_33a-parseInt(temp)*_33a)/_33a;this._loseAccuracyTop=temp=this._loseAccuracyTop+temp;if(temp>=1){_339.scrollTop+=1;this._loseAccuracyTop=temp-1;}}}this.status=_323.MOUSEMOVE;},doMouseDown:function(e){this._start=this.fetchCoordinate(e);this.status=_323.MOUSEDOWN;},doMouseUp:function(e){this.status=_323.MOUSEUP;},doScroll:function(_33f,_340){if(this.scopeSelf){this.scopeSelf=false;return;}var _341=this.zoomRect.style,unit=this.getUnitPx();if(_33f){_341.left=parseFloat(_341.left)+_340/unit.x+"px";}else{_341.top=parseFloat(_341.top)+_340/unit.y+"px";}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);}});})();}
