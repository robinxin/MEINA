/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is an optimized version of Dojo, built for deployment and not for
	development. To get sources and documentation, please visit:

		http://dojotoolkit.org
*/

if(!dojo._hasResource["drawboard.controller.StyleController"]){dojo._hasResource["drawboard.controller.StyleController"]=true;dojo.provide("drawboard.controller.StyleController");(function(){dojo.declare("drawboard.controller.StyleController",common.container.MapContainer,{_style:"fill:none;stroke:black;stroke-width:1",_activeStyle:"fill:none;stroke:red;stroke-width:1",resultIdentity:"serializeStr",actives:null,activedGp:null,setActives:function(_1,gp){this.actives=_1;this.activedGp&&this.activedGp.isActived(false);gp&&gp.isActived(true)&&(this.activedGp=gp);},getActives:function(){return this.actives;},init:function(_2){this._style=_2;},getDefaultStyle:function(){return this._style;},getGraphStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return this.getDefaultStyle();}return gs[this.resultIdentity];},getGraphStyleValue:function(gp,_3){var _4=this.getItem(gp.getIdty());if(_4){return _4[_3];}return null;},containGraphStyle:function(gp){var gs=this.getItem(gp.getIdty());if(!gs){return false;}return true;},addGraphStyle:function(gp,_5,_6){if(gp.isComposite()){return;}var gs=this.getItem(gp.getIdty());if(!gs){gs={fill:"none"};this.addItem(gp.getIdty(),gs);}gs[_5]=_6;gs[this.resultIdentity]=this.serialize(gs);},removeGraphStyle:function(gp,_7){if(gp.isComposite()){return;}var gs=this.getItem(gp.getIdty());if(!gs||!gs[_7]){return;}delete gs[_7];gs[this.resultIdentity]=this.serialize(gs);},removeGraph:function(gp){var _8=gp.getIdty(),gs=this.getItem(_8);if(!gs){return;}this.removeItem(_8);},serialize:function(sj){var _9=[];for(var _a in sj){if(_a!=this.resultIdentity){_9.push([_a,":",sj[_a]].join(""));}}if(!sj["stroke"]){_9.push(["stroke",":","black"].join(""));}if(!sj["stroke-width"]){_9.push(["stroke-width",":","1"].join(""));}if(!sj["fill"]){_9.push(["fill",":","none"].join(""));}return _9.join(";");},getStyle:function(_b,gp,d){var _c=this.getActives(),_d=false;if(d&&_c){dojo.some(_c,function(_e){if(_e.equal(d)){_d=true;}},this);if(_d){return this._activeStyle;}}return this.getGraphStyle(gp);}});})();}if(!dojo._hasResource["drawboard.Constant"]){dojo._hasResource["drawboard.Constant"]=true;dojo.provide("drawboard.Constant");drawboard.Constant={MouseAction:{NONE:0,MOUSEDOWN:1,MOUSEMOVE:2,MOUSEUP:3,MOUSEOVER:4,MOUSECLICK:5,MOUSEOUT:6},ActionStatus:{NONE:0,SELECTING:1,DRAWING:2,MOVING:3,MARKING:4,RESIZING:5,ROTATING:6,POLEMOVING:7,MOTION:8},Decorate:{SKELETON:0,MARK:1,ROTATOR:2,MOTIONANCHOR:3,CHARACTER:4,Graph:5,CENTER:6,OUTLET:7},Direction:{EAST:0,EASTNORTH:1,NORTH:2,WESTNORTH:3,WEST:4,WESTSOUTH:5,SOUTH:6,EASTSOUTH:7,END:8},Path:{NONE:"",MOVE:"M",RMOVE:"m",LINE:"L",RLINE:"l",HORIZON:"H",RHORIZON:"h",VERTICAL:"V",RVERTICAL:"v",CUBIC:"C",RCUBIC:"c",CUBICSMOOTH:"S",CUBICRSMOOTH:"s",QUADRATIC:"Q",RQUADRATIC:"q",QUADRATICSMOOTH:"T",RQUADRATICSMOOTH:"t",ARC:"A",RARC:"a",CLOSE:"Z",RCLOSE:"z"},Command:{CREATEVSDELETECOMMAND:"createvsdelete",RESIZECOMMAND:"resize",MOVECOMMAND:"move",ROTATECOMMAND:"rotate",ZOOMCOMMAND:"zoom",STYLECOMMAND:"style",ADDVSDELTECONSTRAINCOMMAND:"addvsdeleteconstrain",COMBINEVSDEVIDEDCOMMAND:"combinevsdevided",COMPOSITECOMMAND:"composite"},Symbol:{concat:"&&"},Toolbar:{COLORPALETTE:0,DROPDOWNLIST:1,DIALOGUE:2}};}if(!dojo._hasResource["drawboard.graph.strategy.GraphStrategy"]){dojo._hasResource["drawboard.graph.strategy.GraphStrategy"]=true;dojo.provide("drawboard.graph.strategy.GraphStrategy");(function(){var _f=drawboard.Constant;dojo.declare("drawboard.graph.strategy.GraphStrategy",null,{type:_f.Decorate.Graph,_hasRotator:true,hasRotator:function(){return this._hasRotator;},getRotatorCoordinate:function(gp,_10){return null;},getActiveAnchors:function(gp,_11){return null;},isAnchor:function(d){return false;},isIn:function(gp,_12,_13){},draw:function(gp,gf,_14){},sizeChange:function(gp,_15,_16,_17){var d=_f.Direction,p=gp.getCoordinate(_17),w=gp.getWidth(_17),h=gp.getHeight(_17),_18=_16.x,_19=_16.y,_1a=_15.getDirect();switch(_1a){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+_19},_17);gp.setHeight(h-_19,_17);break;case d.SOUTH:gp.setHeight(h+_19,_17);break;case d.WEST:gp.setCoordinate({x:p.x+_18,y:p.y},_17);gp.setWidth(w-_18,_17);break;case d.EAST:gp.setWidth(w+_18,_17);break;case d.WESTNORTH:gp.setCoordinate({x:p.x+_18,y:p.y+_19},_17);gp.setWidth(w-_18,_17);gp.setHeight(h-_19,_17);break;case d.EASTNORTH:gp.setCoordinate({x:p.x,y:p.y+_19},_17);gp.setWidth(w+_18,_17);gp.setHeight(h-_19,_17);break;case d.EASTSOUTH:gp.setWidth(w+_18,_17);gp.setHeight(h+_19,_17);break;case d.WESTSOUTH:gp.setCoordinate({x:p.x+_18,y:p.y},_17);gp.setWidth(w-_18,_17);gp.setHeight(h+_19,_17);break;case d.END:break;default:break;}this._sizeChange(gp,_15,_16,_17);},_sizeChange:function(gp,_1b,_1c,_1d){},getGraphCoordinates:function(gp,_1e){},getSkeletonCoordinates:function(gp,_1f){var _20=gp.getCoordinate(_1f),w=gp.getWidth(_1f),h=gp.getHeight(_1f),x=_20.x,y=_20.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y,css:"mover_ne"},{x:x,y:y+h,css:"mover_sw"},{x:x+w,y:y+h,css:"mover_se"},{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"},{x:x+w,y:y+(h>>1),css:"mover_e"}];},calcMotionAnchor:function(gp,_21,_22,_23){},getMotionAnchorCoordinates:function(gp,_24){},getMarkCoordinates:function(gp,_25){var _26=gp.getCoordinate(_25),w=gp.getWidth(_25),h=gp.getHeight(_25),_27=gp.getRealMarks(_25),x=_26.x,y=_26.y;if(!_27){return [{x:x+(w>>1),y:y},{x:x+(w>>1),y:y+h},{x:x,y:y+(h>>1)},{x:x+w,y:y+(h>>1)}];}var _28=[_27[0]||{x:x+(w>>1),y:y},_27[1]||{x:x+(w>>1),y:y+h},_27[2]||{x:x,y:y+(h>>1)},_27[3]||{x:x+w,y:y+(h>>1)}];for(var i=4;i<_27.length;i++){_28.push(_27[i]);}return _28;},getStyle:function(gp,_29){return _29.getContext().getStyleCtrl().getStyle(this.type,gp);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.ImageStrategy"]){dojo._hasResource["drawboard.graph.strategy.ImageStrategy"]=true;dojo.provide("drawboard.graph.strategy.ImageStrategy");(function(){var _2a=common.calc.Geometry,_2b=drawboard.Constant;dojo.declare("drawboard.graph.strategy.ImageStrategy",drawboard.graph.strategy.GraphStrategy,{getGraphCoordinates:function(gp,_2c){var _2d=gp.getCoordinate(_2c),w=gp.getWidth(_2c),h=gp.getHeight(_2c),x=_2d.x,y=_2d.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_2e,_2f){return _2a.isPointInPolyn(gp.getGraphCoordinates(_2f),_2e);},draw:function(gp,gf,_30){var p=_2b.Path,_31=gp.getGraphRotator(_30),a=_31.angle,_32=_31.coordinate,_33=["translate("+_32.x+","+_32.y+")","rotate("+a+")","translate("+-_32.x+","+-_32.y+")"];gf.drawImage(gp.getCoordinate(_30),gp.getWidth(_30),gp.getHeight(_30),gp.getUrl(),(a!=0)&&{transform:_33},this.getStyle(gp,_30));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RatioStrategy"]){dojo._hasResource["drawboard.graph.strategy.RatioStrategy"]=true;dojo.provide("drawboard.graph.strategy.RatioStrategy");(function(){var _34=common.calc.Geometry,_35=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RatioStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_36,_37){},draw:function(gp,gf,_38){},getGraphCoordinates:function(gp,_39){var _3a=gp.getRatio(),w=gp.getWidth(_39),h=gp.getHeight(_39),_3b;if(!_3a){return this._getGraphCoordinates(gp,_39,w,h);}_3b=h*_3a;if(_3b>w){h=w/_3a;}else{w=_3b;}gp.setWidth(w,_39);gp.setHeight(h,_39);return this._getGraphCoordinates(gp,_39,w,h);},_getGraphCoordinates:function(gp,_3c,w,h){},sizeChange:function(gp,_3d,_3e,_3f){var d=_35.Direction,_40=gp.getRatio(),p=gp.getCoordinate(_3f),w=gp.getWidth(_3f),h=gp.getHeight(_3f),_41=_3d.getDirect(),_42;if(_40){_42=h*_40;if(_42>w){h=w/_40;}else{w=_42;}}switch(_41){case d.NORTH:_3e=_3e.y;gp.setCoordinate({x:p.x+(_3e>>1),y:p.y+(_3e)},_3f);gp.setWidth(w-(_3e),_3f);gp.setHeight(h-(_3e),_3f);break;case d.WESTNORTH:_3e=Math.abs(_3e.x)>Math.abs(_3e.y)?_3e.y:_3e.x,gp.setCoordinate({x:p.x+_3e,y:p.y+_3e},_3f);gp.setWidth(w-_3e,_3f);gp.setHeight(h-_3e,_3f);break;case d.EASTNORTH:_3e=_3e.y;gp.setCoordinate({x:p.x,y:p.y+_3e},_3f);gp.setWidth(w-_3e,_3f);gp.setHeight(h-_3e,_3f);break;case d.SOUTH:_3e=_3e.y;gp.setCoordinate({x:p.x-(_3e>>1),y:p.y},_3f);gp.setWidth(w+(_3e),_3f);gp.setHeight(h+(_3e),_3f);break;case d.EASTSOUTH:_3e=Math.abs(_3e.x)>Math.abs(_3e.y)?_3e.y:_3e.x,gp.setCoordinate({x:p.x,y:p.y},_3f);gp.setWidth(w+_3e,_3f);gp.setHeight(h+_3e,_3f);break;case d.WESTSOUTH:_3e=_3e.x;gp.setCoordinate({x:p.x+_3e,y:p.y},_3f);gp.setWidth(w-_3e,_3f);gp.setHeight(h-_3e,_3f);break;case d.WEST:_3e=_3e.x;gp.setCoordinate({x:p.x+_3e,y:p.y+(_3e>>1)},_3f);gp.setWidth(w-(_3e),_3f);gp.setHeight(h-(_3e),_3f);break;case d.EAST:_3e=_3e.x;gp.setCoordinate({x:p.x,y:p.y-(_3e>>1)},_3f);gp.setWidth(w+(_3e),_3f);gp.setHeight(h+(_3e),_3f);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RatioImageStrategy"]){dojo._hasResource["drawboard.graph.strategy.RatioImageStrategy"]=true;dojo.provide("drawboard.graph.strategy.RatioImageStrategy");(function(){var _43=common.calc.Geometry,_44=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RatioImageStrategy",drawboard.graph.strategy.RatioStrategy,{_getGraphCoordinates:function(gp,_45,w,h){var _46=gp.getCoordinate(_45),x=_46.x,y=_46.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_47,_48){return _43.isPointInPolyn(gp.getGraphCoordinates(_48),_47);},draw:function(gp,gf,_49){var p=_44.Path,_4a=gp.getGraphRotator(_49),a=_4a.angle,_4b=_4a.coordinate,_4c=["translate("+_4b.x+","+_4b.y+")","rotate("+a+")","translate("+-_4b.x+","+-_4b.y+")"];gp.getGraphCoordinates(_49);gf.drawImage(gp.getCoordinate(_49),gp.getWidth(_49),gp.getHeight(_49),gp.getUrl(),(a!=0)&&{transform:_4c},this.getStyle(gp,_49));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RectangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RectangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RectangleStrategy");(function(){var _4d=common.calc.Geometry,_4e=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RectangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_4f,_50){return _4d.isPointInPolyn(gp.getGraphCoordinates(_50),_4f);},draw:function(gp,gf,_51){var p=_4e.Path,_52=gp.getGraphCoordinates(_51);gf.drawPath([{command:p.MOVE,points:_52[0]},{command:p.LINE,points:_52[1]},{command:p.LINE,points:_52[2]},{command:p.LINE,points:_52[3]}],this.getStyle(gp,_51));},getGraphCoordinates:function(gp,_53){var _54=gp.getCoordinate(_53),w=gp.getWidth(_53),h=gp.getHeight(_53),x=_54.x,y=_54.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.SquareStrategy"]){dojo._hasResource["drawboard.graph.strategy.SquareStrategy"]=true;dojo.provide("drawboard.graph.strategy.SquareStrategy");(function(){var _55=common.calc.Geometry,_56=drawboard.Constant;dojo.declare("drawboard.graph.strategy.SquareStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_57,_58){return _55.isPointInPolyn(gp.getGraphCoordinates(_58),_57);},draw:function(gp,gf,_59){var p=_56.Path,_5a=gp.getGraphCoordinates(_59);gf.drawPath([{command:p.MOVE,points:_5a[0]},{command:p.LINE,points:_5a[1]},{command:p.LINE,points:_5a[2]},{command:p.LINE,points:_5a[3]}],this.getStyle(gp,_59));},getGraphCoordinates:function(gp,_5b){var _5c=gp.getCoordinate(_5b),w=gp.getWidth(_5b),h=gp.getHeight(_5b),min=w>h?h:w,x=_5c.x,y=_5c.y;gp.setWidth(min,_5b);gp.setHeight(min,_5b);return [{x:x,y:y},{x:x+min,y:y},{x:x+min,y:y+min},{x:x,y:y+min}];},sizeChange:function(gp,_5d,_5e,_5f){var d=_56.Direction,p=gp.getCoordinate(_5f),w=gp.getWidth(_5f),h=gp.getHeight(_5f),min=w>h?h:w,_60=_5d.getDirect();switch(_60){case d.NORTH:_5e=_5e.y;gp.setCoordinate({x:p.x+(_5e>>1),y:p.y+(_5e)},_5f);gp.setWidth(min-(_5e),_5f);gp.setHeight(min-(_5e),_5f);break;case d.WESTNORTH:_5e=Math.abs(_5e.x)>Math.abs(_5e.y)?_5e.y:_5e.x,gp.setCoordinate({x:p.x+_5e,y:p.y+_5e},_5f);gp.setWidth(min-_5e,_5f);gp.setHeight(min-_5e,_5f);break;case d.EASTNORTH:_5e=_5e.y;gp.setCoordinate({x:p.x,y:p.y+_5e},_5f);gp.setWidth(min-_5e,_5f);gp.setHeight(min-_5e,_5f);break;case d.SOUTH:_5e=_5e.y;gp.setCoordinate({x:p.x-(_5e>>1),y:p.y},_5f);gp.setWidth(min+(_5e),_5f);gp.setHeight(min+(_5e),_5f);break;case d.EASTSOUTH:_5e=Math.abs(_5e.x)>Math.abs(_5e.y)?_5e.y:_5e.x,gp.setCoordinate({x:p.x,y:p.y},_5f);gp.setWidth(min+_5e,_5f);gp.setHeight(min+_5e,_5f);break;case d.WESTSOUTH:_5e=_5e.x;gp.setCoordinate({x:p.x+_5e,y:p.y},_5f);gp.setWidth(min-_5e,_5f);gp.setHeight(min-_5e,_5f);break;case d.WEST:_5e=_5e.x;gp.setCoordinate({x:p.x+_5e,y:p.y+(_5e>>1)},_5f);gp.setWidth(min-(_5e),_5f);gp.setHeight(min-(_5e),_5f);break;case d.EAST:_5e=_5e.x;gp.setCoordinate({x:p.x,y:p.y-(_5e>>1)},_5f);gp.setWidth(min+(_5e),_5f);gp.setHeight(min+(_5e),_5f);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.graph.strategy.OvalStrategy"]){dojo._hasResource["drawboard.graph.strategy.OvalStrategy"]=true;dojo.provide("drawboard.graph.strategy.OvalStrategy");(function(){var _61=common.calc.Geometry,_62=drawboard.Constant;dojo.declare("drawboard.graph.strategy.OvalStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_63,_64){var w=gp.getWidth(_64),h=gp.getHeight(_64),r=w>h?h>>1:w>>1;return _61.isPointInCircle(_63,{coordinate:gp.getGraphCoordinates(_64)[0],r:r});},draw:function(gp,gf,_65){var _66=gp.getGraphCoordinates(_65),w=gp.getWidth(_65),h=gp.getHeight(_65),p=_62.Path,_67=[];_67[0]=[p.MOVE,_66[0].x-(w>>1)," ",_66[0].y].join("");_67[1]=[p.RARC,(w>>1)," ",(h>>1)," 0 1,1 1 0"].join("");gf.drawPath(_67,this.getStyle(gp,_65));},getGraphCoordinates:function(gp,_68){var p=gp.getCoordinate(_68),w=gp.getWidth(_68),h=gp.getHeight(_68),_69=[{x:p.x+w,y:p.y+h}];return _69;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.CircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.CircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.CircleStrategy");(function(){var _6a=common.calc.Geometry;dojo.declare("drawboard.graph.strategy.CircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_6b,_6c){var w=gp.getWidth(_6c),h=gp.getHeight(_6c),r=w>h?h>>1:w>>1;return _6a.isPointInCircle(_6b,{coordinate:gp.getGraphCoordinates(_6c)[0],r:r});},draw:function(gp,gf,_6d){var _6e=gp.getGraphCoordinates(_6d),w=gp.getWidth(_6d),h=gp.getHeight(_6d),r=w>h?h>>1:w>>1;gf.drawCircle(_6e[0],r,this.getStyle(gp,_6d));},getGraphCoordinates:function(gp,_6f){var p=gp.getCoordinate(_6f),w=gp.getWidth(_6f),h=gp.getHeight(_6f),min=w>h?h:w,r=min>>1,_70=[{x:p.x+r,y:p.y+r}];gp.setWidth(min,_6f);gp.setHeight(min,_6f);return _70;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]){dojo._hasResource["drawboard.graph.strategy.MotionCircleStrategy"]=true;dojo.provide("drawboard.graph.strategy.MotionCircleStrategy");(function(){var _71=common.calc.Geometry,_72=drawboard.Constant;dojo.declare("drawboard.graph.strategy.MotionCircleStrategy",drawboard.graph.strategy.SquareStrategy,{isIn:function(gp,_73,_74){var w=gp.getWidth(_74),h=gp.getHeight(_74),r=w>h?h>>1:w>>1;return _71.isPointInCircle(_73,{coordinate:gp.getGraphCoordinates(_74)[0],r:r});},draw:function(gp,gf,_75){var p=_72.Path,w=gp.getWidth(_75),h=gp.getHeight(_75),r=w>h?h>>1:w>>1,_76=gp.getGraphCoordinates(_75),_77=gp.getMotionAnchorCoordinates(_75),a=_71.angle(_77[0][0],_76[0],_77[1][0]),arc=[p.ARC+r,r,0,(a<180?0:1)+",1",_77[1][0].x+" "+_77[1][0].y];gf.drawPath([{command:p.MOVE,points:_77[0][0]},arc.join(" ")],this.getStyle(gp,_75),true);},getGraphCoordinates:function(gp,_78){var p=gp.getCoordinate(_78),w=gp.getWidth(_78),h=gp.getHeight(_78),r=w>h?h>>1:w>>1,min=w>h?h:w,_79=[{x:p.x+r,y:p.y+r}];gp.setWidth(min,_78);gp.setHeight(min,_78);return _79;},getMotionAnchorCoordinates:function(gp,_7a){var _7b=gp.getRealMotionAnchors(_7a),_7c=[],gs,w=gp.getWidth(_7a),_7d=gp.getCoordinate(_7a),_7e=_71.rotation,_7f=gp.getGraphCoordinates(_7a)[0];_7d.x+=(w>>1);if(!_7b){_7b=[10,100];gs=gp.getGraphStatus();gs.setMotionAnchors(_7b,_7a);}dojo.forEach(_7b,function(_80){_7c.push(_7e(_7d,_7f,_80));},this);return _7c;},calcMotionAnchor:function(gp,_81,_82,_83){var w=gp.getWidth(_83),h=gp.getHeight(_83),r=w>h?h>>1:w>>1,_84=gp.getCoordinate(_83),_85=gp.getGraphCoordinates(_83),_86=_71.intersectCircleLine(_85[0],r,_85[0],_82)[0];_84.x+=(w>>1);return _71.angle(_84,_85[0],_86);}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RounderRectangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RounderRectangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RounderRectangleStrategy");(function(){var _87=common.calc.Geometry,_88=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RounderRectangleStrategy",drawboard.graph.strategy.GraphStrategy,{getGraphCoordinates:function(gp,_89){var _8a=gp.getCoordinate(_89),h=gp.getHeight(_89),w=gp.getWidth(_89),x=_8a.x,y=_8a.y;return [{x:x,y:y},{x:x+w,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},isIn:function(gp,_8b,_8c){return _87.isPointInPolyn(gp.getGraphCoordinates(_8c),_8b);},draw:function(gp,gf,_8d){var p=_88.Path,_8e=gp.getGraphRotator(_8d),a=_8e.angle,_8f=_8e.coordinate,r=_8d.getRounder(),_90=["translate("+_8f.x+","+_8f.y+")","rotate("+a+")","translate("+-_8f.x+","+-_8f.y+")"];gf.drawRect(gp.getCoordinate(_8d),gp.getWidth(_8d),gp.getHeight(_8d),r,(a!=0)&&{transform:_90},this.getStyle(gp,_8d));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RounderSquareStrategy"]){dojo._hasResource["drawboard.graph.strategy.RounderSquareStrategy"]=true;dojo.provide("drawboard.graph.strategy.RounderSquareStrategy");(function(){var _91=common.calc.Geometry,_92=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RounderSquareStrategy",drawboard.graph.strategy.SquareStrategy,{draw:function(gp,gf,_93){var p=_92.Path,_94=gp.getGraphRotator(_93),a=_94.angle,_95=_94.coordinate,w=gp.getWidth(_93),h=gp.getHeight(_93),min=w>h?h:w,r=_93.getRounder(),_96=["translate("+_95.x+","+_95.y+")","rotate("+a+")","translate("+-_95.x+","+-_95.y+")"];gp.getGraphCoordinates(_93);gf.drawRect(gp.getCoordinate(_93),min,min,r,(a!=0)&&{transform:_96},this.getStyle(gp,_93));}});})();}if(!dojo._hasResource["drawboard.graph.strategy.TriangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.TriangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.TriangleStrategy");(function(){var _97=common.calc.Geometry,_98=drawboard.Constant;dojo.declare("drawboard.graph.strategy.TriangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_99,_9a){return _97.isPointInPolyn(gp.getGraphCoordinates(_9a),_99);},draw:function(gp,gf,_9b){var p=_98.Path,_9c=gp.getGraphCoordinates(_9b);gf.drawPath([{command:p.MOVE,points:_9c[0]},{command:p.LINE,points:_9c[1]},{command:p.LINE,points:_9c[2]}],this.getStyle(gp,_9b));},getGraphCoordinates:function(gp,_9d){var _9e=gp.getCoordinate(_9d),w=gp.getWidth(_9d),h=gp.getHeight(_9d),x=_9e.x,y=_9e.y;return [{x:x+(w>>1),y:y},{x:x,y:y+h},{x:x+w,y:y+h}];},getMarkCoordinates:function(gp,_9f){var _a0=gp.getCoordinate(_9f),w=gp.getWidth(_9f),h=gp.getHeight(_9f),_a1=gp.getRealMarks(_9f),x=_a0.x,y=_a0.y;if(!_a1){return [{x:x+(w>>1),y:y},{x:x,y:y+h},{x:x+w,y:y+h},{x:x+(w>>1),y:y+(h>>1)}];}var _a2=[_a1[0]||{x:x+(w>>1),y:y},_a1[1]||{x:x,y:y+h},_a1[2]||{x:x+w,y:y},_a1[3]||{x:x+(w>>1),y:y+(h>>1)}];for(var i=4;i<_a1.length;i++){_a2.push(_a1[i]);}return _a2;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.RightTriangleStrategy"]){dojo._hasResource["drawboard.graph.strategy.RightTriangleStrategy"]=true;dojo.provide("drawboard.graph.strategy.RightTriangleStrategy");(function(){var _a3=common.calc.Geometry,_a4=drawboard.Constant;dojo.declare("drawboard.graph.strategy.RightTriangleStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_a5,_a6){return _a3.isPointInPolyn(gp.getGraphCoordinates(_a6),_a5);},draw:function(gp,gf,_a7){var p=_a4.Path,_a8=gp.getGraphCoordinates(_a7);gf.drawPath([{command:p.MOVE,points:_a8[0]},{command:p.LINE,points:_a8[1]},{command:p.LINE,points:_a8[2]}],this.getStyle(gp,_a7));},getGraphCoordinates:function(gp,_a9){var _aa=gp.getCoordinate(_a9),w=gp.getWidth(_a9),h=gp.getHeight(_a9),x=_aa.x,y=_aa.y;return [{x:x,y:y},{x:x+w,y:y+h},{x:x,y:y+h}];},getMarkCoordinates:function(gp,_ab){var _ac=gp.getCoordinate(_ab),w=gp.getWidth(_ab),h=gp.getHeight(_ab),_ad=gp.getRealMarks(_ab),x=_ac.x,y=_ac.y;if(!_ad){return [{x:x,y:y},{x:x+w,y:y+h},{x:x,y:y+h},{x:x+(w>>1),y:y+(h>>1)}];}var _ae=[_ad[0]||{x:x,y:y},_ad[1]||{x:x+w,y:y+h},_ad[2]||{x:x,y:y+h},_ad[3]||{x:x+(w>>1),y:y+(h>>1)}];for(var i=4;i<_ad.length;i++){_ae.push(_ad[i]);}return _ae;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.LineStrategy"]){dojo._hasResource["drawboard.graph.strategy.LineStrategy"]=true;dojo.provide("drawboard.graph.strategy.LineStrategy");(function(){var _af=common.calc.Geometry,_b0=drawboard.Constant;dojo.declare("drawboard.graph.strategy.LineStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_b1,_b2){var _b3=gp.getGraphCoordinates(_b2);return _af.isPointInRect(_b3[0],_b3[1],_b1);},isAnchor:function(d){return true;},draw:function(gp,gf,_b4){var p=_b0.Path,_b5=gp.getGraphCoordinates(_b4);gf.drawLine(_b5[0],_b5[1],this.getStyle(gp,_b4));},getActiveAnchors:function(gp,_b6){return drawboard.skeletonController.create(gp.getSkeletonCoordinates(_b6));},getSkeletonCoordinates:function(gp,_b7){var _b8=gp.getCoordinate(_b7),w=gp.getWidth(_b7),h=gp.getHeight(_b7),x=_b8.x,y=_b8.y;return [{x:x,y:y,css:"mover_nw"},{x:x+w,y:y+h,css:"mover_se"}];},getGraphCoordinates:function(gp,_b9){var _ba=gp.getCoordinate(_b9),w=gp.getWidth(_b9),h=gp.getHeight(_b9),x=_ba.x,y=_ba.y;return [{x:x,y:y,css:"mover_nw",isAnchored:true},{x:x+w,y:y+h,css:"mover_se",isAnchored:true}];},getMotionAnchorCoordinates:function(gp,_bb){return null;}});})();}if(!dojo._hasResource["drawboard.graph.strategy.DiamondStrategy"]){dojo._hasResource["drawboard.graph.strategy.DiamondStrategy"]=true;dojo.provide("drawboard.graph.strategy.DiamondStrategy");(function(){var _bc=common.calc.Geometry,_bd=drawboard.Constant;dojo.declare("drawboard.graph.strategy.DiamondStrategy",drawboard.graph.strategy.GraphStrategy,{isIn:function(gp,_be,_bf){return _bc.isPointInPolyn(gp.getGraphCoordinates(_bf),_be);},draw:function(gp,gf,_c0){var p=_bd.Path,_c1=gp.getGraphCoordinates(_c0);gf.drawPath([{command:p.MOVE,points:_c1[0]},{command:p.LINE,points:_c1[1]},{command:p.LINE,points:_c1[2]},{command:p.LINE,points:_c1[3]}],this.getStyle(gp,_c0));},getGraphCoordinates:function(gp,_c2){var _c3=gp.getCoordinate(_c2),w=gp.getWidth(_c2),h=gp.getHeight(_c2),x=_c3.x,y=_c3.y;return [{x:x+(w>>1),y:y},{x:x,y:y+(h>>1)},{x:x+(w>>1),y:y+h},{x:x+w,y:y+(h>>1)}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFOneWayArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy");(function(){var _c4=common.calc.Geometry,_c5=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFOneWayArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_c6,_c7){return _c4.isPointInPolyn(gp.getGraphCoordinates(_c7),_c6);},isAnchor:function(d){if(d.getIndex()==2){return true;}return false;},getActiveAnchors:function(gp,_c8){var _c9=gp.getSkeletonCoordinates(_c8),_ca=[_c9[2]];return drawboard.skeletonController.create(_ca);},getRotatorCoordinate:function(gp,_cb){return this.getGraphCoordinates(gp,_cb)[0];},draw:function(gp,gf,_cc){var p=_c5.Path,_cd=gp.getGraphCoordinates(_cc);gf.drawPath([{command:p.MOVE,points:_cd[0]},{command:p.LINE,points:_cd[1]},{command:p.LINE,points:_cd[2]},{command:p.LINE,points:_cd[3]},{command:p.LINE,points:_cd[4]},{command:p.LINE,points:_cd[5]},{command:p.LINE,points:_cd[6]}],this.getStyle(gp,_cc));},getGraphCoordinates:function(gp,_ce){var _cf=gp.getCoordinate(_ce),w=gp.getWidth(_ce),h=gp.getHeight(_ce),x=_cf.x,y=_cf.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+w,y:y+h3},{x:x+w,y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_d0){var _d1=gp.getCoordinate(_d0),w=gp.getWidth(_d0),h=gp.getHeight(_d0),x=_d1.x,y=_d1.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"}];},sizeChange:function(gp,_d2,_d3,_d4){var d=_c5.Direction,p=gp.getCoordinate(_d4),w=gp.getWidth(_d4),h=gp.getHeight(_d4),_d5=_d3.x,_d6=_d3.y,_d7=_d2.getDirect();switch(_d7){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_d6)},_d4);gp.setHeight(h-(_d6<<1),_d4);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_d6)},_d4);gp.setHeight(h+(_d6<<1),_d4);break;case d.WEST:var _d8=gp.getMotionAnchorCoordinates(_d4)[0][0],_d9,wm,em,_da=gp.getRotator(_d4);gp.setCoordinate({x:p.x+_d5,y:p.y+_d6},_d4);_d9=gp.getCoordinate(_d4);wm={x:_d9.x,y:_d9.y+(h>>1)};em={x:_d9.x+w,y:_d9.y+(h>>1)};_da.angle=_c4.angle(em,wm,_d8);gp.setWidth(_c4.getDistant(_d8,wm),_d4);gp.setRotator(_da,_d4);break;case d.EAST:var _d8=gp.getSkeletonCoordinates(_d4)[3][0],_d9=gp.getCoordinate(_d4),wm,em,_db,_da=gp.getRotator(_d4);wm={x:_d9.x,y:_d9.y+(h>>1)};em={x:_d9.x+w,y:_d9.y+(h>>1)};_db={x:_d8.x+_d5,y:_d8.y+_d6};_da.angle=_c4.angle(em,wm,_db);gp.setWidth(_c4.getDistant(_db,wm),_d4);gp.setRotator(_da,_d4);break;case d.END:break;default:break;}},calcMotionAnchor:function(gp,_dc,_dd,_de){var _df=gp.getCoordinate(_de),wm={x:_df.x,y:_df.y+(gp.getHeight(_de)>>1)},em={x:_df.x+gp.getWidth(_de),y:_df.y+(gp.getHeight(_de)>>1)},_e0=_c4.angle(em,wm,_dd),_e1;_e1=gp.getRotator(_de);_e1.angle=_e0;gp.setWidth(_c4.getDistant(wm,_dd),_de);gp.setRotator(_e1,_de);return _dd;},getMotionAnchorCoordinates:function(gp,_e2){var _e3=gp.getCoordinate(_e2),w=gp.getWidth(_e2),h=gp.getHeight(_e2),x=_e3.x,y=_e3.y;return [{x:x+w,y:y+(h>>1)}];}});})();}if(!dojo._hasResource["drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy"]){dojo._hasResource["drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy"]=true;dojo.provide("drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy");(function(){var _e4=common.calc.Geometry,_e5=drawboard.Constant;dojo.declare("drawboard.graph.strategy.arrow.FFDoubleSideArrowStrategy",drawboard.graph.strategy.GraphStrategy,{_hasRotator:false,isIn:function(gp,_e6,_e7){return _e4.isPointInPolyn(gp.getGraphCoordinates(_e7),_e6);},isAnchor:function(d){if(d.getIndex()==2||d.getIndex()==3){return true;}return false;},getActiveAnchors:function(gp,_e8){var _e9=gp.getSkeletonCoordinates(_e8),_ea=[_e9[2],_e9[3]];return drawboard.skeletonController.create(_ea);},getRotatorCoordinate:function(gp,_eb){return this.getGraphCoordinates(gp,_eb)[0];},draw:function(gp,gf,_ec){var p=_e5.Path,_ed=gp.getGraphCoordinates(_ec);gf.drawPath([{command:p.MOVE,points:_ed[0]},{command:p.LINE,points:_ed[1]},{command:p.LINE,points:_ed[2]},{command:p.LINE,points:_ed[3]},{command:p.LINE,points:_ed[4]},{command:p.LINE,points:_ed[5]},{command:p.LINE,points:_ed[6]},{command:p.LINE,points:_ed[7]},{command:p.LINE,points:_ed[8]},{command:p.LINE,points:_ed[9]}],this.getStyle(gp,_ec));},getGraphCoordinates:function(gp,_ee){var _ef=gp.getCoordinate(_ee),w=gp.getWidth(_ee),h=gp.getHeight(_ee),x=_ef.x,y=_ef.y,h3=h/3;return [{x:x,y:y+(h>>1),isAnchored:true},{x:x+(h>>1),y:y},{x:x+(h>>1),y:y+h3},{x:x+(w-(h>>1)),y:y+h3},{x:x+(w-(h>>1)),y:y},{x:x+w,y:y+(h>>1),isAnchored:true},{x:x+(w-(h>>1)),y:y+h},{x:x+(w-(h>>1)),y:y+(h3<<1)},{x:x+(h>>1),y:y+(h3<<1)},{x:x+(h>>1),y:y+h}];},getSkeletonCoordinates:function(gp,_f0){var _f1=gp.getCoordinate(_f0),w=gp.getWidth(_f0),h=gp.getHeight(_f0),x=_f1.x,y=_f1.y;return [{x:x+(w>>1),y:y,css:"mover_n"},{x:x+(w>>1),y:y+h,css:"mover_s"},{x:x,y:y+(h>>1),css:"mover_w"},{x:x+w,y:y+(h>>1),css:"mover_e"}];},sizeChange:function(gp,_f2,_f3,_f4){var d=_e5.Direction,p=gp.getCoordinate(_f4),w=gp.getWidth(_f4),h=gp.getHeight(_f4),_f5=_f3.x,_f6=_f3.y,_f7=_f2.getDirect();switch(_f7){case d.NORTH:gp.setCoordinate({x:p.x,y:p.y+(_f6)},_f4);gp.setHeight(h-(_f6<<1),_f4);break;case d.SOUTH:gp.setCoordinate({x:p.x,y:p.y-(_f6)},_f4);gp.setHeight(h+(_f6<<1),_f4);break;case d.WEST:var _f8=gp.getSkeletonCoordinates(_f4)[3][0],_f9,wm,em,_fa=gp.getRotator(_f4);gp.setCoordinate({x:p.x+_f5,y:p.y+_f6},_f4);_f9=gp.getCoordinate(_f4);wm={x:_f9.x,y:_f9.y+(h>>1)};em={x:_f9.x+w,y:_f9.y+(h>>1)};_fa.angle=_e4.angle(em,wm,_f8);gp.setWidth(_e4.getDistant(_f8,wm),_f4);gp.setRotator(_fa,_f4);break;case d.EAST:var _f8=gp.getSkeletonCoordinates(_f4)[3][0],_f9=gp.getCoordinate(_f4),wm,em,_fb,_fa=gp.getRotator(_f4);wm={x:_f9.x,y:_f9.y+(h>>1)};em={x:_f9.x+w,y:_f9.y+(h>>1)};_fb={x:_f8.x+_f5,y:_f8.y+_f6};_fa.angle=_e4.angle(em,wm,_fb);gp.setWidth(_e4.getDistant(_fb,wm),_f4);gp.setRotator(_fa,_f4);break;case d.END:break;default:break;}}});})();}if(!dojo._hasResource["drawboard.command.Command"]){dojo._hasResource["drawboard.command.Command"]=true;dojo.provide("drawboard.command.Command");(function(){var _fc=drawboard.Constant.Command;dojo.declare("drawboard.command.Command",common.command.Command,{_memo:null,_executor:null,_runtime:null,_description:{},constructor:function(_fd,_fe,_ff){if(!_fd){new common.exception.Exception({msg:"the executor must be exist in the command!"});return;}this._executor=_fd;this._memo=_fe;if(!_ff){this.execute=this.positive;this.unexecute=this.negative;}else{this.execute=this.negative;this.unexecute=this.positive;}},getType:function(){return "";},getConstant:function(){return _fc;},setMemo:function(memo){this._memo=memo;},getMemo:function(){return this._memo;},setRuntime:function(_100){this._runtime=_100;},getRuntime:function(){var _101=this._runtime;if(!_101){new common.exception.Exception({msg:"the runtime must be exist in the command!"});}return _101;},getExecutor:function(){return this._executor;},setExecutor:function(_102){this._executor=_102;},execute:function(){},unexecute:function(){},positive:function(){},negative:function(){},setDescription:function(_103,_104){this._description={first:_103,second:_104};},isPositive:function(){if(this.execute==this.positive){return true;}return false;},isCancelOut:function(){return false;},getDesciption:function(){var desp=this._description;if(this.isPositive()){return desp.first;}return desp.second;},merge:function(_105){if(this.getType()!=_105.getType()||this.getExecutor()!=_105.getExecutor()){return false;}return this._merge(_105);},_merge:function(_106){}});})();}if(!dojo._hasResource["drawboard.command.AddVSDeleteConstrainCommand"]){dojo._hasResource["drawboard.command.AddVSDeleteConstrainCommand"]=true;dojo.provide("drawboard.command.AddVSDeleteConstrainCommand");dojo.declare("drawboard.command.AddVSDeleteConstrainCommand",drawboard.command.Command,{getType:function(){return this.getConstant().ADDVSDELTECONSTRAINCOMMAND;},positive:function(){var _107=this.getExecutor(),memo=this.getMemo(),_108=this.getRuntime();dojo.forEach(memo,function(mark){_107.addListener(mark.gp,mark.d,mark.restrainedGp,mark.restrainedD,_108);},this);},negative:function(){var _109=this.getExecutor(),memo=this.getMemo(),_10a=this.getRuntime(),_10b,_10c=this.isPositive();dojo.forEach(memo,function(mark){if(!_10c){_10b=_109.getRestrainedCache(mark.restrainedGp,mark.restrainedD,_10a);if(_10b&&_10b.length>0){memo=[];this.setMemo(memo);dojo.forEach(_10b,function(item){memo.push({gp:item.gp,d:item.decorate,restrainedGp:mark.restrainedGp,restrainedD:mark.restrainedD});},this);}_109.removeListener(mark.restrainedGp,mark.restrainedD,_10a);}},this);},_merge:function(_10d){return false;}});}if(!dojo._hasResource["drawboard.command.CombineVSDevidedCommand"]){dojo._hasResource["drawboard.command.CombineVSDevidedCommand"]=true;dojo.provide("drawboard.command.CombineVSDevidedCommand");dojo.declare("drawboard.command.CombineVSDevidedCommand",drawboard.command.Command,{getType:function(){return this.getConstant().COMBINEVSDEVIDEDCOMMAND;},positive:function(){var _10e=this.getExecutor(),memo=this.getMemo();_10e.combineGraph(memo);},negative:function(){var _10f=this.getExecutor(),memo=this.getMemo();_10f.divideGraph(memo);},_merge:function(_110){return false;}});}if(!dojo._hasResource["drawboard.command.CompositeCommand"]){dojo._hasResource["drawboard.command.CompositeCommand"]=true;dojo.provide("drawboard.command.CompositeCommand");dojo.declare("drawboard.command.CompositeCommand",[drawboard.command.Command,common.container.ListContainer],{constructor:function(){this.execute=this.positive;this.unexecute=this.negative;},getType:function(){return this.getConstant().COMPOSITECOMMAND;},add:function(_111){var last=this.last(),len=this.size();if(len==0||(last&&!last.merge(_111))){drawboard.command.CompositeCommand.superclass.add.call(this,_111);return;}},positive:function(){this.forInItems(function(_112){_112.execute();},this);},negative:function(){this.forInItems(function(_113){_113.unexecute();},this);}});}if(!dojo._hasResource["drawboard.command.CreateVSDeleteCommand"]){dojo._hasResource["drawboard.command.CreateVSDeleteCommand"]=true;dojo.provide("drawboard.command.CreateVSDeleteCommand");dojo.declare("drawboard.command.CreateVSDeleteCommand",drawboard.command.Command,{_info:null,index:null,getType:function(){return this.getConstant().CREATEVSDELETECOMMAND;},positive:function(){var _114=this.getExecutor(),memo=this.getMemo(),info=this._info,_115=this.getRuntime(),_116=_115.getContext().getStyleCtrl(),_117=this.index;_117===null?_114.add(memo):_114.insert(this.index,memo);if(info){dojo.forEach(info,function(item){_114.insert(item.index,item.gp);item.gs&&_116.addItem(item.gp.getIdty(),item.gs);memo.add(item.gp,_115);},this);memo.resetRelations();}},negative:function(){var _118=this.getExecutor(),memo=this.getMemo(),info,_119=this.getRuntime(),_11a=_119.getContext().getStyleCtrl();if(memo.isComposite()){if(!this._info){this._info=[];}info=this._info;var gp;memo.forInItems(function(item){gp=item.gp;info.push({gp:gp,gs:_11a.getItem(gp.getIdty()),index:_118.indexOf(gp)});},this);}this.index=_118.indexOf(memo);_118.removeGraph(memo);},_merge:function(_11b){return false;}});}if(!dojo._hasResource["drawboard.command.MoveCommand"]){dojo._hasResource["drawboard.command.MoveCommand"]=true;dojo.provide("drawboard.command.MoveCommand");dojo.declare("drawboard.command.MoveCommand",drawboard.command.Command,{getType:function(){return this.getConstant().MOVECOMMAND;},positive:function(){var _11c=this.getExecutor(),memo=this.getMemo(),_11d=this.getRuntime();_11c.move(memo.start,memo.end,_11d);},negative:function(){var _11e=this.getExecutor(),memo=this.getMemo(),_11f=this.getRuntime();_11e.move(memo.end,memo.start,_11f);},_merge:function(_120){var memo=this.getMemo(),_121=_120.getMemo();memo.end=_121.end;return true;}});}if(!dojo._hasResource["drawboard.command.ResizeCommand"]){dojo._hasResource["drawboard.command.ResizeCommand"]=true;dojo.provide("drawboard.command.ResizeCommand");dojo.declare("drawboard.command.ResizeCommand",drawboard.command.Command,{getType:function(){return this.getConstant().RESIZECOMMAND;},positive:function(){var _122=this.getExecutor(),memo=this.getMemo(),_123=this.getRuntime();_122.sizeChange(memo.decorate,memo.start,memo.end,_123);},negative:function(){var _124=this.getExecutor(),memo=this.getMemo(),_125=this.getRuntime();_124.sizeChange(memo.decorate,memo.end,memo.start,_125);},_merge:function(_126){var memo=this.getMemo(),_127=_126.getMemo();if(memo.decorate!=_127.decorate){return false;}memo.end=_127.end;return true;}});}if(!dojo._hasResource["drawboard.command.RotateCommand"]){dojo._hasResource["drawboard.command.RotateCommand"]=true;dojo.provide("drawboard.command.RotateCommand");dojo.declare("drawboard.command.RotateCommand",drawboard.command.Command,{_oriAngle:null,getType:function(){return this.getConstant().ROTATECOMMAND;},positive:function(){var _128=this.getExecutor(),memo=dojo.clone(this.getMemo()),_129=this.getRuntime();if(this._oriAngle===null){this._oriAngle=_128.getRotator(_129).angle;}_128.setRotator(memo,_129);},negative:function(){var _12a=this.getExecutor(),memo=dojo.clone(this.getMemo()),_12b=this.getRuntime();memo.angle=this._oriAngle;_12a.setRotator(memo,_12b);},_merge:function(_12c){var memo=this.getMemo(),_12d=_12c.getMemo();memo.angle=_12d.angle;return true;}});}if(!dojo._hasResource["drawboard.command.StyleCommand"]){dojo._hasResource["drawboard.command.StyleCommand"]=true;dojo.provide("drawboard.command.StyleCommand");dojo.declare("drawboard.command.StyleCommand",drawboard.command.Command,{_style:null,getType:function(){return this.getConstant().STYLECOMMAND;},getStyle:function(){var _12e=this._style;if(!_12e){this._style=_12e={};}return _12e;},positive:function(){var _12f=this.getExecutor(),memo=this.getMemo();if(!this._style&&_12f.containGraphStyle(memo.gp)){this._style=_12f.getGraphStyleValue(memo.gp,memo.attr);}_12f.addGraphStyle(memo.gp,memo.attr,memo.value,memo.isSelect);if(memo.gp.isComposite()){var _130=this.getStyle();memo.gp.forInItems(function(item){if(_12f.containGraphStyle(item.gp)){_130[item.gp.getIdty()]=_12f.getGraphStyleValue(item.gp,memo.attr);}_12f.addGraphStyle(item.gp,memo.attr,memo.value);},this);}},negative:function(){var _131=this.getExecutor(),memo=this.getMemo();if(memo.gp.isComposite()){var _132=this.getStyle(),_133;memo.gp.forInItems(function(item){_133=_132[item.gp.getIdty()];if(_133){_131.addGraphStyle(item.gp,memo.attr,_133);return;}_131.removeGraphStyle(item.gp,memo.attr);},this);return;}if(this._style){_131.addGraphStyle(memo.gp,memo.attr,this._style);return;}_131.removeGraphStyle(memo.gp,memo.attr);},_merge:function(_134){return false;}});}if(!dojo._hasResource["drawboard.command.ZoomCommand"]){dojo._hasResource["drawboard.command.ZoomCommand"]=true;dojo.provide("drawboard.command.ZoomCommand");dojo.declare("drawboard.command.ZoomCommand",drawboard.command.Command,{getType:function(){return this.getConstant().ZOOMCOMMAND;},positive:function(){var _135=this.getExecutor(),memo=this.getMemo(),_136=this.getRuntime();_135.zoom(memo,_136);},negative:function(){var _137=this.getExecutor(),memo=this.getMemo(),_138=this.getRuntime();_137.zoom({x:-memo.x,y:-memo.y},_138);},_merge:function(_139){var memo=this.getMemo(),_13a=_139.getMemo();this.setMemo(common.calc.Geometry.add2Points(memo,_13a));return true;}});}if(!dojo._hasResource["drawboard.PreRequire"]){dojo._hasResource["drawboard.PreRequire"]=true;dojo.provide("drawboard.PreRequire");}if(!dojo._hasResource["drawboard._Event"]){dojo._hasResource["drawboard._Event"]=true;dojo.provide("drawboard._Event");(function(){var _13b=common.calc.Geometry,_13c=drawboard.Constant.ActionStatus,_13d=drawboard.Constant;dojo.declare("drawboard._Event",null,{_start:null,_end:null,boxCache:null,_marks:null,getBoxCache:function(){if(!this.boxCache){var node=this.dbCanvas,_13e={left:node.offsetLeft,top:node.offsetTop};this.boxCache=_13e;}return this.boxCache;},refreshBoxCache:function(){this.boxCache=null;},fetchCoordinate:function(e){var box=this.getBoxCache(),_13f=this.domNode;return {x:e.pageX-box.left+_13f.scrollLeft,y:e.pageY-box.top+_13f.scrollTop};},showMarkActive:function(gp,d,_140){var _141=d||gp.getActiveAnchors(_140),_142,_143,mark;if(!_141||(d&&!gp.isAnchor(d))){return;}(!dojo.isArray(_141))&&(_141=[_141]);_142=drawboard.markController;dojo.forEach(_141,function(s){mark=_142.cross(s,gp,this,_140);if(mark){!_143&&(_143=[])&&(this._marks=_143);_143.push(mark);}},this);_142=_140.getContext().getStyleCtrl();!_143&&(this._marks=null);if(_143){var _144=[];dojo.forEach(_143,function(m){this.push(m.d);gp=m.gp;},_144);_142.setActives(_144,gp);return;}_142.setActives(null);},doClick:function(e){this.inherited(arguments);},doMouseMove:function(e){this.inherited(arguments);this._end&&(this._start=this._end);this._end=this.fetchCoordinate(e);var gp=this.getActive(),_145=this._start,end=this._end,_146=this.getActionStatus(),_147=this.getDecorate(),_148,pole,a,_149=this.getRuntime(),_14a=this.getSelectRect(),_14b=_13d.Command,_14c=dojo.hitch(this,this.addCommand),_14d=true;if(_146!=_13c.NONE&&gp){_148=dojo.clone(gp.getRotator(_149));pole=_148.coordinate;}_14a&&!gp&&(gp=_14a);if(!gp&&_146!=_13c.DRAWING&&_146!=_13c.SELECTING){return;}switch(_146){case _13c.RESIZING:_14c(_14b.RESIZECOMMAND,gp,{decorate:_147,start:_145,end:end});this.showMarkActive(gp,drawboard.skeletonController.createItem(gp.getSkeletonCoordinates(_149)[_147.getIndex()],_147.getIndex()),_149);break;case _13c.MOVING:_14c(_14b.MOVECOMMAND,gp,{start:_145,end:end});this.showMarkActive(gp,null,_149);break;case _13c.DRAWING:case _13c.SELECTING:var _14e=this.getDrawEntity(true);_14e.width=end.x-_14e.x;_14e.height=end.y-_14e.y;break;case _13c.MOTION:gp.moveMotionAnchor(_147,end,_149);break;case _13c.ROTATING:case _13c.POLEMOVING:if(_146==_13c.ROTATING){_148.angle=_13b.angle({x:pole.x,y:pole.y-_149.getContext().getParamsCtrl().getRotateDistance()},pole,this._end);_14c(_14b.ROTATECOMMAND,gp,_148);}else{_147.pole=_148.coordinate=end;gp.setRotator(_148,_149);}break;case _13c.NONE:default:_14d=false;break;}_14d&&this.draw();},doMouseDown:function(e){this.inherited(arguments);var _14f=this.fetchCoordinate(e),_150=this.getActionStatus(),_151;if(_150==_13c.DRAWING||_150==_13c.SELECTING){_151=this.getDrawEntity(true);_151.x=_14f.x;_151.y=_14f.y;}this._start=_14f;},doMouseOver:function(e){this.inherited(arguments);},doMouseUp:function(e){var _152=this._marks,_153=this.getRuntime(),_154=(this.getActionStatus()==_13c.DRAWING)?false:true,_155=drawboard.relationController,gp=this.getActive(),_156=this.getDecorate();if(gp&&_155.containRestrain(gp,_156,_153)){this.addCommand(_13d.Command.ADDVSDELTECONSTRAINCOMMAND,_155,[{restrainedGp:gp,restrainedD:_156}],true);}if(_152){var _157=[];dojo.forEach(_152,function(mark){if(!_155.containRestrain(mark.restrainedGp,mark.restrainedD,_153)){_157.push(mark);}},this);(_157.length>0)&&this.addCommand(_13d.Command.ADDVSDELTECONSTRAINCOMMAND,_155,_157);}this.getRuntime().getContext().getStyleCtrl().setActives(null);this._start=null;this._end=null;this.clearDrawEntity(_154);this.inherited(arguments);this.clearCommand();this.draw();dojo.publish("/drawboard/mouseup");}});})();}if(!dojo._hasResource["drawboard.container.LayoutContainer"]){dojo._hasResource["drawboard.container.LayoutContainer"]=true;dojo.provide("drawboard.container.LayoutContainer");dojo.declare("drawboard.container.LayoutContainer",[dijit._Widget,common.container.ListContainer],{up:function(gs){var _158=this.indexOf(gs);this.move(_158,_158+1);},down:function(gs){var _159=this.indexOf(gs);this.move(_159,_159-1);},top:function(gs){var _15a=this.indexOf(gs);this.move(_15a,this.size());},bottom:function(gs){var _15b=this.indexOf(gs);this.move(_15b,0);}});}if(!dojo._hasResource["drawboard.graph.strategy.GraphStrategyFactory"]){dojo._hasResource["drawboard.graph.strategy.GraphStrategyFactory"]=true;dojo.provide("drawboard.graph.strategy.GraphStrategyFactory");(function(){dojo.declare("drawboard.graph.strategy.GraphStrategyFactory",common.container.MapContainer,{getGraphStrategy:function(_15c){if(!this.contains(_15c)){var _15d=eval("new "+_15c+"()");this.addItem(_15c,_15d);}return this.getItem(_15c);}});if(!drawboard.GraphStrategyFactory){drawboard.GraphStrategyFactory=new drawboard.graph.strategy.GraphStrategyFactory();}})();}if(!dojo._hasResource["drawboard.controller.RelationController"]){dojo._hasResource["drawboard.controller.RelationController"]=true;dojo.provide("drawboard.controller.RelationController");(function(){var _15e=drawboard.Constant.Symbol,_15f=common.utils.CollectionUtils.hasAttr;dojo.declare("drawboard.controller.RelationController",[common.container.MapContainer,common.Cache],{addListener:function(gp,d,_160,_161,_162){var idty=gp.getIdty(),_163=this.getItem(idty),item,_164=false,_165=d.getType()+_15e.concat+d.getIndex();if(!_163){_163={};this.addItem(idty,_163);}item=_163[_165];if(!item){item=[];_163[_165]=item;}dojo.some(item,function(i){if(i.gp==_160){_164=true;return true;}},this);if(!_164){item.push({gp:_160,decorate:_161});this.addRestrainedCache(gp,d,_160,_161,_162);}},removeListener:function(_166,_167,_168){var _169=this.removeRestrainedCache(_166,_167,_168),_16a,item,_16b,dels,id;dojo.forEach(_169,function(item){id=item.id;_16a=this.getItem(id);if(!_16a){return;}dels=[];_16b=item.decorate.getType()+_15e.concat+item.decorate.getIndex();item=_16a[_16b];dojo.forEach(item,function(_16c,_16d){if(_16c.gp!=_166){return;}if(!_167||(_167&&_16c.decorate.equal(_167))){dels.push(_16d);}},this);dojo.forEach(dels.reverse(),function(_16e){item.splice(_16e,1);},this);delete _16a[_16b];if(!_15f(_16a)){this.removeItem(id);}},this);},fireEvent:function(idty,d,_16f,_170,_171){var _172=this.getItem(idty),item,temp;if(!_172){return;}item=_172[d.getType()+_15e.concat+d.getIndex()];item&&dojo.forEach(item,function(i){if(_171&&!_171(i.gp)){return;}temp=_16f.concat();temp.unshift(i.decorate);temp.push(null);temp.push(_170);i.gp.sizeChange.apply(i.gp,temp);},this);},addRestrainedCache:function(gp,d,_173,_174,_175){var idty=gp.getIdty(),_176=this.getCache(_175),_177=_176[_173.getIdty()],_178=_174.getType()+_15e.concat+_174.getIndex();if(!_177){_177={};_176[_173.getIdty()]=_177;}!_177[_178]&&(_177[_178]={id:idty,gp:gp,decorate:d});},containRestrain:function(_179,_17a,_17b){var _17c=this.getRestrainedCache(_179,_17a,_17b);if(_17c&&_17c.length>0){return true;}return false;},getRestrainedCache:function(_17d,_17e,_17f){var _180=this.getCache(_17f),_181=_180[_17d.getIdty()],_182;if(!_181){return _182;}if(_17e){var _183=_17e.getType()+_15e.concat+_17e.getIndex();_181[_183]&&(_182=[_181[_183]]);return _182;}_182=[];for(var _184 in _181){_182.push(_181[_184]);}return _182;},removeRestrainedCache:function(_185,_186,_187){var _188=this.getCache(_187),_189=_188[_185.getIdty()],_18a;if(!_189){return _18a;}if(_186){var _18b=_186.getType()+_15e.concat+_186.getIndex();_189[_18b]&&(_18a=[_189[_18b]]);delete _189[_18b];if(!_15f(_189)){delete _188[_185.getIdty()];}return _18a;}_18a=[];for(var _18c in _189){_18a.push(_189[_18c]);}delete _188[_185.getIdty()];return _18a;},createCache:function(){return {};}});if(drawboard.relationController==null){drawboard.relationController=new drawboard.controller.RelationController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Decorator"]){dojo._hasResource["drawboard.graph.decorate.Decorator"]=true;dojo.provide("drawboard.graph.decorate.Decorator");dojo.declare("drawboard.graph.decorate.Decorator",dijit._Widget,{_type:null,coordinate:null,index:0,getIndex:function(){return this.index;},setIndex:function(_18d){this.index=_18d;},getType:function(){return this._type;},getCoordinate:function(){return this.coordinate;},setCoordinate:function(_18e){this.coordinate=_18e;},draw:function(gp,_18f,_190){},equal:function(d){if(d.getIndex()!=this.getIndex()){return false;}var same=true,ps=this.getCoordinate();dojo.some(d.getCoordinate(),function(item,_191){if(item!=ps[_191]){same=false;return true;}},this);return same;}});}if(!dojo._hasResource["drawboard.graph.decorate.Mark"]){dojo._hasResource["drawboard.graph.decorate.Mark"]=true;dojo.provide("drawboard.graph.decorate.Mark");(function(){var _192=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Mark",drawboard.graph.decorate.Decorator,{_type:_192.Decorate.MARK,draw:function(gp,_193,_194){var p=this.getCoordinate(),path=_192.Path,_195=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.MOVE,points:p[2]},{command:path.LINE,points:p[3]},];gp.drawPath(_195,_193,true);}});})();}if(!dojo._hasResource["drawboard.graph.GraphProxy"]){dojo._hasResource["drawboard.graph.GraphProxy"]=true;dojo.provide("drawboard.graph.GraphProxy");(function(){var _196=drawboard.Constant,_197=_196.Decorate,_198=drawboard.GraphStrategyFactory,_199=common.calc.Geometry,_19a=_199.dividePoint,add=_199.add2Points,_19b=_199.subtract2Points,_19c=_199.rotation;dojo.declare("drawboard.graph.GraphProxy",null,{_graphStatus:null,_graphStrategyClass:null,_isActive:false,_isActived:false,_isComposite:false,_showMark:false,constructor:function(_19d,_19e){_19e=dojo.trim(_19e);this._graphStrategyClass=_19e;this._graphStatus=_19d;},getGraphStrategy:function(){return _198.getGraphStrategy(this.getGraphStrategyClass());},getGraphStrategyClass:function(){if(!this._graphStrategyClass){new common.exception.Exception({msg:"graph proxy must have an graph strategy class!"});}return this._graphStrategyClass;},getGraphStatus:function(){if(!this._graphStatus){new common.exception.Exception({msg:"graph status proxy must have an graph status instance!"});}return this._graphStatus;},setRatio:function(_19f){return this.getGraphStatus().setRatio(_19f);},getRatio:function(){return this.getGraphStatus().getRatio();},isComposite:function(){return this._isComposite;},showMark:function(_1a0){if(_1a0!==undefined){this._showMark=_1a0;}return this._showMark;},getIdty:function(){return this.getGraphStatus().getIdty();},isActive:function(_1a1){if(_1a1!==null&&_1a1!==undefined){this._isActive=_1a1;}return this._isActive;},isActived:function(_1a2){if(_1a2!==null&&_1a2!==undefined){this._isActived=_1a2;}return this._isActived;},getCenter:function(_1a3){var _1a4=this.getCache(_1a3),_1a5=_1a4[_197.CENTER];if(!_1a5){var gs=this.getGraphStatus(),c=gs.getCoordinate(_1a3),w=gs.getWidth(_1a3),h=gs.getHeight(_1a3);_1a4[_197.CENTER]=_1a5={x:c.x+(w>>1),y:c.y+(h>>1)};}return _1a5;},getCoordinate:function(_1a6){return this.getGraphStatus().getCoordinate(_1a6);},setCoordinate:function(_1a7,_1a8){var gs=this.getGraphStatus();gs.setCoordinate(_1a7,_1a8);},reset:function(_1a9,_1aa){var gs=this.getGraphStatus(),_1ab=gs.getMarks(_1aa);_1a9=_19a([_1a9],_1aa.getContext().getZoom())[0];if(_1ab){dojo.forEach(_1ab,function(item){if(item){item.x+=_1a9.x;item.y+=_1a9.y;}},this);gs.setMarks(_1ab,_1aa);}},getWidth:function(_1ac){return this.getGraphStatus().getWidth(_1ac);},setWidth:function(w,_1ad){this.getGraphStatus().setWidth(w,_1ad);},getHeight:function(_1ae){return this.getGraphStatus().getHeight(_1ae);},setHeight:function(h,_1af){this.getGraphStatus().setHeight(h,_1af);},setRotator:function(_1b0,_1b1,_1b2){var gs=this.getGraphStatus(),_1b3=gs.getRotator();(!_1b3)&&(_1b3={angle:0});if(_1b0.angle!=_1b3.angle){_1b3.angle=_1b0.angle;gs.setRotator(_1b3);}else{}!_1b2&&this.refresh(_1b1);},getRotator:function(_1b4){var gs=this.getGraphStatus(),_1b5=gs.getRotator(),_1b6=gs.getCoordinate(_1b4),h=gs.getHeight(_1b4),w=gs.getWidth(_1b4);return {coordinate:{x:_1b6.x+(w>>1),y:_1b6.y+(h>>1)},angle:_1b5?_1b5.angle:0};},getGraphRotator:function(_1b7){var gs=this.getGraphStatus(),_1b8=this.getGraphStrategy(),_1b9=gs.getRotateAngle(),_1ba=this.getCenter(_1b7);if(!_1b8.hasRotator()){return {coordinate:_1b8.getRotatorCoordinate(this,_1b7)||_1ba,angle:_1b9};}return {coordinate:_1ba,angle:_1b9};},getRealMarks:function(_1bb){return this.getGraphStatus().getMarks(_1bb);},getRealMotionAnchors:function(_1bc){return this.getGraphStatus().getMotionAnchors(_1bc);},getUrl:function(){return this.getGraphStatus().getUrl();},getNWCoordinate:function(_1bd){var _1be=this.getGraphRotator(_1bd),pole=_1be.coordinate,a=_1be.angle;return _19c(this.getCoordinate(_1bd),pole,a);},getSECoordinate:function(_1bf){var _1c0=this.getGraphRotator(_1bf),pole=_1c0.coordinate,a=_1c0.angle,_1c1=this.getCoordinate(_1bf),w=this.getWidth(_1bf),h=this.getHeight(_1bf);return _19c({x:_1c1.x+(w>>1),y:_1c1.y+(h>>1)},pole,a);},getCoordinatesByDeal:function(_1c2,_1c3){var _1c4=_1c2(this,_1c3);if(!_1c4){return null;}var r=_1c3.getDistance(),_1c5=this.getGraphRotator(_1c3),pole=_1c5.coordinate,_1c6=common.utils.CollectionUtils.copy4Attrs,a=_1c5.angle,p=_1c4[0],_1c7,temp;temp=_19c(p,pole,a);_1c6(p,temp,{x:1,y:1});_1c4[0]=[temp,_19c({x:p.x-r,y:p.y-r},pole,a),_19c({x:p.x+r,y:p.y-r},pole,a),_19c({x:p.x+r,y:p.y+r},pole,a),_19c({x:p.x-r,y:p.y+r},pole,a)];dojo.forEach(_1c4,function(_1c8,_1c9){if(_1c9!=0){temp=_19c(_1c8,pole,a);_1c6(_1c8,temp,{x:1,y:1});_1c7=_19b(temp,_1c4[0][0]);_1c4[_1c9]=[temp,add(_1c4[0][1],_1c7),add(_1c4[0][2],_1c7),add(_1c4[0][3],_1c7),add(_1c4[0][4],_1c7)];}},this);return _1c4;},getGraphCoordinates:function(_1ca){var _1cb=this.getCache(_1ca),_1cc=_1cb[_197.Graph];if(!_1cc){var _1cd=this.getGraphStrategy(),_1ce=this.getGraphRotator(_1ca),pole=_1ce.coordinate,a=_1ce.angle,_1cf=_1cd.getGraphCoordinates(this,_1ca);dojo.forEach(_1cf,function(item,_1d0){_1cf[_1d0]=_19c(item,pole,a);},this);_1cb[_197.Graph]=_1cf;return _1cf;}return _1cc;},getSkeletonCoordinates:function(_1d1){var _1d2=this.getCache(_1d1),_1d3=_1d2[_197.SKELETON];if(!_1d3){var _1d4=this.getGraphStrategy(),_1d5=this.getCoordinatesByDeal(_1d4.getSkeletonCoordinates,_1d1);_1d2[_197.SKELETON]=_1d5;return _1d5;}return _1d3;},getMarkCoordinates:function(_1d6){var _1d7=this.getCache(_1d6),_1d8=_1d7[_197.MARK];if(!_1d8){var _1d9=this.getGraphStrategy(),_1da=this.getCoordinatesByDeal(_1d9.getMarkCoordinates,_1d6);_1d7[_197.MARK]=_1da;return _1da;}return _1d8;},getOutletCoordinates:function(_1db){var _1dc=this.getCache(_1db),_1dd=_1dc[_197.OUTLET];if(!_1dd){var _1de=new drawboard.graph.strategy.RectangleStrategy(),_1df=_1de.getGraphCoordinates(this,_1db),_1e0=this.getGraphRotator(_1db),pole=_1e0.coordinate,a=_1e0.angle;dojo.forEach(_1df,function(item,_1e1){_1df[_1e1]=_19c(item,pole,a);},this);_1dc[_197.OUTLET]=_1df;return _1df;}return _1dd;},hasRotator:function(){return this.getGraphStrategy().hasRotator();},getRotatorCoordinates:function(_1e2){if(!this.hasRotator()){return null;}var _1e3=this.getCache(_1e2),_1e4=_1e3[_197.ROTATOR];if(!_1e4){var r=_1e2.getDistance(),d=_1e2.getRotateDistance(),_1e5=this.getRotator(_1e2),pole=_1e5.coordinate,a=_1e5.angle,_1e6=this.getCoordinate(_1e2),_1e7={x:pole.x,y:_1e6.y},_1e8=this.getGraphRotator(_1e2).coordinate,_1e9=_199.getDistant(pole,_19c(_1e7,_1e8,a)),_1ea;(_1e9>0)&&(d+=_1e9);_1ea=_19c({x:pole.x,y:pole.y-d-r},pole,a);_1e4=[_199.intersectCircleLine(_1ea,r,_1ea,{x:_1ea.x,y:_1ea.y+10})[0],_19c({x:pole.x,y:pole.y-d},pole,a),_19c({x:pole.x,y:pole.y-r},pole,a),{x:pole.x,y:pole.y},_19c({x:pole.x,y:pole.y-2*r},pole,a),_1ea];_1e3[_197.ROTATOR]=_1e4;return _1e4;}return _1e4;},getMotionAnchorCoordinates:function(_1eb){var _1ec=this.getCache(_1eb),_1ed=_1ec[_197.MOTIONANCHOR];if(!_1ed){var _1ee=this.getGraphStrategy(),_1ef=this.getCoordinatesByDeal(_1ee.getMotionAnchorCoordinates,_1eb);_1ec[_197.MOTIONANCHOR]=_1ef;return _1ef;}return _1ed;},refresh:function(_1f0,_1f1){var _1f2=this.getMarkCoordinates(_1f0),_1f3,_1f4;this.clearCache(_1f0);this.getSkeletonCoordinates(_1f0);this.getMotionAnchorCoordinates(_1f0);_1f3=this.getMarkCoordinates(_1f0);dojo.forEach(_1f2,function(item,_1f5){if(item[0]!=_1f3[_1f5][0]){_1f4=_19b(_1f3[_1f5][0],item[0]);drawboard.relationController.fireEvent(this.getIdty(),new drawboard.graph.decorate.Mark({coordinate:[item[1],item[3],item[2],item[4]],index:_1f5}),[_1f4],_1f0,_1f1);}},this);},getCache:function(_1f6){return _1f6.getCache(this);},clearCache:function(_1f7,type){_1f7.clearCache(this,type);},draw:function(_1f8){this.getGraphStrategy().draw(this,_1f8.getGraphic(),_1f8);if(this.isActived()){var p=drawboard.Constant.Path,_1f9=this.getOutletCoordinates(_1f8);_1f8.getGraphic().drawPath([{command:p.MOVE,points:_1f9[0]},{command:p.LINE,points:_1f9[1]},{command:p.LINE,points:_1f9[2]},{command:p.LINE,points:_1f9[3]}],"fill:none;stroke:red;stroke-width:2");}},sizeChange:function(_1fa,_1fb,end,_1fc){var _1fd=this.getGraphStrategy(),_1fe=this.getGraphRotator(_1fc),_1ff=_1fe.coordinate,a=_1fe.angle,_200=_1fb,gp=this,_201=_1fd.hasRotator(),_202={};if(end!==null&&end!==undefined){_200=_19b(end,_1fb);if(_201){var _203=_1fa.getDirect(),d=_196.Direction,_204=this.getCoordinate(_1fc),_205=this.getSkeletonCoordinates(_1fc),_206,_207;switch(_203){case d.NORTH:case d.WEST:case d.WESTNORTH:_206=_205[3][0];_207=function(pos,p,a){gp.setCoordinate(add(_204,_19b(_19c(pos,p,-a),{x:_204.x+gp.getWidth(_1fc),y:_204.y+gp.getHeight(_1fc)})),_1fc);};break;case d.EASTNORTH:_206=_205[2][0];_207=function(pos,p,a){gp.setCoordinate(add(_204,_19b(_19c(pos,p,-a),{x:_204.x,y:_204.y+gp.getHeight(_1fc)})),_1fc);};break;case d.WESTSOUTH:_206=_205[1][0];_207=function(pos,p,a){gp.setCoordinate(add(_204,_19b(_19c(pos,p,-a),{x:_204.x+gp.getWidth(_1fc),y:_204.y})),_1fc);};break;case d.SOUTH:case d.EAST:case d.EASTSOUTH:_206=_205[0][0];_207=function(pos,p,a){pos=_19c(pos,p,-a);gp.setCoordinate(pos,_1fc);};break;case d.END:break;default:break;}_202.oriFixPos=_206;_202.oriFixFunct=_207;_1fb=_19c(_1fb,_1ff,-a);end=_19c(end,_1ff,-a);_200=_19b(end,_1fb);}}_1fd.sizeChange(this,_1fa,_200,_1fc);if(_201&&a!=0&&_202!==undefined){this.clearCache(_1fc,_197.CENTER);var _208=_19c(this.getCenter(_1fc),_1ff,a);_202.oriFixFunct(_202.oriFixPos,_208,a);}this.refresh(_1fc);},move:function(_209,end,_20a){var _20b=this.getCoordinate(_20a),_20c=_19b(end,_209);this.setCoordinate({x:_20b.x+_20c.x,y:_20b.y+_20c.y},_20a);this.reset(_20c,_20a);this.refresh(_20a);},zoom:function(rate,_20d){this.refresh(_20d,function(){return false;});},moveMotionAnchor:function(_20e,_20f,_210){var _211=this.getRealMotionAnchors(_210);_211[_20e.index]=this.getGraphStrategy().calcMotionAnchor(this,_20e,_20f,_210);this.refresh(_210);},active:function(p,_212){if(this.getGraphStrategy().isIn(this,p,_212)){return this;}return null;},getActiveAnchors:function(_213){return this.getGraphStrategy().getActiveAnchors(this,_213);},isAnchor:function(d){return this.getGraphStrategy().isAnchor(d);},deleteAll:function(db,_214){this.destroy(_214);},destroy:function(_215){drawboard.relationController.removeListener(this,_215);}});})();}if(!dojo._hasResource["drawboard.graph.CompositeProxy"]){dojo._hasResource["drawboard.graph.CompositeProxy"]=true;dojo.provide("drawboard.graph.CompositeProxy");(function(){var _216=common.calc.Geometry,add=_216.add2Points,_217=_216.subtract2Points,_218=drawboard.Constant.Decorate;dojo.declare("drawboard.graph.CompositeProxy",[common.container.ListContainer,drawboard.graph.GraphProxy],{_focus:false,_isComposite:true,_operate:false,isFocus:function(_219){if(_219!==undefined){this._focus=_219;}return this._focus;},contains:function(gp){if(!gp){return false;}var _21a=false;this.some(function(item){if(item.gp==gp){_21a=true;return true;}},this);return _21a;},remove:function(gp){var _21b;this.some(function(item,i){if(item.gp==gp){_21b=i;return true;}},this);drawboard.graph.CompositeProxy.superclass.remove.apply(this,[_21b]);},equals:function(cp){if(cp.size()!=this.size()){return false;}var same=true;this.some(function(item){if(!cp.contains(item.gp)){same=false;return true;}},this);return same;},resetRelations:function(){var that=this,_21c,gp;this.forInItems(function(item){gp=item.gp;_21c=(gp.getParent&&gp.getParent());if(_21c!=that){_21c&&_21c.remove(gp);gp.getParent=function(){return that;};}},this);},add:function(gp,_21d){drawboard.graph.CompositeProxy.superclass.add.apply(this,[{gp:gp,oriPos:gp.getCoordinate(_21d),oriRotator:dojo.clone(gp.getRotator(_21d))}]);if(_216.graphContainsGraph(this.getSkeletonCoordinates(_21d),gp.getSkeletonCoordinates(_21d))){return;}var rect=_216.getMaxRect(gp.getSkeletonCoordinates(_21d).concat(this.getSkeletonCoordinates(_21d)));this.setCoordinate({x:rect.x,y:rect.y},_21d);this.setWidth(rect.width,_21d);this.setHeight(rect.height,_21d);this.refresh(_21d);},setRotator:function(_21e,_21f,_220){this._operate=true;var r=this.getRotator(_21f),_221,_222=_216.rotation,_223=_21e.angle-r.angle,_224=dojo.hitch(this,this.contains),_225=[];this.inherited(arguments);if(_220){return;}this.recursiveChild(_225);dojo.forEach(_225,function(gp){r=gp.getGraphRotator(_21f);r.angle+=_223;_221=gp.getNWCoordinate(_21f);_221=_222(_222(_221,_21e.coordinate,_223),_222(r.coordinate,_21e.coordinate,_223),-r.angle);gp.setCoordinate(_221,_21f);gp.setRotator(r,_21f,true);gp.refresh(_21f,function(_226){if(_224(_226)){return false;}return true;});},this);this._operate=false;},recursiveChild:function(_227){var gp;this.forInItems(function(item){gp=item.gp;_227.push(gp);if(gp.recursiveChild){gp.recursiveChild(_227);return;}},this);},deleteAll:function(db){this.forInItems(function(item){db.removeGraph(item.gp);},this);this.destroy();},destroy:function(){this.inherited(arguments);var gp;this.forInItems(function(item){gp=item.gp;gp.getParent&&(gp.getParent()==this)&&(delete gp.getParent);},this);},draw:function(_228){this.inherited(arguments);},sizeChange:function(_229,_22a,end,_22b){this._operate=true;var w=this.getWidth(_22b),h=this.getHeight(_22b),_22c=1,_22d=1,gp,nw,r,nnw,_22e,_22f,_230=_216.rotation,_231=this.getSkeletonCoordinates(_22b)[0][0],_232=this.getRotator(_22b),_233=dojo.hitch(this,this.contains);this.inherited(arguments);_22c=this.getWidth(_22b)/w;_22d=this.getHeight(_22b)/h;fixCoordinate=this.getSkeletonCoordinates(_22b)[0][0];this.forInItems(function(item){gp=item.gp;_22f=gp.getCoordinate(_22b);nw=gp.getNWCoordinate(_22b);nw=_230(nw,_231,-_232.angle);_22e=_217(nw,_231);nw=_230(add(_231,{x:_22e.x*_22c,y:_22e.y*_22d}),_231,_232.angle);nw=add(nw,_217(fixCoordinate,_231));gp.setWidth(gp.getWidth(_22b)*_22c,_22b);gp.setHeight(gp.getHeight(_22b)*_22d,_22b);_22b.clearCache(gp,_218.CENTER);r=gp.getGraphRotator(_22b);_22f=gp.getCoordinate(_22b);nnw=_230(_22f,r.coordinate,r.angle);gp.setCoordinate(add(_22f,_217(nw,nnw)),_22b);gp.refresh(_22b,function(_234){if(_233(_234)){return false;}return true;});},this);this._operate=false;},move:function(_235,end,_236){this._operate=true;this.inherited(arguments);this.forInItems(function(item){if(item){item.oriPos=add(item.oriPos,_217(end,_235));item.gp.move(_235,end,_236);}},this);this._operate=false;},zoom:function(rate,_237){this._operate=true;this.inherited(arguments);this.forInItems(function(item){if(item){item.gp.zoom(rate,_237);}},this);this._operate=false;}});})();}if(!dojo._hasResource["drawboard.graph.GraphStatus"]){dojo._hasResource["drawboard.graph.GraphStatus"]=true;dojo.provide("drawboard.graph.GraphStatus");(function(){var _238=common.calc.Geometry,_239=_238.multiPoint,_23a=_238.dividePoint;dojo.declare("drawboard.graph.GraphStatus",[dijit._Widget,common.Identity],{_coordinate:null,_w:null,_h:null,_rotator:null,_motionAnchors:null,_marks:null,_url:null,_ratio:null,setRatio:function(_23b){return this._ratio=_23b;},getRatio:function(){return this._ratio;},setCoordinate:function(_23c,_23d){this._coordinate=_23a(_23c,this.getZoom(_23d))[0];},getCoordinate:function(_23e){return _239(this._coordinate,this.getZoom(_23e))[0];},getZoom:function(_23f){return _23f.getContext().getZoom();},setWidth:function(w,_240){this._w=w/this.getZoom(_240).x;},getWidth:function(_241){return this._w*this.getZoom(_241).x;},setHeight:function(h,_242){this._h=h/this.getZoom(_242).y;},getHeight:function(_243){return this._h*this.getZoom(_243).y;},hasRotator:function(){if(this._rotator){return true;}return false;},setRotator:function(_244){this._rotator=_244;},getRotator:function(){return this._rotator;},getRotateAngle:function(){var _245=this.getRotator();if(_245){return _245.angle;}return 0;},setMarks:function(_246,_247){this._marks=_23a(_246,this.getZoom(_247));},getMarks:function(_248){return this._marks&&_239(this._marks,this.getZoom(_248));},setMotionAnchors:function(_249,_24a){this._motionAnchors=_249;},getMotionAnchors:function(_24b){return this._motionAnchors;},getUrl:function(){return this._url;},setUrl:function(url){this._url=url;}});})();}if(!dojo._hasResource["drawboard.drawProcessor.DrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DrawProcessor");dojo.declare("drawboard.drawProcessor.DrawProcessor",null,{draw:function(gp,_24c){}});}if(!dojo._hasResource["drawboard._Selector"]){dojo._hasResource["drawboard._Selector"]=true;dojo.provide("drawboard._Selector");(function(){var _24d=drawboard.Constant,_24e=_24d.ActionStatus,_24f=_24d.MouseAction,_250=common.calc.Geometry;dojo.declare("drawboard._Selector",drawboard.container.LayoutContainer,{_events:null,_status:_24e.NONE,_mouseStatus:_24f.NONE,_active:null,_decorate:null,_graphStrategy:null,_isMark:false,_isSelecting:false,lastScrollTop:0,lastScrollLeft:0,cache:null,postCreate:function(host){this._events=[dojo.connect(host,"onmousemove",dojo.hitch(this,"doMouseMove")),dojo.connect(host,"onmousedown",dojo.hitch(this,"doMouseDown")),dojo.connect(host,"onmouseup",dojo.hitch(this,"doMouseUp")),dojo.connect(host,"onmouseover",dojo.hitch(this,"doMouseOver")),dojo.connect(host,"onclick",dojo.hitch(this,"doClick")),dojo.connect(window,"onkeydown",dojo.hitch(this,"doKeyDown")),dojo.connect(window,"onkeyup",dojo.hitch(this,"doKeyUp")),dojo.connect(this.domNode,"onscroll",dojo.hitch(this,"doScroll"))];},getStatusCache:function(){if(!this.cache){this.cache={};}return this.cache;},setStatusCache:function(gp,_251,_252){var _253=this.getStatusCache();gp&&(_253.active=gp);_251&&(_253.decorate=_251);_253.status=_252;},setStatus:function(gp,_254,_255){var _256=this._active,_257;if(_256&&_256!=gp){_257=_256.getParent&&_256.getParent();if(_256.isComposite()&&!_256.contains(gp)){_256.isFocus(false);}_256.isActive(false);if(_257&&!_257.contains(gp)){_257.isFocus(false);_257.isActive(false);}}this._active=gp;this._decorate=_254;this._status=_255;this.updateActive();},updateActive:function(){var gp=this.getActive();gp&&gp.isActive(true)&&gp.isComposite()&&gp.isFocus(true);},getMouseStatus:function(){return this._mouseStatus;},setMouseStatus:function(_258){this._mouseStatus=_258;},getActionStatus:function(){return this._status;},setActionStatus:function(_259){this._status=_259;},getDecorate:function(){return this._decorate;},setDecorate:function(d){this._decorate=d;},getActive:function(){return this._active;},setActive:function(gp){this._active=gp;},setDrawType:function(_25a){this._graphStrategy=_25a;this._isSelecting=false;this._isMark=false;},getDrawType:function(){return this._graphStrategy;},isSelecting:function(_25b){this._isSelecting=_25b;if(_25b){this._isMark=false;this._graphStrategy=null;}},isMark:function(mark){this._isMark=mark;if(mark){this._isSelecting=false;this._graphStrategy=null;}},doClick:function(e){this.setMouseStatus(_24f.MOUSECLICK);},doMouseMove:function(e){if(this.getMouseStatus()==_24f.MOUSEDOWN){var _25c=this.getActive(),_25d=this.getStatusCache(),_25e=_25d.active,_25f=_25e&&_25e.getParent&&_25e.getParent(),_260=drawboard.relationController,_261=this.getDecorate(),_262=this.getRuntime();_25c&&_260.containRestrain(_25c,_261,_262)&&this.addCommand(_24d.Command.ADDVSDELTECONSTRAINCOMMAND,_260,{restrainedGp:_25c,restrainedD:_261},false);if(_25e&&_25e.isComposite()&&_25c){!_25c.isActive(false)&&_25c.isComposite()&&_25c.isFocus(false);_25e.isActive(true);_25e.isFocus(true);_25f&&_25f.isFocus(true);this._active=_25e;}}this.setMouseStatus(_24f.MOUSEMOVE);},doMouseDown:function(e){var d=drawboard,_263=d.markController,_264=this.fetchCoordinate(e),_265,_266=this.getRuntime(),_267=dojo.hitch(_266.getDrawProcessor(),"setActive"),_268=this.getSelectRect();this.setMouseStatus(_24f.MOUSEDOWN);if(this._graphStrategy){this.setStatus(null,null,_24e.DRAWING);return;}_268&&(_265=_267(_268,_264,this._isMark,_263,_266));if(!_265){this.some(function(gp){_265=_267(gp,_264,this._isMark,_263,_266);if(_265){return true;}},this,true);}if(this.getActive()&&e.ctrlKey&&_265&&_265.active){_265=_265.active;if(_268){if(_268.contains(_265)){return;}_268.add(_265,_266);}else{var _269=this.getActive();if(!_269){return;}if(_269.isComposite()&&_269.contains(_265)){return;}var rect=_250.getMaxRect([_265.getGraphCoordinates(_266).concat(_269.getGraphCoordinates(_266))]),_268=new drawboard.graph.CompositeProxy(new drawboard.graph.GraphStatus({_coordinate:{x:rect.x,y:rect.y},_w:rect.width,_h:rect.height}),this.getSRGraphStrategyClass());_269.isActive(false);_268.add(_269,_266);_268.add(_265,_266);this.setSelectRect(_268);this.setStatus(_268,null,_24e.MOVING);}this.draw();return;}if(_268){if(!_265){this.setSelectRect(null);this.draw();return;}this.setStatus(_265.active,_265.decorate,_265.status);return;}if(!_265){this.setStatus(null,null,_24e.SELECTING);}else{this.setStatus(_265.active,_265.decorate,_265.status);}},doMouseOver:function(e){this.setMouseStatus(_24f.MOUSEOVER);},doMouseUp:function(e){this.setMouseStatus(_24f.MOUSEUP);this.setStatusCache(this._active,this._decorate,this._status);this._status=_24e.NONE;this._decorate=null;},doKeyDown:function(e){var gp=this.getActive(),_26a=this.getSelectRect(),keys=dojo.keys,_26b=_24d.Command,_26c=dojo.hitch(this,"addCommand");if(gp&&e.keyCode==keys.DELETE&&!e.ctrlKey){_26c(_26b.CREATEVSDELETECOMMAND,this,gp,true);_26a&&this.setSelectRect(null);}if(e.keyCode==keys.UP_ARROW){_26c(_26b.ZOOMCOMMAND,this,{x:10,y:10});}if(e.keyCode==keys.DOWN_ARROW){_26c(_26b.ZOOMCOMMAND,this,{x:-10,y:-10});}if(e.keyCode==90&&e.ctrlKey){this.undo();}if(e.keyCode==89&&e.ctrlKey){this.redo();}this.draw();},doKeyUp:function(e){this.clearCommand();},doScroll:function(e){var _26d=e.target||e.srcElement;if(_26d!=this.domNode){return;}var top=_26d.scrollTop,left=_26d.scrollLeft,_26e=this.lastScrollTop,_26f=this.lastScrollLeft;if(top!=_26e){this.fireListener(["doScroll",[false,top-_26e]]);this.lastScrollTop=top;return;}if(left!=_26f){this.fireListener(["doScroll",[true,left-_26f]]);this.lastScrollLeft=left;}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);}});})();}if(!dojo._hasResource["drawboard.graphic.Graphic"]){dojo._hasResource["drawboard.graphic.Graphic"]=true;dojo.provide("drawboard.graphic.Graphic");dojo.declare("drawboard.graphic.Graphic",null,{createAnchor:function(w,h){},setStyle:function(_270){},drawLine:function(_271,w,h){},drawRect:function(_272,w,h){},drawCircle:function(_273,r){},drawPath:function(_274){},drawImage:function(_275,w,h,url,_276){},setSize:function(w,h){},clear:function(){}});}if(!dojo._hasResource["drawboard.graphic.SVGGraphic"]){dojo._hasResource["drawboard.graphic.SVGGraphic"]=true;dojo.provide("drawboard.graphic.SVGGraphic");(function(){var _277="http://www.w3.org/2000/svg",_278="http://www.w3.org/1999/xlink",attr=dojo.attr,_279=window.location.pathname,_27a=_279.substring(0,_279.indexOf("/",1)+1),_27b=function(node,ns,_27c,_27d){node.setAttributeNS(ns,_27c,_27d);},_27e=function(ele){return document.createElementNS(_277,ele);};dojo.declare("drawboard.graphic.SVGGraphic",drawboard.graphic.Graphic,{anchor:null,createAnchor:function(w,h){var node=_27e("svg");w&&attr(node,"width",w);h&&attr(node,"height",h);this.anchor=node;return node;},setSize:function(w,h){var node=this.anchor;w&&attr(node,"width",w);h&&attr(node,"height",h);},drawPath:function(_27f,_280,open){var path=_27e("path"),d=[],ps;dojo.forEach(_27f,function(item){if(typeof item=="string"){this.push(item);}else{this.push(item.command);ps=item.points;(!dojo.isArray(ps))&&(ps=[ps]);dojo.forEach(ps,function(p){this.push((p.x?(p.y?p.x+","+p.y:p.x):p.y)+" ");},this);}},d);!open&&d.push("Z");attr(path,"d",d.join(""));_280&&attr(path,"style",_280);this.anchor.appendChild(path);return path;},drawCircle:function(_281,r,_282){var _283=_27e("circle");attr(_283,"cx",_281.x);attr(_283,"cy",_281.y);attr(_283,"r",r);_282&&attr(_283,"style",_282);this.anchor.appendChild(_283);return _283;},drawLine:function(p1,p2,_284){var line=_27e("line");attr(line,"x1",p1.x);attr(line,"y1",p1.y);attr(line,"x2",p2.x);attr(line,"y2",p2.y);_284&&attr(line,"style",_284);this.anchor.appendChild(line);return line;},drawRect:function(_285,w,h,rx,_286,_287){var rect=_27e("rect");attr(rect,"x",_285.x);attr(rect,"y",_285.y);attr(rect,"width",w);attr(rect,"height",h);if(_286){for(var item in _286){attr(rect,item,((_286[item] instanceof Array)?_286[item].join(" "):_286[item]));}}(rx!==undefined&&rx!=null)&&(attr(rect,"rx",rx));_287&&attr(rect,"style",_287);this.anchor.appendChild(rect);return rect;},drawImage:function(_288,w,h,url,_289){var _28a=_27e("image");_288&&attr(_28a,"x",_288.x);_288&&attr(_28a,"y",_288.y);attr(_28a,"width",w);attr(_28a,"height",h);_27b(_28a,_278,"xlink:href",_27a+url);if(_289){for(var item in _289){attr(_28a,item,_289[item] instanceof Array?_289[item].join(" "):_289[item]);}}this.anchor.appendChild(_28a);return _28a;},clear:function(){var _28b=this.anchor;while(_28b.lastChild){_28b.removeChild(_28b.lastChild);}}});})();}if(!dojo._hasResource["drawboard.controller.ParamsController"]){dojo._hasResource["drawboard.controller.ParamsController"]=true;dojo.provide("drawboard.controller.ParamsController");(function(){dojo.declare("drawboard.controller.ParamsController",null,{_distance:5,rotate_distance:20,rounder:10,getDistance:function(){return this._distance;},setDistance:function(_28c){this._distance=_28c;},getRotateDistance:function(){return this.rotate_distance;},setRotateDistance:function(_28d){this.rotate_distance=_28d;},getRounder:function(){return this.rounder;}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.Controller"]){dojo._hasResource["drawboard.graph.decorate.controller.Controller"]=true;dojo.provide("drawboard.graph.decorate.controller.Controller");dojo.declare("drawboard.graph.decorate.controller.Controller",null,{draw:function(gp,_28e){},active:function(gp,_28f,_290){},create:function(ps){return null;},getStyle:function(gp,_291,_292){return _292.getContext().getStyleCtrl().getStyle(this.type,gp,_291);}});}if(!dojo._hasResource["drawboard.graph.decorate.controller.MarkController"]){dojo._hasResource["drawboard.graph.decorate.controller.MarkController"]=true;dojo.provide("drawboard.graph.decorate.controller.MarkController");(function(){var _293=common.calc.Geometry;dojo.declare("drawboard.graph.decorate.controller.MarkController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.MARK,draw:function(gp,_294){var _295,mark=new drawboard.graph.decorate.Mark(),gf=_294.getGraphic();dojo.forEach(gp.getMarkCoordinates(_294),function(item,_296){_295=[item[1],item[3],item[2],item[4]];mark.setCoordinate(_295);mark.setIndex(_296);mark.draw(gf,this.getStyle(gp,mark,_294),_294);},this);},active:function(gp,_297,_298){var mark;dojo.some(gp.getMarkCoordinates(_298),function(item,_299){item=[item[1],item[3],item[2],item[4]];if(_293.isPointInPolyn(item,_297)){mark=new drawboard.graph.decorate.Mark({coordinate:item,index:_299});return true;}},this);return mark;},create:function(ps){var mark,_29a=[];dojo.forEach(ps,function(item,_29b){mark=[item[1],item[3],item[2],item[4]];mark=new drawboard.graph.decorate.Mark({coordinate:skeleton,index:_29b});_29a.push(mark);},this);return _29a;},cross:function(s,cgp,db,_29c){var _29d,_29e=drawboard.skeletonController,mark,_29f={};db.some(function(gp){if(gp==cgp){return false;}_29d=gp.getMarkCoordinates(_29c);dojo.some(_29d,function(item,_2a0){item=[item[1],item[3],item[2],item[4]];dojo.some(item,function(p){if(_29e.isIn(s.getCoordinate(),p,_29c)){mark=true;return true;}},this);if(mark){_29f.d=new drawboard.graph.decorate.Mark({coordinate:item,index:_2a0});return true;}},this);if(mark){_29f.gp=gp;return true;}},this,true);if(mark){_29f.restrainedGp=cgp;_29f.restrainedD=s;return _29f;}return null;}});if(!drawboard.markController){drawboard.markController=new drawboard.graph.decorate.controller.MarkController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.MotionAnchor"]){dojo._hasResource["drawboard.graph.decorate.MotionAnchor"]=true;dojo.provide("drawboard.graph.decorate.MotionAnchor");(function(){var _2a1=drawboard.Constant;dojo.declare("drawboard.graph.decorate.MotionAnchor",drawboard.graph.decorate.Decorator,{_type:_2a1.Decorate.MOTIONANCHOR,draw:function(gp,_2a2,_2a3){var p=this.getCoordinate(),path=_2a1.Path,_2a4=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.LINE,points:p[2]},{command:path.LINE,points:p[3]}];gp.drawPath(_2a4,_2a2);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.MotionAnchorController"]){dojo._hasResource["drawboard.graph.decorate.controller.MotionAnchorController"]=true;dojo.provide("drawboard.graph.decorate.controller.MotionAnchorController");(function(){var _2a5=common.calc.Geometry,_2a6=common.utils.CollectionUtils;dojo.declare("drawboard.graph.decorate.controller.MotionAnchorController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.MOTIONANCHOR,draw:function(gp,_2a7){var _2a8,_2a9=new drawboard.graph.decorate.MotionAnchor(),gf=_2a7.getGraphic(),_2aa=gp.getMotionAnchorCoordinates(_2a7);_2aa&&dojo.forEach(_2aa,function(item,_2ab){_2a8=_2a6.sliceRange(item,1,4);_2a9.setCoordinate(_2a8);_2a9.setIndex(_2ab),_2a9.draw(gf,this.getStyle(gp,_2a9,_2a7),_2a7);},this);},active:function(gp,_2ac,_2ad){var _2ae,_2af=gp.getMotionAnchorCoordinates(_2ad);_2af&&dojo.some(_2af,function(item,_2b0){item=_2a6.sliceRange(item,1,4);if(_2a5.isPointInPolyn(item,_2ac)){_2ae=new drawboard.graph.decorate.MotionAnchor({coordinate:item,index:_2b0});return true;}},this);return _2ae;}});if(!drawboard.motionAnchorController){drawboard.motionAnchorController=new drawboard.graph.decorate.controller.MotionAnchorController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Rotator"]){dojo._hasResource["drawboard.graph.decorate.Rotator"]=true;dojo.provide("drawboard.graph.decorate.Rotator");(function(){var _2b1=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Rotator",drawboard.graph.decorate.Decorator,{_type:_2b1.Decorate.ROTATOR,pole:null,angle:null,draw:function(gf,_2b2,_2b3){var r=_2b3.getDistance(),p=_2b1.Path,path=[],_2b4=this.getCoordinate();gf.drawCircle(_2b4[3],r,_2b2);gf.drawLine(_2b4[2],_2b4[1],_2b2);gf.drawCircle({x:_2b4[0].x,y:_2b4[0].y-r},r,_2b2);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.RotatorController"]){dojo._hasResource["drawboard.graph.decorate.controller.RotatorController"]=true;dojo.provide("drawboard.graph.decorate.controller.RotatorController");(function(){var _2b5=common.calc.Geometry;dojo.declare("drawboard.graph.decorate.controller.RotatorController",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.ROTATOR,draw:function(gp,_2b6){if(!gp.hasRotator()){return;}var _2b7=gp.getRotatorCoordinates(_2b6),_2b8;_2b8=gp.getRotator(_2b6);_2b8=new drawboard.graph.decorate.Rotator({pole:_2b8.coordinate,angle:_2b8.angle,coordinate:_2b7});_2b8.draw(_2b6.getGraphic(),this.getStyle(gp,_2b8,_2b6),_2b6);},active:function(gp,_2b9,_2ba){if(!gp.hasRotator()){return null;}var _2bb;if(this.isIn(gp,_2b9,_2ba)){_2bb=gp.getRotator(_2ba);_2bb=new drawboard.graph.decorate.Rotator({coordinate:gp.getRotatorCoordinates(_2ba),pole:_2bb.pole,angle:_2bb.angle});}return _2bb;},isIn:function(gp,_2bc,_2bd){if(!gp.hasRotator()){return false;}var r=_2bd.getDistance(),_2be=gp.getRotatorCoordinates(_2bd);if(_2b5.isPointInCircle(_2bc,{coordinate:_2be[3],r:r})||_2b5.isPointInCircle(_2bc,{coordinate:_2be[5],r:r})||_2b5.isPointInSegment(_2be[1],_2be[4],_2bc)){return true;}return false;},isInPole:function(gp,_2bf,_2c0){if(!gp.hasRotator()){return false;}var _2c1=gp.getRotatorCoordinates(_2c0);if(_2b5.isPointInCircle(_2bf,{coordinate:_2c1[3],r:_2c0.getDistance()})){return true;}return false;}});if(!drawboard.rotatorController){drawboard.rotatorController=new drawboard.graph.decorate.controller.RotatorController();}})();}if(!dojo._hasResource["drawboard.graph.decorate.Skeleton"]){dojo._hasResource["drawboard.graph.decorate.Skeleton"]=true;dojo.provide("drawboard.graph.decorate.Skeleton");(function(){var _2c2=drawboard.Constant;dojo.declare("drawboard.graph.decorate.Skeleton",drawboard.graph.decorate.Decorator,{_type:_2c2.Decorate.SKELETON,_direct:null,_isAnchored:false,anchored:function(_2c3){this._isAnchored=_2c3;},isAnchored:function(){return this._isAnchored;},getDirect:function(){var _2c4=this._direct,t;if(typeof _2c4=="number"){return _2c4;}if(_2c4!==null&&_2c4!==undefined){var d=_2c2.Direction;switch(_2c4){case "mover_n":t=d.NORTH;break;case "mover_s":t=d.SOUTH;break;case "mover_w":t=d.WEST;break;case "mover_e":t=d.EAST;break;case "mover_nw":t=d.WESTNORTH;break;case "mover_ne":t=d.EASTNORTH;break;case "mover_sw":t=d.WESTSOUTH;break;case "mover_se":t=d.EASTSOUTH;break;default:t=d.NORTH;break;}this._direct=t;}return t;},draw:function(gp,_2c5,_2c6){var p=this.getCoordinate(),path=_2c2.Path;paths=[{command:path.MOVE,points:p[0]},{command:path.LINE,points:p[1]},{command:path.LINE,points:p[2]},{command:path.LINE,points:p[3]}];gp.drawPath(paths,_2c5);}});})();}if(!dojo._hasResource["drawboard.graph.decorate.controller.SkeletonController"]){dojo._hasResource["drawboard.graph.decorate.controller.SkeletonController"]=true;dojo.provide("drawboard.graph.decorate.controller.SkeletonController");(function(){var _2c7=common.calc.Geometry,_2c8=common.utils.CollectionUtils;dojo.declare("drawboard.graph.decorate.controller.SkeletonContainer",drawboard.graph.decorate.controller.Controller,{type:drawboard.Constant.Decorate.SKELETON,draw:function(gp,_2c9){var _2ca,_2cb=new drawboard.graph.decorate.Skeleton(),gf=_2c9.getGraphic();dojo.forEach(gp.getSkeletonCoordinates(_2c9),function(item,_2cc){_2ca=_2c8.sliceRange(item,1,4);_2cb.setCoordinate(_2ca);_2cb.setIndex(_2cc);item[0].isAnchored&&_2cb.anchored(item[0].isAnchored);_2cb.draw(gf,this.getStyle(gp,_2cb,_2c9),_2c9);},this);},isIn:function(ps,_2cd,_2ce){return _2c7.isPointInPolyn(ps,_2cd);},active:function(gp,_2cf,_2d0){var _2d1,gs=gp.getGraphStrategy(),temp;dojo.some(gp.getSkeletonCoordinates(_2d0),function(item,_2d2){temp=_2c8.sliceRange(item,1,4);if(this.isIn(temp,_2cf,_2d0)){_2d1=new drawboard.graph.decorate.Skeleton({coordinate:temp,index:_2d2,_direct:item[0].css});gs.isAnchor(_2d1)&&_2d1.anchored(true);return true;}},this);return _2d1;},create:function(ps){var _2d3=[];dojo.forEach(ps,function(item,_2d4){_2d3.push(this.createItem(item,_2d4));},this);return _2d3;},createItem:function(ps,_2d5){var _2d6=new drawboard.graph.decorate.Skeleton({coordinate:_2c8.sliceRange(ps,1,4),index:_2d5,_direct:ps[0].css});ps[0].isAnchored&&_2d6.anchored(true);return _2d6;}});if(!drawboard.skeletonController){drawboard.skeletonController=new drawboard.graph.decorate.controller.SkeletonContainer();}})();}if(!dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.DbDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.DbDrawProcessor");(function(){dojo.declare("drawboard.drawProcessor.DbDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_2d7){if(gp.isComposite()&&!gp.isFocus()){return;}gp.draw(_2d7);if(gp.isActive()){drawboard.skeletonController.draw(gp,_2d7);drawboard.motionAnchorController.draw(gp,_2d7);drawboard.rotatorController.draw(gp,_2d7);}((_2d7.getShowMark()||gp.showMark())||gp.isActive()||gp.isActived())&&drawboard.markController.draw(gp,_2d7);},setActive:function(gp,p,only,_2d8,_2d9){var _2da=drawboard.Constant.ActionStatus,_2db,_2dc;if(gp&&gp.isActive()){var _2dd=[{controller:drawboard.skeletonController,status:_2da.RESIZING},{controller:drawboard.rotatorController,status:[_2da.POLEMOVING,_2da.ROTATING]},{controller:drawboard.markController,status:_2da.MARKING},{controller:drawboard.motionAnchorController,status:_2da.MOTION}],_2de,_2df,_2e0;dojo.some(_2dd,function(item){_2de=item.controller;if(only&&_2de!=_2d8){return;}if(!only&&_2de==_2d8){return;}_2df=_2de.active(gp,p,_2d9);if(_2df){_2db={};_2e0=item.status;if(dojo.isArray(_2e0)){if(_2de.isInPole(gp,p,_2d9)){_2db.status=_2e0[0];}else{_2db.status=_2e0[1];}}else{_2db.status=_2e0;}_2db.active=gp;_2db.decorate=_2df;return true;}},this);}if(!_2db&&gp.isComposite()){return null;}if(!_2db&&gp.active(p,_2d9)){_2dc=this.getActiveParent(gp);_2db={};_2db.status=_2da.MOVING;if(_2dc&&!_2dc.isFocus()){gp=_2dc;}_2db.active=gp;_2db.decorate=null;}return _2db;},getActiveParent:function(gp){var _2e1=(gp.getParent&&gp.getParent()),_2e2,_2e3;do{if(!_2e1||_2e1.isFocus()){_2e3=_2e2;break;}_2e2=_2e1;_2e1=(_2e2.getParent&&_2e2.getParent());}while(true);return _2e3;}});})();}if(!dojo._hasResource["drawboard.context.ExecuteContext"]){dojo._hasResource["drawboard.context.ExecuteContext"]=true;dojo.provide("drawboard.context.ExecuteContext");(function(){var _2e4=common.calc.Geometry;dojo.declare("drawboard.context.ExecuteContext",dijit._Widget,{zoom:{x:100,y:100},paramsCtrl:null,styleCtrl:null,commandCtrl:null,drawProcessor:null,getZoom:function(){return _2e4.dividePoint(this.zoom,{x:100,y:100})[0];},setZoom:function(rate){var zoom=_2e4.add2Points(this.zoom,rate);if(zoom.x<0||zoom.y<0||zoom.x>200||zoom.y>200){return false;}this.zoom=zoom;return true;},getParamsCtrl:function(){if(!this.paramsCtrl){new common.exception.Exception({msg:"the parameters controller in context doesnt' exist!"});}return this.paramsCtrl;},setParamsCtrl:function(_2e5){this.paramsCtrl=_2e5;},getCommandCtrl:function(){if(!this.commandCtrl){new common.exception.Exception({msg:"the command controller in context doesnt' exist!"});}return this.commandCtrl;},setCommandCtrl:function(_2e6){this.commandCtrl=_2e6;},setStyleCtrl:function(_2e7){if(!this.styleCtrl){new common.exception.Exception({msg:"the style controller in context doesnt' exist!"});}this.styleCtrl=_2e7;},getStyleCtrl:function(){return this.styleCtrl;},getDrawProcessor:function(){if(!this.drawProcessor){new common.exception.Exception({msg:"the draw processor in context doesnt' exist!"});}return this.drawProcessor;},setDrawProcessor:function(_2e8){this.drawProcessor=_2e8;}});})();}if(!dojo._hasResource["drawboard.runtime.ExecuteRuntime"]){dojo._hasResource["drawboard.runtime.ExecuteRuntime"]=true;dojo.provide("drawboard.runtime.ExecuteRuntime");dojo.declare("drawboard.runtime.ExecuteRuntime",[dijit._Widget,common.Cache,common.listener.Listener],{context:null,graphic:null,_showMark:false,setShowMark:function(_2e9){this._showMark=_2e9;},getShowMark:function(){return this._showMark;},apply:function(_2ea,_2eb){this[_2ea]&&this[_2ea].apply(this,_2eb);},createCache:function(){return {};},getCache:function(gp){var _2ec=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this),item=_2ec[gp.getIdty()];(!item)&&(_2ec[gp.getIdty()]=item={});return item;},addCache:function(gp,type,_2ed){var _2ee=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this),item=_2ee[gp.getIdty()];(!item)&&(_2ee[gp.getIdty()]=item={});item[type]=_2ed;},clearCache:function(gp,type){var _2ef=drawboard.runtime.ExecuteRuntime.superclass.getCache.apply(this);if(type!==undefined&&type!==null){var item=_2ef[gp.getIdty()];if(item){item[type]=null;delete item[type];}this.fireListener(["clearCache",[gp,type]]);return;}_2ef[gp.getIdty()]=null;delete _2ef[gp.getIdty()];this.fireListener(["clearCache",[gp]]);},getContext:function(){if(!this.context){new common.exception.Exception({msg:"the context in runtime doesnt' exist!"});}return this.context;},setContext:function(_2f0){this.context=_2f0;},getGraphic:function(){if(!this.graphic){new common.exception.Exception({msg:"the graphic in runtime doesnt' exist!"});}return this.graphic;},setGraphic:function(gf){this.graphic=gf;},getDistance:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getDistance();},getRotateDistance:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getRotateDistance();},getRounder:function(){var ctx=this.getContext();return ctx.getParamsCtrl().getRounder();},getDrawProcessor:function(){return this.getContext().getDrawProcessor();},draw:function(gp){this.getDrawProcessor().draw(gp,this);},zoom:function(gp,rate){gp.zoom(rate,this);}});}if(!dojo._hasResource["drawboard.controller.CommandController"]){dojo._hasResource["drawboard.controller.CommandController"]=true;dojo.provide("drawboard.controller.CommandController");dojo.declare("drawboard.controller.CommandController",common.container.MapContainer,{resouce:drawboardRuntimeSetting.commands,_undoList:null,_redoList:null,maxSteps:20,store:null,constructor:function(){var list=common.container.ListContainer;this._undoList=new list();this._redoList=new list();this.render();},getReadStore:function(){var _2f1=this.store;if(!_2f1){_2f1=new dojo.data.ItemFileReadStore({url:this.resouce});_2f1._forceLoad();this.store=_2f1;}return this.store;},render:function(){var _2f2=this.getReadStore(),type,_2f3,_2f4,_2f5;dojo.forEach(_2f2._getItemsArray(),function(item){type=_2f2.getValue(item,"type");_2f3=_2f2.getValue(item,"command");_2f4=_2f2.getValue(item,"desp0");_2f5=_2f2.getValue(item,"desp1");this.registerCommand(type,_2f3,_2f4,_2f5);},this);},registerCommand:function(type,_2f6,_2f7,_2f8){this.addItem(type,{command:_2f6,0:_2f7,1:_2f8});},instanceCommand:function(type,_2f9,memo,_2fa,_2fb){var item=this.getItem(type),_2fc,_2fd;if(!item){new common.exception.Exception({msg:"the command type doesn't exsit!"});return;}_2fd=eval(item.command);_2fc=new _2fd(_2f9,memo,_2fa);_2fc.setDescription({0:item.desp0,1:item.desp1});_2fc.setRuntime(_2fb);return _2fc;},add:function(_2fe){var _2ff=this._undoList;_2ff.add(_2fe);if(_2ff.size()>this.maxSteps){_2ff.shift();}this._redoList.clearItems();},undo:function(){var _300=this._undoList.pop();if(!_300){return;}_300.unexecute();this._redoList.add(_300);},redo:function(){var _301=this._redoList.pop();if(!_301){return;}_301.execute();this._undoList.add(_301);}});}if(!dojo._hasResource["drawboard.DrawBoard"]){dojo._hasResource["drawboard.DrawBoard"]=true;dojo.provide("drawboard.DrawBoard");dojo.declare("drawboard.DrawBoard",[dijit._Templated,drawboard._Selector,drawboard._Event,common.listener.Listener],{templateString:"<div></div>",dbCanvas:null,graphicClass:drawboard.graphic.SVGGraphic,_graphic:null,anchor:null,w:null,h:null,defaultWidth:300,defaultHeight:300,_selectRect:null,_runtime:null,SRGraphStrategyClass:"drawboard.graph.strategy.RectangleStrategy",graphStrategyParam:null,drawEntity:null,_commands:null,postCreate:function(){var _302=this.createGraphic(),node,_303=drawboard.controller,ctx,_304,w=this.w,h=this.h,_305=this.domNode.style;_304=dojo.create("div",{},this.domNode);_305.overflow="auto";_305.width=w+"px";_305.height=h+"px";this.dbCanvas=_304;node=_302.createAnchor(w||this.defaultWidth,h||this.defaultHeight);this.anchor=node;ctx=new drawboard.context.ExecuteContext({paramsCtrl:new _303.ParamsController(),styleCtrl:new _303.StyleController(),commandCtrl:new _303.CommandController(),drawProcessor:new drawboard.drawProcessor.DbDrawProcessor()});this._runtime=new drawboard.runtime.ExecuteRuntime({context:ctx,graphic:_302});drawboard.DrawBoard.superclass.postCreate.call(this,node);_304.appendChild(this.anchor);},getGraphic:function(){return this.getRuntime().getGraphic();},getRuntime:function(){return this._runtime;},setRuntime:function(_306){this._runtime=_306;},setGraphStrategyParam:function(_307){this.graphStrategyParam=_307;},getGraphStrategyParam:function(){return this.graphStrategyParam;},createGraphic:function(){return new this.graphicClass();},getDrawEntity:function(_308){if(!this.drawEntity&&_308){this.drawEntity={};}return this.drawEntity;},getCanvasSize:function(){var zoom=this.getRuntime().getContext().getZoom();return {x:this.w*zoom.x,y:this.h*zoom.y};},getUserViewSize:function(){var _309=this.domNode;return {x:_309.clientWidth,y:_309.clientHeight};},clearDrawEntity:function(_30a){var _30b=this.drawEntity,_30c=this.graphStrategyParam;if(_30b&&!_30a){var gs=new drawboard.graph.GraphStatus({_coordinate:{x:_30b.x,y:_30b.y},_w:_30b.width,_h:_30b.height}),gp=new drawboard.graph.GraphProxy(gs,this.getDrawType());_30c&&_30c.url&&(gs.setUrl(_30c.url));_30c&&_30c.ratio&&(gs.setRatio(_30c.ratio));this.addCommand(drawboard.Constant.Command.CREATEVSDELETECOMMAND,this,gp);}this.drawEntity=null;this.graphStrategyParam=null;},getSRGraphStrategyClass:function(){return this.SRGraphStrategyClass;},setSRGraphStrategyClass:function(_30d){this.SRGraphStrategyClass=_30d;},getSelectRect:function(){return this._selectRect;},setSelectRect:function(_30e){var _30f=this._selectRect;if(_30e==_30f){return;}_30f&&_30f.destroy();this._selectRect=_30e;},containsSelectRect:function(_310){var _311=false;this.some(function(gp){if(gp.isComposite()&&gp.equals(_310)){_311=true;return true;}},this);return _311;},combine:function(){var _312=this.getSelectRect();_312&&!this.containsSelectRect(_312)&&!_312.resetRelations()&&this.combineGraph(_312);this._selectRect=null;},combineGraph:function(gp){this.add(gp);},divide:function(){var gp=this.getActive();this.divideGraph(gp);},divideGraph:function(gp){if(gp&&gp.isComposite()){gp.destroy();this.remove(gp);}},addGraph:function(gs,_313){var _314=new drawboard.graph.GraphProxy(gs,_313);this.add(_314);},removeGraph:function(gp){gp.deleteAll(this,this.getRuntime());this.getRuntime().getContext().getStyleCtrl().removeGraph(gp);this.remove(gp);},getGraph:function(idty){var gs;this.some(function(item){if(item.getIdty()==idty){gs=item;return true;}});return gs;},zoom:function(rate,_315){var _316=dojo.clone(_315.getContext().getZoom());if(!_315.getContext().setZoom(rate)){return;}var zoom=_315.getContext().getZoom(),_317=this.dbCanvas.style,gf=this.getGraphic(),w=this.w*zoom.x,h=this.h*zoom.y,_318=this.domNode,_319=common.calc.Geometry,_31a=this.getSelectRect(),_31b;_31b={x:_318.scrollLeft+(this.w>>1),y:_318.scrollTop+(this.h>>1)};_31b=_319.dividePoint(_31b,_316)[0];_31b=_319.multiPoint(_31b,zoom)[0];_317.width=w+"px";_317.height=h+"px";_318.scrollLeft=_31b.x-(this.w>>1);_318.scrollTop=_31b.y-(this.h>>1);gf.setSize(w,h);this.forInItems(function(gp){gp&&_315.zoom(gp,zoom);},this,true);_31a&&_315.zoom(_31a,zoom);this.fireListener(["zoom",[rate]]);},draw:function(){this.clearGraphs();var _31c=this.getSelectRect(),_31d=this.getDrawEntity(),_31e=this.getRuntime();this.drawGraphs(_31e);if(_31d){var gs=new drawboard.graph.GraphStatus({_coordinate:{x:_31d.x,y:_31d.y},_w:_31d.width,_h:_31d.height}),_31f=new drawboard.graph.GraphProxy(gs,this.getDrawType()||this.getSRGraphStrategyClass()),_320=this.graphStrategyParam;_320&&_320.url&&(gs.setUrl(_320.url));_320&&_320.ratio&&(gs.setRatio(_320.ratio));_31f.showMark(false);_31e.draw(_31f);}_31c&&(_31e.draw(_31c));this.fireListener(["draw"]);},drawGraphs:function(_321){this.forInItems(function(gp){gp&&_321.draw(gp);},this);},clearGraphs:function(){this.getGraphic().clear();},setStyle:function(_322,_323){var gp=this.getActive();gp&&this.addCommand(drawboard.Constant.Command.STYLECOMMAND,this.getRuntime().getContext().getStyleCtrl(),{gp:gp,attr:_322,value:_323});this.clearCommand();this.draw();},getCommandCtrl:function(){return this.getRuntime().getContext().getCommandCtrl();},getCommands:function(){var _324=this._commands;if(!_324){_324=this._commands=new drawboard.command.CompositeCommand();this.getCommandCtrl().add(_324);}return _324;},addCommand:function(type,_325,memo,_326){var _327=this.getCommandCtrl().instanceCommand(type,_325,memo,_326,this.getRuntime());_327.execute();this.getCommands().add(_327);},clearCommand:function(){this._commands=null;},undo:function(){this.getCommandCtrl().undo();this.draw();},redo:function(){this.getCommandCtrl().redo();this.draw();}});}if(!dojo._hasResource["drawboard.drawProcessor.ZoomDrawProcessor"]){dojo._hasResource["drawboard.drawProcessor.ZoomDrawProcessor"]=true;dojo.provide("drawboard.drawProcessor.ZoomDrawProcessor");(function(){dojo.declare("drawboard.drawProcessor.ZoomDrawProcessor",drawboard.drawProcessor.DrawProcessor,{draw:function(gp,_328){gp.draw(_328);}});})();}if(!dojo._hasResource["drawboard.ZoomDrawBoard"]){dojo._hasResource["drawboard.ZoomDrawBoard"]=true;dojo.provide("drawboard.ZoomDrawBoard");(function(){var _329=common.calc.Geometry,_32a=drawboard.Constant.MouseAction,_32b=_329.subtract2Points;dojo.declare("drawboard.ZoomDrawBoard",[dijit._Widget,dijit._Templated],{templateString:"<div style='position:relative;overflow:hidden;'><div dojoAttachPoint='zoomDrawboard'></div><div dojoAttachPoint='zoomRect' style='position:absolute;border:2px solid red;left:0px;top:0px;'></div></div>",graphicClass:drawboard.graphic.SVGGraphic,_graphic:null,anchor:null,w:null,h:null,_zoom:{x:100,y:100},rectBorder:2,defaultWidth:300,defaultHeight:300,_runtime:null,drawboard:null,events:null,boxCache:null,scopeSelf:false,postCreate:function(){var _32c=this.createGraphic(),node,_32d=drawboard.controller,ctx,db=this.getDrawBoard(),_32e,_32f=this.zoomRect,_330=this.domNode,_331=this.rectBorder,w=this.w||this.defaultWidth,h=this.h||this.defaultHeight;node=_32c.createAnchor(w,h);this.anchor=node;ctx=new drawboard.context.ExecuteContext({paramsCtrl:new _32d.ParamsController(),styleCtrl:new _32d.StyleController(),drawProcessor:new drawboard.drawProcessor.ZoomDrawProcessor(),zoom:{x:50,y:50}});this._runtime=_32e=new drawboard.runtime.ExecuteRuntime({context:ctx,graphic:_32c});this.zoomDrawboard.appendChild(this.anchor);_32f.style.width=w+"px";_32f.style.height=h+"px";_330.style.width=w+(_331<<1)+"px";_330.style.height=h+(_331<<1)+"px";this.events=[dojo.connect(_32f,"onmousemove",dojo.hitch(this,"doMouseMove")),dojo.connect(_32f,"onmousedown",dojo.hitch(this,"doMouseDown")),dojo.connect(_32f,"onmouseup",dojo.hitch(this,"doMouseUp"))];db.addListener(this.apply,this);db.getRuntime().addListener(_32e.apply,_32e);},getDrawBoard:function(){if(!this.drawboard){new common.exception.Exception({msg:"the draw board can't find in the zoom window!"});}return this.drawboard;},setDrawBoard:function(_332){this.drawboard=_332;},setZoom:function(rate){var zoom=_32b(this._zoom,{x:rate.x,y:rate.y});if(zoom.x<0||zoom.y<0||zoom.x>200||zoom.y>200){return false;}this._zoom=zoom;return true;},getZoom:function(){return _329.dividePoint(this._zoom,{x:100,y:100})[0];},getGraphic:function(){return this.getRuntime().getGraphic();},getRuntime:function(){return this._runtime;},setRuntime:function(_333){this._runtime=_333;},createGraphic:function(){return new this.graphicClass();},apply:function(_334,_335){this[_334]&&this[_334].apply(this,_335);},zoom:function(rate){this._unitCache=null;if(!this.setZoom(rate)){return;}this.scopeSelf=true;var _336=this.zoomRect,zoom=this.getDrawBoard().getRuntime().getContext().getZoom(),_337=_336.style,w=this.w,h=this.h,rw=w/(zoom.x),rh=h/(zoom.y);_337.left=parseFloat(_337.left)+(parseFloat(_337.width)>>1)-(rw>>1)+"px";_337.top=parseFloat(_337.top)+(parseFloat(_337.height)>>1)-(rh>>1)+"px";_337.width=rw+"px";_337.height=rh+"px";this.draw();},draw:function(){this.clearGraphs();var db=this.getDrawBoard();db.drawGraphs(this.getRuntime());},clearGraphs:function(){var _338=this.anchor;while(_338.lastChild){_338.removeChild(_338.lastChild);}},getBoxCache:function(){if(!this.boxCache){var node=this.domNode,_339={left:node.offsetLeft,top:node.offsetTop};this.boxCache=_339;}return this.boxCache;},fetchCoordinate:function(e){var box=this.getBoxCache(),_33a=this.domNode;return {x:e.pageX-box.left+_33a.scrollLeft,y:e.pageY-box.top+_33a.scrollTop};},getUnitPx:function(){if(!this._unitCache){var db=this.getDrawBoard(),_33b=db.getCanvasSize(),_33c=db.getUserViewSize(),_33d=this.zoomRect.style;this._unitCache={x:(_33b.x-_33c.x)/(this.w-parseFloat(_33d.width)),y:(_33b.y-_33c.y)/(this.h-parseFloat(_33d.height))};}return this._unitCache;},status:_32a.NONE,_start:null,_end:null,_loseAccuracyLeft:0,_loseAccuracyTop:0,_accuracy:100000,doMouseMove:function(e){if(this.status!=_32a.MOUSEDOWN&&this.status!=_32a.MOUSEMOVE){return;}var end=this.fetchCoordinate(e),_33e=_32b(end,this._start),_33f=this.zoomRect.style,db=this.getDrawBoard(),_340=db.domNode,unit=this.getUnitPx(),temp,_341=this._accuracy,top=parseFloat(_33f.top)+_33e.y,left=parseFloat(_33f.left)+_33e.x,_342=db.getCanvasSize(),_343=db.getUserViewSize(),_344=parseFloat(_33f.width),_345=parseFloat(_33f.height);this._start=end;(top<0)&&(top=0);(left<0)&&(left=0);this.scopeSelf=true;_33f.top=top+"px";_33f.left=left+"px";if(left==0){_340.scrollLeft=0;this._loseAccuracyLeft=0;}else{if((left+_344)>this.w){_340.scrollLeft=_342.x-_343.x;_33f.left=this.w-_344+"px";}else{_340.scrollLeft=temp=_340.scrollLeft+_33e.x*unit.x;temp=(temp*_341-parseInt(temp)*_341)/_341;this._loseAccuracyLeft=temp=this._loseAccuracyLeft+temp;if(temp>=1){_340.scrollLeft+=1;this._loseAccuracyLeft=temp-1;}}}if(top==0){_340.scrollTop=0;this._loseAccuracyTop=0;}else{if((top+_345)>this.h){_340.scrollTop=_342.y-_343.y;_33f.top=this.h-_345+"px";}else{_340.scrollTop=temp=_340.scrollTop+_33e.y*unit.y;temp=(temp*_341-parseInt(temp)*_341)/_341;this._loseAccuracyTop=temp=this._loseAccuracyTop+temp;if(temp>=1){_340.scrollTop+=1;this._loseAccuracyTop=temp-1;}}}this.status=_32a.MOUSEMOVE;},doMouseDown:function(e){this._start=this.fetchCoordinate(e);this.status=_32a.MOUSEDOWN;},doMouseUp:function(e){this.status=_32a.MOUSEUP;},doScroll:function(_346,_347){if(this.scopeSelf){this.scopeSelf=false;return;}var _348=this.zoomRect.style,unit=this.getUnitPx();if(_346){_348.left=parseFloat(_348.left)+_347/unit.x+"px";}else{_348.top=parseFloat(_348.top)+_347/unit.y+"px";}},destroy:function(){dojo.forEach(this.events,dojo.disconnect);}});})();}
