/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["window.widget.GraphChooseContainer"]){dojo._hasResource["window.widget.GraphChooseContainer"]=true;dojo.provide("window.widget.GraphChooseContainer");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.layout.AccordionContainer");dojo.require("dijit.layout.ContentPane");dojo.require("dojo.data.ItemFileReadStore");dojo.require("common.exception.Exception");dojo.declare("window.widget.GraphChooseContainer",[dijit._Widget,dijit._Templated],{templateString:"<div></div>",definition:null,accordion:null,width:null,height:null,active:null,drawboard:null,overNode:null,clickCss:"graphClick",overCss:"graphOver",events:null,postCreate:function(){var _1=[],_2=this;(this.width)&&(_1.push("width:"+this.width+";"));(this.height)&&(_1.push("height:"+this.height+";"));var _3=new dijit.layout.AccordionContainer({style:_1.join(" ")}).placeAt(this.domNode);dojo.connect(_3,"_showChild",function(){_2.clearStatus();});_3.startup();this.accordion=_3;this.createContent();dojo.subscribe("/drawboard/mouseup",dojo.hitch(this,"clearStatus"));this.events=[dojo.connect(this.domNode,"onclick",this,this.doclick),dojo.connect(this.domNode,"onmousemove",this,this.domousemove)];},clearStatus:function(){var db=this.drawboard;db&&db.setDrawType(null);var _4=this.active;if(_4){dojo.removeClass(_4,this.clickCss);this.active=null;}},getDefinition:function(){if(!this.definition){this.createDefinition();}return this.definition;},createDefinition:function(){this.definition=new dojo.data.ItemFileReadStore({url:drawboardRuntimeSetting.graphImgUrl});this.definition._forceLoad();},createContent:function(){var _5=this.getDefinition(),_6=_5._arrayOfAllItems[0],_7=this.createGraphContent;dojo.forEach(_6.children,function(_8,_9){_7.call(this,_8,_9);},this);},createGraphContent:function(_a,_b){var _c=new dijit.layout.ContentPane({title:_a.name[0]});_c.containerNode.innerHTML=this.generateGraphContent(_a);this.accordion.addChild(_c);},generateGraphContent:function(_d){var _e=[],_f;dojo.forEach(_d.children,function(_10){_f=["<div id=",_10.id[0]," name=",_10.name[0]," title=",_10.name[0],"","",""," strategy='",_10.strategy[0],"' class='graphIconContainer'><img src='",drawboardRuntimeSetting.blankGif,"' class='graphIcon ",(_d.css||"")," ",_10.css[0],"'/>","<span class='graphText'>",_10.name[0],"</span></div>"];_10.url&&(_f[6]=" url='"+_10.url[0]+"'");_10.ratio&&(_f[7]=" ratio='"+_10.ratio[0]+"'");_10.affectedByZoom&&(_f[8]=" affectedByZoom='"+_10.affectedByZoom[0]+"'");_e.push(_f.join(" "));},this);return _e.join(" ");},getGraphNode:function(e){var _11=e.target||e.srcElement;if(dojo.hasClass(_11,"graphIconContainer")){return _11;}else{if(dojo.hasClass(_11,"graphIcon")||dojo.hasClass(_11,"graphText")){return _11.parentNode;}}return null;},destroyComponent:function(){dojo.forEach(this.events,dojo.disconnect);for(var _12 in this){if(typeof _12=="function"){continue;}if(this[_12].destroyRecursive){this[_12].destroyRecursive(true);}this[_12]=null;delete this[_12];}},setDrawboard:function(db){this.drawboard=db;},getDrawboard:function(){if(!this.drawboard){new common.exception.Exception({msg:"the drawboard doesn't exist!"});return;}return this.drawboard;},doclick:function(e){var _13=this.getGraphNode(e),_14,_15,db,_16={},tmp,_17=false;if(!_13){return;}_14=this.clickCss;_15=this.active;if(dojo.hasClass(_13,_14)||_15==_13){return;}_15&&(dojo.removeClass(_15,_14));dojo.addClass(_13,_14);db=this.getDrawboard();db.setDrawType(dojo.attr(_13,"strategy"));tmp=dojo.attr(_13,"url");if(tmp){_16.url=tmp;tmp=dojo.attr(_13,"ratio");tmp&&(_16.ratio=tmp);_17=true;}tmp=dojo.attr(_13,"affectedByZoom");tmp&&((_16.affectedByZoom=tmp)||(_17=true));_17&&db.setGraphStrategyParam(_16);this.active=_13;},domousemove:function(e){var _18=this.getGraphNode(e),_19=this.overCss,_1a=this.overNode;if(!_18){_1a&&(dojo.removeClass(_1a,_19));this.overNode=null;return;}if(dojo.hasClass(_18,_19)||_1a==_18){return;}_1a&&(dojo.removeClass(_1a,_19));dojo.addClass(_18,_19);this.overNode=_18;}});}